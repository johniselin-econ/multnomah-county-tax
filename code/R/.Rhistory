name = "CTC per Child ($)",
labels = scales::dollar_format(),
limits = c(0, 1000),
breaks = seq(0, 1000, 200)) +
coord_map("mercator") +
labs(title = "State CTC Supplements as of 2026",
subtitle = "CTC benefit amount in dollars per eligible child",
caption = paste0("Source: ITEP, https://itep.org/state-child-tax-credits-2025/", fig2_notes)) +
theme_void() +
theme(
plot.background = element_rect(fill = "white", color = NA),
panel.background = element_rect(fill = "white", color = NA),
plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
plot.subtitle = element_text(size = 12, hjust = 0.5, margin = margin(t = 5, b = 10)),
plot.caption = element_text(size = 8, hjust = 0, margin = margin(t = 15)),
legend.position = "right",
legend.title = element_text(size = 10),
legend.text = element_text(size = 9),
plot.margin = margin(20, 20, 20, 20)
)
# Save Figure 2
ggsave(file.path(output_dir, "Figure2_CTC_Map.png"),
plot = fig2, width = 10, height = 8, dpi = 300)
print("Figure 2 saved successfully!")
# ============================================================================
# FIGURE 3: Federal and State EITC/CTC Diagram for Connecticut
# ============================================================================
# Simulate 2000 individuals (single filer with 2 qualifying children)
# Earned income from $0 to $199,900 in $100 increments
sim_data <- data.frame(
earned_income = seq(0, 199900, by = 100)
)
# Function to calculate Federal EITC (2025 parameters for single filer with 2 children)
# 2025 EITC parameters (estimated):
# Phase-in rate: 40%
# Maximum credit: ~$6,960
# Phase-out threshold: ~$21,560
# Phase-out end: ~$55,768
# Phase-out rate: 21.06%
calculate_federal_eitc <- function(earned_income, num_children = 2) {
# 2025 EITC parameters for single filer with 2 qualifying children
phase_in_rate <- 0.40
max_credit <- 6960
phase_out_start <- 21560
phase_out_rate <- 0.2106
# Calculate phase-in amount
phase_in_credit <- earned_income * phase_in_rate
# Calculate phase-out amount
if (earned_income > phase_out_start) {
phase_out_reduction <- (earned_income - phase_out_start) * phase_out_rate
} else {
phase_out_reduction <- 0
}
# Final credit is minimum of phase-in and (max - phase-out), but not less than 0
credit <- pmin(phase_in_credit, max_credit - phase_out_reduction)
credit <- pmax(credit, 0)
return(credit)
}
# Function to calculate Federal CTC (refundable portion - ACTC)
# 2025 parameters: $2,000 per child, refundable up to $1,700 per child
# Refundable portion phases in at 15% of earned income above $2,500
calculate_federal_ctc_refundable <- function(earned_income, num_children = 2) {
# 2025 CTC parameters
ctc_per_child <- 2000
refundable_max_per_child <- 1700  # ACTC limit
phase_in_threshold <- 2500
phase_in_rate <- 0.15
# Maximum refundable amount
max_refundable <- refundable_max_per_child * num_children
# Calculate refundable amount based on earned income
if (earned_income <= phase_in_threshold) {
refundable <- 0
} else {
refundable <- (earned_income - phase_in_threshold) * phase_in_rate
}
# Cap at maximum refundable amount
refundable <- pmin(refundable, max_refundable)
return(refundable)
}
# Function to calculate Connecticut State EITC (40% of federal EITC)
calculate_ct_eitc <- function(federal_eitc) {
return(federal_eitc * 0.40)
}
# Apply calculations to simulated data
sim_data <- sim_data %>%
mutate(
federal_eitc = sapply(earned_income, calculate_federal_eitc),
federal_ctc_refundable = sapply(earned_income, calculate_federal_ctc_refundable),
state_eitc = calculate_ct_eitc(federal_eitc),
total = federal_eitc + federal_ctc_refundable + state_eitc
)
# Reshape data for plotting
library(tidyr)
sim_long <- sim_data %>%
pivot_longer(
cols = c(federal_eitc, federal_ctc_refundable, state_eitc, total),
names_to = "credit_type",
values_to = "credit_amount"
) %>%
mutate(
credit_type = case_when(
credit_type == "federal_eitc" ~ "Federal EITC",
credit_type == "federal_ctc_refundable" ~ "Federal CTC (Refundable)",
credit_type == "state_eitc" ~ "CT State EITC",
credit_type == "total" ~ "Total (All Credits)"
),
credit_type = factor(credit_type, levels = c("Federal EITC", "Federal CTC (Refundable)",
"CT State EITC", "Total (All Credits)")),
# Replace zeros with NA (except at earned_income = 0) so line doesn't show
credit_amount = ifelse(credit_amount == 0 & earned_income > 0, NA, credit_amount)
)
# Create Figure 3
fig3 <- ggplot(sim_long, aes(x = earned_income, y = credit_amount, color = credit_type)) +
geom_line(linewidth = 1.2, na.rm = TRUE) +
scale_x_continuous(
name = "Earned Income",
labels = scales::dollar_format(),
breaks = seq(0, 200000, by = 25000),
limits = c(0, 200000)
) +
scale_y_continuous(
name = "Credit Amount",
labels = scales::dollar_format(),
breaks = seq(0, 14000, by = 2000),
limits = c(0, 14000)
) +
scale_color_manual(
name = "Credit Type",
values = c("Federal EITC" = "#1f77b4",
"Federal CTC (Refundable)" = "#ff7f0e",
"CT State EITC" = "#2ca02c",
"Total (All Credits)" = "#d62728")
) +
labs(
title = "Federal and State EITC and CTC for Connecticut (2025)",
subtitle = "Single filer with 2 qualifying children",
caption = "Note: Federal CTC shows refundable portion only (ACTC). Simulated for 2,000 income levels."
) +
theme_minimal() +
theme(
plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
plot.subtitle = element_text(size = 12, hjust = 0.5, margin = margin(t = 5, b = 10)),
plot.caption = element_text(size = 9, hjust = 0, margin = margin(t = 15)),
legend.position = "bottom",
legend.title = element_text(size = 11),
legend.text = element_text(size = 10),
axis.title = element_text(size = 11),
axis.text = element_text(size = 10),
panel.grid.minor = element_blank(),
plot.margin = margin(20, 20, 20, 20)
)
# Save Figure 3
ggsave(file.path(output_dir, "Figure3_CT_Credits.png"),
plot = fig3, width = 12, height = 8, dpi = 300)
print("Figure 3 saved successfully!")
# ============================================================================
# Display all figures
# ============================================================================
print(fig1)
print(fig2)
print(fig3)
print("All three figures have been created and saved!")
# ============================================================================
# R Script to Generate Three Figures for CTCTC Presentation
# Created: January 2026
# ============================================================================
# Load required packages
library(readxl)
library(ggplot2)
library(dplyr)
library(sf)
library(maps)
library(viridis)
# Set working directory and file paths
# NOTE: OneDrive paths with spaces can cause issues with R's readxl package.
# Solution: Copy data.xlsx to a local path without spaces before running.
# Example: Copy data.xlsx to C:/Users/ji252/data_temp.xlsx
data_path <- "C:/Users/ji252/OneDrive - Yale University/External Events/2026_01_21_CTCTC/data.xlsx"
# Output directory - figures will be saved here
output_dir <- "C:/Users/ji252/OneDrive - Yale University/External Events/2026_01_21_CTCTC"
# ============================================================================
# FIGURE 1: State EITC Supplements Map (New England + NY)
# ============================================================================
# Read Fig1 data
fig1_data <- read_excel(data_path, sheet = "Fig1")
fig1_data <- fig1_data[1:7, ]  # Keep only state data rows
# Get US states map data
states_map <- map_data("state")
# Filter for New England + NY
ne_states <- c("connecticut", "maine", "massachusetts", "new hampshire",
"new york", "rhode island", "vermont")
ne_map <- states_map %>% filter(region %in% ne_states)
# Create state name mapping for joining
fig1_data <- fig1_data %>%
mutate(region = tolower(State))
# Join map data with EITC data
ne_map_data <- ne_map %>%
left_join(fig1_data, by = "region")
# Calculate state centroids for labels
state_centers <- ne_map_data %>%
group_by(region, State, EITC) %>%
summarize(
long = mean(range(long)),
lat = mean(range(lat)),
.groups = "drop"
) %>%
mutate(
label = paste0(State, "\n(", scales::percent(EITC, accuracy = 1), ")"),
# Store original centroid for connector lines
long_orig = long,
lat_orig = lat,
# Move Rhode Island label to the right
long = ifelse(region == "rhode island", long + 2.5, long),
lat = ifelse(region == "rhode island", lat - 0.3, lat),
# Move Massachusetts label to the right
long = ifelse(region == "massachusetts", long + 2.8, long),
lat = ifelse(region == "massachusetts", lat - 0.2, lat),
# Move New Hampshire down
lat = ifelse(region == "new hampshire", lat - 0.8, lat),
# Move Vermont label up
long = ifelse(region == "vermont", long, long),
lat = ifelse(region == "vermont", lat + 2, lat)
)
# Connector line data for offset states
ri_center <- state_centers %>% filter(region == "rhode island")
ma_center <- state_centers %>% filter(region == "massachusetts")
vt_center <- state_centers %>% filter(region == "vermont")
connector_lines <- data.frame(
x = c(ri_center$long_orig, ma_center$long_orig, vt_center$long_orig),
xend = c(ri_center$long - 0.3, ma_center$long - 0.3, vt_center$long),
y = c(ri_center$lat_orig, ma_center$lat_orig, vt_center$lat_orig),
yend = c(ri_center$lat + 0.2, ma_center$lat + 0.2, vt_center$lat - 0.4)
)
# Notes for Figure 1
fig1_notes <- "Notes: Maine offers 50% of the federal EITC for workers without kids. NYC offers a local EITC that matches 10-30% of the federal EITC.\nVermont offers 100% of the federal EITC for workers without kids."
# States with offset labels (right-aligned: RI, MA; center-aligned: VT)
offset_right_states <- c("rhode island", "massachusetts")
offset_up_states <- c("vermont")
# Create Figure 1
fig1 <- ggplot(ne_map_data, aes(x = long, y = lat, group = group, fill = EITC)) +
geom_polygon(color = "gray40", linewidth = 0.5) +
# Add connector lines for offset states
geom_segment(data = connector_lines, aes(x = x, y = y, xend = xend, yend = yend),
color = "gray30", linewidth = 0.5, inherit.aes = FALSE) +
# Labels for states without offset
geom_text(data = state_centers %>% filter(!region %in% c(offset_right_states, offset_up_states)),
aes(x = long, y = lat, label = label, group = NULL),
size = 3, fontface = "bold", color = "black") +
# Labels for states offset to the right (RI, MA)
geom_text(data = state_centers %>% filter(region %in% offset_right_states),
aes(x = long, y = lat, label = label, group = NULL),
size = 3, fontface = "bold", color = "black", hjust = 0) +
# Labels for states offset up (VT)
geom_text(data = state_centers %>% filter(region %in% offset_up_states),
aes(x = long, y = lat, label = label, group = NULL),
size = 3, fontface = "bold", color = "black", vjust = 1) +
scale_fill_gradient(low = "#f7fbff", high = "#08519c",
name = "% of Federal EITC",
labels = scales::percent_format(accuracy = 1),
limits = c(0, 0.5),
breaks = seq(0, 0.5, 0.1)) +
coord_map("mercator") +
labs(title = "State EITC Supplements as of 2026",
subtitle = "Refundable tax credit as a percent of the federal EITC",
caption = paste0("Source: ITEP, https://itep.org/state-earned-income-tax-credits-support-families/\n", fig1_notes)) +
theme_void() +
theme(
plot.background = element_rect(fill = "white", color = NA),
panel.background = element_rect(fill = "white", color = NA),
plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
plot.subtitle = element_text(size = 12, hjust = 0.5, margin = margin(t = 5, b = 10)),
plot.caption = element_text(size = 8, hjust = 0, margin = margin(t = 15)),
legend.position = "right",
legend.title = element_text(size = 10),
legend.text = element_text(size = 9),
plot.margin = margin(20, 20, 20, 20)
)
# Save Figure 1
ggsave(file.path(output_dir, "Figure1_EITC_Map.png"),
plot = fig1, width = 10, height = 8, dpi = 500)
print("Figure 1 saved successfully!")
# ============================================================================
# FIGURE 2: State CTC Supplements Map (New England + NY)
# ============================================================================
# Read Fig2 data
fig2_data <- read_excel(data_path, sheet = "Fig2")
fig2_data <- fig2_data[1:7, ]  # Keep only state data rows
names(fig2_data)[2] <- "CTC"  # Rename for easier handling
# Create state name mapping for joining
fig2_data <- fig2_data %>%
mutate(region = tolower(State))
# Join map data with CTC data
ne_map_data2 <- ne_map %>%
left_join(fig2_data, by = "region")
# Calculate state centroids for labels
state_centers2 <- ne_map_data2 %>%
group_by(region, State, CTC) %>%
summarize(
long = mean(range(long)),
lat = mean(range(lat)),
.groups = "drop"
) %>%
mutate(
label = paste0(State, "\n(", scales::dollar(CTC, accuracy = 1), ")"),
# Store original centroid for connector lines
long_orig = long,
lat_orig = lat,
# Move Rhode Island label to the right
long = ifelse(region == "rhode island", long + 2.5, long),
lat = ifelse(region == "rhode island", lat - 0.3, lat),
# Move Massachusetts label to the right
long = ifelse(region == "massachusetts", long + 2.8, long),
lat = ifelse(region == "massachusetts", lat - 0.2, lat),
# Move New Hampshire down
lat = ifelse(region == "new hampshire", lat - 0.8, lat),
# Move Vermont label up
long = ifelse(region == "vermont", long, long),
lat = ifelse(region == "vermont", lat + 1.8, lat)
)
# Connector line data for offset states (Figure 2)
ri_center2 <- state_centers2 %>% filter(region == "rhode island")
ma_center2 <- state_centers2 %>% filter(region == "massachusetts")
vt_center2 <- state_centers2 %>% filter(region == "vermont")
connector_lines2 <- data.frame(
x = c(ri_center2$long_orig, ma_center2$long_orig, vt_center2$long_orig),
xend = c(ri_center2$long - 0.3, ma_center2$long - 0.3, vt_center2$long),
y = c(ri_center2$lat_orig, ma_center2$lat_orig, vt_center2$lat_orig),
yend = c(ri_center2$lat + 0.2, ma_center2$lat + 0.2, vt_center2$lat - 0.4)
)
# Notes for Figure 2
fig2_notes <- "Notes: Maine offers $315 per child under 17, doubled for children under 6. Massachusetts offers $440 per child under 13, and \nfor disabled adults and the elderly. New York offers $500 per child aged 4-17, and $1,000 per child under 4. Vermont offers $1,000 per child under 7."
# Create Figure 2
fig2 <- ggplot(ne_map_data2, aes(x = long, y = lat, group = group, fill = CTC)) +
geom_polygon(color = "gray40", linewidth = 0.5) +
# Add connector lines for offset states
geom_segment(data = connector_lines2, aes(x = x, y = y, xend = xend, yend = yend),
color = "gray30", linewidth = 0.5, inherit.aes = FALSE) +
# Labels for states without offset
geom_text(data = state_centers2 %>% filter(!region %in% c("rhode island", "massachusetts", "vermont")),
aes(x = long, y = lat, label = label, group = NULL),
size = 3, fontface = "bold", color = "black") +
# Labels for states offset to the right (RI, MA)
geom_text(data = state_centers2 %>% filter(region %in% c("rhode island", "massachusetts")),
aes(x = long, y = lat, label = label, group = NULL),
size = 3, fontface = "bold", color = "black", hjust = 0) +
# Labels for states offset up (VT)
geom_text(data = state_centers2 %>% filter(region == "vermont"),
aes(x = long, y = lat, label = label, group = NULL),
size = 3, fontface = "bold", color = "black", vjust = 1) +
scale_fill_gradient(low = "#f7fcf5", high = "#238b45",
name = "CTC per Child ($)",
labels = scales::dollar_format(),
limits = c(0, 1000),
breaks = seq(0, 1000, 200)) +
coord_map("mercator") +
labs(title = "State CTC Supplements as of 2026",
subtitle = "CTC benefit amount in dollars per eligible child",
caption = paste0("Source: ITEP, https://itep.org/state-child-tax-credits-2025/", fig2_notes)) +
theme_void() +
theme(
plot.background = element_rect(fill = "white", color = NA),
panel.background = element_rect(fill = "white", color = NA),
plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
plot.subtitle = element_text(size = 12, hjust = 0.5, margin = margin(t = 5, b = 10)),
plot.caption = element_text(size = 8, hjust = 0, margin = margin(t = 15)),
legend.position = "right",
legend.title = element_text(size = 10),
legend.text = element_text(size = 9),
plot.margin = margin(20, 20, 20, 20)
)
# Save Figure 2
ggsave(file.path(output_dir, "Figure2_CTC_Map.png"),
plot = fig2, width = 10, height = 8, dpi = 300)
print("Figure 2 saved successfully!")
# ============================================================================
# FIGURE 3: Federal and State EITC/CTC Diagram for Connecticut
# ============================================================================
# Simulate 2000 individuals (single filer with 2 qualifying children)
# Earned income from $0 to $199,900 in $100 increments
sim_data <- data.frame(
earned_income = seq(0, 199900, by = 100)
)
# Function to calculate Federal EITC (2025 parameters for single filer with 2 children)
# 2025 EITC parameters (estimated):
# Phase-in rate: 40%
# Maximum credit: ~$6,960
# Phase-out threshold: ~$21,560
# Phase-out end: ~$55,768
# Phase-out rate: 21.06%
calculate_federal_eitc <- function(earned_income, num_children = 2) {
# 2025 EITC parameters for single filer with 2 qualifying children
phase_in_rate <- 0.40
max_credit <- 6960
phase_out_start <- 21560
phase_out_rate <- 0.2106
# Calculate phase-in amount
phase_in_credit <- earned_income * phase_in_rate
# Calculate phase-out amount
if (earned_income > phase_out_start) {
phase_out_reduction <- (earned_income - phase_out_start) * phase_out_rate
} else {
phase_out_reduction <- 0
}
# Final credit is minimum of phase-in and (max - phase-out), but not less than 0
credit <- pmin(phase_in_credit, max_credit - phase_out_reduction)
credit <- pmax(credit, 0)
return(credit)
}
# Function to calculate Federal CTC (refundable portion - ACTC)
# 2025 parameters: $2,000 per child, refundable up to $1,700 per child
# Refundable portion phases in at 15% of earned income above $2,500
calculate_federal_ctc_refundable <- function(earned_income, num_children = 2) {
# 2025 CTC parameters
ctc_per_child <- 2000
refundable_max_per_child <- 1700  # ACTC limit
phase_in_threshold <- 2500
phase_in_rate <- 0.15
# Maximum refundable amount
max_refundable <- refundable_max_per_child * num_children
# Calculate refundable amount based on earned income
if (earned_income <= phase_in_threshold) {
refundable <- 0
} else {
refundable <- (earned_income - phase_in_threshold) * phase_in_rate
}
# Cap at maximum refundable amount
refundable <- pmin(refundable, max_refundable)
return(refundable)
}
# Function to calculate Connecticut State EITC (40% of federal EITC)
calculate_ct_eitc <- function(federal_eitc) {
return(federal_eitc * 0.40)
}
# Apply calculations to simulated data
sim_data <- sim_data %>%
mutate(
federal_eitc = sapply(earned_income, calculate_federal_eitc),
federal_ctc_refundable = sapply(earned_income, calculate_federal_ctc_refundable),
state_eitc = calculate_ct_eitc(federal_eitc),
total = federal_eitc + federal_ctc_refundable + state_eitc
)
# Reshape data for plotting
library(tidyr)
sim_long <- sim_data %>%
pivot_longer(
cols = c(federal_eitc, federal_ctc_refundable, state_eitc, total),
names_to = "credit_type",
values_to = "credit_amount"
) %>%
mutate(
credit_type = case_when(
credit_type == "federal_eitc" ~ "Federal EITC",
credit_type == "federal_ctc_refundable" ~ "Federal CTC (Refundable)",
credit_type == "state_eitc" ~ "CT State EITC",
credit_type == "total" ~ "Total (All Credits)"
),
credit_type = factor(credit_type, levels = c("Federal EITC", "Federal CTC (Refundable)",
"CT State EITC", "Total (All Credits)")),
# Replace zeros with NA (except at earned_income = 0) so line doesn't show
credit_amount = ifelse(credit_amount == 0 & earned_income > 0, NA, credit_amount)
)
# Create Figure 3
fig3 <- ggplot(sim_long, aes(x = earned_income, y = credit_amount, color = credit_type)) +
geom_line(linewidth = 1.2, na.rm = TRUE) +
scale_x_continuous(
name = "Earned Income",
labels = scales::dollar_format(),
breaks = seq(0, 200000, by = 25000),
limits = c(0, 200000)
) +
scale_y_continuous(
name = "Credit Amount",
labels = scales::dollar_format(),
breaks = seq(0, 14000, by = 2000),
limits = c(0, 14000)
) +
scale_color_manual(
name = "Credit Type",
values = c("Federal EITC" = "#1f77b4",
"Federal CTC (Refundable)" = "#ff7f0e",
"CT State EITC" = "#2ca02c",
"Total (All Credits)" = "#d62728")
) +
labs(
title = "Federal and State EITC and CTC for Connecticut (2025)",
subtitle = "Single filer with 2 qualifying children",
caption = "Note: Federal CTC shows refundable portion only (ACTC). Simulated for 2,000 income levels."
) +
theme_minimal() +
theme(
plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
plot.subtitle = element_text(size = 12, hjust = 0.5, margin = margin(t = 5, b = 10)),
plot.caption = element_text(size = 9, hjust = 0, margin = margin(t = 15)),
legend.position = "bottom",
legend.title = element_text(size = 11),
legend.text = element_text(size = 10),
axis.title = element_text(size = 11),
axis.text = element_text(size = 10),
panel.grid.minor = element_blank(),
plot.margin = margin(20, 20, 20, 20)
)
# Save Figure 3
ggsave(file.path(output_dir, "Figure3_CT_Credits.png"),
plot = fig3, width = 12, height = 8, dpi = 300)
print("Figure 3 saved successfully!")
# ============================================================================
# Display all figures
# ============================================================================
print(fig1)
print(fig2)
print(fig3)
print("All three figures have been created and saved!")
