---------------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_did_2026-02-05.log
  log type:  text
 opened on:   5 Feb 2026, 22:29:53

. 
. 
. ********************************************************************************
. ** LOAD AND PREPARE DATA
. ********************************************************************************
. 
. ** Load ACS migration data
. use "${data}working/acs_migration_file", replace

. 
. ** Sample restrictions
. drop if year == 2015                                    // Sample: 2016-2024
(2,334,973 observations deleted)

. drop if qmigplc1 == 4                                   // Error in migration place
(401,283 observations deleted)

. drop if inlist(state_fips_o, 2, 15)     // Alaska and Hawaii
(137,699 observations deleted)

. drop if inlist(state_fips_d, 2, 15)     // Alaska and Hawaii
(3,633 observations deleted)

. 
. ********************************************************************************
. ** DEFINE SAMPLES AND TREATMENT
. ********************************************************************************
. 
. ** Multnomah county indicators
. gen multnomah_o = (state_fips_o == 41 & county_fips_o == 51)

. gen multnomah_d = (state_fips_d == 41 & county_fips_d == 51)

. 
. ** Analysis samples
. gen sample_1 = (multnomah_o == 1) & year != 2020    // Multnomah in origin (out-migration)

. gen sample_2 = (multnomah_o != 1) &                             ///
>                                 year != 2020 &                                          /// Not Multnom
> ah in origin
>                            inlist(state_fips_o, 6, 41, 53)      // CA, OR, WA (in-migration)

. gen sample_3 = (multnomah_o != 1) &                             /// Not Multnomah in origin
>                                 year != 2020                                            // 

. 
. label var sample_1 "Out-migration Sample"

. label var sample_2 "In-migration Sample (West Coast)"

. label var sample_3 "In-migration Sample (Lower 48 + DC)"

. 
. ** Outcome variables (scaled to percentages)
. gen out_1 = (same_county == 0) * 100

. label var out_1 "Moved out of Multnomah (%)"

. 
. gen out_2 = (multnomah_d == 1) * 100

. label var out_2 "Moved to Multnomah (%)"

. 
. ** Treatment variables
. gen post = year > 2020

. label var post "Post-2020"

. 
. gen high_ed = educd >= 101

. label var high_ed "College Degree"

. 
. gen treated = high_ed * post

. label var treated "College Degree × Post"

. 
. ********************************************************************************
. ** COVARIATE CATEGORIES
. ********************************************************************************
. 
. ** Age categories
. recode age ///
>     (18/24   = 1 "18-24") ///
>     (25/44   = 2 "25-44") ///
>     (45/64   = 3 "45-64") ///
>     (65/max  = 4 "65+"), ///
>     gen(cat_age)
(21,137,449 differences between age and cat_age)

. label var cat_age "Age categories"

. 
. ** Sex
. gen cat_sex = (sex == 2)

. label var cat_sex "Female indicator"

. label define lb_cat_sex 0 "Male" 1 "Female", replace

. label values cat_sex lb_cat_sex

. 
. ** Marital status
. recode marst ///
>     (1       = 1 "Married") ///
>     (2/3     = 2 "Separated") ///
>     (4/5     = 3 "Divorced / Widowed") ///
>     (6       = 4 "Single"), ///
>     gen(cat_married)
(9,179,293 differences between marst and cat_married)

. label var cat_married "Marriage categories"

. 
. ** Number of children
. recode nchild ///
>     (0       = 0 "0 Children") ///
>     (1       = 1 "1 Child") ///
>     (2       = 2 "2 Children") ///
>     (3/max   = 3 "3+ Children"), ///
>     gen(cat_child)
(412,696 differences between nchild and cat_child)

. label var cat_child "Number of Children"

. 
. ** Age of youngest child
. recode yngch ///
>     (99      = 0 "No Children") ///
>     (0/4     = 1 "0-4") ///
>     (5/12    = 2 "5-12") ///
>     (13/17   = 3 "13-17")       ///
>         (18/max  = 4 "18+"), ///
>     gen(cat_yngch)
(20,719,194 differences between yngch and cat_yngch)

. label var cat_yngch "Age of youngest child"

. 
. ** Education categories
. recode educd ///
>     (min/61  = 1 "Less than HS") ///
>     (62/71   = 2 "HS Diploma") ///
>     (80/100  = 3 "Some College") ///
>     (101/max = 4 "College Degree"), ///
>     gen(cat_educ)
(21,137,449 differences between educd and cat_educ)

. label var cat_educ "Education categories"

. 
. ********************************************************************************
. ** REGRESSION 1: DIFFERENCE-IN-DIFFERENCES
. ********************************************************************************
. 
. ** Store estimates for coefficient plot
. estimates clear

. 
. ** Out-migration regression (Sample 1: Multnomah residents)
. reghdfe out_1 treated if sample_1 == 1 [pw = perwt],    ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     47,139
Absorbing 7 HDFE groups                           F(   1,  47114) =       4.51
                                                  Prob > F        =     0.0338
                                                  R-squared       =     0.0201
                                                  Adj R-squared   =     0.0196
                                                  Within R-sq.    =     0.0002
                                                  Root MSE        =    23.7528

------------------------------------------------------------------------------
             |               Robust
       out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |   1.232005   .5804414     2.12   0.034     .0943319    2.369679
       _cons |    5.83538   .1934965    30.16   0.000     5.456124    6.214636
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store did_out

. 
. ** In-migration regression (Sample 2: CA/OR/WA residents)
. reghdfe out_2 treated if sample_2 == 1 [pw = perwt],    ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  2,946,024
Absorbing 8 HDFE groups                           F(   1,     54) =       0.74
Statistics robust to heteroskedasticity           Prob > F        =     0.3926
                                                  R-squared       =     0.0058
                                                  Adj R-squared   =     0.0058
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.5588

                                (Std. err. adjusted for 55 clusters in fips_o)
------------------------------------------------------------------------------
             |               Robust
       out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |  -.0089625   .0103988    -0.86   0.393    -.0298109    .0118858
       _cons |   .0674888   .0018439    36.60   0.000      .063792    .0711857
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_in_west

. 
. ** In-migration regression (Sample 3: Lower 48 + DC residents)
. reghdfe out_2 treated if sample_3 == 1 [pw = perwt],    ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 19,190,525
Absorbing 8 HDFE groups                           F(   1,    527) =       2.60
Statistics robust to heteroskedasticity           Prob > F        =     0.1072
                                                  R-squared       =     0.0040
                                                  Adj R-squared   =     0.0040
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.2246

                               (Std. err. adjusted for 528 clusters in fips_o)
------------------------------------------------------------------------------
             |               Robust
       out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |  -.0033242   .0020603    -1.61   0.107    -.0073716    .0007232
       _cons |   .0156366   .0003574    43.76   0.000     .0149346    .0163386
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_in_48

. 
. ********************************************************************************
. ** TABLE: DiD RESULTS
. ********************************************************************************
. 
. esttab did_out did_in_west did_in_48                                                                   
>  ///
>         using "${results}did/tab_did_overall.tex",                                                     
>  ///
>         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                                                       
>  ///
>         b(%-9.3f) se(%-9.3f) replace                                                                   
>          ///
>         keep(treated)                                                                                  
>                          ///
>         coeflabels(treated  "College Degree $\times$ Post")                             ///
>         mtitle( "Out-migration"                                                                        
>                  ///
>                         "In-migration (West Coast)"                                                    
>          ///
>                         "In-migration (Lower 48 + DC)")                                                
>          ///
>         stats(N, fmt(%12.0fc) labels("Observations"))
(output written to C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/tab_did_overall.tex)

. 
. ********************************************************************************
. ** REGRESSION 2: EVENT STUDY
. ********************************************************************************
. 
. ** Create year × education interactions (base year = 2019, 2020 excluded)
. foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2.         gen x_high_ed_`y' = high_ed * (year == `y')
  3. }

. 
. ** Out-migration event study
. reghdfe out_1 x_high_ed_* if sample_1 == 1 [pw = perwt],        ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     47,139
Absorbing 7 HDFE groups                           F(   7,  47108) =       1.08
                                                  Prob > F        =     0.3730
                                                  R-squared       =     0.0202
                                                  Adj R-squared   =     0.0196
                                                  Within R-sq.    =     0.0003
                                                  Root MSE        =    23.7529

--------------------------------------------------------------------------------
               |               Robust
         out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_high_ed_2016 |   .2157829    1.12025     0.19   0.847    -1.979922    2.411488
x_high_ed_2017 |   1.621033   1.091858     1.48   0.138    -.5190244    3.761091
x_high_ed_2018 |   1.121102   1.042543     1.08   0.282    -.9222971    3.164502
x_high_ed_2021 |   1.763493    1.08754     1.62   0.105     -.368102    3.895088
x_high_ed_2022 |   2.440565   1.261722     1.93   0.053    -.0324276    4.913558
x_high_ed_2023 |   1.844759    1.05149     1.75   0.079    -.2161771    3.905695
x_high_ed_2024 |   1.818619   1.052574     1.73   0.084    -.2444413    3.881679
         _cons |    5.50135    .339634    16.20   0.000     4.835663    6.167037
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store es_out

. 
. ** In-migration event study
. reghdfe out_2 x_high_ed_* if sample_2 == 1 [pw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  2,946,024
Absorbing 8 HDFE groups                           F(   7,     54) =       1.72
Statistics robust to heteroskedasticity           Prob > F        =     0.1249
                                                  R-squared       =     0.0058
                                                  Adj R-squared   =     0.0058
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.5588

                                  (Std. err. adjusted for 55 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_high_ed_2016 |   .0006089   .0176853     0.03   0.973     -.034848    .0360657
x_high_ed_2017 |  -.0112805   .0173832    -0.65   0.519    -.0461316    .0235707
x_high_ed_2018 |   .0218863   .0186693     1.17   0.246    -.0155434    .0593161
x_high_ed_2021 |   .0234131   .0266451     0.88   0.383    -.0300071    .0768334
x_high_ed_2022 |  -.0022492   .0138437    -0.16   0.872    -.0300041    .0255057
x_high_ed_2023 |  -.0201526   .0249975    -0.81   0.424    -.0702697    .0299644
x_high_ed_2024 |  -.0243619   .0235203    -1.04   0.305    -.0715172    .0227935
         _cons |   .0665584   .0047197    14.10   0.000     .0570961    .0760207
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_in_west

. 
. ** In-migration event study
. reghdfe out_2 x_high_ed_* if sample_3 == 1 [pw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 19,190,525
Absorbing 8 HDFE groups                           F(   7,    527) =       1.08
Statistics robust to heteroskedasticity           Prob > F        =     0.3732
                                                  R-squared       =     0.0040
                                                  Adj R-squared   =     0.0040
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.2246

                                 (Std. err. adjusted for 528 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_high_ed_2016 |  -.0004553    .003629    -0.13   0.900    -.0075843    .0066738
x_high_ed_2017 |  -.0019644   .0034234    -0.57   0.566    -.0086895    .0047608
x_high_ed_2018 |   .0029225   .0038388     0.76   0.447    -.0046187    .0104638
x_high_ed_2021 |   .0001685   .0049201     0.03   0.973     -.009497     .009834
x_high_ed_2022 |   8.89e-07   .0031913     0.00   1.000    -.0062684    .0062702
x_high_ed_2023 |  -.0060519   .0047712    -1.27   0.205    -.0154248    .0033209
x_high_ed_2024 |  -.0066425   .0044517    -1.49   0.136    -.0153878    .0021027
         _cons |   .0155965   .0008911    17.50   0.000      .013846    .0173471
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_in_48

. 
. ********************************************************************************
. ** EVENT STUDY PLOTS
. ********************************************************************************
. 
. ** Extract coefficients and create event study dataset
. preserve

.         clear

.         set obs 9
Number of observations (_N) was 0, now 9.

.         gen year = 2015 + _n

. 
.         ** Out-migration coefficients
.         gen out_coef = .
(9 missing values generated)

.         gen out_ci_lo = .
(9 missing values generated)

.         gen out_ci_hi = .
(9 missing values generated)

. 
.         ** In-migration coefficients
.         gen in_west_coef = .
(9 missing values generated)

.         gen in_west_ci_lo = .
(9 missing values generated)

.         gen in_west_ci_hi = .
(9 missing values generated)

.         
.         ** In-migration coefficients
.         gen in_48_coef = .
(9 missing values generated)

.         gen in_48_ci_lo = .
(9 missing values generated)

.         gen in_48_ci_hi = .
(9 missing values generated)

. 
.         ** Fill in coefficients (2020 = base year = 0)
.         foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2. 
.                 ** Out-migration
.                 estimates restore es_out
  3.                 capture {
  4.                         replace out_coef = _b[x_high_ed_`y'] if year == `y'
  5.                         replace out_ci_lo = _b[x_high_ed_`y'] - 1.96 * _se[x_high_ed_`y'] if year ==
>  `y'
  6.                         replace out_ci_hi = _b[x_high_ed_`y'] + 1.96 * _se[x_high_ed_`y'] if year ==
>  `y'
  7.                 }
  8. 
.                 ** In-migration
.                 estimates restore es_in_west
  9.                 capture {
 10.                         replace in_west_coef = _b[x_high_ed_`y'] if year == `y'
 11.                         replace in_west_ci_lo = _b[x_high_ed_`y'] - 1.96 * _se[x_high_ed_`y'] if yea
> r == `y'
 12.                         replace in_west_ci_hi = _b[x_high_ed_`y'] + 1.96 * _se[x_high_ed_`y'] if yea
> r == `y'
 13.                 }
 14.                 
.                 ** In-migration
.                 estimates restore es_in_48
 15.                 capture {
 16.                         replace in_48_coef = _b[x_high_ed_`y'] if year == `y'
 17.                         replace in_48_ci_lo = _b[x_high_ed_`y'] - 1.96 * _se[x_high_ed_`y'] if year 
> == `y'
 18.                         replace in_48_ci_hi = _b[x_high_ed_`y'] + 1.96 * _se[x_high_ed_`y'] if year 
> == `y'
 19.                 }
 20.                 
.         }
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)

. 
.         ** Base year (2019) = 0; 2020 excluded (no coefficient)
.         foreach v in out_coef out_ci_lo out_ci_hi in_west_coef in_west_ci_lo in_west_ci_hi in_48_coef i
> n_48_ci_lo in_48_ci_hi {
  2.                 replace `v' = 0 if year == 2019
  3.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
.         ** Offset years slightly for visibility
.         gen year_out = year - 0.15

.         gen year_in_west = year

.         gen year_in_48 = year + 0.15

. 
.         ** Plot 1: Out-migration event study
.         twoway  (rcap out_ci_lo out_ci_hi year, lc(navy))                               ///
>                         (scatter out_coef year, mc(navy) ms(O)),                ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>  ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>  ///
>                 xlabel(2016(1)2024)                                                                    
>          ///
>                 ytitle("Effect on Out-Migration (pp)")                                          ///
>                 xtitle("Year")                                                                         
>                  ///
>                 legend(off)                                                                            
>                  ///
>                 title("Out-Migration from Multnomah County")                            ///
>                 subtitle("College Degree vs. No College Degree")                        ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_out_migration.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_out_migration.png saved as
    PNG format

. 
.         ** Plot 2: In-migration event study (West Coast)
.         twoway  (rcap in_west_ci_lo in_west_ci_hi year, lc(maroon))     ///
>                         (scatter in_west_coef year, mc(maroon) ms(O)),  ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>  ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>  ///
>                 xlabel(2016(1)2024)                                                                    
>          ///
>                 ytitle("Effect on In-Migration (pp)")                                           ///
>                 xtitle("Year")                                                                         
>                  ///
>                 legend(off)                                                                            
>                  ///
>                 title("In-Migration to Multnomah County (West Coast)")          ///
>                 subtitle("College Degree vs. No College Degree")                        ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_in_migration_west.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_in_migration_west.png
    saved as PNG format

. 
.         ** Plot 3: In-migration event study (Lower 48 + DC)
.         twoway  (rcap in_48_ci_lo in_48_ci_hi year, lc(forest_green))   ///
>                         (scatter in_48_coef year, mc(forest_green) ms(O)),      ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>  ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>  ///
>                 xlabel(2016(1)2024)                                                                    
>          ///
>                 ytitle("Effect on In-Migration (pp)")                                           ///
>                 xtitle("Year")                                                                         
>                  ///
>                 legend(off)                                                                            
>                  ///
>                 title("In-Migration to Multnomah County (Lower 48 + DC)")       ///
>                 subtitle("College Degree vs. No College Degree")                        ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_in_migration_48.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_in_migration_48.png saved
    as PNG format

. 
.         ** Plot 4: Combined event study
.         twoway  (rcap out_ci_lo out_ci_hi year_out, lc(navy))                                   ///
>                         (scatter out_coef year_out, mc(navy) ms(O))                     ///
>                         (rcap in_west_ci_lo in_west_ci_hi year_in_west, lc(maroon))     ///
>                         (scatter in_west_coef year_in_west, mc(maroon) ms(T))   ///
>                         (rcap in_48_ci_lo in_48_ci_hi year_in_48, lc(forest_green))     ///
>                         (scatter in_48_coef year_in_48, mc(forest_green) ms(S)),        ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>                  ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>                  ///
>                 xlabel(2016(1)2024)                                                                    
>                          ///
>                 ytitle("Effect on Migration Rate (pp)")                                                
>          ///
>                 xtitle("Year")                                                                         
>                                  ///
>                 legend(order(2 "Out-migration" 4 "In-migration (West Coast)"            ///
>                         6 "In-migration (Lower 48 + DC)") pos(6) rows(1))                              
>  ///
>                 title("Migration Effects: Multnomah County Tax")                                       
>  ///
>                 subtitle("College Degree vs. No College Degree")                                       
>  ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_combined.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_combined.png saved as PNG
    format

. 
. restore

. 
. ********************************************************************************
. ** REGRESSION 3: DIFFERENCE-IN-DIFFERENCES BY AGE
. ********************************************************************************
. 
. ** Create age × treatment interactions
. gen treated_age_1 = treated * (cat_age == 1)

. gen treated_age_2 = treated * (cat_age == 2)

. gen treated_age_3 = treated * (cat_age == 3)

. gen treated_age_4 = treated * (cat_age == 4)

. 
. label var treated_age_1 "College x Post x Age 18-24"

. label var treated_age_2 "College x Post x Age 25-44"

. label var treated_age_3 "College x Post x Age 45-64"

. label var treated_age_4 "College x Post x Age 65+"

. 
. ** Store estimates
. estimates clear

. 
. ** Out-migration regression by age (Sample 1: Multnomah residents)
. reghdfe out_1 treated_age_* if sample_1 == 1 [pw = perwt],      ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     47,139
Absorbing 7 HDFE groups                           F(   4,  47111) =       2.56
                                                  Prob > F        =     0.0364
                                                  R-squared       =     0.0203
                                                  Adj R-squared   =     0.0198
                                                  Within R-sq.    =     0.0004
                                                  Root MSE        =    23.7507

-------------------------------------------------------------------------------
              |               Robust
        out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
treated_age_1 |   4.206692   2.667201     1.58   0.115     -1.02106    9.434443
treated_age_2 |     1.5351   .7605364     2.02   0.044     .0444374    3.025762
treated_age_3 |   1.276167   .6951838     1.84   0.066    -.0864033    2.638737
treated_age_4 |  -.2597344    .667996    -0.39   0.697    -1.569016    1.049547
        _cons |   5.835584   .1934643    30.16   0.000     5.456391    6.214777
-------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store did_age_out

. 
. ** In-migration regression by age (Sample 2: CA/OR/WA residents)
. reghdfe out_2 treated_age_* if sample_2 == 1 [pw = perwt],      ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  2,946,024
Absorbing 8 HDFE groups                           F(   4,     54) =       1.48
Statistics robust to heteroskedasticity           Prob > F        =     0.2203
                                                  R-squared       =     0.0058
                                                  Adj R-squared   =     0.0058
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.5588

                                 (Std. err. adjusted for 55 clusters in fips_o)
-------------------------------------------------------------------------------
              |               Robust
        out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
treated_age_1 |   .1764101   .0915686     1.93   0.059    -.0071739    .3599941
treated_age_2 |   .0038349   .0160875     0.24   0.812    -.0284187    .0360884
treated_age_3 |  -.0294809   .0171489    -1.72   0.091    -.0638623    .0049005
treated_age_4 |  -.0376184   .0165849    -2.27   0.027    -.0708692   -.0043677
        _cons |   .0674534   .0018332    36.80   0.000     .0637781    .0711288
-------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_age_in_west

. 
. ** In-migration regression by age (Sample 3: Lower 48 + DC residents)
. reghdfe out_2 treated_age_* if sample_3 == 1 [pw = perwt],      ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 19,190,525
Absorbing 8 HDFE groups                           F(   4,    527) =       3.38
Statistics robust to heteroskedasticity           Prob > F        =     0.0096
                                                  R-squared       =     0.0041
                                                  Adj R-squared   =     0.0040
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.2246

                                (Std. err. adjusted for 528 clusters in fips_o)
-------------------------------------------------------------------------------
              |               Robust
        out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
treated_age_1 |   .0275705   .0127281     2.17   0.031     .0025664    .0525746
treated_age_2 |   .0017701   .0031459     0.56   0.574    -.0044099    .0079501
treated_age_3 |  -.0092488    .002831    -3.27   0.001    -.0148103   -.0036873
treated_age_4 |  -.0103184    .003239    -3.19   0.002    -.0166814   -.0039554
        _cons |   .0156321   .0003585    43.60   0.000     .0149278    .0163364
-------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_age_in_48

. 
. ********************************************************************************
. ** TABLE: DiD BY AGE
. ********************************************************************************
. 
. esttab did_age_out did_age_in_west did_age_in_48                                                ///
>         using "${results}did/tab_did_by_age.tex",                                                      
>  ///
>         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                                                       
>  ///
>         b(%-9.3f) se(%-9.3f) replace                                                                   
>          ///
>         keep(treated_age_*)                                                                            
>                  ///
>         order(treated_age_1 treated_age_2 treated_age_3 treated_age_4)          ///
>         coeflabels(     treated_age_1  "College $\times$ Post $\times$ Age 18-24"       ///
>                                 treated_age_2  "College $\times$ Post $\times$ Age 25-44"       ///
>                                 treated_age_3  "College $\times$ Post $\times$ Age 45-64"       ///
>                                 treated_age_4  "College $\times$ Post $\times$ Age 65+")        ///
>         mtitle( "Out-migration"                                                                        
>                  ///
>                         "In-migration (West Coast)"                                                    
>          ///
>                         "In-migration (Lower 48 + DC)")                                                
>          ///
>         stats(N, fmt(%12.0fc) labels("Observations"))
(output written to C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/tab_did_by_age.tex)

. 
. ********************************************************************************
. ** REGRESSION 4: EVENT STUDY BY AGE
. ********************************************************************************
. 
. ** Create year × education × age interactions (base year = 2019, 2020 excluded)
. foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2.         forvalues a = 1/4 {
  3.                 gen x_he_`y'_age`a' = high_ed * (year == `y') * (cat_age == `a')
  4.         }
  5. }

. 
. ** Out-migration event study by age
. reghdfe out_1 x_he_*_age* if sample_1 == 1 [pw = perwt],        ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     47,139
Absorbing 7 HDFE groups                           F(  28,  47087) =       1.55
                                                  Prob > F        =     0.0313
                                                  R-squared       =     0.0214
                                                  Adj R-squared   =     0.0204
                                                  Within R-sq.    =     0.0015
                                                  Root MSE        =    23.7435

--------------------------------------------------------------------------------
               |               Robust
         out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_he_2016_age1 |   9.590886   5.242235     1.83   0.067    -.6839692    19.86574
x_he_2016_age2 |   .4381895   1.422232     0.31   0.758    -2.349406    3.225785
x_he_2016_age3 |  -.5692084   1.258638    -0.45   0.651    -3.036157     1.89774
x_he_2016_age4 |  -.8129739   1.286826    -0.63   0.528    -3.335172    1.709224
x_he_2017_age1 |   5.924555   5.221217     1.13   0.257    -4.309105    16.15821
x_he_2017_age2 |   .9300908   1.309948     0.71   0.478    -1.637427    3.497609
x_he_2017_age3 |   2.057912   1.501669     1.37   0.171    -.8853803    5.001204
x_he_2017_age4 |   2.255588   1.450483     1.56   0.120    -.5873803    5.098556
x_he_2018_age1 |   10.05077   5.779527     1.74   0.082    -1.277186    21.37873
x_he_2018_age2 |   2.180571    1.33089     1.64   0.101    -.4279922    4.789134
x_he_2018_age3 |    -.64437   1.107386    -0.58   0.561    -2.814862    1.526122
x_he_2018_age4 |  -.4798878   1.137991    -0.42   0.673    -2.710366    1.750591
x_he_2021_age1 |    2.50488   5.012561     0.50   0.617    -7.319811    12.32957
x_he_2021_age2 |   2.734966   1.375891     1.99   0.047     .0382003    5.431731
x_he_2021_age3 |   .9905859   1.285971     0.77   0.441    -1.529936    3.511108
x_he_2021_age4 |   .0541246   1.294038     0.04   0.967    -2.482208    2.590458
x_he_2022_age1 |   6.784287   5.149933     1.32   0.188    -3.309655    16.87823
x_he_2022_age2 |   3.020563    1.77839     1.70   0.089    -.4651071    6.506233
x_he_2022_age3 |   1.048525   1.321265     0.79   0.427    -1.541174    3.638224
x_he_2022_age4 |   2.425017   1.626793     1.49   0.136    -.7635197    5.613554
x_he_2023_age1 |   4.817064   4.881821     0.99   0.324    -4.751375     14.3855
x_he_2023_age2 |   1.554406   1.246417     1.25   0.212    -.8885903    3.997401
x_he_2023_age3 |   3.215491   1.408986     2.28   0.022     .4538574    5.977124
x_he_2023_age4 |  -.4482232   1.154298    -0.39   0.698    -2.710664    1.814218
x_he_2024_age1 |   7.181952   5.364786     1.34   0.181    -3.333106    17.69701
x_he_2024_age2 |   2.035919   1.303867     1.56   0.118    -.5196791    4.591517
x_he_2024_age3 |   2.164931     1.2425     1.74   0.081    -.2703861    4.600249
x_he_2024_age4 |  -.4159041   1.038928    -0.40   0.689    -2.452219    1.620411
         _cons |   5.501312   .3401661    16.17   0.000     4.834581    6.168042
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store es_age_out

. 
. ** In-migration event study by age (West Coast)
. reghdfe out_2 x_he_*_age* if sample_2 == 1 [pw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  2,946,024
Absorbing 8 HDFE groups                           F(  28,     54) =       3.55
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.0059
                                                  Adj R-squared   =     0.0059
                                                  Within R-sq.    =     0.0001
Number of clusters (fips_o)  =         55         Root MSE        =     2.5587

                                  (Std. err. adjusted for 55 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_he_2016_age1 |    .116345   .1022555     1.14   0.260    -.0886649     .321355
x_he_2016_age2 |    .030291   .0248124     1.22   0.227    -.0194548    .0800368
x_he_2016_age3 |   -.025082   .0306522    -0.82   0.417    -.0865361     .036372
x_he_2016_age4 |  -.0438552   .0210292    -2.09   0.042    -.0860162   -.0016942
x_he_2017_age1 |   .2158114   .0921601     2.34   0.023     .0310415    .4005813
x_he_2017_age2 |   .0173834     .01987     0.87   0.386    -.0224535    .0572203
x_he_2017_age3 |  -.0416858   .0196561    -2.12   0.039    -.0810939   -.0022777
x_he_2017_age4 |  -.0659194   .0319865    -2.06   0.044    -.1300485   -.0017902
x_he_2018_age1 |   .2335527    .123407     1.89   0.064    -.0138633    .4809688
x_he_2018_age2 |   .0457768   .0347204     1.32   0.193    -.0238334    .1153869
x_he_2018_age3 |  -.0050265   .0256289    -0.20   0.845    -.0564093    .0463563
x_he_2018_age4 |  -.0252927   .0221179    -1.14   0.258    -.0696364    .0190511
x_he_2021_age1 |   .2469107   .1358977     1.82   0.075    -.0255479    .5193692
x_he_2021_age2 |   .0807291   .0465328     1.73   0.088    -.0125634    .1740217
x_he_2021_age3 |  -.0478946   .0288143    -1.66   0.102    -.1056637    .0098746
x_he_2021_age4 |  -.0250447   .0280395    -0.89   0.376    -.0812605     .031171
x_he_2022_age1 |   .2950717    .188259     1.57   0.123    -.0823649    .6725082
x_he_2022_age2 |   .0033668   .0156115     0.22   0.830    -.0279325    .0346661
x_he_2022_age3 |  -.0111911   .0293769    -0.38   0.705    -.0700882     .047706
x_he_2022_age4 |  -.0562313    .024603    -2.29   0.026    -.1055574   -.0069053
x_he_2023_age1 |   .1208385   .0887001     1.36   0.179    -.0569945    .2986715
x_he_2023_age2 |   -.011558   .0326019    -0.35   0.724    -.0769208    .0538049
x_he_2023_age3 |  -.0376957   .0327808    -1.15   0.255    -.1034172    .0280258
x_he_2023_age4 |  -.0359353   .0324168    -1.11   0.273     -.100927    .0290565
x_he_2024_age1 |   .0966876   .1067939     0.91   0.369    -.1174212    .3107964
x_he_2024_age2 |  -.0218652   .0309696    -0.71   0.483    -.0839555    .0402251
x_he_2024_age3 |  -.0263885   .0257145    -1.03   0.309     -.077943    .0251661
x_he_2024_age4 |  -.0476121   .0282711    -1.68   0.098    -.1042923    .0090681
         _cons |   .0665527   .0046704    14.25   0.000      .057189    .0759164
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_age_in_west

. 
. ** In-migration event study by age (Lower 48 + DC)
. reghdfe out_2 x_he_*_age* if sample_3 == 1 [pw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 19,190,525
Absorbing 8 HDFE groups                           F(  28,    527) =       2.51
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.0041
                                                  Adj R-squared   =     0.0040
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.2246

                                 (Std. err. adjusted for 528 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_he_2016_age1 |   .0181861     .01527     1.19   0.234    -.0118114    .0481837
x_he_2016_age2 |   .0088194   .0052559     1.68   0.094    -.0015056    .0191444
x_he_2016_age3 |  -.0073424   .0053112    -1.38   0.167    -.0177762    .0030913
x_he_2016_age4 |  -.0124549   .0043592    -2.86   0.004    -.0210184   -.0038913
x_he_2017_age1 |    .039433   .0169107     2.33   0.020     .0062123    .0726537
x_he_2017_age2 |   .0083097   .0048349     1.72   0.086    -.0011883    .0178076
x_he_2017_age3 |  -.0113289   .0036127    -3.14   0.002     -.018426   -.0042318
x_he_2017_age4 |   -.016416   .0056923    -2.88   0.004    -.0275984   -.0052337
x_he_2018_age1 |   .0505087   .0221456     2.28   0.023     .0070042    .0940131
x_he_2018_age2 |   .0078117   .0063455     1.23   0.219    -.0046539    .0202773
x_he_2018_age3 |  -.0017967   .0052058    -0.35   0.730    -.0120233    .0084299
x_he_2018_age4 |  -.0097562   .0047554    -2.05   0.041    -.0190982   -.0004143
x_he_2021_age1 |   .0215699    .018647     1.16   0.248    -.0150617    .0582016
x_he_2021_age2 |    .014234    .008882     1.60   0.110    -.0032145    .0316825
x_he_2021_age3 |   -.013449   .0048548    -2.77   0.006    -.0229862   -.0039118
x_he_2021_age4 |  -.0101919   .0048891    -2.08   0.038    -.0197964   -.0005874
x_he_2022_age1 |   .0461065   .0243754     1.89   0.059    -.0017785    .0939914
x_he_2022_age2 |   .0075859   .0045514     1.67   0.096    -.0013552    .0165271
x_he_2022_age3 |    -.00631   .0049506    -1.27   0.203    -.0160354    .0034154
x_he_2022_age4 |  -.0148865   .0043394    -3.43   0.001    -.0234111   -.0063619
x_he_2023_age1 |   .0351077   .0242859     1.45   0.149    -.0126014    .0828168
x_he_2023_age2 |  -.0017451   .0064692    -0.27   0.787    -.0144536    .0109634
x_he_2023_age3 |  -.0129433    .005223    -2.48   0.014    -.0232037   -.0026829
x_he_2023_age4 |   -.011994    .006906    -1.74   0.083    -.0255606    .0015726
x_he_2024_age1 |   .0150043   .0169593     0.88   0.377    -.0183118    .0483204
x_he_2024_age2 |  -.0059065   .0058455    -1.01   0.313    -.0173899    .0055768
x_he_2024_age3 |  -.0081108   .0046358    -1.75   0.081    -.0172177    .0009961
x_he_2024_age4 |  -.0101322   .0062411    -1.62   0.105    -.0223927    .0021282
         _cons |   .0155967   .0008909    17.51   0.000     .0138465    .0173469
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_age_in_48

. 
. ********************************************************************************
. ** EVENT STUDY BY AGE PLOTS
. ********************************************************************************
. 
. 
.         clear

.         set obs 9
Number of observations (_N) was 0, now 9.

.         gen year = 2015 + _n

. 
.         ** Create coefficient variables for each age group and sample
.         forvalues a = 1/4 {
  2.                 foreach s in "out" "in_west" "in_48" {
  3.                         gen `s'_coef_age`a' = .
  4.                         gen `s'_ci_lo_age`a' = .
  5.                         gen `s'_ci_hi_age`a' = .
  6.                 }
  7.         }
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)

. 
.         ** Fill in coefficients
.         foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2.                 forvalues a = 1/4 {
  3. 
.                         ** Out-migration
.                         estimates restore es_age_out
  4.                         capture {
  5.                                 replace out_coef_age`a' = _b[x_he_`y'_age`a'] if year == `y'
  6.                                 replace out_ci_lo_age`a' = _b[x_he_`y'_age`a'] - 1.96 * _se[x_he_`y'
> _age`a'] if year == `y'
  7.                                 replace out_ci_hi_age`a' = _b[x_he_`y'_age`a'] + 1.96 * _se[x_he_`y'
> _age`a'] if year == `y'
  8.                         }
  9. 
.                         ** In-migration (West Coast)
.                         estimates restore es_age_in_west
 10.                         capture {
 11.                                 replace in_west_coef_age`a' = _b[x_he_`y'_age`a'] if year == `y'
 12.                                 replace in_west_ci_lo_age`a' = _b[x_he_`y'_age`a'] - 1.96 * _se[x_he
> _`y'_age`a'] if year == `y'
 13.                                 replace in_west_ci_hi_age`a' = _b[x_he_`y'_age`a'] + 1.96 * _se[x_he
> _`y'_age`a'] if year == `y'
 14.                         }
 15. 
.                         ** In-migration (Lower 48)
.                         estimates restore es_age_in_48
 16.                         capture {
 17.                                 replace in_48_coef_age`a' = _b[x_he_`y'_age`a'] if year == `y'
 18.                                 replace in_48_ci_lo_age`a' = _b[x_he_`y'_age`a'] - 1.96 * _se[x_he_`
> y'_age`a'] if year == `y'
 19.                                 replace in_48_ci_hi_age`a' = _b[x_he_`y'_age`a'] + 1.96 * _se[x_he_`
> y'_age`a'] if year == `y'
 20.                         }
 21. 
.                 }
 22.         }
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)

. 
.         ** Base year (2019) = 0; 2020 excluded (no coefficient)
.         forvalues a = 1/4 {
  2.                 foreach s in "out" "in_west" "in_48" {
  3.                         foreach v in coef ci_lo ci_hi {
  4.                                 replace `s'_`v'_age`a' = 0 if year == 2019
  5.                         }
  6.                 }
  7.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
.         ** Offset years slightly for visibility across age groups
.         gen year_age1 = year - 0.225

.         gen year_age2 = year - 0.075

.         gen year_age3 = year + 0.075

.         gen year_age4 = year + 0.225

. 
.         ** Plot 1: Out-migration event study by age
.         twoway  (rcap out_ci_lo_age1 out_ci_hi_age1 year_age1, lc(navy))                               
>          ///
>                         (scatter out_coef_age1 year_age1, mc(navy) ms(O))                              
>  ///
>                         (rcap out_ci_lo_age2 out_ci_hi_age2 year_age2, lc(maroon))                     
>          ///
>                         (scatter out_coef_age2 year_age2, mc(maroon) ms(T))                     ///
>                         (rcap out_ci_lo_age3 out_ci_hi_age3 year_age3, lc(forest_green))               
>          ///
>                         (scatter out_coef_age3 year_age3, mc(forest_green) ms(S)) ///
>                         (rcap out_ci_lo_age4 out_ci_hi_age4 year_age4, lc(dkorange))                   
>          ///
>                         (scatter out_coef_age4 year_age4, mc(dkorange) ms(D)),          ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>                                          ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>                                          ///
>                 xlabel(2016(1)2024)                                                                    
>                                                  ///
>                 ytitle("Effect on Out-Migration (pp)")                                                 
>                                  ///
>                 xtitle("Year")                                                                         
>                                                          ///
>                 legend(order(2 "18-24" 4 "25-44" 6 "45-64" 8 "65+") pos(6) rows(1))                    
>  ///
>                 title("Out-Migration from Multnomah County by Age")                                    
>                          ///
>                 subtitle("College Degree vs. No College Degree")                                       
>                          ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_age_out_migration.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_age_out_migration.png
    saved as PNG format

. 
.         ** Plot 2: In-migration (West Coast) event study by age
.         twoway  (rcap in_west_ci_lo_age1 in_west_ci_hi_age1 year_age1, lc(navy))                       
>  ///
>                         (scatter in_west_coef_age1 year_age1, mc(navy)  ms(O))                  ///
>                         (rcap in_west_ci_lo_age2 in_west_ci_hi_age2 year_age2, lc(maroon))             
>  ///
>                         (scatter in_west_coef_age2 year_age2, mc(maroon) ms(T))                 ///
>                         (rcap in_west_ci_lo_age3 in_west_ci_hi_age3 year_age3, lc(forest_green))       
>  ///
>                         (scatter in_west_coef_age3 year_age3, mc(forest_green) ms(S)) ///
>                         (rcap in_west_ci_lo_age4 in_west_ci_hi_age4 year_age4, lc(dkorange))           
>  ///
>                         (scatter in_west_coef_age4 year_age4, mc(dkorange) ms(D)),      ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>                                          ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>                                          ///
>                 xlabel(2016(1)2024)                                                                    
>                                                  ///
>                 ytitle("Effect on In-Migration (pp)")                                                  
>                                  ///
>                 xtitle("Year")                                                                         
>                                                          ///
>                 legend(order(2 "18-24" 4 "25-44" 6 "45-64" 8 "65+") pos(6) rows(1))                    
>  ///
>                 title("In-Migration to Multnomah (West Coast) by Age")                                 
>                  ///
>                 subtitle("College Degree vs. No College Degree")                                       
>                          ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_age_in_migration_west.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_age_in_migration_west.png
    saved as PNG format

. 
.         ** Plot 3: In-migration (Lower 48 + DC) event study by age
.         twoway  (rcap in_48_ci_lo_age1 in_48_ci_hi_age1 year_age1, lc(navy))                           
>  ///
>                         (scatter in_48_coef_age1 year_age1, mc(navy) ms(O))                     ///
>                         (rcap in_48_ci_lo_age2 in_48_ci_hi_age2 year_age2, lc(maroon))                 
>  ///
>                         (scatter in_48_coef_age2 year_age2, mc(maroon) ms(T))           ///
>                         (rcap in_48_ci_lo_age3 in_48_ci_hi_age3 year_age3, lc(forest_green))           
>  ///
>                         (scatter in_48_coef_age3 year_age3, mc(forest_green) ms(S)) ///
>                         (rcap in_48_ci_lo_age4 in_48_ci_hi_age4 year_age4, lc(dkorange))               
>          ///
>                         (scatter in_48_coef_age4 year_age4, mc(dkorange) ms(D)),        ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>                                          ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>                                          ///
>                 xlabel(2016(1)2024)                                                                    
>                                                  ///
>                 ytitle("Effect on In-Migration (pp)")                                                  
>                                  ///
>                 xtitle("Year")                                                                         
>                                                          ///
>                 legend(order(2 "18-24" 4 "25-44" 6 "45-64" 8 "65+") pos(6) rows(1))                    
>  ///
>                 title("In-Migration to Multnomah (Lower 48 + DC) by Age")                              
>                  ///
>                 subtitle("College Degree vs. No College Degree")                                       
>                          ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_age_in_migration_48.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_age_in_migration_48.png
    saved as PNG format

. 
. 
. ********************************************************************************
. ** CLEANUP
. ********************************************************************************
. 
. ** Close log
. clear

. log close log_02
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_did_2026-02-05.log
  log type:  text
 closed on:   5 Feb 2026, 23:32:00
---------------------------------------------------------------------------------------------------------
