----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_did_2026-02-10.log
  log type:  text
 opened on:  11 Feb 2026, 01:28:55

. 
. 
. ********************************************************************************
. ** LOAD AND PREPARE DATA
. ********************************************************************************
. 
. ** Load ACS migration data
. use "${data}working/acs_migration_file", replace

. 
. ** Sample restrictions
. drop if year == 2015                                    // Sample: 2016-2024
(2,334,973 observations deleted)

. drop if qmigplc1 == 4                                   // Error in migration place
(401,283 observations deleted)

. drop if inlist(state_fips_o, 2, 15)     // Alaska and Hawaii
(137,699 observations deleted)

. drop if inlist(state_fips_d, 2, 15)     // Alaska and Hawaii
(3,633 observations deleted)

. drop if age < 25                                                // Dropping under 25
(1,814,112 observations deleted)

. drop if ftotinc < 0                                     // Negative Family Income       
(7,054 observations deleted)

. 
. ********************************************************************************
. ** DEFINE SAMPLES AND TREATMENT
. ********************************************************************************
. 
. ** Multnomah county indicators
. gen multnomah_o = (state_fips_o == 41 & county_fips_o == 51)

. gen multnomah_d = (state_fips_d == 41 & county_fips_d == 51)

. 
. ** Analysis samples
. gen sample_1 = (multnomah_o == 1) & year != 2020    // Multnomah in origin (out-migration)

. gen sample_2 = (multnomah_o != 1) &                             ///
>                                 year != 2020 &                                          /// Not Multnomah in origin
>                            inlist(state_fips_o, 6, 41, 53)      // CA, OR, WA (in-migration)

. gen sample_3 = (multnomah_o != 1) &                             /// Not Multnomah in origin
>                                 year != 2020                                            // 

. 
. label var sample_1 "Out-migration Sample"

. label var sample_2 "In-migration Sample (West Coast)"

. label var sample_3 "In-migration Sample (Lower 48 + DC)"

. 
. ** Outcome variables (scaled to percentages)
. gen out_1 = (same_county == 0) * 100

. label var out_1 "Moved out of Multnomah (%)"

. 
. gen out_2 = (multnomah_d == 1) * 100

. label var out_2 "Moved to Multnomah (%)"

. 
. gen out_3 = (state_fips_o != state_fips_d) * 100

. label var out_3 "Moved out of Oregon (%)"

. 
. ** Treatment variables
. gen post = year > 2020

. label var post "Post-2020"

. 
. gen high_ed = educd >= 101

. label var high_ed "College Degree"

. 
. gen treated = high_ed * post

. label var treated "College Degree × Post"

. 
. ********************************************************************************
. ** COVARIATE CATEGORIES
. ********************************************************************************
. 
. ** Age categories
. recode age ///
>     (25/44   = 1 "25-44") ///
>     (45/64   = 2 "45-64") ///
>     (65/max  = 3 "65+"), ///
>     gen(cat_age)
(19,316,283 differences between age and cat_age)

. label var cat_age "Age categories"

. 
. ** Sex
. gen cat_sex = (sex == 2)

. label var cat_sex "Female indicator"

. label define lb_cat_sex 0 "Male" 1 "Female", replace

. label values cat_sex lb_cat_sex

. 
. ** Marital status
. recode marst ///
>     (1       = 1 "Married") ///
>     (2/3     = 2 "Separated") ///
>     (4/5     = 3 "Divorced / Widowed") ///
>     (6       = 4 "Single"), ///
>     gen(cat_married)
(7,510,801 differences between marst and cat_married)

. label var cat_married "Marriage categories"

. 
. ** Number of children
. recode nchild ///
>     (0       = 0 "0 Children") ///
>     (1       = 1 "1 Child") ///
>     (2       = 2 "2 Children") ///
>     (3/max   = 3 "3+ Children"), ///
>     gen(cat_child)
(410,461 differences between nchild and cat_child)

. label var cat_child "Number of Children"

. 
. ** Age of youngest child
. recode yngch ///
>     (99      = 0 "No Children") ///
>     (0/4     = 1 "0-4") ///
>     (5/12    = 2 "5-12") ///
>     (13/17   = 3 "13-17")       ///
>         (18/max  = 4 "18+"), ///
>     gen(cat_yngch)
(18,931,365 differences between yngch and cat_yngch)

. label var cat_yngch "Age of youngest child"

. 
. ** Education categories
. recode educd ///
>     (min/61  = 1 "Less than HS") ///
>     (62/71   = 2 "HS Diploma") ///
>     (80/100  = 3 "Some College") ///
>     (101/max = 4 "College Degree"), ///
>     gen(cat_educ)
(19,316,283 differences between educd and cat_educ)

. label var cat_educ "Education categories"

. 
. ********************************************************************************
. ** REGRESSION 1: DIFFERENCE-IN-DIFFERENCES
. ********************************************************************************
. 
. ** Store estimates for coefficient plot
. estimates clear

. 
. ** Out-migration regression (Sample 1: Multnomah residents)
. reghdfe out_1 treated if sample_1 == 1 [pw = perwt],    ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     43,700
Absorbing 7 HDFE groups                           F(   1,  43676) =      10.80
                                                  Prob > F        =     0.0010
                                                  R-squared       =     0.0176
                                                  Adj R-squared   =     0.0171
                                                  Within R-sq.    =     0.0004
                                                  Root MSE        =    22.8530

------------------------------------------------------------------------------
             |               Robust
       out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |    1.87921   .5719049     3.29   0.001     .7582661    3.000154
       _cons |   5.154435   .1897731    27.16   0.000     4.782476    5.526394
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. qui count if e(sample)

. estadd scalar N_unwtd = r(N)

added scalar:
            e(N_unwtd) =  43700

. estimates store did_out

. 
. ** In-migration regression (Sample 2: CA/OR/WA residents)
. reghdfe out_2 treated if sample_2 == 1 [pw = perwt],    ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  2,671,879
Absorbing 8 HDFE groups                           F(   1,     54) =       0.36
Statistics robust to heteroskedasticity           Prob > F        =     0.5516
                                                  R-squared       =     0.0057
                                                  Adj R-squared   =     0.0057
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.4386

                                (Std. err. adjusted for 55 clusters in fips_o)
------------------------------------------------------------------------------
             |               Robust
       out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |  -.0059234   .0098863    -0.60   0.552    -.0257441    .0138974
       _cons |   .0609758   .0018896    32.27   0.000     .0571874    .0647642
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. qui count if e(sample)

. estadd scalar N_unwtd = r(N)

added scalar:
            e(N_unwtd) =  2671879

. estimates store did_in_west

. 
. ** In-migration regression (Sample 3: Lower 48 + DC residents)
. reghdfe out_2 treated if sample_3 == 1 [pw = perwt],    ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 17,535,332
Absorbing 8 HDFE groups                           F(   1,    527) =       1.96
Statistics robust to heteroskedasticity           Prob > F        =     0.1624
                                                  R-squared       =     0.0040
                                                  Adj R-squared   =     0.0039
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.1658

                               (Std. err. adjusted for 528 clusters in fips_o)
------------------------------------------------------------------------------
             |               Robust
       out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |  -.0027702   .0019803    -1.40   0.162    -.0066605      .00112
       _cons |    .014161   .0003675    38.53   0.000      .013439     .014883
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. qui count if e(sample)

. estadd scalar N_unwtd = r(N)

added scalar:
            e(N_unwtd) =  17535332

. estimates store did_in_48

. 
. ** Out-of-state migration regression (Sample 1: Multnomah residents)
. reghdfe out_3 treated if sample_1 == 1 [pw = perwt],    ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     43,700
Absorbing 7 HDFE groups                           F(   1,  43676) =       9.12
                                                  Prob > F        =     0.0025
                                                  R-squared       =     0.0124
                                                  Adj R-squared   =     0.0118
                                                  Within R-sq.    =     0.0004
                                                  Root MSE        =    17.2846

------------------------------------------------------------------------------
             |               Robust
       out_3 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |   1.336162   .4425255     3.02   0.003     .4688043     2.20352
       _cons |   2.782316   .1417274    19.63   0.000     2.504528    3.060105
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. qui count if e(sample)

. estadd scalar N_unwtd = r(N)

added scalar:
            e(N_unwtd) =  43700

. estimates store did_out_state

. 
. ********************************************************************************
. ** TABLE: DiD RESULTS
. ********************************************************************************
. 
. esttab did_out did_out_state did_in_west did_in_48                                              ///
>         using "${results}did/tab_did_overall.tex",                                                      ///
>         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                                                        ///
>         b(%-9.3f) se(%-9.3f) replace                                                                            ///
>         keep(treated)                                                                                                           ///
>         coeflabels(treated  "College Degree $\times$ Post")                             ///
>         mtitle( "Out-migration"                                                                                         ///
>                         "Out-of-state"                                                                                          ///
>                         "In-migration (West Coast)"                                                             ///
>                         "In-migration (Lower 48 + DC)")                                                         ///
>         stats(N_unwtd, fmt(%12.0fc) labels("Observations"))
(output written to C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/tab_did_overall.tex)

. 
. ********************************************************************************
. ** REGRESSION 2: EVENT STUDY
. ********************************************************************************
. 
. ** Create year × education interactions (base year = 2019, 2020 excluded)
. foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2.         gen x_high_ed_`y' = high_ed * (year == `y')
  3. }

. 
. ** Out-migration event study
. reghdfe out_1 x_high_ed_* if sample_1 == 1 [pw = perwt],        ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     43,700
Absorbing 7 HDFE groups                           F(   7,  43670) =       2.16
                                                  Prob > F        =     0.0345
                                                  R-squared       =     0.0177
                                                  Adj R-squared   =     0.0171
                                                  Within R-sq.    =     0.0005
                                                  Root MSE        =    22.8532

--------------------------------------------------------------------------------
               |               Robust
         out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_high_ed_2016 |   .0111546   1.096317     0.01   0.992    -2.137646    2.159956
x_high_ed_2017 |   1.612263   1.062038     1.52   0.129    -.4693515    3.693878
x_high_ed_2018 |   .9835067   1.004267     0.98   0.327    -.9848755    2.951889
x_high_ed_2021 |   2.236601   1.051952     2.13   0.033     .1747565    4.298445
x_high_ed_2022 |   2.877864   1.237786     2.33   0.020     .4517803    5.303948
x_high_ed_2023 |   2.477298   .9783823     2.53   0.011     .5596508    4.394945
x_high_ed_2024 |   2.529116   .9572056     2.64   0.008     .6529754    4.405256
         _cons |   4.841722   .3271145    14.80   0.000     4.200571    5.482872
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store es_out

. 
. ** In-migration event study
. reghdfe out_2 x_high_ed_* if sample_2 == 1 [pw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  2,671,879
Absorbing 8 HDFE groups                           F(   7,     54) =       1.60
Statistics robust to heteroskedasticity           Prob > F        =     0.1562
                                                  R-squared       =     0.0057
                                                  Adj R-squared   =     0.0057
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.4386

                                  (Std. err. adjusted for 55 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_high_ed_2016 |   .0081211   .0199764     0.41   0.686    -.0319292    .0481714
x_high_ed_2017 |  -.0130854   .0166265    -0.79   0.435    -.0464195    .0202487
x_high_ed_2018 |    .024363   .0189363     1.29   0.204     -.013602    .0623279
x_high_ed_2021 |   .0294417   .0252506     1.17   0.249    -.0211826    .0800661
x_high_ed_2022 |  -.0041697    .017745    -0.23   0.815    -.0397463     .031407
x_high_ed_2023 |  -.0175256   .0238206    -0.74   0.465     -.065283    .0302318
x_high_ed_2024 |  -.0113086    .022593    -0.50   0.619    -.0566048    .0339877
         _cons |   .0592554   .0052014    11.39   0.000     .0488272    .0696835
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_in_west

. 
. ** In-migration event study
. reghdfe out_2 x_high_ed_* if sample_3 == 1 [pw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 17,535,332
Absorbing 8 HDFE groups                           F(   7,    527) =       1.16
Statistics robust to heteroskedasticity           Prob > F        =     0.3263
                                                  R-squared       =     0.0040
                                                  Adj R-squared   =     0.0039
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.1658

                                 (Std. err. adjusted for 528 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_high_ed_2016 |   .0007498   .0039623     0.19   0.850    -.0070342    .0085337
x_high_ed_2017 |  -.0031063   .0033683    -0.92   0.357    -.0097232    .0035107
x_high_ed_2018 |   .0025704   .0038514     0.67   0.505    -.0049956    .0101363
x_high_ed_2021 |   .0014856   .0047718     0.31   0.756    -.0078886    .0108597
x_high_ed_2022 |  -.0009981   .0036541    -0.27   0.785    -.0081764    .0061802
x_high_ed_2023 |  -.0058045    .004544    -1.28   0.202    -.0147312    .0031222
x_high_ed_2024 |  -.0053443    .004367    -1.22   0.222    -.0139231    .0032345
         _cons |   .0141468   .0009804    14.43   0.000     .0122207    .0160728
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_in_48

. 
. ** Out-of-state migration event study
. reghdfe out_3 x_high_ed_* if sample_1 == 1 [pw = perwt],        ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     43,700
Absorbing 7 HDFE groups                           F(   7,  43670) =       1.65
                                                  Prob > F        =     0.1173
                                                  R-squared       =     0.0125
                                                  Adj R-squared   =     0.0119
                                                  Within R-sq.    =     0.0006
                                                  Root MSE        =    17.2842

--------------------------------------------------------------------------------
               |               Robust
         out_3 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_high_ed_2016 |   .3908869   .7863394     0.50   0.619    -1.150353    1.932126
x_high_ed_2017 |   -.104465     .83409    -0.13   0.900    -1.739297    1.530367
x_high_ed_2018 |   .0619677   .7419937     0.08   0.933    -1.392353    1.516289
x_high_ed_2021 |   .6481993   .8224614     0.79   0.431    -.9638402    2.260239
x_high_ed_2022 |   2.400929   .9828922     2.44   0.015     .4744427    4.327416
x_high_ed_2023 |   1.302751   .7438215     1.75   0.080    -.1551531    2.760655
x_high_ed_2024 |   1.337775   .7407058     1.81   0.071    -.1140222    2.789572
         _cons |   2.741633   .2481168    11.05   0.000     2.255319    3.227946
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store es_out_state

. 
. ********************************************************************************
. ** EVENT STUDY PLOTS
. ********************************************************************************
. 
. ** Extract coefficients and create event study dataset
. preserve

.         clear

.         set obs 9
Number of observations (_N) was 0, now 9.

.         gen year = 2015 + _n

. 
.         ** Out-migration coefficients
.         gen out_coef = .
(9 missing values generated)

.         gen out_ci_lo = .
(9 missing values generated)

.         gen out_ci_hi = .
(9 missing values generated)

. 
.         ** In-migration coefficients
.         gen in_west_coef = .
(9 missing values generated)

.         gen in_west_ci_lo = .
(9 missing values generated)

.         gen in_west_ci_hi = .
(9 missing values generated)

.         
.         ** In-migration coefficients
.         gen in_48_coef = .
(9 missing values generated)

.         gen in_48_ci_lo = .
(9 missing values generated)

.         gen in_48_ci_hi = .
(9 missing values generated)

. 
.         ** Out-of-state migration coefficients
.         gen out_state_coef = .
(9 missing values generated)

.         gen out_state_ci_lo = .
(9 missing values generated)

.         gen out_state_ci_hi = .
(9 missing values generated)

. 
.         ** Fill in coefficients (2020 = base year = 0)
.         foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2. 
.                 ** Out-migration
.                 estimates restore es_out
  3.                 capture {
  4.                         replace out_coef = _b[x_high_ed_`y'] if year == `y'
  5.                         replace out_ci_lo = _b[x_high_ed_`y'] - 1.96 * _se[x_high_ed_`y'] if year == `y'
  6.                         replace out_ci_hi = _b[x_high_ed_`y'] + 1.96 * _se[x_high_ed_`y'] if year == `y'
  7.                 }
  8. 
.                 ** In-migration
.                 estimates restore es_in_west
  9.                 capture {
 10.                         replace in_west_coef = _b[x_high_ed_`y'] if year == `y'
 11.                         replace in_west_ci_lo = _b[x_high_ed_`y'] - 1.96 * _se[x_high_ed_`y'] if year == `y'
 12.                         replace in_west_ci_hi = _b[x_high_ed_`y'] + 1.96 * _se[x_high_ed_`y'] if year == `y'
 13.                 }
 14.                 
.                 ** In-migration
.                 estimates restore es_in_48
 15.                 capture {
 16.                         replace in_48_coef = _b[x_high_ed_`y'] if year == `y'
 17.                         replace in_48_ci_lo = _b[x_high_ed_`y'] - 1.96 * _se[x_high_ed_`y'] if year == `y'
 18.                         replace in_48_ci_hi = _b[x_high_ed_`y'] + 1.96 * _se[x_high_ed_`y'] if year == `y'
 19.                 }
 20. 
.                 ** Out-of-state migration
.                 estimates restore es_out_state
 21.                 capture {
 22.                         replace out_state_coef = _b[x_high_ed_`y'] if year == `y'
 23.                         replace out_state_ci_lo = _b[x_high_ed_`y'] - 1.96 * _se[x_high_ed_`y'] if year == `y'
 24.                         replace out_state_ci_hi = _b[x_high_ed_`y'] + 1.96 * _se[x_high_ed_`y'] if year == `y'
 25.                 }
 26. 
.         }
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out_state are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out_state are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out_state are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out_state are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out_state are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out_state are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out_state are active now)

. 
.         ** Base year (2019) = 0; 2020 excluded (no coefficient)
.         foreach v in out_coef out_ci_lo out_ci_hi in_west_coef in_west_ci_lo in_west_ci_hi in_48_coef in_48_ci_lo in_48_ci_hi out_state_coef out_state_ci_lo out_state_ci_hi {
  2.                 replace `v' = 0 if year == 2019
  3.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
.         ** Offset years slightly for visibility
.         gen year_out = year - 0.2

.         gen year_out_state = year - 0.07

.         gen year_in_west = year + 0.07

.         gen year_in_48 = year + 0.2

. 
.         ** Plot 1: Out-migration event study
.         twoway  (rcap out_ci_lo out_ci_hi year, lc(navy))                               ///
>                         (scatter out_coef year, mc(navy) ms(O)),                ///
>                 yline(0, lc(gs10) lp(dash))                                                             ///
>                 xline(2020.5, lc(black) lp(solid))                                                      ///
>                 xlabel(2016(1)2024)                                                                             ///
>                 ytitle("Effect on Out-Migration (pp)")                                          ///
>                 xtitle("Year")                                                                                          ///
>                 legend(off)                                                                                             ///
>                 title("Out-Migration from Multnomah County")                            ///
>                 subtitle("College Degree vs. No College Degree")                        ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")     ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_out_migration.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_out_migration.png saved as PNG format

.         if ${overleaf} == 1 {
.                 graph export "${ol_fig}fig_es_out_migration.png", replace
file C:/Users/ji252/Dropbox/Apps/Overleaf/Multnomah County/figures/fig_es_out_migration.png saved as PNG format
.         }

. 
.         ** Plot 2: In-migration event study (West Coast)
.         twoway  (rcap in_west_ci_lo in_west_ci_hi year, lc(maroon))     ///
>                         (scatter in_west_coef year, mc(maroon) ms(O)),  ///
>                 yline(0, lc(gs10) lp(dash))                                                             ///
>                 xline(2020.5, lc(black) lp(solid))                                                      ///
>                 xlabel(2016(1)2024)                                                                             ///
>                 ytitle("Effect on In-Migration (pp)")                                           ///
>                 xtitle("Year")                                                                                          ///
>                 legend(off)                                                                                             ///
>                 title("In-Migration to Multnomah County (West Coast)")          ///
>                 subtitle("College Degree vs. No College Degree")                        ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")     ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_in_migration_west.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_in_migration_west.png saved as PNG format

.         if ${overleaf} == 1 {
.                 graph export "${ol_fig}fig_es_in_migration_west.png", replace
file C:/Users/ji252/Dropbox/Apps/Overleaf/Multnomah County/figures/fig_es_in_migration_west.png saved as PNG format
.         }

. 
.         ** Plot 3: In-migration event study (Lower 48 + DC)
.         twoway  (rcap in_48_ci_lo in_48_ci_hi year, lc(forest_green))   ///
>                         (scatter in_48_coef year, mc(forest_green) ms(O)),      ///
>                 yline(0, lc(gs10) lp(dash))                                                             ///
>                 xline(2020.5, lc(black) lp(solid))                                                      ///
>                 xlabel(2016(1)2024)                                                                             ///
>                 ytitle("Effect on In-Migration (pp)")                                           ///
>                 xtitle("Year")                                                                                          ///
>                 legend(off)                                                                                             ///
>                 title("In-Migration to Multnomah County (Lower 48 + DC)")       ///
>                 subtitle("College Degree vs. No College Degree")                        ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")     ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_in_migration_48.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_in_migration_48.png saved as PNG format

.         if ${overleaf} == 1 {
.                 graph export "${ol_fig}fig_es_in_migration_48.png", replace
file C:/Users/ji252/Dropbox/Apps/Overleaf/Multnomah County/figures/fig_es_in_migration_48.png saved as PNG format
.         }

. 
.         ** Plot 4: Out-of-state migration event study
.         twoway  (rcap out_state_ci_lo out_state_ci_hi year, lc(purple))                 ///
>                         (scatter out_state_coef year, mc(purple) ms(D)),                                ///
>                 yline(0, lc(gs10) lp(dash))                                                                             ///
>                 xline(2020.5, lc(black) lp(solid))                                                                      ///
>                 xlabel(2016(1)2024)                                                                                             ///
>                 ytitle("Effect on Out-of-State Migration (pp)")                                         ///
>                 xtitle("Year")                                                                                                          ///
>                 legend(off)                                                                                                             ///
>                 title("Out-of-State Migration from Multnomah County")                           ///
>                 subtitle("College Degree vs. No College Degree")                                        ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")     ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_out_state_migration.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_out_state_migration.png saved as PNG format

.         if ${overleaf} == 1 {
.                 graph export "${ol_fig}fig_es_out_state_migration.png", replace
file C:/Users/ji252/Dropbox/Apps/Overleaf/Multnomah County/figures/fig_es_out_state_migration.png saved as PNG format
.         }

. 
.         ** Plot 5: Combined event study
.         twoway  (rcap out_ci_lo out_ci_hi year_out, lc(navy))                                   ///
>                         (scatter out_coef year_out, mc(navy) ms(O))                     ///
>                         (rcap out_state_ci_lo out_state_ci_hi year_out_state, lc(purple))       ///
>                         (scatter out_state_coef year_out_state, mc(purple) ms(D))       ///
>                         (rcap in_west_ci_lo in_west_ci_hi year_in_west, lc(maroon))     ///
>                         (scatter in_west_coef year_in_west, mc(maroon) ms(T))   ///
>                         (rcap in_48_ci_lo in_48_ci_hi year_in_48, lc(forest_green))     ///
>                         (scatter in_48_coef year_in_48, mc(forest_green) ms(S)),        ///
>                 yline(0, lc(gs10) lp(dash))                                                                             ///
>                 xline(2020.5, lc(black) lp(solid))                                                                      ///
>                 xlabel(2016(1)2024)                                                                                             ///
>                 ytitle("Effect on Migration Rate (pp)")                                                         ///
>                 xtitle("Year")                                                                                                          ///
>                 legend(order(2 "Out-migration" 4 "Out-of-state"                                         ///
>                         6 "In-migration (West Coast)"                                                                   ///
>                         8 "In-migration (Lower 48 + DC)") pos(6) rows(1))                               ///
>                 title("Migration Effects: Multnomah County Tax")                                        ///
>                 subtitle("College Degree vs. No College Degree")                                        ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")     ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_combined.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_combined.png saved as PNG format

.         if ${overleaf} == 1 {
.                 graph export "${ol_fig}fig_es_combined.png", replace
file C:/Users/ji252/Dropbox/Apps/Overleaf/Multnomah County/figures/fig_es_combined.png saved as PNG format
.         }

. 
. restore

. 
. ********************************************************************************
. ** REGRESSION 3: DIFFERENCE-IN-DIFFERENCES BY AGE
. ********************************************************************************
. 
. ** Create age × treatment interactions
. gen treated_age_1 = treated * (cat_age == 1)

. gen treated_age_2 = treated * (cat_age == 2)

. gen treated_age_3 = treated * (cat_age == 3)

. 
. label var treated_age_1 "College x Post x Age 25-44"

. label var treated_age_2 "College x Post x Age 45-64"

. label var treated_age_3 "College x Post x Age 65+"

. 
. ** Store estimates
. estimates clear

. 
. ** Out-migration regression by age (Sample 1: Multnomah residents)
. reghdfe out_1 treated_age_* if sample_1 == 1 [pw = perwt],      ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     43,700
Absorbing 7 HDFE groups                           F(   3,  43674) =       4.72
                                                  Prob > F        =     0.0027
                                                  R-squared       =     0.0178
                                                  Adj R-squared   =     0.0172
                                                  Within R-sq.    =     0.0006
                                                  Root MSE        =    22.8517

-------------------------------------------------------------------------------
              |               Robust
        out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
treated_age_1 |   2.265208    .755182     3.00   0.003     .7850374    3.745378
treated_age_2 |   2.038199   .6907515     2.95   0.003     .6843137    3.392085
treated_age_3 |    .473663   .6616506     0.72   0.474    -.8231843     1.77051
        _cons |   5.153861   .1897256    27.16   0.000     4.781996    5.525727
-------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. qui count if e(sample)

. estadd scalar N_unwtd = r(N)

added scalar:
            e(N_unwtd) =  43700

. estimates store did_age_out

. 
. ** In-migration regression by age (Sample 2: CA/OR/WA residents)
. reghdfe out_2 treated_age_* if sample_2 == 1 [pw = perwt],      ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  2,671,879
Absorbing 8 HDFE groups                           F(   3,     54) =       1.52
Statistics robust to heteroskedasticity           Prob > F        =     0.2205
                                                  R-squared       =     0.0057
                                                  Adj R-squared   =     0.0057
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.4386

                                 (Std. err. adjusted for 55 clusters in fips_o)
-------------------------------------------------------------------------------
              |               Robust
        out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
treated_age_1 |   .0138113   .0159846     0.86   0.391     -.018236    .0458585
treated_age_2 |  -.0185364   .0152836    -1.21   0.230    -.0491783    .0121054
treated_age_3 |  -.0265835   .0143442    -1.85   0.069    -.0553419    .0021749
        _cons |   .0609475   .0018883    32.28   0.000     .0571616    .0647334
-------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. qui count if e(sample)

. estadd scalar N_unwtd = r(N)

added scalar:
            e(N_unwtd) =  2671879

. estimates store did_age_in_west

. 
. ** In-migration regression by age (Sample 3: Lower 48 + DC residents)
. reghdfe out_2 treated_age_* if sample_3 == 1 [pw = perwt],      ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 17,535,332
Absorbing 8 HDFE groups                           F(   3,    527) =       3.39
Statistics robust to heteroskedasticity           Prob > F        =     0.0178
                                                  R-squared       =     0.0040
                                                  Adj R-squared   =     0.0039
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.1658

                                (Std. err. adjusted for 528 clusters in fips_o)
-------------------------------------------------------------------------------
              |               Robust
        out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
treated_age_1 |   .0036081    .003105     1.16   0.246    -.0024916    .0097078
treated_age_2 |  -.0072223   .0026292    -2.75   0.006    -.0123874   -.0020572
treated_age_3 |  -.0081355   .0029817    -2.73   0.007     -.013993    -.002278
        _cons |   .0141567   .0003688    38.39   0.000     .0134322    .0148812
-------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. qui count if e(sample)

. estadd scalar N_unwtd = r(N)

added scalar:
            e(N_unwtd) =  17535332

. estimates store did_age_in_48

. 
. ** Out-of-state migration regression by age (Sample 1: Multnomah residents)
. reghdfe out_3 treated_age_* if sample_1 == 1 [pw = perwt],      ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     43,700
Absorbing 7 HDFE groups                           F(   3,  43674) =       9.37
                                                  Prob > F        =     0.0000
                                                  R-squared       =     0.0128
                                                  Adj R-squared   =     0.0123
                                                  Within R-sq.    =     0.0008
                                                  Root MSE        =    17.2809

-------------------------------------------------------------------------------
              |               Robust
        out_3 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
treated_age_1 |   1.779864   .6103926     2.92   0.004     .5834834    2.976245
treated_age_2 |   1.656235   .5494208     3.01   0.003       .57936     2.73311
treated_age_3 |  -.5268591   .4092551    -1.29   0.198    -1.329007    .2752883
        _cons |    2.78137   .1416907    19.63   0.000     2.503653    3.059086
-------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. qui count if e(sample)

. estadd scalar N_unwtd = r(N)

added scalar:
            e(N_unwtd) =  43700

. estimates store did_age_out_state

. 
. ********************************************************************************
. ** TABLE: DiD BY AGE
. ********************************************************************************
. 
. esttab did_age_out did_age_out_state did_age_in_west did_age_in_48              ///
>         using "${results}did/tab_did_by_age.tex",                                                       ///
>         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                                                        ///
>         b(%-9.3f) se(%-9.3f) replace                                                                            ///
>         keep(treated_age_*)                                                                                             ///
>         order(treated_age_1 treated_age_2 treated_age_3)                                        ///
>         coeflabels(     treated_age_1  "College $\times$ Post $\times$ Age 25-44"       ///
>                                 treated_age_2  "College $\times$ Post $\times$ Age 45-64"       ///
>                                 treated_age_3  "College $\times$ Post $\times$ Age 65+")        ///
>         mtitle( "Out-migration"                                                                                         ///
>                         "Out-of-state"                                                                                          ///
>                         "In-migration (West Coast)"                                                             ///
>                         "In-migration (Lower 48 + DC)")                                                         ///
>         stats(N_unwtd, fmt(%12.0fc) labels("Observations"))
(output written to C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/tab_did_by_age.tex)

. 
. ********************************************************************************
. ** REGRESSION 4: EVENT STUDY BY AGE
. ********************************************************************************
. 
. ** Create year × education × age interactions (base year = 2019, 2020 excluded)
. foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2.         forvalues a = 1/3 {
  3.                 gen x_he_`y'_age`a' = high_ed * (year == `y') * (cat_age == `a')
  4.         }
  5. }

. 
. ** Out-migration event study by age
. reghdfe out_1 x_he_*_age* if sample_1 == 1 [pw = perwt],        ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 7 iterations)

HDFE Linear regression                            Number of obs   =     43,700
Absorbing 7 HDFE groups                           F(  21,  43656) =       1.89
                                                  Prob > F        =     0.0080
                                                  R-squared       =     0.0184
                                                  Adj R-squared   =     0.0175
                                                  Within R-sq.    =     0.0013
                                                  Root MSE        =    22.8486

--------------------------------------------------------------------------------
               |               Robust
         out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_he_2016_age1 |   .5654758   1.407002     0.40   0.688    -2.192274    3.323225
x_he_2016_age2 |  -.4646754   1.236332    -0.38   0.707     -2.88791    1.958559
x_he_2016_age3 |   -.739679   1.266197    -0.58   0.559    -3.221448     1.74209
x_he_2017_age1 |   1.070128   1.285403     0.83   0.405    -1.449285    3.589541
x_he_2017_age2 |   2.187111   1.477376     1.48   0.139    -.7085736    5.082795
x_he_2017_age3 |    2.34649   1.428167     1.64   0.100    -.4527433    5.145724
x_he_2018_age1 |   2.297031   1.304998     1.76   0.078    -.2607899    4.854851
x_he_2018_age2 |  -.5506761   1.073324    -0.51   0.608    -2.654411    1.553059
x_he_2018_age3 |  -.3888978   1.105224    -0.35   0.725    -2.555156    1.777361
x_he_2021_age1 |   3.239788   1.346531     2.41   0.016     .6005636    5.879013
x_he_2021_age2 |    1.51225   1.254731     1.21   0.228    -.9470459    3.971547
x_he_2021_age3 |   .5173142   1.261616     0.41   0.682    -1.955476    2.990105
x_he_2022_age1 |   3.609613     1.7562     2.06   0.040     .1674288    7.051798
x_he_2022_age2 |   1.651577   1.290632     1.28   0.201    -.8780849    4.181238
x_he_2022_age3 |   2.978487    1.59915     1.86   0.063    -.1558756    6.112849
x_he_2023_age1 |   2.302332   1.188666     1.94   0.053    -.0274744    4.632139
x_he_2023_age2 |    3.97115   1.361482     2.92   0.004      1.30262     6.63968
x_he_2023_age3 |   .2711685   1.092291     0.25   0.804    -1.869742    2.412079
x_he_2024_age1 |   2.927704   1.232188     2.38   0.018     .5125931    5.342814
x_he_2024_age2 |   3.058156    1.16764     2.62   0.009     .7695591    5.346752
x_he_2024_age3 |   .4458743   .9505898     0.47   0.639    -1.417299    2.309048
         _cons |   4.837621   .3273582    14.78   0.000     4.195992    5.479249
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store es_age_out

. 
. ** In-migration event study by age (West Coast)
. reghdfe out_2 x_he_*_age* if sample_2 == 1 [pw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  2,671,879
Absorbing 8 HDFE groups                           F(  21,     54) =       4.13
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.0058
                                                  Adj R-squared   =     0.0057
                                                  Within R-sq.    =     0.0001
Number of clusters (fips_o)  =         55         Root MSE        =     2.4385

                                  (Std. err. adjusted for 55 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_he_2016_age1 |   .0421749   .0247268     1.71   0.094    -.0073994    .0917492
x_he_2016_age2 |   -.012331   .0303391    -0.41   0.686    -.0731572    .0484952
x_he_2016_age3 |  -.0312634   .0199959    -1.56   0.124    -.0713527    .0088259
x_he_2017_age1 |   .0242656   .0190252     1.28   0.208    -.0138777    .0624089
x_he_2017_age2 |  -.0343093   .0177475    -1.93   0.058    -.0698908    .0012723
x_he_2017_age3 |  -.0584671    .028811    -2.03   0.047    -.1162296   -.0007046
x_he_2018_age1 |   .0561582   .0346995     1.62   0.111    -.0134101    .1257265
x_he_2018_age2 |    .006481   .0260016     0.25   0.804    -.0456491     .058611
x_he_2018_age3 |  -.0142124   .0200198    -0.71   0.481    -.0543497    .0259248
x_he_2021_age1 |   .0951098    .047103     2.02   0.048      .000674    .1895455
x_he_2021_age2 |  -.0324995   .0249188    -1.30   0.198    -.0824588    .0174597
x_he_2021_age3 |   -.009891   .0249196    -0.40   0.693    -.0598518    .0400699
x_he_2022_age1 |   .0132397    .018503     0.72   0.477    -.0238566     .050336
x_he_2022_age2 |  -.0004084   .0304345    -0.01   0.989    -.0614259    .0606091
x_he_2022_age3 |  -.0454088   .0214991    -2.11   0.039     -.088512   -.0023056
x_he_2023_age1 |  -.0037799   .0326808    -0.12   0.908     -.069301    .0617412
x_he_2023_age2 |   -.028886   .0296214    -0.98   0.334    -.0882733    .0305013
x_he_2023_age3 |  -.0271568   .0308182    -0.88   0.382    -.0889435    .0346299
x_he_2024_age1 |  -.0043577   .0284376    -0.15   0.879    -.0613716    .0526562
x_he_2024_age2 |  -.0079026   .0245824    -0.32   0.749    -.0571872    .0413821
x_he_2024_age3 |  -.0292426    .025533    -1.15   0.257    -.0804333    .0219481
         _cons |   .0592401   .0051705    11.46   0.000     .0488738    .0696064
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_age_in_west

. 
. ** In-migration event study by age (Lower 48 + DC)
. reghdfe out_2 x_he_*_age* if sample_3 == 1 [pw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 17,535,332
Absorbing 8 HDFE groups                           F(  21,    527) =       2.60
Statistics robust to heteroskedasticity           Prob > F        =     0.0001
                                                  R-squared       =     0.0040
                                                  Adj R-squared   =     0.0040
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.1658

                                 (Std. err. adjusted for 528 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_he_2016_age1 |   .0107592   .0052532     2.05   0.041     .0004394    .0210791
x_he_2016_age2 |  -.0052065   .0053178    -0.98   0.328    -.0156533    .0052402
x_he_2016_age3 |  -.0101711   .0042646    -2.39   0.017    -.0185488   -.0017934
x_he_2017_age1 |   .0089671   .0049154     1.82   0.069    -.0006891    .0186232
x_he_2017_age2 |  -.0105508   .0034474    -3.06   0.002    -.0173231   -.0037785
x_he_2017_age3 |  -.0154797   .0052641    -2.94   0.003     -.025821   -.0051385
x_he_2018_age1 |   .0095084    .006351     1.50   0.135    -.0029679    .0219848
x_he_2018_age2 |   .0000986   .0052492     0.02   0.985    -.0102133    .0104105
x_he_2018_age3 |  -.0077424   .0045299    -1.71   0.088    -.0166413    .0011565
x_he_2021_age1 |   .0163991   .0089717     1.83   0.068    -.0012256    .0340238
x_he_2021_age2 |  -.0111084   .0044173    -2.51   0.012    -.0197861   -.0024307
x_he_2021_age3 |  -.0077473   .0045318    -1.71   0.088    -.0166499    .0011553
x_he_2022_age1 |   .0086928    .004765     1.82   0.069     -.000668    .0180536
x_he_2022_age2 |  -.0050524   .0050831    -0.99   0.321    -.0150381    .0049333
x_he_2022_age3 |  -.0135022   .0040139    -3.36   0.001    -.0213875    -.005617
x_he_2023_age1 |    .000257   .0064691     0.04   0.968    -.0124515    .0129654
x_he_2023_age2 |  -.0107436   .0048548    -2.21   0.027    -.0202808   -.0012063
x_he_2023_age3 |  -.0096725   .0067135    -1.44   0.150     -.022861     .003516
x_he_2024_age1 |  -.0037182   .0056401    -0.66   0.510    -.0147982    .0073617
x_he_2024_age2 |  -.0057541   .0044777    -1.29   0.199    -.0145504    .0030422
x_he_2024_age3 |   -.007678   .0059703    -1.29   0.199    -.0194065    .0040505
         _cons |   .0141441   .0009805    14.43   0.000     .0122179    .0160703
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_age_in_48

. 
. ** Out-of-state migration event study by age
. reghdfe out_3 x_he_*_age* if sample_1 == 1 [pw = perwt],        ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 7 iterations)

HDFE Linear regression                            Number of obs   =     43,700
Absorbing 7 HDFE groups                           F(  21,  43656) =       2.40
                                                  Prob > F        =     0.0003
                                                  R-squared       =     0.0136
                                                  Adj R-squared   =     0.0126
                                                  Within R-sq.    =     0.0016
                                                  Root MSE        =    17.2778

--------------------------------------------------------------------------------
               |               Robust
         out_3 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_he_2016_age1 |   .8247441   1.023638     0.81   0.420    -1.181605    2.831094
x_he_2016_age2 |   .1103482   .9434687     0.12   0.907    -1.738868    1.959564
x_he_2016_age3 |  -.3369884   .9186078    -0.37   0.714    -2.137477      1.4635
x_he_2017_age1 |   .1226511   1.021224     0.12   0.904    -1.878967     2.12427
x_he_2017_age2 |  -.0547736   1.198555    -0.05   0.964    -2.403963    2.294415
x_he_2017_age3 |  -.8828364   .8614916    -1.02   0.305    -2.571376    .8057029
x_he_2018_age1 |   .8173409    .976319     0.84   0.403    -1.096262    2.730944
x_he_2018_age2 |  -.7050017   .7946651    -0.89   0.375     -2.26256    .8525565
x_he_2018_age3 |  -.9147078   .7681922    -1.19   0.234    -2.420379    .5909631
x_he_2021_age1 |   1.732888    1.06905     1.62   0.105    -.3624699    3.828247
x_he_2021_age2 |  -.0695909   .9750672    -0.07   0.943     -1.98074    1.841559
x_he_2021_age3 |  -1.323025   .8054941    -1.64   0.100    -2.901808    .2557585
x_he_2022_age1 |   3.489822   1.538601     2.27   0.023      .474136    6.505508
x_he_2022_age2 |   1.597339   .9672462     1.65   0.099    -.2984815    3.493159
x_he_2022_age3 |   .6653446   .8673947     0.77   0.443    -1.034765    2.365454
x_he_2023_age1 |   1.051456   .9393392     1.12   0.263    -.7896665    2.892578
x_he_2023_age2 |   2.999209   1.104547     2.72   0.007     .8342769     5.16414
x_he_2023_age3 |   -1.04621   .6507414    -1.61   0.108    -2.321675    .2292549
x_he_2024_age1 |    1.61121   .9407872     1.71   0.087    -.2327497    3.455171
x_he_2024_age2 |   2.044851   .9759195     2.10   0.036     .1320311    3.957671
x_he_2024_age3 |  -.7007509   .6796308    -1.03   0.303     -2.03284     .631338
         _cons |   2.736044   .2483739    11.02   0.000     2.249226    3.222861
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store es_age_out_state

. 
. ********************************************************************************
. ** EVENT STUDY BY AGE PLOTS
. ********************************************************************************
. 
. 
.         clear

.         set obs 9
Number of observations (_N) was 0, now 9.

.         gen year = 2015 + _n

. 
.         ** Create coefficient variables for each age group and sample
.         forvalues a = 1/3 {
  2.                 foreach s in "out" "out_state" "in_west" "in_48" {
  3.                         gen `s'_coef_age`a' = .
  4.                         gen `s'_ci_lo_age`a' = .
  5.                         gen `s'_ci_hi_age`a' = .
  6.                 }
  7.         }
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)

. 
.         ** Fill in coefficients
.         foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2.                 forvalues a = 1/3 {
  3. 
.                         ** Out-migration
.                         estimates restore es_age_out
  4.                         capture {
  5.                                 replace out_coef_age`a' = _b[x_he_`y'_age`a'] if year == `y'
  6.                                 replace out_ci_lo_age`a' = _b[x_he_`y'_age`a'] - 1.96 * _se[x_he_`y'_age`a'] if year == `y'
  7.                                 replace out_ci_hi_age`a' = _b[x_he_`y'_age`a'] + 1.96 * _se[x_he_`y'_age`a'] if year == `y'
  8.                         }
  9. 
.                         ** Out-of-state migration
.                         estimates restore es_age_out_state
 10.                         capture {
 11.                                 replace out_state_coef_age`a' = _b[x_he_`y'_age`a'] if year == `y'
 12.                                 replace out_state_ci_lo_age`a' = _b[x_he_`y'_age`a'] - 1.96 * _se[x_he_`y'_age`a'] if year == `y'
 13.                                 replace out_state_ci_hi_age`a' = _b[x_he_`y'_age`a'] + 1.96 * _se[x_he_`y'_age`a'] if year == `y'
 14.                         }
 15. 
.                         ** In-migration (West Coast)
.                         estimates restore es_age_in_west
 16.                         capture {
 17.                                 replace in_west_coef_age`a' = _b[x_he_`y'_age`a'] if year == `y'
 18.                                 replace in_west_ci_lo_age`a' = _b[x_he_`y'_age`a'] - 1.96 * _se[x_he_`y'_age`a'] if year == `y'
 19.                                 replace in_west_ci_hi_age`a' = _b[x_he_`y'_age`a'] + 1.96 * _se[x_he_`y'_age`a'] if year == `y'
 20.                         }
 21. 
.                         ** In-migration (Lower 48)
.                         estimates restore es_age_in_48
 22.                         capture {
 23.                                 replace in_48_coef_age`a' = _b[x_he_`y'_age`a'] if year == `y'
 24.                                 replace in_48_ci_lo_age`a' = _b[x_he_`y'_age`a'] - 1.96 * _se[x_he_`y'_age`a'] if year == `y'
 25.                                 replace in_48_ci_hi_age`a' = _b[x_he_`y'_age`a'] + 1.96 * _se[x_he_`y'_age`a'] if year == `y'
 26.                         }
 27. 
.                 }
 28.         }
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_out_state are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)

. 
.         ** Base year (2019) = 0; 2020 excluded (no coefficient)
.         forvalues a = 1/3 {
  2.                 foreach s in "out" "out_state" "in_west" "in_48" {
  3.                         foreach v in coef ci_lo ci_hi {
  4.                                 replace `s'_`v'_age`a' = 0 if year == 2019
  5.                         }
  6.                 }
  7.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
.         ** Offset years slightly for visibility across age groups
.         gen year_age1 = year - 0.15

.         gen year_age2 = year

.         gen year_age3 = year + 0.15

. 
.         ** Plot 1: Out-migration event study by age
.         twoway  (rcap out_ci_lo_age1 out_ci_hi_age1 year_age1, lc(maroon))                              ///
>                         (scatter out_coef_age1 year_age1, mc(maroon) ms(O))                     ///
>                         (rcap out_ci_lo_age2 out_ci_hi_age2 year_age2, lc(forest_green))                        ///
>                         (scatter out_coef_age2 year_age2, mc(forest_green) ms(T))       ///
>                         (rcap out_ci_lo_age3 out_ci_hi_age3 year_age3, lc(dkorange))                            ///
>                         (scatter out_coef_age3 year_age3, mc(dkorange) ms(S)),          ///
>                 yline(0, lc(gs10) lp(dash))                                                                                                     ///
>                 xline(2020.5, lc(black) lp(solid))                                                                                              ///
>                 xlabel(2016(1)2024)                                                                                                                     ///
>                 ytitle("Effect on Out-Migration (pp)")                                                                                  ///
>                 xtitle("Year")                                                                                                                                  ///
>                 legend(order(2 "25-44" 4 "45-64" 6 "65+") pos(6) rows(1))                                               ///
>                 title("Out-Migration from Multnomah County by Age")                                                             ///
>                 subtitle("College Degree vs. No College Degree")                                                                ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")     ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_age_out_migration.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_age_out_migration.png saved as PNG format

.         if ${overleaf} == 1 {
.                 graph export "${ol_fig}fig_es_age_out_migration.png", replace
file C:/Users/ji252/Dropbox/Apps/Overleaf/Multnomah County/figures/fig_es_age_out_migration.png saved as PNG format
.         }

. 
.         ** Plot 2: In-migration (West Coast) event study by age
.         twoway  (rcap in_west_ci_lo_age1 in_west_ci_hi_age1 year_age1, lc(maroon))              ///
>                         (scatter in_west_coef_age1 year_age1, mc(maroon) ms(O))                 ///
>                         (rcap in_west_ci_lo_age2 in_west_ci_hi_age2 year_age2, lc(forest_green))        ///
>                         (scatter in_west_coef_age2 year_age2, mc(forest_green) ms(T)) ///
>                         (rcap in_west_ci_lo_age3 in_west_ci_hi_age3 year_age3, lc(dkorange))            ///
>                         (scatter in_west_coef_age3 year_age3, mc(dkorange) ms(S)),      ///
>                 yline(0, lc(gs10) lp(dash))                                                                                                     ///
>                 xline(2020.5, lc(black) lp(solid))                                                                                              ///
>                 xlabel(2016(1)2024)                                                                                                                     ///
>                 ytitle("Effect on In-Migration (pp)")                                                                                   ///
>                 xtitle("Year")                                                                                                                                  ///
>                 legend(order(2 "25-44" 4 "45-64" 6 "65+") pos(6) rows(1))                                               ///
>                 title("In-Migration to Multnomah (West Coast) by Age")                                                  ///
>                 subtitle("College Degree vs. No College Degree")                                                                ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")     ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_age_in_migration_west.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_age_in_migration_west.png saved as PNG format

.         if ${overleaf} == 1 {
.                 graph export "${ol_fig}fig_es_age_in_migration_west.png", replace
file C:/Users/ji252/Dropbox/Apps/Overleaf/Multnomah County/figures/fig_es_age_in_migration_west.png saved as PNG format
.         }

. 
.         ** Plot 3: In-migration (Lower 48 + DC) event study by age
.         twoway  (rcap in_48_ci_lo_age1 in_48_ci_hi_age1 year_age1, lc(maroon))                  ///
>                         (scatter in_48_coef_age1 year_age1, mc(maroon) ms(O))           ///
>                         (rcap in_48_ci_lo_age2 in_48_ci_hi_age2 year_age2, lc(forest_green))            ///
>                         (scatter in_48_coef_age2 year_age2, mc(forest_green) ms(T)) ///
>                         (rcap in_48_ci_lo_age3 in_48_ci_hi_age3 year_age3, lc(dkorange))                        ///
>                         (scatter in_48_coef_age3 year_age3, mc(dkorange) ms(S)),        ///
>                 yline(0, lc(gs10) lp(dash))                                                                                                     ///
>                 xline(2020.5, lc(black) lp(solid))                                                                                              ///
>                 xlabel(2016(1)2024)                                                                                                                     ///
>                 ytitle("Effect on In-Migration (pp)")                                                                                   ///
>                 xtitle("Year")                                                                                                                                  ///
>                 legend(order(2 "25-44" 4 "45-64" 6 "65+") pos(6) rows(1))                                               ///
>                 title("In-Migration to Multnomah (Lower 48 + DC) by Age")                                               ///
>                 subtitle("College Degree vs. No College Degree")                                                                ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")     ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_age_in_migration_48.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_age_in_migration_48.png saved as PNG format

.         if ${overleaf} == 1 {
.                 graph export "${ol_fig}fig_es_age_in_migration_48.png", replace
file C:/Users/ji252/Dropbox/Apps/Overleaf/Multnomah County/figures/fig_es_age_in_migration_48.png saved as PNG format
.         }

. 
.         ** Plot 4: Out-of-state migration event study by age
.         twoway  (rcap out_state_ci_lo_age1 out_state_ci_hi_age1 year_age1, lc(maroon))                  ///
>                         (scatter out_state_coef_age1 year_age1, mc(maroon) ms(O))               ///
>                         (rcap out_state_ci_lo_age2 out_state_ci_hi_age2 year_age2, lc(forest_green))            ///
>                         (scatter out_state_coef_age2 year_age2, mc(forest_green) ms(T)) ///
>                         (rcap out_state_ci_lo_age3 out_state_ci_hi_age3 year_age3, lc(dkorange))                        ///
>                         (scatter out_state_coef_age3 year_age3, mc(dkorange) ms(S)),    ///
>                 yline(0, lc(gs10) lp(dash))                                                                                                     ///
>                 xline(2020.5, lc(black) lp(solid))                                                                                              ///
>                 xlabel(2016(1)2024)                                                                                                                     ///
>                 ytitle("Effect on Out-of-State Migration (pp)")                                                                 ///
>                 xtitle("Year")                                                                                                                                  ///
>                 legend(order(2 "25-44" 4 "45-64" 6 "65+") pos(6) rows(1))                                               ///
>                 title("Out-of-State Migration from Multnomah County by Age")                                    ///
>                 subtitle("College Degree vs. No College Degree")                                                                ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")     ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_age_out_state_migration.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_age_out_state_migration.png saved as PNG format

.         if ${overleaf} == 1 {
.                 graph export "${ol_fig}fig_es_age_out_state_migration.png", replace
file C:/Users/ji252/Dropbox/Apps/Overleaf/Multnomah County/figures/fig_es_age_out_state_migration.png saved as PNG format
.         }

. 
. 
. ********************************************************************************
. ** REGRESSION 5: DIFFERENCE-IN-DIFFERENCES BY AGE (NO EDUCATION)
. ********************************************************************************
. 
. ** Restore original data
. use "${data}working/acs_migration_file", replace

. 
. ** Sample restrictions
. drop if year == 2015
(2,334,973 observations deleted)

. drop if qmigplc1 == 4
(401,283 observations deleted)

. drop if inlist(state_fips_o, 2, 15)
(137,699 observations deleted)

. drop if inlist(state_fips_d, 2, 15)
(3,633 observations deleted)

. drop if age < 25
(1,814,112 observations deleted)

. drop if ftotinc < 0
(7,054 observations deleted)

. 
. ** Multnomah county indicators
. gen multnomah_o = (state_fips_o == 41 & county_fips_o == 51)

. gen multnomah_d = (state_fips_d == 41 & county_fips_d == 51)

. 
. ** Analysis samples
. gen sample_1 = (multnomah_o == 1) & year != 2020

. gen sample_2 = (multnomah_o != 1) &                             ///
>                                 year != 2020 &                                          ///
>                            inlist(state_fips_o, 6, 41, 53)

. gen sample_3 = (multnomah_o != 1) &                             ///
>                                 year != 2020

. 
. ** Outcome variables
. gen out_1 = (same_county == 0) * 100

. gen out_2 = (multnomah_d == 1) * 100

. gen out_3 = (state_fips_o != state_fips_d) * 100

. 
. ** Treatment variables
. gen post = year > 2020

. 
. ** Covariate categories
. recode age ///
>     (25/44   = 1 "25-44") ///
>     (45/64   = 2 "45-64") ///
>     (65/max  = 3 "65+"), ///
>     gen(cat_age)
(19,316,283 differences between age and cat_age)

. 
. gen cat_sex = (sex == 2)

. label define lb_cat_sex 0 "Male" 1 "Female", replace

. label values cat_sex lb_cat_sex

. 
. recode marst ///
>     (1       = 1 "Married") ///
>     (2/3     = 2 "Separated") ///
>     (4/5     = 3 "Divorced / Widowed") ///
>     (6       = 4 "Single"), ///
>     gen(cat_married)
(7,510,801 differences between marst and cat_married)

. 
. recode nchild ///
>     (0       = 0 "0 Children") ///
>     (1       = 1 "1 Child") ///
>     (2       = 2 "2 Children") ///
>     (3/max   = 3 "3+ Children"), ///
>     gen(cat_child)
(410,461 differences between nchild and cat_child)

. 
. recode yngch ///
>     (99      = 0 "No Children") ///
>     (0/4     = 1 "0-4") ///
>     (5/12    = 2 "5-12") ///
>     (13/17   = 3 "13-17")       ///
>         (18/max  = 4 "18+"), ///
>     gen(cat_yngch)
(18,931,365 differences between yngch and cat_yngch)

. 
. recode educd ///
>     (min/61  = 1 "Less than HS") ///
>     (62/71   = 2 "HS Diploma") ///
>     (80/100  = 3 "Some College") ///
>     (101/max = 4 "College Degree"), ///
>     gen(cat_educ)
(19,316,283 differences between educd and cat_educ)

. 
. ** Create age × post interactions (omit middle age group: 45-64)
. gen age_post_1 = (cat_age == 1) * post

. gen age_post_3 = (cat_age == 3) * post

. 
. label var age_post_1 "Age 25-44 × Post"

. label var age_post_3 "Age 65+ × Post"

. 
. ** Store estimates
. estimates clear

. 
. ** Out-migration regression (Sample 1: Multnomah residents)
. reghdfe out_1 age_post_1 age_post_3 if sample_1 == 1 [pw = perwt],      ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 7 iterations)

HDFE Linear regression                            Number of obs   =     43,700
Absorbing 7 HDFE groups                           F(   2,  43675) =       3.40
                                                  Prob > F        =     0.0335
                                                  R-squared       =     0.0173
                                                  Adj R-squared   =     0.0168
                                                  Within R-sq.    =     0.0001
                                                  Root MSE        =    22.8565

------------------------------------------------------------------------------
             |               Robust
       out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
  age_post_1 |   .1059751     .64706     0.16   0.870    -1.162274    1.374225
  age_post_3 |  -1.310131   .5752247    -2.28   0.023    -2.437582   -.1826806
       _cons |   5.734775   .2312587    24.80   0.000     5.281503    6.188046
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. qui count if e(sample)

. estadd scalar N_unwtd = r(N)

added scalar:
            e(N_unwtd) =  43700

. estimates store did_agep_out

. 
. ** In-migration regression (Sample 2: CA/OR/WA residents)
. reghdfe out_2 age_post_1 age_post_3 if sample_2 == 1 [pw = perwt],      ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  2,671,879
Absorbing 8 HDFE groups                           F(   2,     54) =       0.07
Statistics robust to heteroskedasticity           Prob > F        =     0.9304
                                                  R-squared       =     0.0057
                                                  Adj R-squared   =     0.0057
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.4386

                                (Std. err. adjusted for 55 clusters in fips_o)
------------------------------------------------------------------------------
             |               Robust
       out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
  age_post_1 |  -.0066754   .0180492    -0.37   0.713    -.0428618     .029511
  age_post_3 |  -.0028292   .0095017    -0.30   0.767    -.0218789    .0162206
       _cons |   .0615596   .0045179    13.63   0.000     .0525019    .0706174
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. qui count if e(sample)

. estadd scalar N_unwtd = r(N)

added scalar:
            e(N_unwtd) =  2671879

. estimates store did_agep_in_west

. 
. ** In-migration regression (Sample 3: Lower 48 + DC residents)
. reghdfe out_2 age_post_1 age_post_3 if sample_3 == 1 [pw = perwt],      ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 17,535,332
Absorbing 8 HDFE groups                           F(   2,    527) =       0.35
Statistics robust to heteroskedasticity           Prob > F        =     0.7049
                                                  R-squared       =     0.0040
                                                  Adj R-squared   =     0.0039
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.1658

                               (Std. err. adjusted for 528 clusters in fips_o)
------------------------------------------------------------------------------
             |               Robust
       out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
  age_post_1 |   -.001657   .0030713    -0.54   0.590    -.0076905    .0043765
  age_post_3 |   .0004089   .0015695     0.26   0.795    -.0026742    .0034921
       _cons |   .0139181   .0007287    19.10   0.000     .0124865    .0153497
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. qui count if e(sample)

. estadd scalar N_unwtd = r(N)

added scalar:
            e(N_unwtd) =  17535332

. estimates store did_agep_in_48

. 
. ** Out-of-state migration regression (Sample 1: Multnomah residents)
. reghdfe out_3 age_post_1 age_post_3 if sample_1 == 1 [pw = perwt],      ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 7 iterations)

HDFE Linear regression                            Number of obs   =     43,700
Absorbing 7 HDFE groups                           F(   2,  43675) =       3.24
                                                  Prob > F        =     0.0390
                                                  R-squared       =     0.0121
                                                  Adj R-squared   =     0.0115
                                                  Within R-sq.    =     0.0001
                                                  Root MSE        =    17.2871

------------------------------------------------------------------------------
             |               Robust
       out_3 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
  age_post_1 |  -.2313006   .5062044    -0.46   0.648     -1.22347    .7608693
  age_post_3 |   -.974104   .4029642    -2.42   0.016    -1.763921   -.1842868
       _cons |   3.271297   .1772195    18.46   0.000     2.923944    3.618651
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. qui count if e(sample)

. estadd scalar N_unwtd = r(N)

added scalar:
            e(N_unwtd) =  43700

. estimates store did_agep_out_state

. 
. ********************************************************************************
. ** TABLE: DiD BY AGE (NO EDUCATION)
. ********************************************************************************
. 
. esttab did_agep_out did_agep_out_state did_agep_in_west did_agep_in_48  ///
>         using "${results}did/tab_did_by_age_post.tex",                                          ///
>         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                                                        ///
>         b(%-9.3f) se(%-9.3f) replace                                                                            ///
>         keep(age_post_1 age_post_3)                                                                             ///
>         order(age_post_1 age_post_3)                                                                            ///
>         coeflabels(     age_post_1  "Age 25-44 $\times$ Post"                                   ///
>                                 age_post_3  "Age 65+ $\times$ Post")                                    ///
>         mtitle( "Out-migration"                                                                                         ///
>                         "Out-of-state"                                                                                          ///
>                         "In-migration (West Coast)"                                                             ///
>                         "In-migration (Lower 48 + DC)")                                                         ///
>         stats(N_unwtd, fmt(%12.0fc) labels("Observations"))
(output written to C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/tab_did_by_age_post.tex)

. 
. ********************************************************************************
. ** REGRESSION 6: EVENT STUDY BY AGE (NO EDUCATION)
. ********************************************************************************
. 
. ** Create year × age interactions (base year = 2019, 2020 excluded, omit age 2)
. foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2.         gen x_age1_`y' = (cat_age == 1) * (year == `y')
  3.         gen x_age3_`y' = (cat_age == 3) * (year == `y')
  4. }

. 
. ** Out-migration event study by age
. reghdfe out_1 x_age1_* x_age3_* if sample_1 == 1 [pw = perwt],  ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 7 iterations)

HDFE Linear regression                            Number of obs   =     43,700
Absorbing 7 HDFE groups                           F(  14,  43663) =       1.61
                                                  Prob > F        =     0.0675
                                                  R-squared       =     0.0179
                                                  Adj R-squared   =     0.0171
                                                  Within R-sq.    =     0.0007
                                                  Root MSE        =    22.8529

------------------------------------------------------------------------------
             |               Robust
       out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
 x_age1_2016 |   1.199059   1.226903     0.98   0.328    -1.205694    3.603812
 x_age1_2017 |  -.2361761   1.177646    -0.20   0.841    -2.544384    2.072032
 x_age1_2018 |   1.121955   1.126466     1.00   0.319     -1.08594     3.32985
 x_age1_2021 |   .7406844   1.207867     0.61   0.540    -1.626758    3.108127
 x_age1_2022 |   2.608865   1.361904     1.92   0.055     -.060491    5.278222
 x_age1_2023 |  -1.321786   1.155113    -1.14   0.253    -3.585829    .9422568
 x_age1_2024 |    .434225   1.092313     0.40   0.691    -1.706728    2.575178
 x_age3_2016 |  -.2750749   1.136483    -0.24   0.809    -2.502602    1.952452
 x_age3_2017 |   .3315503   1.231348     0.27   0.788    -2.081915    2.745015
 x_age3_2018 |  -1.136721    1.00327    -1.13   0.257    -3.103149    .8297074
 x_age3_2021 |  -2.241253   1.074641    -2.09   0.037    -4.347569   -.1349364
 x_age3_2022 |  -.3025758   1.118243    -0.27   0.787    -2.494353    1.889201
 x_age3_2023 |  -2.838288   1.066123    -2.66   0.008    -4.927907   -.7486678
 x_age3_2024 |  -.9671296   .9249904    -1.05   0.296    -2.780128    .8458686
       _cons |   5.535916   .4277654    12.94   0.000     4.697487    6.374344
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store es_agep_out

. 
. ** In-migration event study by age (West Coast)
. reghdfe out_2 x_age1_* x_age3_* if sample_2 == 1 [pw = perwt],  ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 7 iterations)

HDFE Linear regression                            Number of obs   =  2,671,879
Absorbing 8 HDFE groups                           F(  14,     54) =       0.84
Statistics robust to heteroskedasticity           Prob > F        =     0.6231
                                                  R-squared       =     0.0057
                                                  Adj R-squared   =     0.0057
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.4386

                                (Std. err. adjusted for 55 clusters in fips_o)
------------------------------------------------------------------------------
             |               Robust
       out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
 x_age1_2016 |   .0048483   .0191045     0.25   0.801    -.0334539    .0431505
 x_age1_2017 |  -.0117243   .0238733    -0.49   0.625    -.0595875    .0361388
 x_age1_2018 |  -.0139317   .0276819    -0.50   0.617    -.0694306    .0415673
 x_age1_2021 |   .0244274   .0268052     0.91   0.366    -.0293139    .0781686
 x_age1_2022 |  -.0181265   .0257764    -0.70   0.485     -.069805     .033552
 x_age1_2023 |  -.0129168   .0155644    -0.83   0.410    -.0441214    .0182879
 x_age1_2024 |  -.0413394   .0297263    -1.39   0.170     -.100937    .0182583
 x_age3_2016 |  -.0039991   .0176241    -0.23   0.821    -.0393333     .031335
 x_age3_2017 |  -.0160012   .0139794    -1.14   0.257    -.0440283    .0120259
 x_age3_2018 |  -.0132623   .0145055    -0.91   0.365    -.0423442    .0158195
 x_age3_2021 |  -.0036207   .0124609    -0.29   0.772    -.0286033    .0213618
 x_age3_2022 |  -.0203641    .016279    -1.25   0.216    -.0530015    .0122733
 x_age3_2023 |  -.0033638   .0185913    -0.18   0.857    -.0406373    .0339096
 x_age3_2024 |  -.0180663   .0126484    -1.43   0.159    -.0434248    .0072922
       _cons |   .0656431   .0058506    11.22   0.000     .0539134    .0773727
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_agep_in_west

. 
. ** In-migration event study by age (Lower 48 + DC)
. reghdfe out_2 x_age1_* x_age3_* if sample_3 == 1 [pw = perwt],  ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 17,535,332
Absorbing 8 HDFE groups                           F(  14,    527) =       0.71
Statistics robust to heteroskedasticity           Prob > F        =     0.7691
                                                  R-squared       =     0.0040
                                                  Adj R-squared   =     0.0039
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.1658

                               (Std. err. adjusted for 528 clusters in fips_o)
------------------------------------------------------------------------------
             |               Robust
       out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
 x_age1_2016 |  -.0020325   .0039898    -0.51   0.611    -.0098703    .0058054
 x_age1_2017 |  -.0032239   .0046856    -0.69   0.492    -.0124286    .0059808
 x_age1_2018 |  -.0057418   .0049704    -1.16   0.249    -.0155061    .0040225
 x_age1_2021 |   .0020534   .0052489     0.39   0.696    -.0082579    .0123647
 x_age1_2022 |  -.0047396   .0048003    -0.99   0.324    -.0141697    .0046905
 x_age1_2023 |  -.0042583   .0035322    -1.21   0.229    -.0111973    .0026807
 x_age1_2024 |  -.0106027   .0051742    -2.05   0.041    -.0207673   -.0004382
 x_age3_2016 |  -.0006027   .0029041    -0.21   0.836    -.0063077    .0051023
 x_age3_2017 |  -.0015086   .0022964    -0.66   0.512    -.0060198    .0030027
 x_age3_2018 |  -.0024259   .0026381    -0.92   0.358    -.0076085    .0027566
 x_age3_2021 |   .0007567   .0020789     0.36   0.716    -.0033271    .0048406
 x_age3_2022 |   -.002922   .0025774    -1.13   0.257    -.0079853    .0021413
 x_age3_2023 |   .0005439    .003151     0.17   0.863    -.0056461    .0067338
 x_age3_2024 |  -.0015056   .0025366    -0.59   0.553    -.0064886    .0034774
       _cons |   .0152647   .0011602    13.16   0.000     .0129855     .017544
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_agep_in_48

. 
. ** Out-of-state migration event study by age
. reghdfe out_3 x_age1_* x_age3_* if sample_1 == 1 [pw = perwt],  ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 7 iterations)

HDFE Linear regression                            Number of obs   =     43,700
Absorbing 7 HDFE groups                           F(  14,  43663) =       1.10
                                                  Prob > F        =     0.3544
                                                  R-squared       =     0.0125
                                                  Adj R-squared   =     0.0117
                                                  Within R-sq.    =     0.0005
                                                  Root MSE        =    17.2860

------------------------------------------------------------------------------
             |               Robust
       out_3 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
 x_age1_2016 |   .7950612   .8893673     0.89   0.371    -.9481151    2.538237
 x_age1_2017 |   .5702529   .9377991     0.61   0.543    -1.267851    2.408356
 x_age1_2018 |   .7285747   .8510265     0.86   0.392    -.9394529    2.396602
 x_age1_2021 |     .24923   .9723973     0.26   0.798    -1.656686    2.155146
 x_age1_2022 |   1.830638   1.093331     1.67   0.094     -.312311    3.973587
 x_age1_2023 |  -.8716418   .9001819    -0.97   0.333    -2.636015    .8927313
 x_age1_2024 |  -.0733679   .8727212    -0.08   0.933    -1.783917    1.637182
 x_age3_2016 |    .010321   .6971397     0.01   0.988    -1.356085    1.376727
 x_age3_2017 |   .6804318   .9130497     0.75   0.456    -1.109162    2.470026
 x_age3_2018 |  -.3404508   .6420519    -0.53   0.596    -1.598884    .9179826
 x_age3_2021 |  -1.188255    .810754    -1.47   0.143    -2.777348    .4008375
 x_age3_2022 |  -.0738096   .6726096    -0.11   0.913    -1.392137    1.244518
 x_age3_2023 |  -1.601175   .7188942    -2.23   0.026    -3.010221   -.1921294
 x_age3_2024 |  -.6977231   .6830913    -1.02   0.307    -2.036594    .6411483
       _cons |   3.006618   .3295982     9.12   0.000     2.360599    3.652636
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         3           1           2     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store es_agep_out_state

. 
. ********************************************************************************
. ** EVENT STUDY BY AGE (NO EDUCATION) PLOTS
. ********************************************************************************
. 
. preserve

.         clear

.         set obs 9
Number of observations (_N) was 0, now 9.

.         gen year = 2015 + _n

. 
.         ** Create coefficient variables for age groups 1 and 3, each sample
.         foreach a in 1 3 {
  2.                 foreach s in "out" "out_state" "in_west" "in_48" {
  3.                         gen `s'_coef_age`a' = .
  4.                         gen `s'_ci_lo_age`a' = .
  5.                         gen `s'_ci_hi_age`a' = .
  6.                 }
  7.         }
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)

. 
.         ** Fill in coefficients
.         foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2.                 foreach a in 1 3 {
  3. 
.                         ** Out-migration
.                         estimates restore es_agep_out
  4.                         capture {
  5.                                 replace out_coef_age`a' = _b[x_age`a'_`y'] if year == `y'
  6.                                 replace out_ci_lo_age`a' = _b[x_age`a'_`y'] - 1.96 * _se[x_age`a'_`y'] if year == `y'
  7.                                 replace out_ci_hi_age`a' = _b[x_age`a'_`y'] + 1.96 * _se[x_age`a'_`y'] if year == `y'
  8.                         }
  9. 
.                         ** Out-of-state migration
.                         estimates restore es_agep_out_state
 10.                         capture {
 11.                                 replace out_state_coef_age`a' = _b[x_age`a'_`y'] if year == `y'
 12.                                 replace out_state_ci_lo_age`a' = _b[x_age`a'_`y'] - 1.96 * _se[x_age`a'_`y'] if year == `y'
 13.                                 replace out_state_ci_hi_age`a' = _b[x_age`a'_`y'] + 1.96 * _se[x_age`a'_`y'] if year == `y'
 14.                         }
 15. 
.                         ** In-migration (West Coast)
.                         estimates restore es_agep_in_west
 16.                         capture {
 17.                                 replace in_west_coef_age`a' = _b[x_age`a'_`y'] if year == `y'
 18.                                 replace in_west_ci_lo_age`a' = _b[x_age`a'_`y'] - 1.96 * _se[x_age`a'_`y'] if year == `y'
 19.                                 replace in_west_ci_hi_age`a' = _b[x_age`a'_`y'] + 1.96 * _se[x_age`a'_`y'] if year == `y'
 20.                         }
 21. 
.                         ** In-migration (Lower 48)
.                         estimates restore es_agep_in_48
 22.                         capture {
 23.                                 replace in_48_coef_age`a' = _b[x_age`a'_`y'] if year == `y'
 24.                                 replace in_48_ci_lo_age`a' = _b[x_age`a'_`y'] - 1.96 * _se[x_age`a'_`y'] if year == `y'
 25.                                 replace in_48_ci_hi_age`a' = _b[x_age`a'_`y'] + 1.96 * _se[x_age`a'_`y'] if year == `y'
 26.                         }
 27. 
.                 }
 28.         }
(results es_agep_out are active now)
(results es_agep_out_state are active now)
(results es_agep_in_west are active now)
(results es_agep_in_48 are active now)
(results es_agep_out are active now)
(results es_agep_out_state are active now)
(results es_agep_in_west are active now)
(results es_agep_in_48 are active now)
(results es_agep_out are active now)
(results es_agep_out_state are active now)
(results es_agep_in_west are active now)
(results es_agep_in_48 are active now)
(results es_agep_out are active now)
(results es_agep_out_state are active now)
(results es_agep_in_west are active now)
(results es_agep_in_48 are active now)
(results es_agep_out are active now)
(results es_agep_out_state are active now)
(results es_agep_in_west are active now)
(results es_agep_in_48 are active now)
(results es_agep_out are active now)
(results es_agep_out_state are active now)
(results es_agep_in_west are active now)
(results es_agep_in_48 are active now)
(results es_agep_out are active now)
(results es_agep_out_state are active now)
(results es_agep_in_west are active now)
(results es_agep_in_48 are active now)
(results es_agep_out are active now)
(results es_agep_out_state are active now)
(results es_agep_in_west are active now)
(results es_agep_in_48 are active now)
(results es_agep_out are active now)
(results es_agep_out_state are active now)
(results es_agep_in_west are active now)
(results es_agep_in_48 are active now)
(results es_agep_out are active now)
(results es_agep_out_state are active now)
(results es_agep_in_west are active now)
(results es_agep_in_48 are active now)
(results es_agep_out are active now)
(results es_agep_out_state are active now)
(results es_agep_in_west are active now)
(results es_agep_in_48 are active now)
(results es_agep_out are active now)
(results es_agep_out_state are active now)
(results es_agep_in_west are active now)
(results es_agep_in_48 are active now)
(results es_agep_out are active now)
(results es_agep_out_state are active now)
(results es_agep_in_west are active now)
(results es_agep_in_48 are active now)
(results es_agep_out are active now)
(results es_agep_out_state are active now)
(results es_agep_in_west are active now)
(results es_agep_in_48 are active now)

. 
.         ** Base year (2019) = 0; 2020 excluded (no coefficient)
.         foreach a in 1 3 {
  2.                 foreach s in "out" "out_state" "in_west" "in_48" {
  3.                         foreach v in coef ci_lo ci_hi {
  4.                                 replace `s'_`v'_age`a' = 0 if year == 2019
  5.                         }
  6.                 }
  7.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
.         ** Offset years slightly for visibility
.         gen year_age1 = year - 0.1

.         gen year_age3 = year + 0.1

. 
.         ** Plot 1: Out-migration event study by age (no education)
.         twoway  (rcap out_ci_lo_age1 out_ci_hi_age1 year_age1, lc(maroon))                              ///
>                         (scatter out_coef_age1 year_age1, mc(maroon) ms(O))                                             ///
>                         (rcap out_ci_lo_age3 out_ci_hi_age3 year_age3, lc(dkorange))                            ///
>                         (scatter out_coef_age3 year_age3, mc(dkorange) ms(S)),                                          ///
>                 yline(0, lc(gs10) lp(dash))                                                                                                     ///
>                 xline(2020.5, lc(black) lp(solid))                                                                                              ///
>                 xlabel(2016(1)2024)                                                                                                                     ///
>                 ytitle("Effect on Out-Migration (pp)")                                                                                  ///
>                 xtitle("Year")                                                                                                                                  ///
>                 legend(order(2 "25-44" 4 "65+") pos(6) rows(1))                                                                 ///
>                 title("Out-Migration from Multnomah County by Age")                                                             ///
>                 subtitle("Relative to Age 45-64")                                                                                               ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")     ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_agepost_out_migration.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_agepost_out_migration.png saved as PNG format

.         if ${overleaf} == 1 {
.                 graph export "${ol_fig}fig_es_agepost_out_migration.png", replace
file C:/Users/ji252/Dropbox/Apps/Overleaf/Multnomah County/figures/fig_es_agepost_out_migration.png saved as PNG format
.         }

. 
.         ** Plot 2: In-migration (West Coast) event study by age (no education)
.         twoway  (rcap in_west_ci_lo_age1 in_west_ci_hi_age1 year_age1, lc(maroon))              ///
>                         (scatter in_west_coef_age1 year_age1, mc(maroon) ms(O))                                         ///
>                         (rcap in_west_ci_lo_age3 in_west_ci_hi_age3 year_age3, lc(dkorange))            ///
>                         (scatter in_west_coef_age3 year_age3, mc(dkorange) ms(S)),                                      ///
>                 yline(0, lc(gs10) lp(dash))                                                                                                     ///
>                 xline(2020.5, lc(black) lp(solid))                                                                                              ///
>                 xlabel(2016(1)2024)                                                                                                                     ///
>                 ytitle("Effect on In-Migration (pp)")                                                                                   ///
>                 xtitle("Year")                                                                                                                                  ///
>                 legend(order(2 "25-44" 4 "65+") pos(6) rows(1))                                                                 ///
>                 title("In-Migration to Multnomah (West Coast) by Age")                                                  ///
>                 subtitle("Relative to Age 45-64")                                                                                               ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")     ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_agepost_in_migration_west.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_agepost_in_migration_west.png saved as PNG format

.         if ${overleaf} == 1 {
.                 graph export "${ol_fig}fig_es_agepost_in_migration_west.png", replace
file C:/Users/ji252/Dropbox/Apps/Overleaf/Multnomah County/figures/fig_es_agepost_in_migration_west.png saved as PNG format
.         }

. 
.         ** Plot 3: In-migration (Lower 48 + DC) event study by age (no education)
.         twoway  (rcap in_48_ci_lo_age1 in_48_ci_hi_age1 year_age1, lc(maroon))                  ///
>                         (scatter in_48_coef_age1 year_age1, mc(maroon) ms(O))                                           ///
>                         (rcap in_48_ci_lo_age3 in_48_ci_hi_age3 year_age3, lc(dkorange))                        ///
>                         (scatter in_48_coef_age3 year_age3, mc(dkorange) ms(S)),                                        ///
>                 yline(0, lc(gs10) lp(dash))                                                                                                     ///
>                 xline(2020.5, lc(black) lp(solid))                                                                                              ///
>                 xlabel(2016(1)2024)                                                                                                                     ///
>                 ytitle("Effect on In-Migration (pp)")                                                                                   ///
>                 xtitle("Year")                                                                                                                                  ///
>                 legend(order(2 "25-44" 4 "65+") pos(6) rows(1))                                                                 ///
>                 title("In-Migration to Multnomah (Lower 48 + DC) by Age")                                               ///
>                 subtitle("Relative to Age 45-64")                                                                                               ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")     ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_agepost_in_migration_48.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_agepost_in_migration_48.png saved as PNG format

.         if ${overleaf} == 1 {
.                 graph export "${ol_fig}fig_es_agepost_in_migration_48.png", replace
file C:/Users/ji252/Dropbox/Apps/Overleaf/Multnomah County/figures/fig_es_agepost_in_migration_48.png saved as PNG format
.         }

. 
.         ** Plot 4: Out-of-state migration event study by age (no education)
.         twoway  (rcap out_state_ci_lo_age1 out_state_ci_hi_age1 year_age1, lc(maroon))  ///
>                         (scatter out_state_coef_age1 year_age1, mc(maroon) ms(O))                                       ///
>                         (rcap out_state_ci_lo_age3 out_state_ci_hi_age3 year_age3, lc(dkorange))        ///
>                         (scatter out_state_coef_age3 year_age3, mc(dkorange) ms(S)),                            ///
>                 yline(0, lc(gs10) lp(dash))                                                                                                     ///
>                 xline(2020.5, lc(black) lp(solid))                                                                                              ///
>                 xlabel(2016(1)2024)                                                                                                                     ///
>                 ytitle("Effect on Out-of-State Migration (pp)")                                                                 ///
>                 xtitle("Year")                                                                                                                                  ///
>                 legend(order(2 "25-44" 4 "65+") pos(6) rows(1))                                                                 ///
>                 title("Out-of-State Migration from Multnomah County by Age")                                    ///
>                 subtitle("Relative to Age 45-64")                                                                                               ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")     ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_agepost_out_state_migration.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_agepost_out_state_migration.png saved as PNG format

.         if ${overleaf} == 1 {
.                 graph export "${ol_fig}fig_es_agepost_out_state_migration.png", replace
file C:/Users/ji252/Dropbox/Apps/Overleaf/Multnomah County/figures/fig_es_agepost_out_state_migration.png saved as PNG format
.         }

. 
. restore

. 
. 
. ********************************************************************************
. ** CLEANUP
. ********************************************************************************
. 
. ** Close log
. clear

. log close log_02
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_did_2026-02-10.log
  log type:  text
 closed on:  11 Feb 2026, 02:24:21
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
