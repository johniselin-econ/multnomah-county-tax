---------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/00_log_multnomah_2026-02-05.l
> og
  log type:  text
 opened on:   5 Feb 2026, 19:38:47

. 
. ** Set Seed 
. set seed 56403

. 
. ** Set scheme
. set scheme plotplainblind

. 
. ** PARALLEL PROCESSING FLAG
. ** Set to 1 to use parallel processing, 0 for sequential processing
. global use_parallel = 1

. 
. ** Set parameters 
. local overwrite_csv = 0

. global start_year_acs = 2015

. global end_year_acs = 2024

. 
end of do-file

. do "C:\Users\ji252\AppData\Local\Temp\STD44e8_000001.tmp"

. ** Difference-in-Difference (ACS)
. do ${code}02_did_analysis.do

. /*******************************************************************************
> File Name:              02_did_analysis.do
> Creator:                John Iselin
> Date Update:    January 11, 2026
> 
> Called by: 00_multnomah.do
> 
> Purpose: Perform DiD analysis on ACS data examining the effect of the
>          Multnomah County tax on migration patterns by education level.
> 
> Authors: John Iselin
> 
> For more information, contact john.iselin@yale.edu
> 
> *******************************************************************************/
. 
. 
. ** Start log file
. capture log close log_02

. log using "${logs}02_log_did_${date}", replace text name(log_02)
---------------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_did_2026-02-05.log
  log type:  text
 opened on:   5 Feb 2026, 19:38:52

. 
. 
. ********************************************************************************
. ** LOAD AND PREPARE DATA
. ********************************************************************************
. 
. ** Load ACS migration data
. use "${data}working/acs_migration_file", replace

. 
. ** Sample restrictions
. drop if year == 2015                                    // Sample: 2016-2024
(2,334,973 observations deleted)

. drop if qmigplc1 == 4                                   // Error in migration place
(401,283 observations deleted)

. drop if inlist(state_fips_o, 2, 15)     // Alaska and Hawaii
(137,699 observations deleted)

. drop if inlist(state_fips_d, 2, 15)     // Alaska and Hawaii
(3,633 observations deleted)

. 
. ********************************************************************************
. ** DEFINE SAMPLES AND TREATMENT
. ********************************************************************************
. 
. ** Multnomah county indicators
. gen multnomah_o = (state_fips_o == 41 & county_fips_o == 51)

. gen multnomah_d = (state_fips_d == 41 & county_fips_d == 51)

. 
. ** Analysis samples
. gen sample_1 = (multnomah_o == 1) & year != 2020    // Multnomah in origin (out-migration)

. gen sample_2 = (multnomah_o != 1) &                             ///
>                                 year != 2020 &                                          /// Not Multnom
> ah in origin
>                            inlist(state_fips_o, 6, 41, 53)      // CA, OR, WA (in-migration)

. gen sample_3 = (multnomah_o != 1) &                             /// Not Multnomah in origin
>                                 year != 2020                                            // 

. 
. label var sample_1 "Out-migration Sample"

. label var sample_2 "In-migration Sample (West Coast)"

. label var sample_3 "In-migration Sample (Lower 48 + DC)"

. 
. ** Outcome variables (scaled to percentages)
. gen out_1 = (same_county == 0) * 100

. label var out_1 "Moved out of Multnomah (%)"

. 
. gen out_2 = (multnomah_d == 1) * 100

. label var out_2 "Moved to Multnomah (%)"

. 
. ** Treatment variables
. gen post = year > 2020

. label var post "Post-2020"

. 
. gen high_ed = educd >= 101

. label var high_ed "College Degree"

. 
. gen treated = high_ed * post

. label var treated "College Degree × Post"

. 
. ********************************************************************************
. ** COVARIATE CATEGORIES
. ********************************************************************************
. 
. ** Age categories
. recode age ///
>     (18/24   = 1 "18-24") ///
>     (25/44   = 2 "25-44") ///
>     (45/64   = 3 "45-64") ///
>     (65/max  = 4 "65+"), ///
>     gen(cat_age)
(21,137,449 differences between age and cat_age)

. label var cat_age "Age categories"

. 
. ** Sex
. gen cat_sex = (sex == 2)

. label var cat_sex "Female indicator"

. label define lb_cat_sex 0 "Male" 1 "Female", replace

. label values cat_sex lb_cat_sex

. 
. ** Marital status
. recode marst ///
>     (1       = 1 "Married") ///
>     (2/3     = 2 "Separated") ///
>     (4/5     = 3 "Divorced / Widowed") ///
>     (6       = 4 "Single"), ///
>     gen(cat_married)
(9,179,293 differences between marst and cat_married)

. label var cat_married "Marriage categories"

. 
. ** Number of children
. recode nchild ///
>     (0       = 0 "0 Children") ///
>     (1       = 1 "1 Child") ///
>     (2       = 2 "2 Children") ///
>     (3/max   = 3 "3+ Children"), ///
>     gen(cat_child)
(412,696 differences between nchild and cat_child)

. label var cat_child "Number of Children"

. 
. ** Age of youngest child
. recode yngch ///
>     (99      = 0 "No Children") ///
>     (0/4     = 1 "0-4") ///
>     (5/12    = 2 "5-12") ///
>     (13/17   = 3 "13-17")       ///
>         (18/max  = 4 "18+"), ///
>     gen(cat_yngch)
(20,719,194 differences between yngch and cat_yngch)

. label var cat_yngch "Age of youngest child"

. 
. ** Education categories
. recode educd ///
>     (min/61  = 1 "Less than HS") ///
>     (62/71   = 2 "HS Diploma") ///
>     (80/100  = 3 "Some College") ///
>     (101/max = 4 "College Degree"), ///
>     gen(cat_educ)
(21,137,449 differences between educd and cat_educ)

. label var cat_educ "Education categories"

. 
. ********************************************************************************
. ** REGRESSION 1: DIFFERENCE-IN-DIFFERENCES
. ********************************************************************************
. 
. ** Store estimates for coefficient plot
. estimates clear

. 
. ** Out-migration regression (Sample 1: Multnomah residents)
. reghdfe out_1 treated if sample_1 == 1 [fw = perwt],    ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  4,940,249
Absorbing 7 HDFE groups                           F(   1,4940224) =     808.40
                                                  Prob > F        =     0.0000
                                                  R-squared       =     0.0201
                                                  Adj R-squared   =     0.0201
                                                  Within R-sq.    =     0.0002
                                                  Root MSE        =    23.7465

------------------------------------------------------------------------------
             |               Robust
       out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |   1.232005   .0433311    28.43   0.000     1.147078    1.316933
       _cons |    5.83538   .0145229   401.81   0.000     5.806915    5.863844
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store did_out

. 
. ** In-migration regression (Sample 2: CA/OR/WA residents)
. reghdfe out_2 treated if sample_2 == 1 [fw = perwt],    ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  297625606
Absorbing 8 HDFE groups                           F(   1,     54) =       0.74
Statistics robust to heteroskedasticity           Prob > F        =     0.3926
                                                  R-squared       =     0.0058
                                                  Adj R-squared   =     0.0058
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.5588

                                (Std. err. adjusted for 55 clusters in fips_o)
------------------------------------------------------------------------------
             |               Robust
       out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |  -.0089625   .0103988    -0.86   0.393    -.0298108    .0118858
       _cons |   .0674888   .0018439    36.60   0.000      .063792    .0711856
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_in_west

. 
. ** In-migration regression (Sample 3: Lower 48 + DC residents)
. reghdfe out_2 treated if sample_3 == 1 [fw = perwt],    ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 1925060790
Absorbing 8 HDFE groups                           F(   1,    527) =       2.60
Statistics robust to heteroskedasticity           Prob > F        =     0.1072
                                                  R-squared       =     0.0040
                                                  Adj R-squared   =     0.0040
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.2246

                               (Std. err. adjusted for 528 clusters in fips_o)
------------------------------------------------------------------------------
             |               Robust
       out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |  -.0033242   .0020603    -1.61   0.107    -.0073716    .0007232
       _cons |   .0156366   .0003574    43.76   0.000     .0149346    .0163386
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_in_48

. 
. ********************************************************************************
. ** COEFFICIENT PLOT: DiD RESULTS
. ********************************************************************************
. 
. coefplot        (did_out, label("Out-migration from Multnomah")                                        
>  ///
>                                 mc(sea) ciopts(lc(sea)))                                               
>                                  ///
>                         (did_in_west, label("In-migration to Multnomah, West Coast Sample")     ///
>                                 mc(vermillion) ciopts(lc(vermillion)))                                 
>                                  ///
>                         (did_in_48, label("In-migration to Multnomah, Lower 48 + DC Sample")    ///
>                                 mc(turquoise) ciopts(lc(turquoise))),                           ///    
>  
>         keep(treated)                                                                                  
>          ///
>         ciopts(recast(rcap))                                                                           
>  ///
>         yline(0, lc(gs10) lp(dash))                                                             ///
>         xline(0, lc(gs10) lp(dash))                                                             ///
>         coeflabels(treated = "College Degree × Post")                          ///
>         ytitle("")                                                                                     
>                  ///
>         xtitle("Effect on Migration Rate (pp)")                                         ///
>         legend(pos(6) rows(1))                                                                         
>  ///
>         title("Effect of Multnomah County Tax on Migration")            ///
>         subtitle("Difference-in-Differences Estimates")                         ///
>         graphregion(color(white))

. 
. graph export "${results}did/fig_did_coefplot.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_did_coefplot.png saved as PNG
    format

. 
. ********************************************************************************
. ** REGRESSION 2: EVENT STUDY
. ********************************************************************************
. 
. ** Create year × education interactions (base year = 2019, 2020 excluded)
. foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2.         gen x_high_ed_`y' = high_ed * (year == `y')
  3. }

. 
. ** Out-migration event study
. reghdfe out_1 x_high_ed_* if sample_1 == 1 [fw = perwt],        ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  4,940,249
Absorbing 7 HDFE groups                           F(   7,4940218) =     194.67
                                                  Prob > F        =     0.0000
                                                  R-squared       =     0.0202
                                                  Adj R-squared   =     0.0202
                                                  Within R-sq.    =     0.0003
                                                  Root MSE        =    23.7452

--------------------------------------------------------------------------------
               |               Robust
         out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_high_ed_2016 |   .2157829   .0850134     2.54   0.011     .0491597    .3824061
x_high_ed_2017 |   1.621033   .0824513    19.66   0.000     1.459432    1.782635
x_high_ed_2018 |   1.121102   .0828463    13.53   0.000     .9587267    1.283478
x_high_ed_2021 |   1.763493   .0848149    20.79   0.000     1.597259    1.929727
x_high_ed_2022 |   2.440565   .0880362    27.72   0.000     2.268017    2.613113
x_high_ed_2023 |   1.844759   .0824545    22.37   0.000     1.683151    2.006367
x_high_ed_2024 |   1.818619   .0799575    22.74   0.000     1.661905    1.975333
         _cons |    5.50135     .02612   210.62   0.000     5.450156    5.552544
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store es_out

. 
. ** In-migration event study
. reghdfe out_2 x_high_ed_* if sample_2 == 1 [fw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  297625606
Absorbing 8 HDFE groups                           F(   7,     54) =       1.72
Statistics robust to heteroskedasticity           Prob > F        =     0.1249
                                                  R-squared       =     0.0058
                                                  Adj R-squared   =     0.0058
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.5588

                                  (Std. err. adjusted for 55 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_high_ed_2016 |   .0006089   .0176852     0.03   0.973    -.0348478    .0360655
x_high_ed_2017 |  -.0112805   .0173831    -0.65   0.519    -.0461314    .0235705
x_high_ed_2018 |   .0218863   .0186692     1.17   0.246    -.0155432    .0593159
x_high_ed_2021 |   .0234131    .026645     0.88   0.383    -.0300068    .0768331
x_high_ed_2022 |  -.0022492   .0138436    -0.16   0.872    -.0300039    .0255056
x_high_ed_2023 |  -.0201526   .0249974    -0.81   0.424    -.0702694    .0299642
x_high_ed_2024 |  -.0243619   .0235202    -1.04   0.305    -.0715169    .0227932
         _cons |   .0665584   .0047196    14.10   0.000     .0570961    .0760207
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_in_west

. 
. ** In-migration event study
. reghdfe out_2 x_high_ed_* if sample_3 == 1 [fw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 1925060790
Absorbing 8 HDFE groups                           F(   7,    527) =       1.08
Statistics robust to heteroskedasticity           Prob > F        =     0.3732
                                                  R-squared       =     0.0040
                                                  Adj R-squared   =     0.0040
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.2246

                                 (Std. err. adjusted for 528 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_high_ed_2016 |  -.0004553    .003629    -0.13   0.900    -.0075843    .0066738
x_high_ed_2017 |  -.0019644   .0034234    -0.57   0.566    -.0086895    .0047608
x_high_ed_2018 |   .0029225   .0038388     0.76   0.447    -.0046187    .0104638
x_high_ed_2021 |   .0001685   .0049201     0.03   0.973     -.009497     .009834
x_high_ed_2022 |   8.89e-07   .0031913     0.00   1.000    -.0062684    .0062702
x_high_ed_2023 |  -.0060519   .0047712    -1.27   0.205    -.0154247    .0033209
x_high_ed_2024 |  -.0066425   .0044517    -1.49   0.136    -.0153878    .0021027
         _cons |   .0155965   .0008911    17.50   0.000      .013846    .0173471
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_in_48

. 
. ********************************************************************************
. ** EVENT STUDY PLOTS
. ********************************************************************************
. 
. ** Extract coefficients and create event study dataset
. preserve

.         clear

.         set obs 9
Number of observations (_N) was 0, now 9.

.         gen year = 2015 + _n

. 
.         ** Out-migration coefficients
.         gen out_coef = .
(9 missing values generated)

.         gen out_ci_lo = .
(9 missing values generated)

.         gen out_ci_hi = .
(9 missing values generated)

. 
.         ** In-migration coefficients
.         gen in_west_coef = .
(9 missing values generated)

.         gen in_west_ci_lo = .
(9 missing values generated)

.         gen in_west_ci_hi = .
(9 missing values generated)

.         
.         ** In-migration coefficients
.         gen in_48_coef = .
(9 missing values generated)

.         gen in_48_ci_lo = .
(9 missing values generated)

.         gen in_48_ci_hi = .
(9 missing values generated)

. 
.         ** Fill in coefficients (2020 = base year = 0)
.         foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2. 
.                 ** Out-migration
.                 estimates restore es_out
  3.                 capture {
  4.                         replace out_coef = _b[x_high_ed_`y'] if year == `y'
  5.                         replace out_ci_lo = _b[x_high_ed_`y'] - 1.96 * _se[x_high_ed_`y'] if year ==
>  `y'
  6.                         replace out_ci_hi = _b[x_high_ed_`y'] + 1.96 * _se[x_high_ed_`y'] if year ==
>  `y'
  7.                 }
  8. 
.                 ** In-migration
.                 estimates restore es_in_west
  9.                 capture {
 10.                         replace in_west_coef = _b[x_high_ed_`y'] if year == `y'
 11.                         replace in_west_ci_lo = _b[x_high_ed_`y'] - 1.96 * _se[x_high_ed_`y'] if yea
> r == `y'
 12.                         replace in_west_ci_hi = _b[x_high_ed_`y'] + 1.96 * _se[x_high_ed_`y'] if yea
> r == `y'
 13.                 }
 14.                 
.                 ** In-migration
.                 estimates restore es_in_48
 15.                 capture {
 16.                         replace in_48_coef = _b[x_high_ed_`y'] if year == `y'
 17.                         replace in_48_ci_lo = _b[x_high_ed_`y'] - 1.96 * _se[x_high_ed_`y'] if year 
> == `y'
 18.                         replace in_48_ci_hi = _b[x_high_ed_`y'] + 1.96 * _se[x_high_ed_`y'] if year 
> == `y'
 19.                 }
 20.                 
.         }
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)

. 
.         ** Base year (2019) = 0; 2020 excluded (no coefficient)
.         foreach v in out_coef out_ci_lo out_ci_hi in_west_coef in_west_ci_lo in_west_ci_hi in_48_coef i
> n_48_ci_lo in_48_ci_hi {
  2.                 replace `v' = 0 if year == 2019
  3.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
.         ** Offset years slightly for visibility
.         gen year_out = year - 0.15

.         gen year_in_west = year

.         gen year_in_48 = year + 0.15

. 
.         ** Plot 1: Out-migration event study
.         twoway  (rcap out_ci_lo out_ci_hi year, lc(navy))                               ///
>                         (connected out_coef year, mc(navy) lc(navy) ms(O)),             ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>  ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>  ///
>                 xlabel(2016(1)2024)                                                                    
>          ///
>                 ytitle("Effect on Out-Migration (pp)")                                          ///
>                 xtitle("Year")                                                                         
>                  ///
>                 legend(off)                                                                            
>                  ///
>                 title("Out-Migration from Multnomah County")                            ///
>                 subtitle("College Degree vs. No College Degree")                        ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_out_migration.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_out_migration.png saved as
    PNG format

. 
.         ** Plot 2: In-migration event study (West Coast)
.         twoway  (rcap in_west_ci_lo in_west_ci_hi year, lc(maroon))     ///
>                         (connected in_west_coef year, mc(maroon) lc(maroon) ms(O)),     ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>  ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>  ///
>                 xlabel(2016(1)2024)                                                                    
>          ///
>                 ytitle("Effect on In-Migration (pp)")                                           ///
>                 xtitle("Year")                                                                         
>                  ///
>                 legend(off)                                                                            
>                  ///
>                 title("In-Migration to Multnomah County (West Coast)")          ///
>                 subtitle("College Degree vs. No College Degree")                        ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_in_migration_west.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_in_migration_west.png
    saved as PNG format

. 
.         ** Plot 3: In-migration event study (Lower 48 + DC)
.         twoway  (rcap in_48_ci_lo in_48_ci_hi year, lc(forest_green))   ///
>                         (connected in_48_coef year, mc(forest_green) lc(forest_green) ms(O)),   ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>  ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>  ///
>                 xlabel(2016(1)2024)                                                                    
>          ///
>                 ytitle("Effect on In-Migration (pp)")                                           ///
>                 xtitle("Year")                                                                         
>                  ///
>                 legend(off)                                                                            
>                  ///
>                 title("In-Migration to Multnomah County (Lower 48 + DC)")       ///
>                 subtitle("College Degree vs. No College Degree")                        ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_in_migration_48.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_in_migration_48.png saved
    as PNG format

. 
.         ** Plot 4: Combined event study
.         twoway  (rcap out_ci_lo out_ci_hi year_out, lc(navy))                                   ///
>                         (connected out_coef year_out, mc(navy) lc(navy) ms(O))                  ///
>                         (rcap in_west_ci_lo in_west_ci_hi year_in_west, lc(maroon))     ///
>                         (connected in_west_coef year_in_west, mc(maroon) lc(maroon) ms(T))      ///
>                         (rcap in_48_ci_lo in_48_ci_hi year_in_48, lc(forest_green))     ///
>                         (connected in_48_coef year_in_48, mc(forest_green) lc(forest_green) ms(S)),    
>  ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>                  ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>                  ///
>                 xlabel(2016(1)2024)                                                                    
>                          ///
>                 ytitle("Effect on Migration Rate (pp)")                                                
>          ///
>                 xtitle("Year")                                                                         
>                                  ///
>                 legend(order(2 "Out-migration" 4 "In-migration (West Coast)"            ///
>                         6 "In-migration (Lower 48 + DC)") pos(6) rows(1))                              
>  ///
>                 title("Migration Effects: Multnomah County Tax")                                       
>  ///
>                 subtitle("College Degree vs. No College Degree")                                       
>  ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_combined.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_combined.png saved as PNG
    format

. 
. restore

. 
. ********************************************************************************
. ** REGRESSION 3: DIFFERENCE-IN-DIFFERENCES BY AGE
. ********************************************************************************
. 
. ** Create age × treatment interactions
. gen treated_age_1 = treated * (cat_age == 1)

. gen treated_age_2 = treated * (cat_age == 2)

. gen treated_age_3 = treated * (cat_age == 3)

. gen treated_age_4 = treated * (cat_age == 4)

. 
. label var treated_age_1 "College x Post x Age 18-24"

. label var treated_age_2 "College x Post x Age 25-44"

. label var treated_age_3 "College x Post x Age 45-64"

. label var treated_age_4 "College x Post x Age 65+"

. 
. ** Store estimates
. estimates clear

. 
. ** Out-migration regression by age (Sample 1: Multnomah residents)
. reghdfe out_1 treated_age_* if sample_1 == 1 [fw = perwt],      ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  4,940,249
Absorbing 7 HDFE groups                           F(   4,4940221) =     420.41
                                                  Prob > F        =     0.0000
                                                  R-squared       =     0.0203
                                                  Adj R-squared   =     0.0203
                                                  Within R-sq.    =     0.0004
                                                  Root MSE        =    23.7437

-------------------------------------------------------------------------------
              |               Robust
        out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
treated_age_1 |   4.206692   .2104285    19.99   0.000     3.794259    4.619124
treated_age_2 |     1.5351   .0558324    27.49   0.000      1.42567    1.644529
treated_age_3 |   1.276167   .0531025    24.03   0.000     1.172088    1.380246
treated_age_4 |  -.2597344   .0554651    -4.68   0.000     -.368444   -.1510247
        _cons |   5.835584   .0145176   401.97   0.000      5.80713    5.864038
-------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store did_age_out

. 
. ** In-migration regression by age (Sample 2: CA/OR/WA residents)
. reghdfe out_2 treated_age_* if sample_2 == 1 [fw = perwt],      ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  297625606
Absorbing 8 HDFE groups                           F(   4,     54) =       1.48
Statistics robust to heteroskedasticity           Prob > F        =     0.2203
                                                  R-squared       =     0.0058
                                                  Adj R-squared   =     0.0058
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.5587

                                 (Std. err. adjusted for 55 clusters in fips_o)
-------------------------------------------------------------------------------
              |               Robust
        out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
treated_age_1 |   .1764101   .0915682     1.93   0.059    -.0071731    .3599932
treated_age_2 |   .0038349   .0160875     0.24   0.812    -.0284186    .0360883
treated_age_3 |  -.0294809   .0171488    -1.72   0.091    -.0638621    .0049004
treated_age_4 |  -.0376184   .0165848    -2.27   0.027     -.070869   -.0043678
        _cons |   .0674534   .0018332    36.80   0.000     .0637781    .0711288
-------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_age_in_west

. 
. ** In-migration regression by age (Sample 3: Lower 48 + DC residents)
. reghdfe out_2 treated_age_* if sample_3 == 1 [fw = perwt],      ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 1925060790
Absorbing 8 HDFE groups                           F(   4,    527) =       3.38
Statistics robust to heteroskedasticity           Prob > F        =     0.0096
                                                  R-squared       =     0.0041
                                                  Adj R-squared   =     0.0041
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.2246

                                (Std. err. adjusted for 528 clusters in fips_o)
-------------------------------------------------------------------------------
              |               Robust
        out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
treated_age_1 |   .0275705   .0127281     2.17   0.031     .0025664    .0525746
treated_age_2 |   .0017701   .0031459     0.56   0.574    -.0044099    .0079501
treated_age_3 |  -.0092488    .002831    -3.27   0.001    -.0148103   -.0036874
treated_age_4 |  -.0103184    .003239    -3.19   0.002    -.0166814   -.0039554
        _cons |   .0156321   .0003585    43.60   0.000     .0149278    .0163364
-------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_age_in_48

. 
. ********************************************************************************
. ** COEFFICIENT PLOTS: DiD BY AGE
. ********************************************************************************
. 
. ** Plot 1: Out-migration by age
. coefplot did_age_out,                                                                                  
>  ///
>         keep(treated_age_*)                                                                            
>  ///
>         ciopts(recast(rcap))                                                                           
>  ///
>         yline(0, lc(gs10) lp(dash))                                                             ///
>         xline(0, lc(gs10) lp(dash))                                                             ///
>         coeflabels(treated_age_1 = "18-24" treated_age_2 = "25-44"      ///
>                 treated_age_3 = "45-64" treated_age_4 = "65+")          ///
>         ytitle("Age Group")                                                                            
>  ///
>         xtitle("Effect on Out-Migration Rate (pp)")                                     ///
>         title("Out-Migration from Multnomah County by Age")                     ///
>         subtitle("College x Post Interaction by Age Group")                     ///
>         graphregion(color(white))

. 
. graph export "${results}did/fig_did_age_out.png", replace
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_did_age_out.png not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_did_age_out.png saved as PNG
    format

. 
. ** Plot 2: In-migration (West Coast) by age
. coefplot did_age_in_west,                                                                              
>  ///
>         keep(treated_age_*)                                                                            
>  ///
>         ciopts(recast(rcap))                                                                           
>  ///
>         yline(0, lc(gs10) lp(dash))                                                             ///
>         xline(0, lc(gs10) lp(dash))                                                             ///
>         coeflabels(treated_age_1 = "18-24" treated_age_2 = "25-44"      ///
>                 treated_age_3 = "45-64" treated_age_4 = "65+")          ///
>         ytitle("Age Group")                                                                            
>  ///
>         xtitle("Effect on In-Migration Rate (pp)")                                      ///
>         title("In-Migration to Multnomah (West Coast) by Age")          ///
>         subtitle("College x Post Interaction by Age Group")                     ///
>         graphregion(color(white))

. 
. graph export "${results}did/fig_did_age_in_west.png", replace
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_did_age_in_west.png not
    found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_did_age_in_west.png saved as
    PNG format

. 
. ** Plot 3: In-migration (Lower 48 + DC) by age
. coefplot did_age_in_48,                                                                                
>  ///
>         keep(treated_age_*)                                                                            
>  ///
>         ciopts(recast(rcap))                                                                           
>  ///
>         yline(0, lc(gs10) lp(dash))                                                             ///
>         xline(0, lc(gs10) lp(dash))                                                             ///
>         coeflabels(treated_age_1 = "18-24" treated_age_2 = "25-44"      ///
>                 treated_age_3 = "45-64" treated_age_4 = "65+")          ///
>         ytitle("Age Group")                                                                            
>  ///
>         xtitle("Effect on In-Migration Rate (pp)")                                      ///
>         title("In-Migration to Multnomah (Lower 48 + DC) by Age")       ///
>         subtitle("College x Post Interaction by Age Group")                     ///
>         graphregion(color(white))

. 
. graph export "${results}did/fig_did_age_in_48.png", replace
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_did_age_in_48.png not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_did_age_in_48.png saved as
    PNG format

. 
. ** Plot 4: Combined DiD by age (all samples)
. coefplot        (did_age_out, label("Out-migration")                                            ///
>                                 mc(sea) ciopts(lc(sea)))                                               
>                  ///
>                         (did_age_in_west, label("In-migration (West Coast)")            ///
>                                 mc(vermillion) ciopts(lc(vermillion)))                                 
>  ///
>                         (did_age_in_48, label("In-migration (Lower 48 + DC)")           ///
>                                 mc(turquoise) ciopts(lc(turquoise))),                                  
>  ///
>         keep(treated_age_*)                                                                            
>                  ///
>         ciopts(recast(rcap))                                                                           
>                  ///
>         yline(0, lc(gs10) lp(dash))                                                                    
>          ///
>         xline(0, lc(gs10) lp(dash))                                                                    
>          ///
>         coeflabels(treated_age_1 = "18-24" treated_age_2 = "25-44"                      ///
>                 treated_age_3 = "45-64" treated_age_4 = "65+")                          ///
>         ytitle("Age Group")                                                                            
>                  ///
>         xtitle("Effect on Migration Rate (pp)")                                                        
>  ///
>         legend(pos(6) rows(1))                                                                         
>          ///
>         title("Effect of Multnomah County Tax by Age")                                          ///
>         subtitle("College x Post Interaction by Age Group")                                     ///
>         graphregion(color(white))

. 
. graph export "${results}did/fig_did_age_combined.png", replace
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_did_age_combined.png not
    found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_did_age_combined.png saved as
    PNG format

. 
. ********************************************************************************
. ** REGRESSION 4: EVENT STUDY BY AGE
. ********************************************************************************
. 
. ** Create year × education × age interactions (base year = 2019, 2020 excluded)
. foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2.         forvalues a = 1/4 {
  3.                 gen x_he_`y'_age`a' = high_ed * (year == `y') * (cat_age == `a')
  4.         }
  5. }

. 
. ** Out-migration event study by age
. reghdfe out_1 x_he_*_age* if sample_1 == 1 [fw = perwt],        ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  4,940,249
Absorbing 7 HDFE groups                           F(  28,4940197) =     234.85
                                                  Prob > F        =     0.0000
                                                  R-squared       =     0.0214
                                                  Adj R-squared   =     0.0214
                                                  Within R-sq.    =     0.0015
                                                  Root MSE        =    23.7305

--------------------------------------------------------------------------------
               |               Robust
         out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_he_2016_age1 |   9.590886   .4677815    20.50   0.000     8.674051    10.50772
x_he_2016_age2 |   .4381895    .107251     4.09   0.000     .2279813    .6483977
x_he_2016_age3 |  -.5692084    .096539    -5.90   0.000    -.7584214   -.3799954
x_he_2016_age4 |  -.8129739   .1143348    -7.11   0.000    -1.037066   -.5888818
x_he_2017_age1 |   5.924555   .4282726    13.83   0.000     5.085156    6.763954
x_he_2017_age2 |   .9300908   .1007008     9.24   0.000     .7327209    1.127461
x_he_2017_age3 |   2.057912   .1019426    20.19   0.000     1.858108    2.257716
x_he_2017_age4 |   2.255588    .123474    18.27   0.000     2.013583    2.497593
x_he_2018_age1 |   10.05077   .4939253    20.35   0.000     9.082695    11.01885
x_he_2018_age2 |   2.180571    .105912    20.59   0.000     1.972987    2.388155
x_he_2018_age3 |    -.64437   .0899093    -7.17   0.000    -.8205891    -.468151
x_he_2018_age4 |  -.4798878   .1010446    -4.75   0.000    -.6779317    -.281844
x_he_2021_age1 |    2.50488   .4324265     5.79   0.000     1.657339    3.352421
x_he_2021_age2 |   2.734966    .107609    25.42   0.000     2.524056    2.945876
x_he_2021_age3 |   .9905859    .100744     9.83   0.000     .7931312    1.188041
x_he_2021_age4 |   .0541246   .1100533     0.49   0.623     -.161576    .2698252
x_he_2022_age1 |   6.784287   .4221186    16.07   0.000      5.95695    7.611625
x_he_2022_age2 |   3.020563   .1113542    27.13   0.000     2.802313    3.238813
x_he_2022_age3 |   1.048525   .1050626     9.98   0.000     .8426058    1.254444
x_he_2022_age4 |   2.425017   .1325645    18.29   0.000     2.165196    2.684839
x_he_2023_age1 |   4.817064   .3640273    13.23   0.000     4.103583    5.530545
x_he_2023_age2 |   1.554406    .103151    15.07   0.000     1.352233    1.756578
x_he_2023_age3 |   3.215491   .1055514    30.46   0.000     3.008614    3.422368
x_he_2023_age4 |  -.4482232   .0926689    -4.84   0.000     -.629851   -.2665955
x_he_2024_age1 |   7.181952   .4230336    16.98   0.000     6.352821    8.011082
x_he_2024_age2 |   2.035919   .1015888    20.04   0.000     1.836809    2.235029
x_he_2024_age3 |   2.164931   .0958626    22.58   0.000     1.977044    2.352819
x_he_2024_age4 |  -.4159041   .0868636    -4.79   0.000    -.5861536   -.2456545
         _cons |   5.501312   .0261419   210.44   0.000     5.450074    5.552549
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store es_age_out

. 
. ** In-migration event study by age (West Coast)
. reghdfe out_2 x_he_*_age* if sample_2 == 1 [fw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  297625606
Absorbing 8 HDFE groups                           F(  28,     54) =       3.55
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.0059
                                                  Adj R-squared   =     0.0059
                                                  Within R-sq.    =     0.0001
Number of clusters (fips_o)  =         55         Root MSE        =     2.5587

                                  (Std. err. adjusted for 55 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_he_2016_age1 |    .116345   .1022546     1.14   0.260    -.0886631    .3213532
x_he_2016_age2 |    .030291   .0248121     1.22   0.227    -.0194544    .0800363
x_he_2016_age3 |   -.025082    .030652    -0.82   0.417    -.0865355    .0363715
x_he_2016_age4 |  -.0438552    .021029    -2.09   0.042    -.0860158   -.0016946
x_he_2017_age1 |   .2158114   .0921593     2.34   0.023     .0310431    .4005797
x_he_2017_age2 |   .0173834   .0198698     0.87   0.386    -.0224531    .0572199
x_he_2017_age3 |  -.0416858   .0196559    -2.12   0.039    -.0810936    -.002278
x_he_2017_age4 |  -.0659194   .0319863    -2.06   0.044     -.130048   -.0017907
x_he_2018_age1 |   .2335527   .1234059     1.89   0.064    -.0138612    .4809667
x_he_2018_age2 |   .0457768   .0347201     1.32   0.193    -.0238328    .1153863
x_he_2018_age3 |  -.0050265   .0256287    -0.20   0.845    -.0564089    .0463559
x_he_2018_age4 |  -.0252927   .0221177    -1.14   0.258    -.0696361    .0190507
x_he_2021_age1 |   .2469107   .1358966     1.82   0.075    -.0255456    .5193669
x_he_2021_age2 |   .0807291   .0465324     1.73   0.088    -.0125626    .1740209
x_he_2021_age3 |  -.0478946    .028814    -1.66   0.102    -.1056632    .0098741
x_he_2021_age4 |  -.0250447   .0280392    -0.89   0.376      -.08126    .0311705
x_he_2022_age1 |   .2950717   .1882574     1.57   0.123    -.0823617     .672505
x_he_2022_age2 |   .0033668   .0156114     0.22   0.830    -.0279322    .0346658
x_he_2022_age3 |  -.0111911   .0293766    -0.38   0.705    -.0700877    .0477055
x_he_2022_age4 |  -.0562313   .0246028    -2.29   0.026     -.105557   -.0069057
x_he_2023_age1 |   .1208385   .0886993     1.36   0.179     -.056993      .29867
x_he_2023_age2 |   -.011558   .0326016    -0.35   0.724    -.0769202    .0538043
x_he_2023_age3 |  -.0376957   .0327805    -1.15   0.255    -.1034167    .0280252
x_he_2023_age4 |  -.0359353   .0324165    -1.11   0.273    -.1009265    .0290559
x_he_2024_age1 |   .0966876   .1067929     0.91   0.369    -.1174194    .3107946
x_he_2024_age2 |  -.0218652   .0309693    -0.71   0.483    -.0839549    .0402246
x_he_2024_age3 |  -.0263885   .0257143    -1.03   0.309    -.0779426    .0251656
x_he_2024_age4 |  -.0476121   .0282709    -1.68   0.098    -.1042918    .0090676
         _cons |   .0665527   .0046704    14.25   0.000     .0571891    .0759163
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_age_in_west

. 
. ** In-migration event study by age (Lower 48 + DC)
. reghdfe out_2 x_he_*_age* if sample_3 == 1 [fw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 1925060790
Absorbing 8 HDFE groups                           F(  28,    527) =       2.51
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.0041
                                                  Adj R-squared   =     0.0041
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.2246

                                 (Std. err. adjusted for 528 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_he_2016_age1 |   .0181861     .01527     1.19   0.234    -.0118114    .0481837
x_he_2016_age2 |   .0088194   .0052559     1.68   0.094    -.0015056    .0191444
x_he_2016_age3 |  -.0073424   .0053112    -1.38   0.167    -.0177761    .0030913
x_he_2016_age4 |  -.0124549   .0043592    -2.86   0.004    -.0210184   -.0038913
x_he_2017_age1 |    .039433   .0169107     2.33   0.020     .0062124    .0726536
x_he_2017_age2 |   .0083097   .0048349     1.72   0.086    -.0011883    .0178076
x_he_2017_age3 |  -.0113289   .0036127    -3.14   0.002    -.0184259   -.0042318
x_he_2017_age4 |   -.016416   .0056923    -2.88   0.004    -.0275984   -.0052337
x_he_2018_age1 |   .0505087   .0221455     2.28   0.023     .0070043     .094013
x_he_2018_age2 |   .0078117   .0063455     1.23   0.219    -.0046539    .0202773
x_he_2018_age3 |  -.0017967   .0052057    -0.35   0.730    -.0120233    .0084299
x_he_2018_age4 |  -.0097562   .0047554    -2.05   0.041    -.0190982   -.0004143
x_he_2021_age1 |   .0215699    .018647     1.16   0.248    -.0150617    .0582015
x_he_2021_age2 |    .014234    .008882     1.60   0.110    -.0032145    .0316824
x_he_2021_age3 |   -.013449   .0048548    -2.77   0.006    -.0229862   -.0039118
x_he_2021_age4 |  -.0101919   .0048891    -2.08   0.038    -.0197964   -.0005875
x_he_2022_age1 |   .0461065   .0243754     1.89   0.059    -.0017784    .0939914
x_he_2022_age2 |   .0075859   .0045514     1.67   0.096    -.0013552     .016527
x_he_2022_age3 |    -.00631   .0049506    -1.27   0.203    -.0160354    .0034154
x_he_2022_age4 |  -.0148865   .0043394    -3.43   0.001    -.0234111   -.0063619
x_he_2023_age1 |   .0351077   .0242859     1.45   0.149    -.0126013    .0828168
x_he_2023_age2 |  -.0017451   .0064692    -0.27   0.787    -.0144536    .0109634
x_he_2023_age3 |  -.0129433    .005223    -2.48   0.014    -.0232037   -.0026829
x_he_2023_age4 |   -.011994    .006906    -1.74   0.083    -.0255606    .0015726
x_he_2024_age1 |   .0150043   .0169593     0.88   0.377    -.0183118    .0483204
x_he_2024_age2 |  -.0059065   .0058455    -1.01   0.313    -.0173899    .0055768
x_he_2024_age3 |  -.0081108   .0046358    -1.75   0.081    -.0172177    .0009961
x_he_2024_age4 |  -.0101322   .0062411    -1.62   0.105    -.0223927    .0021282
         _cons |   .0155967   .0008909    17.51   0.000     .0138465    .0173469
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_age_in_48

. 
. ********************************************************************************
. ** EVENT STUDY BY AGE PLOTS
. ********************************************************************************
. 
. preserve

.         (pp)")                                                                                  ///
( is not a valid command name
r(199);

end of do-file
r(199);

end of do-file

r(199);

. clear

. do "C:\Users\ji252\Documents\GitHub\multnomah-county-tax\code\02_did_analysis.do"

. /*******************************************************************************
> File Name:              02_did_analysis.do
> Creator:                John Iselin
> Date Update:    January 11, 2026
> 
> Called by: 00_multnomah.do
> 
> Purpose: Perform DiD analysis on ACS data examining the effect of the
>          Multnomah County tax on migration patterns by education level.
> 
> Authors: John Iselin
> 
> For more information, contact john.iselin@yale.edu
> 
> *******************************************************************************/
. 
. 
. ** Start log file
. capture log close log_02

. log using "${logs}02_log_did_${date}", replace text name(log_02)
---------------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_did_2026-02-05.log
  log type:  text
 opened on:   5 Feb 2026, 20:40:02

. 
. 
. ********************************************************************************
. ** LOAD AND PREPARE DATA
. ********************************************************************************
. 
. ** Load ACS migration data
. use "${data}working/acs_migration_file", replace

. 
. ** Sample restrictions
. drop if year == 2015                                    // Sample: 2016-2024
(2,334,973 observations deleted)

. drop if qmigplc1 == 4                                   // Error in migration place
(401,283 observations deleted)

. drop if inlist(state_fips_o, 2, 15)     // Alaska and Hawaii
(137,699 observations deleted)

. drop if inlist(state_fips_d, 2, 15)     // Alaska and Hawaii
(3,633 observations deleted)

. 
. ********************************************************************************
. ** DEFINE SAMPLES AND TREATMENT
. ********************************************************************************
. 
. ** Multnomah county indicators
. gen multnomah_o = (state_fips_o == 41 & county_fips_o == 51)

. gen multnomah_d = (state_fips_d == 41 & county_fips_d == 51)

. 
. ** Analysis samples
. gen sample_1 = (multnomah_o == 1) & year != 2020    // Multnomah in origin (out-migration)

. gen sample_2 = (multnomah_o != 1) &                             ///
>                                 year != 2020 &                                          /// Not Multnom
> ah in origin
>                            inlist(state_fips_o, 6, 41, 53)      // CA, OR, WA (in-migration)

. gen sample_3 = (multnomah_o != 1) &                             /// Not Multnomah in origin
>                                 year != 2020                                            // 

. 
. label var sample_1 "Out-migration Sample"

. label var sample_2 "In-migration Sample (West Coast)"

. label var sample_3 "In-migration Sample (Lower 48 + DC)"

. 
. ** Outcome variables (scaled to percentages)
. gen out_1 = (same_county == 0) * 100

. label var out_1 "Moved out of Multnomah (%)"

. 
. gen out_2 = (multnomah_d == 1) * 100

. label var out_2 "Moved to Multnomah (%)"

. 
. ** Treatment variables
. gen post = year > 2020

. label var post "Post-2020"

. 
. gen high_ed = educd >= 101

. label var high_ed "College Degree"

. 
. gen treated = high_ed * post

. label var treated "College Degree × Post"

. 
. ********************************************************************************
. ** COVARIATE CATEGORIES
. ********************************************************************************
. 
. ** Age categories
. recode age ///
>     (18/24   = 1 "18-24") ///
>     (25/44   = 2 "25-44") ///
>     (45/64   = 3 "45-64") ///
>     (65/max  = 4 "65+"), ///
>     gen(cat_age)
(21,137,449 differences between age and cat_age)

. label var cat_age "Age categories"

. 
. ** Sex
. gen cat_sex = (sex == 2)

. label var cat_sex "Female indicator"

. label define lb_cat_sex 0 "Male" 1 "Female", replace

. label values cat_sex lb_cat_sex

. 
. ** Marital status
. recode marst ///
>     (1       = 1 "Married") ///
>     (2/3     = 2 "Separated") ///
>     (4/5     = 3 "Divorced / Widowed") ///
>     (6       = 4 "Single"), ///
>     gen(cat_married)
(9,179,293 differences between marst and cat_married)

. label var cat_married "Marriage categories"

. 
. ** Number of children
. recode nchild ///
>     (0       = 0 "0 Children") ///
>     (1       = 1 "1 Child") ///
>     (2       = 2 "2 Children") ///
>     (3/max   = 3 "3+ Children"), ///
>     gen(cat_child)
(412,696 differences between nchild and cat_child)

. label var cat_child "Number of Children"

. 
. ** Age of youngest child
. recode yngch ///
>     (99      = 0 "No Children") ///
>     (0/4     = 1 "0-4") ///
>     (5/12    = 2 "5-12") ///
>     (13/17   = 3 "13-17")       ///
>         (18/max  = 4 "18+"), ///
>     gen(cat_yngch)
(20,719,194 differences between yngch and cat_yngch)

. label var cat_yngch "Age of youngest child"

. 
. ** Education categories
. recode educd ///
>     (min/61  = 1 "Less than HS") ///
>     (62/71   = 2 "HS Diploma") ///
>     (80/100  = 3 "Some College") ///
>     (101/max = 4 "College Degree"), ///
>     gen(cat_educ)
(21,137,449 differences between educd and cat_educ)

. label var cat_educ "Education categories"

. 
. ********************************************************************************
. ** REGRESSION 1: DIFFERENCE-IN-DIFFERENCES
. ********************************************************************************
. 
. ** Store estimates for coefficient plot
. estimates clear

. 
. ** Out-migration regression (Sample 1: Multnomah residents)
. reghdfe out_1 treated if sample_1 == 1 [fw = perwt],    ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  4,940,249
Absorbing 7 HDFE groups                           F(   1,4940224) =     808.40
                                                  Prob > F        =     0.0000
                                                  R-squared       =     0.0201
                                                  Adj R-squared   =     0.0201
                                                  Within R-sq.    =     0.0002
                                                  Root MSE        =    23.7465

------------------------------------------------------------------------------
             |               Robust
       out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |   1.232005   .0433311    28.43   0.000     1.147078    1.316933
       _cons |    5.83538   .0145229   401.81   0.000     5.806915    5.863844
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store did_out

. 
. ** In-migration regression (Sample 2: CA/OR/WA residents)
. reghdfe out_2 treated if sample_2 == 1 [fw = perwt],    ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  297625606
Absorbing 8 HDFE groups                           F(   1,     54) =       0.74
Statistics robust to heteroskedasticity           Prob > F        =     0.3926
                                                  R-squared       =     0.0058
                                                  Adj R-squared   =     0.0058
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.5588

                                (Std. err. adjusted for 55 clusters in fips_o)
------------------------------------------------------------------------------
             |               Robust
       out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |  -.0089625   .0103988    -0.86   0.393    -.0298108    .0118858
       _cons |   .0674888   .0018439    36.60   0.000      .063792    .0711856
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_in_west

. 
. ** In-migration regression (Sample 3: Lower 48 + DC residents)
. reghdfe out_2 treated if sample_3 == 1 [fw = perwt],    ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 1925060790
Absorbing 8 HDFE groups                           F(   1,    527) =       2.60
Statistics robust to heteroskedasticity           Prob > F        =     0.1072
                                                  R-squared       =     0.0040
                                                  Adj R-squared   =     0.0040
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.2246

                               (Std. err. adjusted for 528 clusters in fips_o)
------------------------------------------------------------------------------
             |               Robust
       out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |  -.0033242   .0020603    -1.61   0.107    -.0073716    .0007232
       _cons |   .0156366   .0003574    43.76   0.000     .0149346    .0163386
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_in_48

. 
. ********************************************************************************
. ** TABLE: DiD RESULTS
. ********************************************************************************
. 
. esttab did_out did_in_west did_in_48                                                                   
>  ///
>         using "${results}did/tab_did_overall.tex",                                                     
>  ///
>         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                                                       
>  ///
>         b(%-9.3f) se(%-9.3f) replace                                                                   
>          ///
>         keep(treated)                                                                                  
>                          ///
>         coeflabels(treated = "College Degree $\times$ Post")                            ///
>         mtitle( "Out-migration"                                                                        
>                  ///
>                         "In-migration (West Coast)"                                                    
>          ///
>                         "In-migration (Lower 48 + DC)")                                                
>          ///
>         stats(N, fmt(%9.0fc) labels("Observations"))
=exp not allowed
r(101);

end of do-file

r(101);

. do "C:\Users\ji252
> \AppData\Local\Tem
> p\STD44e8_000002.t
> mp"

. esttab did_out did
> _in_west did_in_48
>                   
>                   
>                   
>               ///
>         using "${r
> esults}did/tab_did
> _overall.tex",    
>                   
>                   
>               ///
>         starlevel(
> "*" 0.10 "**" 0.05
>  "***" 0.01)      
>                   
>                   
>               ///
>         b(%-9.3f) 
> se(%-9.3f) replace
>                   
>                   
>                   
>                   
>     ///
>         keep(treat
> ed)               
>                   
>                   
>                   
>                   
>                   
>   ///
>         coeflabels
> (treated  "College
>  Degree $\times$ P
> ost")             
>                 //
> /
>         mtitle( "O
> ut-migration"     
>                   
>                   
>                   
>                   
>             ///
>                   
>       "In-migratio
> n (West Coast)"   
>                   
>                   
>                   
>     ///
>                   
>       "In-migratio
> n (Lower 48 + DC)"
> )                 
>                   
>                   
>     ///
>         stats(N, f
> mt(%9.0fc) labels(
> "Observations"))
(file
C:/Users/ji252/Docum
> ents/GitHub/multno
> mah-county-tax/res
> ults/did/tab_did_o
> verall.tex not
found)
(output written to C
> :/Users/ji252/Docu
> ments/GitHub/multn
> omah-county-tax/re
> sults/did/tab_did_
> overall.tex)

. 
end of do-file

. help esttab

. help esttab

. do "C:\Users\ji252\AppData\Local\Temp\STD44e8_000003.tmp"

. 
. esttab did_out did_in_west did_in_48                                                                   
>  ///
>         using "${results}did/tab_did_overall.tex",                                                     
>  ///
>         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                                                       
>  ///
>         b(%-9.3f) se(%-9.3f) replace                                                                   
>          ///
>         keep(treated)                                                                                  
>                          ///
>         coeflabels(treated  "College Degree $\times$ Post")                             ///
>         mtitle( "Out-migration"                                                                        
>                  ///
>                         "In-migration (West Coast)"                                                    
>          ///
>                         "In-migration (Lower 48 + DC)")                                                
>          ///
>         stats(N, fmt(%12.0fc) labels("Observations"))
(output written to C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/tab_did_overall.tex)

. 
end of do-file

. do "C:\Users\ji252\AppData\Local\Temp\STD44e8_000004.tmp"

. /*******************************************************************************
> File Name:              02_did_analysis.do
> Creator:                John Iselin
> Date Update:    January 11, 2026
> 
> Called by: 00_multnomah.do
> 
> Purpose: Perform DiD analysis on ACS data examining the effect of the
>          Multnomah County tax on migration patterns by education level.
> 
> Authors: John Iselin
> 
> For more information, contact john.iselin@yale.edu
> 
> *******************************************************************************/
. 
. 
. ** Start log file
. capture log close log_02

. log using "${logs}02_log_did_${date}", replace text name(log_02)
---------------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_did_2026-02-05.log
  log type:  text
 opened on:   5 Feb 2026, 20:56:42

. 
. 
. ********************************************************************************
. ** LOAD AND PREPARE DATA
. ********************************************************************************
. 
. ** Load ACS migration data
. use "${data}working/acs_migration_file", replace

. 
. ** Sample restrictions
. drop if year == 2015                                    // Sample: 2016-2024
(2,334,973 observations deleted)

. drop if qmigplc1 == 4                                   // Error in migration place
(401,283 observations deleted)

. drop if inlist(state_fips_o, 2, 15)     // Alaska and Hawaii
(137,699 observations deleted)

. drop if inlist(state_fips_d, 2, 15)     // Alaska and Hawaii
(3,633 observations deleted)

. 
. ********************************************************************************
. ** DEFINE SAMPLES AND TREATMENT
. ********************************************************************************
. 
. ** Multnomah county indicators
. gen multnomah_o = (state_fips_o == 41 & county_fips_o == 51)

. gen multnomah_d = (state_fips_d == 41 & county_fips_d == 51)

. 
. ** Analysis samples
. gen sample_1 = (multnomah_o == 1) & year != 2020    // Multnomah in origin (out-migration)

. gen sample_2 = (multnomah_o != 1) &                             ///
>                                 year != 2020 &                                          /// Not Multnom
> ah in origin
>                            inlist(state_fips_o, 6, 41, 53)      // CA, OR, WA (in-migration)

. gen sample_3 = (multnomah_o != 1) &                             /// Not Multnomah in origin
>                                 year != 2020                                            // 

. 
. label var sample_1 "Out-migration Sample"

. label var sample_2 "In-migration Sample (West Coast)"

. label var sample_3 "In-migration Sample (Lower 48 + DC)"

. 
. ** Outcome variables (scaled to percentages)
. gen out_1 = (same_county == 0) * 100

. label var out_1 "Moved out of Multnomah (%)"

. 
. gen out_2 = (multnomah_d == 1) * 100

. label var out_2 "Moved to Multnomah (%)"

. 
. ** Treatment variables
. gen post = year > 2020

. label var post "Post-2020"

. 
. gen high_ed = educd >= 101

. label var high_ed "College Degree"

. 
. gen treated = high_ed * post

. label var treated "College Degree × Post"

. 
. ********************************************************************************
. ** COVARIATE CATEGORIES
. ********************************************************************************
. 
. ** Age categories
. recode age ///
>     (18/24   = 1 "18-24") ///
>     (25/44   = 2 "25-44") ///
>     (45/64   = 3 "45-64") ///
>     (65/max  = 4 "65+"), ///
>     gen(cat_age)
(21,137,449 differences between age and cat_age)

. label var cat_age "Age categories"

. 
. ** Sex
. gen cat_sex = (sex == 2)

. label var cat_sex "Female indicator"

. label define lb_cat_sex 0 "Male" 1 "Female", replace

. label values cat_sex lb_cat_sex

. 
. ** Marital status
. recode marst ///
>     (1       = 1 "Married") ///
>     (2/3     = 2 "Separated") ///
>     (4/5     = 3 "Divorced / Widowed") ///
>     (6       = 4 "Single"), ///
>     gen(cat_married)
(9,179,293 differences between marst and cat_married)

. label var cat_married "Marriage categories"

. 
. ** Number of children
. recode nchild ///
>     (0       = 0 "0 Children") ///
>     (1       = 1 "1 Child") ///
>     (2       = 2 "2 Children") ///
>     (3/max   = 3 "3+ Children"), ///
>     gen(cat_child)
(412,696 differences between nchild and cat_child)

. label var cat_child "Number of Children"

. 
. ** Age of youngest child
. recode yngch ///
>     (99      = 0 "No Children") ///
>     (0/4     = 1 "0-4") ///
>     (5/12    = 2 "5-12") ///
>     (13/17   = 3 "13-17")       ///
>         (18/max  = 4 "18+"), ///
>     gen(cat_yngch)
(20,719,194 differences between yngch and cat_yngch)

. label var cat_yngch "Age of youngest child"

. 
. ** Education categories
. recode educd ///
>     (min/61  = 1 "Less than HS") ///
>     (62/71   = 2 "HS Diploma") ///
>     (80/100  = 3 "Some College") ///
>     (101/max = 4 "College Degree"), ///
>     gen(cat_educ)
(21,137,449 differences between educd and cat_educ)

. label var cat_educ "Education categories"

. 
. ********************************************************************************
. ** REGRESSION 1: DIFFERENCE-IN-DIFFERENCES
. ********************************************************************************
. 
. ** Store estimates for coefficient plot
. estimates clear

. 
. ** Out-migration regression (Sample 1: Multnomah residents)
. reghdfe out_1 treated if sample_1 == 1 [pw = perwt],    ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     47,139
Absorbing 7 HDFE groups                           F(   1,  47114) =       4.51
                                                  Prob > F        =     0.0338
                                                  R-squared       =     0.0201
                                                  Adj R-squared   =     0.0196
                                                  Within R-sq.    =     0.0002
                                                  Root MSE        =    23.7528

------------------------------------------------------------------------------
             |               Robust
       out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |   1.232005   .5804414     2.12   0.034     .0943319    2.369679
       _cons |    5.83538   .1934965    30.16   0.000     5.456124    6.214636
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store did_out

. 
. ** In-migration regression (Sample 2: CA/OR/WA residents)
. reghdfe out_2 treated if sample_2 == 1 [pw = perwt],    ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  2,946,024
Absorbing 8 HDFE groups                           F(   1,     54) =       0.74
Statistics robust to heteroskedasticity           Prob > F        =     0.3926
                                                  R-squared       =     0.0058
                                                  Adj R-squared   =     0.0058
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.5588

                                (Std. err. adjusted for 55 clusters in fips_o)
------------------------------------------------------------------------------
             |               Robust
       out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |  -.0089625   .0103988    -0.86   0.393    -.0298109    .0118858
       _cons |   .0674888   .0018439    36.60   0.000      .063792    .0711857
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_in_west

. 
. ** In-migration regression (Sample 3: Lower 48 + DC residents)
. reghdfe out_2 treated if sample_3 == 1 [pw = perwt],    ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 19,190,525
Absorbing 8 HDFE groups                           F(   1,    527) =       2.60
Statistics robust to heteroskedasticity           Prob > F        =     0.1072
                                                  R-squared       =     0.0040
                                                  Adj R-squared   =     0.0040
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.2246

                               (Std. err. adjusted for 528 clusters in fips_o)
------------------------------------------------------------------------------
             |               Robust
       out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |  -.0033242   .0020603    -1.61   0.107    -.0073716    .0007232
       _cons |   .0156366   .0003574    43.76   0.000     .0149346    .0163386
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_in_48

. 
. ********************************************************************************
. ** TABLE: DiD RESULTS
. ********************************************************************************
. 
. esttab did_out did_in_west did_in_48                                                                   
>  ///
>         using "${results}did/tab_did_overall.tex",                                                     
>  ///
>         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                                                       
>  ///
>         b(%-9.3f) se(%-9.3f) replace                                                                   
>          ///
>         keep(treated)                                                                                  
>                          ///
>         coeflabels(treated  "College Degree $\times$ Post")                             ///
>         mtitle( "Out-migration"                                                                        
>                  ///
>                         "In-migration (West Coast)"                                                    
>          ///
>                         "In-migration (Lower 48 + DC)")                                                
>          ///
>         stats(N, fmt(%12.0fc) labels("Observations"))
(output written to C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/tab_did_overall.tex)

. 
. ********************************************************************************
. ** REGRESSION 2: EVENT STUDY
. ********************************************************************************
. 
. ** Create year × education interactions (base year = 2019, 2020 excluded)
. foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2.         gen x_high_ed_`y' = high_ed * (year == `y')
  3. }

. 
. ** Out-migration event study
. reghdfe out_1 x_high_ed_* if sample_1 == 1 [pw = perwt],        ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     47,139
Absorbing 7 HDFE groups                           F(   7,  47108) =       1.08
                                                  Prob > F        =     0.3730
                                                  R-squared       =     0.0202
                                                  Adj R-squared   =     0.0196
                                                  Within R-sq.    =     0.0003
                                                  Root MSE        =    23.7529

--------------------------------------------------------------------------------
               |               Robust
         out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_high_ed_2016 |   .2157829    1.12025     0.19   0.847    -1.979922    2.411488
x_high_ed_2017 |   1.621033   1.091858     1.48   0.138    -.5190244    3.761091
x_high_ed_2018 |   1.121102   1.042543     1.08   0.282    -.9222971    3.164502
x_high_ed_2021 |   1.763493    1.08754     1.62   0.105     -.368102    3.895088
x_high_ed_2022 |   2.440565   1.261722     1.93   0.053    -.0324276    4.913558
x_high_ed_2023 |   1.844759    1.05149     1.75   0.079    -.2161771    3.905695
x_high_ed_2024 |   1.818619   1.052574     1.73   0.084    -.2444413    3.881679
         _cons |    5.50135    .339634    16.20   0.000     4.835663    6.167037
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store es_out

. 
. ** In-migration event study
. reghdfe out_2 x_high_ed_* if sample_2 == 1 [pw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  2,946,024
Absorbing 8 HDFE groups                           F(   7,     54) =       1.72
Statistics robust to heteroskedasticity           Prob > F        =     0.1249
                                                  R-squared       =     0.0058
                                                  Adj R-squared   =     0.0058
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.5588

                                  (Std. err. adjusted for 55 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_high_ed_2016 |   .0006089   .0176853     0.03   0.973     -.034848    .0360657
x_high_ed_2017 |  -.0112805   .0173832    -0.65   0.519    -.0461316    .0235707
x_high_ed_2018 |   .0218863   .0186693     1.17   0.246    -.0155434    .0593161
x_high_ed_2021 |   .0234131   .0266451     0.88   0.383    -.0300071    .0768334
x_high_ed_2022 |  -.0022492   .0138437    -0.16   0.872    -.0300041    .0255057
x_high_ed_2023 |  -.0201526   .0249975    -0.81   0.424    -.0702697    .0299644
x_high_ed_2024 |  -.0243619   .0235203    -1.04   0.305    -.0715172    .0227935
         _cons |   .0665584   .0047197    14.10   0.000     .0570961    .0760207
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_in_west

. 
. ** In-migration event study
. reghdfe out_2 x_high_ed_* if sample_3 == 1 [pw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 19,190,525
Absorbing 8 HDFE groups                           F(   7,    527) =       1.08
Statistics robust to heteroskedasticity           Prob > F        =     0.3732
                                                  R-squared       =     0.0040
                                                  Adj R-squared   =     0.0040
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.2246

                                 (Std. err. adjusted for 528 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_high_ed_2016 |  -.0004553    .003629    -0.13   0.900    -.0075843    .0066738
x_high_ed_2017 |  -.0019644   .0034234    -0.57   0.566    -.0086895    .0047608
x_high_ed_2018 |   .0029225   .0038388     0.76   0.447    -.0046187    .0104638
x_high_ed_2021 |   .0001685   .0049201     0.03   0.973     -.009497     .009834
x_high_ed_2022 |   8.89e-07   .0031913     0.00   1.000    -.0062684    .0062702
x_high_ed_2023 |  -.0060519   .0047712    -1.27   0.205    -.0154248    .0033209
x_high_ed_2024 |  -.0066425   .0044517    -1.49   0.136    -.0153878    .0021027
         _cons |   .0155965   .0008911    17.50   0.000      .013846    .0173471
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_in_48

. 
. ********************************************************************************
. ** EVENT STUDY PLOTS
. ********************************************************************************
. 
. ** Extract coefficients and create event study dataset
. preserve

.         clear

.         set obs 9
Number of observations (_N) was 0, now 9.

.         gen year = 2015 + _n

. 
.         ** Out-migration coefficients
.         gen out_coef = .
(9 missing values generated)

.         gen out_ci_lo = .
(9 missing values generated)

.         gen out_ci_hi = .
(9 missing values generated)

. 
.         ** In-migration coefficients
.         gen in_west_coef = .
(9 missing values generated)

.         gen in_west_ci_lo = .
(9 missing values generated)

.         gen in_west_ci_hi = .
(9 missing values generated)

.         
.         ** In-migration coefficients
.         gen in_48_coef = .
(9 missing values generated)

.         gen in_48_ci_lo = .
(9 missing values generated)

.         gen in_48_ci_hi = .
(9 missing values generated)

. 
.         ** Fill in coefficients (2020 = base year = 0)
.         foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2. 
.                 ** Out-migration
.                 estimates restore es_out
  3.                 capture {
  4.                         replace out_coef = _b[x_high_ed_`y'] if year == `y'
  5.                         replace out_ci_lo = _b[x_high_ed_`y'] - 1.96 * _se[x_high_ed_`y'] if year ==
>  `y'
  6.                         replace out_ci_hi = _b[x_high_ed_`y'] + 1.96 * _se[x_high_ed_`y'] if year ==
>  `y'
  7.                 }
  8. 
.                 ** In-migration
.                 estimates restore es_in_west
  9.                 capture {
 10.                         replace in_west_coef = _b[x_high_ed_`y'] if year == `y'
 11.                         replace in_west_ci_lo = _b[x_high_ed_`y'] - 1.96 * _se[x_high_ed_`y'] if yea
> r == `y'
 12.                         replace in_west_ci_hi = _b[x_high_ed_`y'] + 1.96 * _se[x_high_ed_`y'] if yea
> r == `y'
 13.                 }
 14.                 
.                 ** In-migration
.                 estimates restore es_in_48
 15.                 capture {
 16.                         replace in_48_coef = _b[x_high_ed_`y'] if year == `y'
 17.                         replace in_48_ci_lo = _b[x_high_ed_`y'] - 1.96 * _se[x_high_ed_`y'] if year 
> == `y'
 18.                         replace in_48_ci_hi = _b[x_high_ed_`y'] + 1.96 * _se[x_high_ed_`y'] if year 
> == `y'
 19.                 }
 20.                 
.         }
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)

. 
.         ** Base year (2019) = 0; 2020 excluded (no coefficient)
.         foreach v in out_coef out_ci_lo out_ci_hi in_west_coef in_west_ci_lo in_west_ci_hi in_48_coef i
> n_48_ci_lo in_48_ci_hi {
  2.                 replace `v' = 0 if year == 2019
  3.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
.         ** Offset years slightly for visibility
.         gen year_out = year - 0.15

.         gen year_in_west = year

.         gen year_in_48 = year + 0.15

. 
.         ** Plot 1: Out-migration event study
.         twoway  (rcap out_ci_lo out_ci_hi year, lc(navy))                               ///
>                         (connected out_coef year, mc(navy) lc(navy) ms(O)),             ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>  ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>  ///
>                 xlabel(2016(1)2024)                                                                    
>          ///
>                 ytitle("Effect on Out-Migration (pp)")                                          ///
>                 xtitle("Year")                                                                         
>                  ///
>                 legend(off)                                                                            
>                  ///
>                 title("Out-Migration from Multnomah County")                            ///
>                 subtitle("College Degree vs. No College Degree")                        ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_out_migration.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_out_migration.png saved as
    PNG format

. 
.         ** Plot 2: In-migration event study (West Coast)
.         twoway  (rcap in_west_ci_lo in_west_ci_hi year, lc(maroon))     ///
>                         (connected in_west_coef year, mc(maroon) lc(maroon) ms(O)),     ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>  ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>  ///
>                 xlabel(2016(1)2024)                                                                    
>          ///
>                 ytitle("Effect on In-Migration (pp)")                                           ///
>                 xtitle("Year")                                                                         
>                  ///
>                 legend(off)                                                                            
>                  ///
>                 title("In-Migration to Multnomah County (West Coast)")          ///
>                 subtitle("College Degree vs. No College Degree")                        ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_in_migration_west.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_in_migration_west.png
    saved as PNG format

. 
.         ** Plot 3: In-migration event study (Lower 48 + DC)
.         twoway  (rcap in_48_ci_lo in_48_ci_hi year, lc(forest_green))   ///
>                         (connected in_48_coef year, mc(forest_green) lc(forest_green) ms(O)),   ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>  ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>  ///
>                 xlabel(2016(1)2024)                                                                    
>          ///
>                 ytitle("Effect on In-Migration (pp)")                                           ///
>                 xtitle("Year")                                                                         
>                  ///
>                 legend(off)                                                                            
>                  ///
>                 title("In-Migration to Multnomah County (Lower 48 + DC)")       ///
>                 subtitle("College Degree vs. No College Degree")                        ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_in_migration_48.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_in_migration_48.png saved
    as PNG format

. 
.         ** Plot 4: Combined event study
.         twoway  (rcap out_ci_lo out_ci_hi year_out, lc(navy))                                   ///
>                         (connected out_coef year_out, mc(navy) lc(navy) ms(O))                  ///
>                         (rcap in_west_ci_lo in_west_ci_hi year_in_west, lc(maroon))     ///
>                         (connected in_west_coef year_in_west, mc(maroon) lc(maroon) ms(T))      ///
>                         (rcap in_48_ci_lo in_48_ci_hi year_in_48, lc(forest_green))     ///
>                         (connected in_48_coef year_in_48, mc(forest_green) lc(forest_green) ms(S)),    
>  ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>                  ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>                  ///
>                 xlabel(2016(1)2024)                                                                    
>                          ///
>                 ytitle("Effect on Migration Rate (pp)")                                                
>          ///
>                 xtitle("Year")                                                                         
>                                  ///
>                 legend(order(2 "Out-migration" 4 "In-migration (West Coast)"            ///
>                         6 "In-migration (Lower 48 + DC)") pos(6) rows(1))                              
>  ///
>                 title("Migration Effects: Multnomah County Tax")                                       
>  ///
>                 subtitle("College Degree vs. No College Degree")                                       
>  ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_combined.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_combined.png saved as PNG
    format

. 
. restore

. 
. ********************************************************************************
. ** REGRESSION 3: DIFFERENCE-IN-DIFFERENCES BY AGE
. ********************************************************************************
. 
. ** Create age × treatment interactions
. gen treated_age_1 = treated * (cat_age == 1)

. gen treated_age_2 = treated * (cat_age == 2)

. gen treated_age_3 = treated * (cat_age == 3)

. gen treated_age_4 = treated * (cat_age == 4)

. 
. label var treated_age_1 "College x Post x Age 18-24"

. label var treated_age_2 "College x Post x Age 25-44"

. label var treated_age_3 "College x Post x Age 45-64"

. label var treated_age_4 "College x Post x Age 65+"

. 
. ** Store estimates
. estimates clear

. 
. ** Out-migration regression by age (Sample 1: Multnomah residents)
. reghdfe out_1 treated_age_* if sample_1 == 1 [pw = perwt],      ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     47,139
Absorbing 7 HDFE groups                           F(   4,  47111) =       2.56
                                                  Prob > F        =     0.0364
                                                  R-squared       =     0.0203
                                                  Adj R-squared   =     0.0198
                                                  Within R-sq.    =     0.0004
                                                  Root MSE        =    23.7507

-------------------------------------------------------------------------------
              |               Robust
        out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
treated_age_1 |   4.206692   2.667201     1.58   0.115     -1.02106    9.434443
treated_age_2 |     1.5351   .7605364     2.02   0.044     .0444374    3.025762
treated_age_3 |   1.276167   .6951838     1.84   0.066    -.0864033    2.638737
treated_age_4 |  -.2597344    .667996    -0.39   0.697    -1.569016    1.049547
        _cons |   5.835584   .1934643    30.16   0.000     5.456391    6.214777
-------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store did_age_out

. 
. ** In-migration regression by age (Sample 2: CA/OR/WA residents)
. reghdfe out_2 treated_age_* if sample_2 == 1 [pw = perwt],      ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  2,946,024
Absorbing 8 HDFE groups                           F(   4,     54) =       1.48
Statistics robust to heteroskedasticity           Prob > F        =     0.2203
                                                  R-squared       =     0.0058
                                                  Adj R-squared   =     0.0058
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.5588

                                 (Std. err. adjusted for 55 clusters in fips_o)
-------------------------------------------------------------------------------
              |               Robust
        out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
treated_age_1 |   .1764101   .0915686     1.93   0.059    -.0071739    .3599941
treated_age_2 |   .0038349   .0160875     0.24   0.812    -.0284187    .0360884
treated_age_3 |  -.0294809   .0171489    -1.72   0.091    -.0638623    .0049005
treated_age_4 |  -.0376184   .0165849    -2.27   0.027    -.0708692   -.0043677
        _cons |   .0674534   .0018332    36.80   0.000     .0637781    .0711288
-------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_age_in_west

. 
. ** In-migration regression by age (Sample 3: Lower 48 + DC residents)
. reghdfe out_2 treated_age_* if sample_3 == 1 [pw = perwt],      ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 19,190,525
Absorbing 8 HDFE groups                           F(   4,    527) =       3.38
Statistics robust to heteroskedasticity           Prob > F        =     0.0096
                                                  R-squared       =     0.0041
                                                  Adj R-squared   =     0.0040
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.2246

                                (Std. err. adjusted for 528 clusters in fips_o)
-------------------------------------------------------------------------------
              |               Robust
        out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
treated_age_1 |   .0275705   .0127281     2.17   0.031     .0025664    .0525746
treated_age_2 |   .0017701   .0031459     0.56   0.574    -.0044099    .0079501
treated_age_3 |  -.0092488    .002831    -3.27   0.001    -.0148103   -.0036873
treated_age_4 |  -.0103184    .003239    -3.19   0.002    -.0166814   -.0039554
        _cons |   .0156321   .0003585    43.60   0.000     .0149278    .0163364
-------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_age_in_48

. 
. ********************************************************************************
. ** TABLE: DiD BY AGE
. ********************************************************************************
. 
. esttab did_age_out did_age_in_west did_age_in_48                                                ///
>         using "${results}did/tab_did_by_age.tex",                                                      
>  ///
>         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                                                       
>  ///
>         b(%-9.3f) se(%-9.3f) replace                                                                   
>          ///
>         keep(treated_age_*)                                                                            
>                  ///
>         order(treated_age_1 treated_age_2 treated_age_3 treated_age_4)          ///
>         coeflabels(     treated_age_1  "College $\times$ Post $\times$ Age 18-24"       ///
>                                 treated_age_2  "College $\times$ Post $\times$ Age 25-44"       ///
>                                 treated_age_3  "College $\times$ Post $\times$ Age 45-64"       ///
>                                 treated_age_4  "College $\times$ Post $\times$ Age 65+")        ///
>         mtitle( "Out-migration"                                                                        
>                  ///
>                         "In-migration (West Coast)"                                                    
>          ///
>                         "In-migration (Lower 48 + DC)")                                                
>          ///
>         stats(N, fmt(%12.0fc) labels("Observations"))
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/tab_did_by_age.tex not found)
(output written to C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/tab_did_by_age.tex)

. 
. ********************************************************************************
. ** REGRESSION 4: EVENT STUDY BY AGE
. ********************************************************************************
. 
. ** Create year × education × age interactions (base year = 2019, 2020 excluded)
. foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2.         forvalues a = 1/4 {
  3.                 gen x_he_`y'_age`a' = high_ed * (year == `y') * (cat_age == `a')
  4.         }
  5. }

. 
. ** Out-migration event study by age
. reghdfe out_1 x_he_*_age* if sample_1 == 1 [pw = perwt],        ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     47,139
Absorbing 7 HDFE groups                           F(  28,  47087) =       1.55
                                                  Prob > F        =     0.0313
                                                  R-squared       =     0.0214
                                                  Adj R-squared   =     0.0204
                                                  Within R-sq.    =     0.0015
                                                  Root MSE        =    23.7435

--------------------------------------------------------------------------------
               |               Robust
         out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_he_2016_age1 |   9.590886   5.242235     1.83   0.067    -.6839692    19.86574
x_he_2016_age2 |   .4381895   1.422232     0.31   0.758    -2.349406    3.225785
x_he_2016_age3 |  -.5692084   1.258638    -0.45   0.651    -3.036157     1.89774
x_he_2016_age4 |  -.8129739   1.286826    -0.63   0.528    -3.335172    1.709224
x_he_2017_age1 |   5.924555   5.221217     1.13   0.257    -4.309105    16.15821
x_he_2017_age2 |   .9300908   1.309948     0.71   0.478    -1.637427    3.497609
x_he_2017_age3 |   2.057912   1.501669     1.37   0.171    -.8853803    5.001204
x_he_2017_age4 |   2.255588   1.450483     1.56   0.120    -.5873803    5.098556
x_he_2018_age1 |   10.05077   5.779527     1.74   0.082    -1.277186    21.37873
x_he_2018_age2 |   2.180571    1.33089     1.64   0.101    -.4279922    4.789134
x_he_2018_age3 |    -.64437   1.107386    -0.58   0.561    -2.814862    1.526122
x_he_2018_age4 |  -.4798878   1.137991    -0.42   0.673    -2.710366    1.750591
x_he_2021_age1 |    2.50488   5.012561     0.50   0.617    -7.319811    12.32957
x_he_2021_age2 |   2.734966   1.375891     1.99   0.047     .0382003    5.431731
x_he_2021_age3 |   .9905859   1.285971     0.77   0.441    -1.529936    3.511108
x_he_2021_age4 |   .0541246   1.294038     0.04   0.967    -2.482208    2.590458
x_he_2022_age1 |   6.784287   5.149933     1.32   0.188    -3.309655    16.87823
x_he_2022_age2 |   3.020563    1.77839     1.70   0.089    -.4651071    6.506233
x_he_2022_age3 |   1.048525   1.321265     0.79   0.427    -1.541174    3.638224
x_he_2022_age4 |   2.425017   1.626793     1.49   0.136    -.7635197    5.613554
x_he_2023_age1 |   4.817064   4.881821     0.99   0.324    -4.751375     14.3855
x_he_2023_age2 |   1.554406   1.246417     1.25   0.212    -.8885903    3.997401
x_he_2023_age3 |   3.215491   1.408986     2.28   0.022     .4538574    5.977124
x_he_2023_age4 |  -.4482232   1.154298    -0.39   0.698    -2.710664    1.814218
x_he_2024_age1 |   7.181952   5.364786     1.34   0.181    -3.333106    17.69701
x_he_2024_age2 |   2.035919   1.303867     1.56   0.118    -.5196791    4.591517
x_he_2024_age3 |   2.164931     1.2425     1.74   0.081    -.2703861    4.600249
x_he_2024_age4 |  -.4159041   1.038928    -0.40   0.689    -2.452219    1.620411
         _cons |   5.501312   .3401661    16.17   0.000     4.834581    6.168042
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store es_age_out

. 
. ** In-migration event study by age (West Coast)
. reghdfe out_2 x_he_*_age* if sample_2 == 1 [pw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  2,946,024
Absorbing 8 HDFE groups                           F(  28,     54) =       3.55
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.0059
                                                  Adj R-squared   =     0.0059
                                                  Within R-sq.    =     0.0001
Number of clusters (fips_o)  =         55         Root MSE        =     2.5587

                                  (Std. err. adjusted for 55 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_he_2016_age1 |    .116345   .1022555     1.14   0.260    -.0886649     .321355
x_he_2016_age2 |    .030291   .0248124     1.22   0.227    -.0194548    .0800368
x_he_2016_age3 |   -.025082   .0306522    -0.82   0.417    -.0865361     .036372
x_he_2016_age4 |  -.0438552   .0210292    -2.09   0.042    -.0860162   -.0016942
x_he_2017_age1 |   .2158114   .0921601     2.34   0.023     .0310415    .4005813
x_he_2017_age2 |   .0173834     .01987     0.87   0.386    -.0224535    .0572203
x_he_2017_age3 |  -.0416858   .0196561    -2.12   0.039    -.0810939   -.0022777
x_he_2017_age4 |  -.0659194   .0319865    -2.06   0.044    -.1300485   -.0017902
x_he_2018_age1 |   .2335527    .123407     1.89   0.064    -.0138633    .4809688
x_he_2018_age2 |   .0457768   .0347204     1.32   0.193    -.0238334    .1153869
x_he_2018_age3 |  -.0050265   .0256289    -0.20   0.845    -.0564093    .0463563
x_he_2018_age4 |  -.0252927   .0221179    -1.14   0.258    -.0696364    .0190511
x_he_2021_age1 |   .2469107   .1358977     1.82   0.075    -.0255479    .5193692
x_he_2021_age2 |   .0807291   .0465328     1.73   0.088    -.0125634    .1740217
x_he_2021_age3 |  -.0478946   .0288143    -1.66   0.102    -.1056637    .0098746
x_he_2021_age4 |  -.0250447   .0280395    -0.89   0.376    -.0812605     .031171
x_he_2022_age1 |   .2950717    .188259     1.57   0.123    -.0823649    .6725082
x_he_2022_age2 |   .0033668   .0156115     0.22   0.830    -.0279325    .0346661
x_he_2022_age3 |  -.0111911   .0293769    -0.38   0.705    -.0700882     .047706
x_he_2022_age4 |  -.0562313    .024603    -2.29   0.026    -.1055574   -.0069053
x_he_2023_age1 |   .1208385   .0887001     1.36   0.179    -.0569945    .2986715
x_he_2023_age2 |   -.011558   .0326019    -0.35   0.724    -.0769208    .0538049
x_he_2023_age3 |  -.0376957   .0327808    -1.15   0.255    -.1034172    .0280258
x_he_2023_age4 |  -.0359353   .0324168    -1.11   0.273     -.100927    .0290565
x_he_2024_age1 |   .0966876   .1067939     0.91   0.369    -.1174212    .3107964
x_he_2024_age2 |  -.0218652   .0309696    -0.71   0.483    -.0839555    .0402251
x_he_2024_age3 |  -.0263885   .0257145    -1.03   0.309     -.077943    .0251661
x_he_2024_age4 |  -.0476121   .0282711    -1.68   0.098    -.1042923    .0090681
         _cons |   .0665527   .0046704    14.25   0.000      .057189    .0759164
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_age_in_west

. 
. ** In-migration event study by age (Lower 48 + DC)
. reghdfe out_2 x_he_*_age* if sample_3 == 1 [pw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 19,190,525
Absorbing 8 HDFE groups                           F(  28,    527) =       2.51
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.0041
                                                  Adj R-squared   =     0.0040
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.2246

                                 (Std. err. adjusted for 528 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_he_2016_age1 |   .0181861     .01527     1.19   0.234    -.0118114    .0481837
x_he_2016_age2 |   .0088194   .0052559     1.68   0.094    -.0015056    .0191444
x_he_2016_age3 |  -.0073424   .0053112    -1.38   0.167    -.0177762    .0030913
x_he_2016_age4 |  -.0124549   .0043592    -2.86   0.004    -.0210184   -.0038913
x_he_2017_age1 |    .039433   .0169107     2.33   0.020     .0062123    .0726537
x_he_2017_age2 |   .0083097   .0048349     1.72   0.086    -.0011883    .0178076
x_he_2017_age3 |  -.0113289   .0036127    -3.14   0.002     -.018426   -.0042318
x_he_2017_age4 |   -.016416   .0056923    -2.88   0.004    -.0275984   -.0052337
x_he_2018_age1 |   .0505087   .0221456     2.28   0.023     .0070042    .0940131
x_he_2018_age2 |   .0078117   .0063455     1.23   0.219    -.0046539    .0202773
x_he_2018_age3 |  -.0017967   .0052058    -0.35   0.730    -.0120233    .0084299
x_he_2018_age4 |  -.0097562   .0047554    -2.05   0.041    -.0190982   -.0004143
x_he_2021_age1 |   .0215699    .018647     1.16   0.248    -.0150617    .0582016
x_he_2021_age2 |    .014234    .008882     1.60   0.110    -.0032145    .0316825
x_he_2021_age3 |   -.013449   .0048548    -2.77   0.006    -.0229862   -.0039118
x_he_2021_age4 |  -.0101919   .0048891    -2.08   0.038    -.0197964   -.0005874
x_he_2022_age1 |   .0461065   .0243754     1.89   0.059    -.0017785    .0939914
x_he_2022_age2 |   .0075859   .0045514     1.67   0.096    -.0013552    .0165271
x_he_2022_age3 |    -.00631   .0049506    -1.27   0.203    -.0160354    .0034154
x_he_2022_age4 |  -.0148865   .0043394    -3.43   0.001    -.0234111   -.0063619
x_he_2023_age1 |   .0351077   .0242859     1.45   0.149    -.0126014    .0828168
x_he_2023_age2 |  -.0017451   .0064692    -0.27   0.787    -.0144536    .0109634
x_he_2023_age3 |  -.0129433    .005223    -2.48   0.014    -.0232037   -.0026829
x_he_2023_age4 |   -.011994    .006906    -1.74   0.083    -.0255606    .0015726
x_he_2024_age1 |   .0150043   .0169593     0.88   0.377    -.0183118    .0483204
x_he_2024_age2 |  -.0059065   .0058455    -1.01   0.313    -.0173899    .0055768
x_he_2024_age3 |  -.0081108   .0046358    -1.75   0.081    -.0172177    .0009961
x_he_2024_age4 |  -.0101322   .0062411    -1.62   0.105    -.0223927    .0021282
         _cons |   .0155967   .0008909    17.51   0.000     .0138465    .0173469
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_age_in_48

. 
. ********************************************************************************
. ** EVENT STUDY BY AGE PLOTS
. ********************************************************************************
. 
. 
.         clear

.         set obs 9
Number of observations (_N) was 0, now 9.

.         gen year = 2015 + _n

. 
.         ** Create coefficient variables for each age group and sample
.         forvalues a = 1/4 {
  2.                 foreach s in "out" "in_west" "in_48" {
  3.                         gen `s'_coef_age`a' = .
  4.                         gen `s'_ci_lo_age`a' = .
  5.                         gen `s'_ci_hi_age`a' = .
  6.                 }
  7.         }
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)

. 
.         ** Fill in coefficients
.         foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2.                 forvalues a = 1/4 {
  3. 
.                         ** Out-migration
.                         estimates restore es_age_out
  4.                         capture {
  5.                                 replace out_coef_age`a' = _b[x_he_`y'_age`a'] if year == `y'
  6.                                 replace out_ci_lo_age`a' = _b[x_he_`y'_age`a'] - 1.96 * _se[x_he_`y'
> _age`a'] if year == `y'
  7.                                 replace out_ci_hi_age`a' = _b[x_he_`y'_age`a'] + 1.96 * _se[x_he_`y'
> _age`a'] if year == `y'
  8.                         }
  9. 
.                         ** In-migration (West Coast)
.                         estimates restore es_age_in_west
 10.                         capture {
 11.                                 replace in_west_coef_age`a' = _b[x_he_`y'_age`a'] if year == `y'
 12.                                 replace in_west_ci_lo_age`a' = _b[x_he_`y'_age`a'] - 1.96 * _se[x_he
> _`y'_age`a'] if year == `y'
 13.                                 replace in_west_ci_hi_age`a' = _b[x_he_`y'_age`a'] + 1.96 * _se[x_he
> _`y'_age`a'] if year == `y'
 14.                         }
 15. 
.                         ** In-migration (Lower 48)
.                         estimates restore es_age_in_48
 16.                         capture {
 17.                                 replace in_48_coef_age`a' = _b[x_he_`y'_age`a'] if year == `y'
 18.                                 replace in_48_ci_lo_age`a' = _b[x_he_`y'_age`a'] - 1.96 * _se[x_he_`
> y'_age`a'] if year == `y'
 19.                                 replace in_48_ci_hi_age`a' = _b[x_he_`y'_age`a'] + 1.96 * _se[x_he_`
> y'_age`a'] if year == `y'
 20.                         }
 21. 
.                 }
 22.         }
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)

. 
.         ** Base year (2019) = 0; 2020 excluded (no coefficient)
.         forvalues a = 1/4 {
  2.                 foreach s in "out" "in_west" "in_48" {
  3.                         foreach v in coef ci_lo ci_hi {
  4.                                 replace `s'_`v'_age`a' = 0 if year == 2019
  5.                         }
  6.                 }
  7.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
.         ** Offset years slightly for visibility across age groups
.         gen year_age1 = year - 0.225

.         gen year_age2 = year - 0.075

.         gen year_age3 = year + 0.075

.         gen year_age4 = year + 0.225

. 
.         ** Plot 1: Out-migration event study by age
.         twoway  (rcap out_ci_lo_age1 out_ci_hi_age1 year_age1, lc(navy))                               
>          ///
>                         (connected out_coef_age1 year_age1, mc(navy) lc(navy) ms(O))                   
>          ///
>                         (rcap out_ci_lo_age2 out_ci_hi_age2 year_age2, lc(maroon))                     
>          ///
>                         (connected out_coef_age2 year_age2, mc(maroon) lc(maroon) ms(T))               
>          ///
>                         (rcap out_ci_lo_age3 out_ci_hi_age3 year_age3, lc(forest_green))               
>          ///
>                         (connected out_coef_age3 year_age3, mc(forest_green) lc(forest_green) ms(S)) //
> /
>                         (rcap out_ci_lo_age4 out_ci_hi_age4 year_age4, lc(dkorange))                   
>          ///
>                         (connected out_coef_age4 year_age4, mc(dkorange) lc(dkorange) ms(D)),          
>  ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>                                          ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>                                          ///
>                 xlabel(2016(1)2024)                                                                    
>                                                  ///
>                 ytitle("Effect on Out-Migration (pp)")                                                 
>                                  ///
>                 xtitle("Year")                                                                         
>                                                          ///
>                 legend(order(2 "18-24" 4 "25-44" 6 "45-64" 8 "65+") pos(6) rows(1))                    
>  ///
>                 title("Out-Migration from Multnomah County by Age")                                    
>                          ///
>                 subtitle("College Degree vs. No College Degree")                                       
>                          ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_age_out_migration.png", replace
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_age_out_migration.png not
    found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_age_out_migration.png
    saved as PNG format

. 
.         ** Plot 2: In-migration (West Coast) event study by age
.         twoway  (rcap in_west_ci_lo_age1 in_west_ci_hi_age1 year_age1, lc(navy))                       
>  ///
>                         (connected in_west_coef_age1 year_age1, mc(navy) lc(navy) ms(O))               
>          ///
>                         (rcap in_west_ci_lo_age2 in_west_ci_hi_age2 year_age2, lc(maroon))             
>  ///
>                         (connected in_west_coef_age2 year_age2, mc(maroon) lc(maroon) ms(T))           
>  ///
>                         (rcap in_west_ci_lo_age3 in_west_ci_hi_age3 year_age3, lc(forest_green))       
>  ///
>                         (connected in_west_coef_age3 year_age3, mc(forest_green) lc(forest_green) ms(S)
> ) ///
>                         (rcap in_west_ci_lo_age4 in_west_ci_hi_age4 year_age4, lc(dkorange))           
>  ///
>                         (connected in_west_coef_age4 year_age4, mc(dkorange) lc(dkorange) ms(D)),      
>  ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>                                          ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>                                          ///
>                 xlabel(2016(1)2024)                                                                    
>                                                  ///
>                 ytitle("Effect on In-Migration (pp)")                                                  
>                                  ///
>                 xtitle("Year")                                                                         
>                                                          ///
>                 legend(order(2 "18-24" 4 "25-44" 6 "45-64" 8 "65+") pos(6) rows(1))                    
>  ///
>                 title("In-Migration to Multnomah (West Coast) by Age")                                 
>                  ///
>                 subtitle("College Degree vs. No College Degree")                                       
>                          ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_age_in_migration_west.png", replace
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_age_in_migration_west.png
    not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_age_in_migration_west.png
    saved as PNG format

. 
.         ** Plot 3: In-migration (Lower 48 + DC) event study by age
.         twoway  (rcap in_48_ci_lo_age1 in_48_ci_hi_age1 year_age1, lc(navy))                           
>  ///
>                         (connected in_48_coef_age1 year_age1, mc(navy) lc(navy) ms(O))                 
>  ///
>                         (rcap in_48_ci_lo_age2 in_48_ci_hi_age2 year_age2, lc(maroon))                 
>  ///
>                         (connected in_48_coef_age2 year_age2, mc(maroon) lc(maroon) ms(T))             
>  ///
>                         (rcap in_48_ci_lo_age3 in_48_ci_hi_age3 year_age3, lc(forest_green))           
>  ///
>                         (connected in_48_coef_age3 year_age3, mc(forest_green) lc(forest_green) ms(S)) 
> ///
>                         (rcap in_48_ci_lo_age4 in_48_ci_hi_age4 year_age4, lc(dkorange))               
>          ///
>                         (connected in_48_coef_age4 year_age4, mc(dkorange) lc(dkorange) ms(D)), ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>                                          ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>                                          ///
>                 xlabel(2016(1)2024)                                                                    
>                                                  ///
>                 ytitle("Effect on In-Migration (pp)")                                                  
>                                  ///
>                 xtitle("Year")                                                                         
>                                                          ///
>                 legend(order(2 "18-24" 4 "25-44" 6 "45-64" 8 "65+") pos(6) rows(1))                    
>  ///
>                 title("In-Migration to Multnomah (Lower 48 + DC) by Age")                              
>                  ///
>                 subtitle("College Degree vs. No College Degree")                                       
>                          ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_age_in_migration_48.png", replace
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_age_in_migration_48.png
    not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_age_in_migration_48.png
    saved as PNG format

. 
. 
. ********************************************************************************
. ** CLEANUP
. ********************************************************************************
. 
. ** Close log
. clear

. log close log_02
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_did_2026-02-05.log
  log type:  text
 closed on:   5 Feb 2026, 21:54:26
---------------------------------------------------------------------------------------------------------

. 
end of do-file

. do "C:\Users\ji252\AppData\Local\Temp\STD44e8_000005.tmp"

. /*******************************************************************************
> File Name:              02_did_analysis.do
> Creator:                John Iselin
> Date Update:    January 11, 2026
> 
> Called by: 00_multnomah.do
> 
> Purpose: Perform DiD analysis on ACS data examining the effect of the
>          Multnomah County tax on migration patterns by education level.
> 
> Authors: John Iselin
> 
> For more information, contact john.iselin@yale.edu
> 
> *******************************************************************************/
. 
. 
. ** Start log file
. capture log close log_02

. log using "${logs}02_log_did_${date}", replace text name(log_02)
---------------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_did_2026-02-05.log
  log type:  text
 opened on:   5 Feb 2026, 22:28:42

. 
. 
. ********************************************************************************
. ** LOAD AND PREPARE DATA
. ********************************************************************************
. 
. ** Load ACS migration data
. use "${data}working/acs_migration_file", replace

. 
. ** Sample restrictions
. drop if year == 2015                                    // Sample: 2016-2024
(2,334,973 observations deleted)

. drop if qmigplc1 == 4                                   // Error in migration place
(401,283 observations deleted)

. drop if inlist(state_fips_o, 2, 15)     // Alaska and Hawaii
(137,699 observations deleted)

. drop if inlist(state_fips_d, 2, 15)     // Alaska and Hawaii
(3,633 observations deleted)

. 
. ********************************************************************************
. ** DEFINE SAMPLES AND TREATMENT
. ********************************************************************************
. 
. ** Multnomah county indicators
. gen multnomah_o = (state_fips_o == 41 & county_fips_o == 51)

. gen multnomah_d = (state_fips_d == 41 & county_fips_d == 51)

. 
. ** Analysis samples
. gen sample_1 = (multnomah_o == 1) & year != 2020    // Multnomah in origin (out-migration)

. gen sample_2 = (multnomah_o != 1) &                             ///
>                                 year != 2020 &                                          /// Not Multnom
> ah in origin
>                            inlist(state_fips_o, 6, 41, 53)      // CA, OR, WA (in-migration)

. gen sample_3 = (multnomah_o != 1) &                             /// Not Multnomah in origin
>                                 year != 2020                                            // 

. 
. label var sample_1 "Out-migration Sample"

. label var sample_2 "In-migration Sample (West Coast)"

. label var sample_3 "In-migration Sample (Lower 48 + DC)"

. 
. ** Outcome variables (scaled to percentages)
. gen out_1 = (same_county == 0) * 100

. label var out_1 "Moved out of Multnomah (%)"

. 
. gen out_2 = (multnomah_d == 1) * 100

. label var out_2 "Moved to Multnomah (%)"

. 
. ** Treatment variables
. gen post = year > 2020

. label var post "Post-2020"

. 
. gen high_ed = educd >= 101

. label var high_ed "College Degree"

. 
. gen treated = high_ed * post

. label var treated "College Degree × Post"

. 
. ********************************************************************************
. ** COVARIATE CATEGORIES
. ********************************************************************************
. 
. ** Age categories
. recode age ///
>     (18/24   = 1 "18-24") ///
>     (25/44   = 2 "25-44") ///
>     (45/64   = 3 "45-64") ///
>     (65/max  = 4 "65+"), ///
>     gen(cat_age)
(21,137,449 differences between age and cat_age)

. label var cat_age "Age categories"

. 
. ** Sex
. gen cat_sex = (sex == 2)

. label var cat_sex "Female indicator"

. label define lb_cat_sex 0 "Male" 1 "Female", replace

. label values cat_sex lb_cat_sex

. 
. ** Marital status
. recode marst ///
>     (1       = 1 "Married") ///
>     (2/3     = 2 "Separated") ///
>     (4/5     = 3 "Divorced / Widowed") ///
>     (6       = 4 "Single"), ///
>     gen(cat_married)
(9,179,293 differences between marst and cat_married)

. label var cat_married "Marriage categories"

. 
. ** Number of children
. recode nchild ///
>     (0       = 0 "0 Children") ///
>     (1       = 1 "1 Child") ///
>     (2       = 2 "2 Children") ///
>     (3/max   = 3 "3+ Children"), ///
>     gen(cat_child)
(412,696 differences between nchild and cat_child)

. label var cat_child "Number of Children"

. 
. ** Age of youngest child
. recode yngch ///
>     (99      = 0 "No Children") ///
>     (0/4     = 1 "0-4") ///
>     (5/12    = 2 "5-12") ///
>     (13/17   = 3 "13-17")       ///
>         (18/max  = 4 "18+"), ///
>     gen(cat_yngch)
(20,719,194 differences between yngch and cat_yngch)

. label var cat_yngch "Age of youngest child"

. 
. ** Education categories
. recode educd ///
>     (min/61  = 1 "Less than HS") ///
>     (62/71   = 2 "HS Diploma") ///
>     (80/100  = 3 "Some College") ///
>     (101/max = 4 "College Degree"), ///
>     gen(cat_educ)
--Break--
r(1);

end of do-file

--Break--
r(1);

. do "C:\Users\ji252\AppData\Local\Temp\STD44e8_000006.tmp"

. 
. ** Difference-in-Difference (ACS)
. do ${code}02_did_analysis.do

. /*******************************************************************************
> File Name:              02_did_analysis.do
> Creator:                John Iselin
> Date Update:    January 11, 2026
> 
> Called by: 00_multnomah.do
> 
> Purpose: Perform DiD analysis on ACS data examining the effect of the
>          Multnomah County tax on migration patterns by education level.
> 
> Authors: John Iselin
> 
> For more information, contact john.iselin@yale.edu
> 
> *******************************************************************************/
. 
. 
. ** Start log file
. capture log close log_02

. log using "${logs}02_log_did_${date}", replace text name(log_02)
---------------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_did_2026-02-05.log
  log type:  text
 opened on:   5 Feb 2026, 22:29:53

. 
. 
. ********************************************************************************
. ** LOAD AND PREPARE DATA
. ********************************************************************************
. 
. ** Load ACS migration data
. use "${data}working/acs_migration_file", replace

. 
. ** Sample restrictions
. drop if year == 2015                                    // Sample: 2016-2024
(2,334,973 observations deleted)

. drop if qmigplc1 == 4                                   // Error in migration place
(401,283 observations deleted)

. drop if inlist(state_fips_o, 2, 15)     // Alaska and Hawaii
(137,699 observations deleted)

. drop if inlist(state_fips_d, 2, 15)     // Alaska and Hawaii
(3,633 observations deleted)

. 
. ********************************************************************************
. ** DEFINE SAMPLES AND TREATMENT
. ********************************************************************************
. 
. ** Multnomah county indicators
. gen multnomah_o = (state_fips_o == 41 & county_fips_o == 51)

. gen multnomah_d = (state_fips_d == 41 & county_fips_d == 51)

. 
. ** Analysis samples
. gen sample_1 = (multnomah_o == 1) & year != 2020    // Multnomah in origin (out-migration)

. gen sample_2 = (multnomah_o != 1) &                             ///
>                                 year != 2020 &                                          /// Not Multnom
> ah in origin
>                            inlist(state_fips_o, 6, 41, 53)      // CA, OR, WA (in-migration)

. gen sample_3 = (multnomah_o != 1) &                             /// Not Multnomah in origin
>                                 year != 2020                                            // 

. 
. label var sample_1 "Out-migration Sample"

. label var sample_2 "In-migration Sample (West Coast)"

. label var sample_3 "In-migration Sample (Lower 48 + DC)"

. 
. ** Outcome variables (scaled to percentages)
. gen out_1 = (same_county == 0) * 100

. label var out_1 "Moved out of Multnomah (%)"

. 
. gen out_2 = (multnomah_d == 1) * 100

. label var out_2 "Moved to Multnomah (%)"

. 
. ** Treatment variables
. gen post = year > 2020

. label var post "Post-2020"

. 
. gen high_ed = educd >= 101

. label var high_ed "College Degree"

. 
. gen treated = high_ed * post

. label var treated "College Degree × Post"

. 
. ********************************************************************************
. ** COVARIATE CATEGORIES
. ********************************************************************************
. 
. ** Age categories
. recode age ///
>     (18/24   = 1 "18-24") ///
>     (25/44   = 2 "25-44") ///
>     (45/64   = 3 "45-64") ///
>     (65/max  = 4 "65+"), ///
>     gen(cat_age)
(21,137,449 differences between age and cat_age)

. label var cat_age "Age categories"

. 
. ** Sex
. gen cat_sex = (sex == 2)

. label var cat_sex "Female indicator"

. label define lb_cat_sex 0 "Male" 1 "Female", replace

. label values cat_sex lb_cat_sex

. 
. ** Marital status
. recode marst ///
>     (1       = 1 "Married") ///
>     (2/3     = 2 "Separated") ///
>     (4/5     = 3 "Divorced / Widowed") ///
>     (6       = 4 "Single"), ///
>     gen(cat_married)
(9,179,293 differences between marst and cat_married)

. label var cat_married "Marriage categories"

. 
. ** Number of children
. recode nchild ///
>     (0       = 0 "0 Children") ///
>     (1       = 1 "1 Child") ///
>     (2       = 2 "2 Children") ///
>     (3/max   = 3 "3+ Children"), ///
>     gen(cat_child)
(412,696 differences between nchild and cat_child)

. label var cat_child "Number of Children"

. 
. ** Age of youngest child
. recode yngch ///
>     (99      = 0 "No Children") ///
>     (0/4     = 1 "0-4") ///
>     (5/12    = 2 "5-12") ///
>     (13/17   = 3 "13-17")       ///
>         (18/max  = 4 "18+"), ///
>     gen(cat_yngch)
(20,719,194 differences between yngch and cat_yngch)

. label var cat_yngch "Age of youngest child"

. 
. ** Education categories
. recode educd ///
>     (min/61  = 1 "Less than HS") ///
>     (62/71   = 2 "HS Diploma") ///
>     (80/100  = 3 "Some College") ///
>     (101/max = 4 "College Degree"), ///
>     gen(cat_educ)
(21,137,449 differences between educd and cat_educ)

. label var cat_educ "Education categories"

. 
. ********************************************************************************
. ** REGRESSION 1: DIFFERENCE-IN-DIFFERENCES
. ********************************************************************************
. 
. ** Store estimates for coefficient plot
. estimates clear

. 
. ** Out-migration regression (Sample 1: Multnomah residents)
. reghdfe out_1 treated if sample_1 == 1 [pw = perwt],    ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     47,139
Absorbing 7 HDFE groups                           F(   1,  47114) =       4.51
                                                  Prob > F        =     0.0338
                                                  R-squared       =     0.0201
                                                  Adj R-squared   =     0.0196
                                                  Within R-sq.    =     0.0002
                                                  Root MSE        =    23.7528

------------------------------------------------------------------------------
             |               Robust
       out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |   1.232005   .5804414     2.12   0.034     .0943319    2.369679
       _cons |    5.83538   .1934965    30.16   0.000     5.456124    6.214636
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store did_out

. 
. ** In-migration regression (Sample 2: CA/OR/WA residents)
. reghdfe out_2 treated if sample_2 == 1 [pw = perwt],    ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  2,946,024
Absorbing 8 HDFE groups                           F(   1,     54) =       0.74
Statistics robust to heteroskedasticity           Prob > F        =     0.3926
                                                  R-squared       =     0.0058
                                                  Adj R-squared   =     0.0058
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.5588

                                (Std. err. adjusted for 55 clusters in fips_o)
------------------------------------------------------------------------------
             |               Robust
       out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |  -.0089625   .0103988    -0.86   0.393    -.0298109    .0118858
       _cons |   .0674888   .0018439    36.60   0.000      .063792    .0711857
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_in_west

. 
. ** In-migration regression (Sample 3: Lower 48 + DC residents)
. reghdfe out_2 treated if sample_3 == 1 [pw = perwt],    ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 19,190,525
Absorbing 8 HDFE groups                           F(   1,    527) =       2.60
Statistics robust to heteroskedasticity           Prob > F        =     0.1072
                                                  R-squared       =     0.0040
                                                  Adj R-squared   =     0.0040
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.2246

                               (Std. err. adjusted for 528 clusters in fips_o)
------------------------------------------------------------------------------
             |               Robust
       out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
     treated |  -.0033242   .0020603    -1.61   0.107    -.0073716    .0007232
       _cons |   .0156366   .0003574    43.76   0.000     .0149346    .0163386
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_in_48

. 
. ********************************************************************************
. ** TABLE: DiD RESULTS
. ********************************************************************************
. 
. esttab did_out did_in_west did_in_48                                                                   
>  ///
>         using "${results}did/tab_did_overall.tex",                                                     
>  ///
>         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                                                       
>  ///
>         b(%-9.3f) se(%-9.3f) replace                                                                   
>          ///
>         keep(treated)                                                                                  
>                          ///
>         coeflabels(treated  "College Degree $\times$ Post")                             ///
>         mtitle( "Out-migration"                                                                        
>                  ///
>                         "In-migration (West Coast)"                                                    
>          ///
>                         "In-migration (Lower 48 + DC)")                                                
>          ///
>         stats(N, fmt(%12.0fc) labels("Observations"))
(output written to C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/tab_did_overall.tex)

. 
. ********************************************************************************
. ** REGRESSION 2: EVENT STUDY
. ********************************************************************************
. 
. ** Create year × education interactions (base year = 2019, 2020 excluded)
. foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2.         gen x_high_ed_`y' = high_ed * (year == `y')
  3. }

. 
. ** Out-migration event study
. reghdfe out_1 x_high_ed_* if sample_1 == 1 [pw = perwt],        ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     47,139
Absorbing 7 HDFE groups                           F(   7,  47108) =       1.08
                                                  Prob > F        =     0.3730
                                                  R-squared       =     0.0202
                                                  Adj R-squared   =     0.0196
                                                  Within R-sq.    =     0.0003
                                                  Root MSE        =    23.7529

--------------------------------------------------------------------------------
               |               Robust
         out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_high_ed_2016 |   .2157829    1.12025     0.19   0.847    -1.979922    2.411488
x_high_ed_2017 |   1.621033   1.091858     1.48   0.138    -.5190244    3.761091
x_high_ed_2018 |   1.121102   1.042543     1.08   0.282    -.9222971    3.164502
x_high_ed_2021 |   1.763493    1.08754     1.62   0.105     -.368102    3.895088
x_high_ed_2022 |   2.440565   1.261722     1.93   0.053    -.0324276    4.913558
x_high_ed_2023 |   1.844759    1.05149     1.75   0.079    -.2161771    3.905695
x_high_ed_2024 |   1.818619   1.052574     1.73   0.084    -.2444413    3.881679
         _cons |    5.50135    .339634    16.20   0.000     4.835663    6.167037
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store es_out

. 
. ** In-migration event study
. reghdfe out_2 x_high_ed_* if sample_2 == 1 [pw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  2,946,024
Absorbing 8 HDFE groups                           F(   7,     54) =       1.72
Statistics robust to heteroskedasticity           Prob > F        =     0.1249
                                                  R-squared       =     0.0058
                                                  Adj R-squared   =     0.0058
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.5588

                                  (Std. err. adjusted for 55 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_high_ed_2016 |   .0006089   .0176853     0.03   0.973     -.034848    .0360657
x_high_ed_2017 |  -.0112805   .0173832    -0.65   0.519    -.0461316    .0235707
x_high_ed_2018 |   .0218863   .0186693     1.17   0.246    -.0155434    .0593161
x_high_ed_2021 |   .0234131   .0266451     0.88   0.383    -.0300071    .0768334
x_high_ed_2022 |  -.0022492   .0138437    -0.16   0.872    -.0300041    .0255057
x_high_ed_2023 |  -.0201526   .0249975    -0.81   0.424    -.0702697    .0299644
x_high_ed_2024 |  -.0243619   .0235203    -1.04   0.305    -.0715172    .0227935
         _cons |   .0665584   .0047197    14.10   0.000     .0570961    .0760207
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_in_west

. 
. ** In-migration event study
. reghdfe out_2 x_high_ed_* if sample_3 == 1 [pw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 19,190,525
Absorbing 8 HDFE groups                           F(   7,    527) =       1.08
Statistics robust to heteroskedasticity           Prob > F        =     0.3732
                                                  R-squared       =     0.0040
                                                  Adj R-squared   =     0.0040
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.2246

                                 (Std. err. adjusted for 528 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_high_ed_2016 |  -.0004553    .003629    -0.13   0.900    -.0075843    .0066738
x_high_ed_2017 |  -.0019644   .0034234    -0.57   0.566    -.0086895    .0047608
x_high_ed_2018 |   .0029225   .0038388     0.76   0.447    -.0046187    .0104638
x_high_ed_2021 |   .0001685   .0049201     0.03   0.973     -.009497     .009834
x_high_ed_2022 |   8.89e-07   .0031913     0.00   1.000    -.0062684    .0062702
x_high_ed_2023 |  -.0060519   .0047712    -1.27   0.205    -.0154248    .0033209
x_high_ed_2024 |  -.0066425   .0044517    -1.49   0.136    -.0153878    .0021027
         _cons |   .0155965   .0008911    17.50   0.000      .013846    .0173471
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_in_48

. 
. ********************************************************************************
. ** EVENT STUDY PLOTS
. ********************************************************************************
. 
. ** Extract coefficients and create event study dataset
. preserve

.         clear

.         set obs 9
Number of observations (_N) was 0, now 9.

.         gen year = 2015 + _n

. 
.         ** Out-migration coefficients
.         gen out_coef = .
(9 missing values generated)

.         gen out_ci_lo = .
(9 missing values generated)

.         gen out_ci_hi = .
(9 missing values generated)

. 
.         ** In-migration coefficients
.         gen in_west_coef = .
(9 missing values generated)

.         gen in_west_ci_lo = .
(9 missing values generated)

.         gen in_west_ci_hi = .
(9 missing values generated)

.         
.         ** In-migration coefficients
.         gen in_48_coef = .
(9 missing values generated)

.         gen in_48_ci_lo = .
(9 missing values generated)

.         gen in_48_ci_hi = .
(9 missing values generated)

. 
.         ** Fill in coefficients (2020 = base year = 0)
.         foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2. 
.                 ** Out-migration
.                 estimates restore es_out
  3.                 capture {
  4.                         replace out_coef = _b[x_high_ed_`y'] if year == `y'
  5.                         replace out_ci_lo = _b[x_high_ed_`y'] - 1.96 * _se[x_high_ed_`y'] if year ==
>  `y'
  6.                         replace out_ci_hi = _b[x_high_ed_`y'] + 1.96 * _se[x_high_ed_`y'] if year ==
>  `y'
  7.                 }
  8. 
.                 ** In-migration
.                 estimates restore es_in_west
  9.                 capture {
 10.                         replace in_west_coef = _b[x_high_ed_`y'] if year == `y'
 11.                         replace in_west_ci_lo = _b[x_high_ed_`y'] - 1.96 * _se[x_high_ed_`y'] if yea
> r == `y'
 12.                         replace in_west_ci_hi = _b[x_high_ed_`y'] + 1.96 * _se[x_high_ed_`y'] if yea
> r == `y'
 13.                 }
 14.                 
.                 ** In-migration
.                 estimates restore es_in_48
 15.                 capture {
 16.                         replace in_48_coef = _b[x_high_ed_`y'] if year == `y'
 17.                         replace in_48_ci_lo = _b[x_high_ed_`y'] - 1.96 * _se[x_high_ed_`y'] if year 
> == `y'
 18.                         replace in_48_ci_hi = _b[x_high_ed_`y'] + 1.96 * _se[x_high_ed_`y'] if year 
> == `y'
 19.                 }
 20.                 
.         }
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)
(results es_out are active now)
(results es_in_west are active now)
(results es_in_48 are active now)

. 
.         ** Base year (2019) = 0; 2020 excluded (no coefficient)
.         foreach v in out_coef out_ci_lo out_ci_hi in_west_coef in_west_ci_lo in_west_ci_hi in_48_coef i
> n_48_ci_lo in_48_ci_hi {
  2.                 replace `v' = 0 if year == 2019
  3.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
.         ** Offset years slightly for visibility
.         gen year_out = year - 0.15

.         gen year_in_west = year

.         gen year_in_48 = year + 0.15

. 
.         ** Plot 1: Out-migration event study
.         twoway  (rcap out_ci_lo out_ci_hi year, lc(navy))                               ///
>                         (scatter out_coef year, mc(navy) ms(O)),                ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>  ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>  ///
>                 xlabel(2016(1)2024)                                                                    
>          ///
>                 ytitle("Effect on Out-Migration (pp)")                                          ///
>                 xtitle("Year")                                                                         
>                  ///
>                 legend(off)                                                                            
>                  ///
>                 title("Out-Migration from Multnomah County")                            ///
>                 subtitle("College Degree vs. No College Degree")                        ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_out_migration.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_out_migration.png saved as
    PNG format

. 
.         ** Plot 2: In-migration event study (West Coast)
.         twoway  (rcap in_west_ci_lo in_west_ci_hi year, lc(maroon))     ///
>                         (scatter in_west_coef year, mc(maroon) ms(O)),  ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>  ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>  ///
>                 xlabel(2016(1)2024)                                                                    
>          ///
>                 ytitle("Effect on In-Migration (pp)")                                           ///
>                 xtitle("Year")                                                                         
>                  ///
>                 legend(off)                                                                            
>                  ///
>                 title("In-Migration to Multnomah County (West Coast)")          ///
>                 subtitle("College Degree vs. No College Degree")                        ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_in_migration_west.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_in_migration_west.png
    saved as PNG format

. 
.         ** Plot 3: In-migration event study (Lower 48 + DC)
.         twoway  (rcap in_48_ci_lo in_48_ci_hi year, lc(forest_green))   ///
>                         (scatter in_48_coef year, mc(forest_green) ms(O)),      ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>  ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>  ///
>                 xlabel(2016(1)2024)                                                                    
>          ///
>                 ytitle("Effect on In-Migration (pp)")                                           ///
>                 xtitle("Year")                                                                         
>                  ///
>                 legend(off)                                                                            
>                  ///
>                 title("In-Migration to Multnomah County (Lower 48 + DC)")       ///
>                 subtitle("College Degree vs. No College Degree")                        ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_in_migration_48.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_in_migration_48.png saved
    as PNG format

. 
.         ** Plot 4: Combined event study
.         twoway  (rcap out_ci_lo out_ci_hi year_out, lc(navy))                                   ///
>                         (scatter out_coef year_out, mc(navy) ms(O))                     ///
>                         (rcap in_west_ci_lo in_west_ci_hi year_in_west, lc(maroon))     ///
>                         (scatter in_west_coef year_in_west, mc(maroon) ms(T))   ///
>                         (rcap in_48_ci_lo in_48_ci_hi year_in_48, lc(forest_green))     ///
>                         (scatter in_48_coef year_in_48, mc(forest_green) ms(S)),        ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>                  ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>                  ///
>                 xlabel(2016(1)2024)                                                                    
>                          ///
>                 ytitle("Effect on Migration Rate (pp)")                                                
>          ///
>                 xtitle("Year")                                                                         
>                                  ///
>                 legend(order(2 "Out-migration" 4 "In-migration (West Coast)"            ///
>                         6 "In-migration (Lower 48 + DC)") pos(6) rows(1))                              
>  ///
>                 title("Migration Effects: Multnomah County Tax")                                       
>  ///
>                 subtitle("College Degree vs. No College Degree")                                       
>  ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_combined.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_combined.png saved as PNG
    format

. 
. restore

. 
. ********************************************************************************
. ** REGRESSION 3: DIFFERENCE-IN-DIFFERENCES BY AGE
. ********************************************************************************
. 
. ** Create age × treatment interactions
. gen treated_age_1 = treated * (cat_age == 1)

. gen treated_age_2 = treated * (cat_age == 2)

. gen treated_age_3 = treated * (cat_age == 3)

. gen treated_age_4 = treated * (cat_age == 4)

. 
. label var treated_age_1 "College x Post x Age 18-24"

. label var treated_age_2 "College x Post x Age 25-44"

. label var treated_age_3 "College x Post x Age 45-64"

. label var treated_age_4 "College x Post x Age 65+"

. 
. ** Store estimates
. estimates clear

. 
. ** Out-migration regression by age (Sample 1: Multnomah residents)
. reghdfe out_1 treated_age_* if sample_1 == 1 [pw = perwt],      ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     47,139
Absorbing 7 HDFE groups                           F(   4,  47111) =       2.56
                                                  Prob > F        =     0.0364
                                                  R-squared       =     0.0203
                                                  Adj R-squared   =     0.0198
                                                  Within R-sq.    =     0.0004
                                                  Root MSE        =    23.7507

-------------------------------------------------------------------------------
              |               Robust
        out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
treated_age_1 |   4.206692   2.667201     1.58   0.115     -1.02106    9.434443
treated_age_2 |     1.5351   .7605364     2.02   0.044     .0444374    3.025762
treated_age_3 |   1.276167   .6951838     1.84   0.066    -.0864033    2.638737
treated_age_4 |  -.2597344    .667996    -0.39   0.697    -1.569016    1.049547
        _cons |   5.835584   .1934643    30.16   0.000     5.456391    6.214777
-------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store did_age_out

. 
. ** In-migration regression by age (Sample 2: CA/OR/WA residents)
. reghdfe out_2 treated_age_* if sample_2 == 1 [pw = perwt],      ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  2,946,024
Absorbing 8 HDFE groups                           F(   4,     54) =       1.48
Statistics robust to heteroskedasticity           Prob > F        =     0.2203
                                                  R-squared       =     0.0058
                                                  Adj R-squared   =     0.0058
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =         55         Root MSE        =     2.5588

                                 (Std. err. adjusted for 55 clusters in fips_o)
-------------------------------------------------------------------------------
              |               Robust
        out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
treated_age_1 |   .1764101   .0915686     1.93   0.059    -.0071739    .3599941
treated_age_2 |   .0038349   .0160875     0.24   0.812    -.0284187    .0360884
treated_age_3 |  -.0294809   .0171489    -1.72   0.091    -.0638623    .0049005
treated_age_4 |  -.0376184   .0165849    -2.27   0.027    -.0708692   -.0043677
        _cons |   .0674534   .0018332    36.80   0.000     .0637781    .0711288
-------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_age_in_west

. 
. ** In-migration regression by age (Sample 3: Lower 48 + DC residents)
. reghdfe out_2 treated_age_* if sample_3 == 1 [pw = perwt],      ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 19,190,525
Absorbing 8 HDFE groups                           F(   4,    527) =       3.38
Statistics robust to heteroskedasticity           Prob > F        =     0.0096
                                                  R-squared       =     0.0041
                                                  Adj R-squared   =     0.0040
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.2246

                                (Std. err. adjusted for 528 clusters in fips_o)
-------------------------------------------------------------------------------
              |               Robust
        out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
treated_age_1 |   .0275705   .0127281     2.17   0.031     .0025664    .0525746
treated_age_2 |   .0017701   .0031459     0.56   0.574    -.0044099    .0079501
treated_age_3 |  -.0092488    .002831    -3.27   0.001    -.0148103   -.0036873
treated_age_4 |  -.0103184    .003239    -3.19   0.002    -.0166814   -.0039554
        _cons |   .0156321   .0003585    43.60   0.000     .0149278    .0163364
-------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store did_age_in_48

. 
. ********************************************************************************
. ** TABLE: DiD BY AGE
. ********************************************************************************
. 
. esttab did_age_out did_age_in_west did_age_in_48                                                ///
>         using "${results}did/tab_did_by_age.tex",                                                      
>  ///
>         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                                                       
>  ///
>         b(%-9.3f) se(%-9.3f) replace                                                                   
>          ///
>         keep(treated_age_*)                                                                            
>                  ///
>         order(treated_age_1 treated_age_2 treated_age_3 treated_age_4)          ///
>         coeflabels(     treated_age_1  "College $\times$ Post $\times$ Age 18-24"       ///
>                                 treated_age_2  "College $\times$ Post $\times$ Age 25-44"       ///
>                                 treated_age_3  "College $\times$ Post $\times$ Age 45-64"       ///
>                                 treated_age_4  "College $\times$ Post $\times$ Age 65+")        ///
>         mtitle( "Out-migration"                                                                        
>                  ///
>                         "In-migration (West Coast)"                                                    
>          ///
>                         "In-migration (Lower 48 + DC)")                                                
>          ///
>         stats(N, fmt(%12.0fc) labels("Observations"))
(output written to C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/tab_did_by_age.tex)

. 
. ********************************************************************************
. ** REGRESSION 4: EVENT STUDY BY AGE
. ********************************************************************************
. 
. ** Create year × education × age interactions (base year = 2019, 2020 excluded)
. foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2.         forvalues a = 1/4 {
  3.                 gen x_he_`y'_age`a' = high_ed * (year == `y') * (cat_age == `a')
  4.         }
  5. }

. 
. ** Out-migration event study by age
. reghdfe out_1 x_he_*_age* if sample_1 == 1 [pw = perwt],        ///
>         vce(robust) absorb(year cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =     47,139
Absorbing 7 HDFE groups                           F(  28,  47087) =       1.55
                                                  Prob > F        =     0.0313
                                                  R-squared       =     0.0214
                                                  Adj R-squared   =     0.0204
                                                  Within R-sq.    =     0.0015
                                                  Root MSE        =    23.7435

--------------------------------------------------------------------------------
               |               Robust
         out_1 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_he_2016_age1 |   9.590886   5.242235     1.83   0.067    -.6839692    19.86574
x_he_2016_age2 |   .4381895   1.422232     0.31   0.758    -2.349406    3.225785
x_he_2016_age3 |  -.5692084   1.258638    -0.45   0.651    -3.036157     1.89774
x_he_2016_age4 |  -.8129739   1.286826    -0.63   0.528    -3.335172    1.709224
x_he_2017_age1 |   5.924555   5.221217     1.13   0.257    -4.309105    16.15821
x_he_2017_age2 |   .9300908   1.309948     0.71   0.478    -1.637427    3.497609
x_he_2017_age3 |   2.057912   1.501669     1.37   0.171    -.8853803    5.001204
x_he_2017_age4 |   2.255588   1.450483     1.56   0.120    -.5873803    5.098556
x_he_2018_age1 |   10.05077   5.779527     1.74   0.082    -1.277186    21.37873
x_he_2018_age2 |   2.180571    1.33089     1.64   0.101    -.4279922    4.789134
x_he_2018_age3 |    -.64437   1.107386    -0.58   0.561    -2.814862    1.526122
x_he_2018_age4 |  -.4798878   1.137991    -0.42   0.673    -2.710366    1.750591
x_he_2021_age1 |    2.50488   5.012561     0.50   0.617    -7.319811    12.32957
x_he_2021_age2 |   2.734966   1.375891     1.99   0.047     .0382003    5.431731
x_he_2021_age3 |   .9905859   1.285971     0.77   0.441    -1.529936    3.511108
x_he_2021_age4 |   .0541246   1.294038     0.04   0.967    -2.482208    2.590458
x_he_2022_age1 |   6.784287   5.149933     1.32   0.188    -3.309655    16.87823
x_he_2022_age2 |   3.020563    1.77839     1.70   0.089    -.4651071    6.506233
x_he_2022_age3 |   1.048525   1.321265     0.79   0.427    -1.541174    3.638224
x_he_2022_age4 |   2.425017   1.626793     1.49   0.136    -.7635197    5.613554
x_he_2023_age1 |   4.817064   4.881821     0.99   0.324    -4.751375     14.3855
x_he_2023_age2 |   1.554406   1.246417     1.25   0.212    -.8885903    3.997401
x_he_2023_age3 |   3.215491   1.408986     2.28   0.022     .4538574    5.977124
x_he_2023_age4 |  -.4482232   1.154298    -0.39   0.698    -2.710664    1.814218
x_he_2024_age1 |   7.181952   5.364786     1.34   0.181    -3.333106    17.69701
x_he_2024_age2 |   2.035919   1.303867     1.56   0.118    -.5196791    4.591517
x_he_2024_age3 |   2.164931     1.2425     1.74   0.081    -.2703861    4.600249
x_he_2024_age4 |  -.4159041   1.038928    -0.40   0.689    -2.452219    1.620411
         _cons |   5.501312   .3401661    16.17   0.000     4.834581    6.168042
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           0           8     |
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher

. estimates store es_age_out

. 
. ** In-migration event study by age (West Coast)
. reghdfe out_2 x_he_*_age* if sample_2 == 1 [pw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   =  2,946,024
Absorbing 8 HDFE groups                           F(  28,     54) =       3.55
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.0059
                                                  Adj R-squared   =     0.0059
                                                  Within R-sq.    =     0.0001
Number of clusters (fips_o)  =         55         Root MSE        =     2.5587

                                  (Std. err. adjusted for 55 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_he_2016_age1 |    .116345   .1022555     1.14   0.260    -.0886649     .321355
x_he_2016_age2 |    .030291   .0248124     1.22   0.227    -.0194548    .0800368
x_he_2016_age3 |   -.025082   .0306522    -0.82   0.417    -.0865361     .036372
x_he_2016_age4 |  -.0438552   .0210292    -2.09   0.042    -.0860162   -.0016942
x_he_2017_age1 |   .2158114   .0921601     2.34   0.023     .0310415    .4005813
x_he_2017_age2 |   .0173834     .01987     0.87   0.386    -.0224535    .0572203
x_he_2017_age3 |  -.0416858   .0196561    -2.12   0.039    -.0810939   -.0022777
x_he_2017_age4 |  -.0659194   .0319865    -2.06   0.044    -.1300485   -.0017902
x_he_2018_age1 |   .2335527    .123407     1.89   0.064    -.0138633    .4809688
x_he_2018_age2 |   .0457768   .0347204     1.32   0.193    -.0238334    .1153869
x_he_2018_age3 |  -.0050265   .0256289    -0.20   0.845    -.0564093    .0463563
x_he_2018_age4 |  -.0252927   .0221179    -1.14   0.258    -.0696364    .0190511
x_he_2021_age1 |   .2469107   .1358977     1.82   0.075    -.0255479    .5193692
x_he_2021_age2 |   .0807291   .0465328     1.73   0.088    -.0125634    .1740217
x_he_2021_age3 |  -.0478946   .0288143    -1.66   0.102    -.1056637    .0098746
x_he_2021_age4 |  -.0250447   .0280395    -0.89   0.376    -.0812605     .031171
x_he_2022_age1 |   .2950717    .188259     1.57   0.123    -.0823649    .6725082
x_he_2022_age2 |   .0033668   .0156115     0.22   0.830    -.0279325    .0346661
x_he_2022_age3 |  -.0111911   .0293769    -0.38   0.705    -.0700882     .047706
x_he_2022_age4 |  -.0562313    .024603    -2.29   0.026    -.1055574   -.0069053
x_he_2023_age1 |   .1208385   .0887001     1.36   0.179    -.0569945    .2986715
x_he_2023_age2 |   -.011558   .0326019    -0.35   0.724    -.0769208    .0538049
x_he_2023_age3 |  -.0376957   .0327808    -1.15   0.255    -.1034172    .0280258
x_he_2023_age4 |  -.0359353   .0324168    -1.11   0.273     -.100927    .0290565
x_he_2024_age1 |   .0966876   .1067939     0.91   0.369    -.1174212    .3107964
x_he_2024_age2 |  -.0218652   .0309696    -0.71   0.483    -.0839555    .0402251
x_he_2024_age3 |  -.0263885   .0257145    -1.03   0.309     -.077943    .0251661
x_he_2024_age4 |  -.0476121   .0282711    -1.68   0.098    -.1042923    .0090681
         _cons |   .0665527   .0046704    14.25   0.000      .057189    .0759164
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |        55          55           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_age_in_west

. 
. ** In-migration event study by age (Lower 48 + DC)
. reghdfe out_2 x_he_*_age* if sample_3 == 1 [pw = perwt],        ///
>         vce(cluster fips_o) absorb(year fips_o cat_*)
(MWFE estimator converged in 8 iterations)

HDFE Linear regression                            Number of obs   = 19,190,525
Absorbing 8 HDFE groups                           F(  28,    527) =       2.51
Statistics robust to heteroskedasticity           Prob > F        =     0.0000
                                                  R-squared       =     0.0041
                                                  Adj R-squared   =     0.0040
                                                  Within R-sq.    =     0.0000
Number of clusters (fips_o)  =        528         Root MSE        =     1.2246

                                 (Std. err. adjusted for 528 clusters in fips_o)
--------------------------------------------------------------------------------
               |               Robust
         out_2 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------+----------------------------------------------------------------
x_he_2016_age1 |   .0181861     .01527     1.19   0.234    -.0118114    .0481837
x_he_2016_age2 |   .0088194   .0052559     1.68   0.094    -.0015056    .0191444
x_he_2016_age3 |  -.0073424   .0053112    -1.38   0.167    -.0177762    .0030913
x_he_2016_age4 |  -.0124549   .0043592    -2.86   0.004    -.0210184   -.0038913
x_he_2017_age1 |    .039433   .0169107     2.33   0.020     .0062123    .0726537
x_he_2017_age2 |   .0083097   .0048349     1.72   0.086    -.0011883    .0178076
x_he_2017_age3 |  -.0113289   .0036127    -3.14   0.002     -.018426   -.0042318
x_he_2017_age4 |   -.016416   .0056923    -2.88   0.004    -.0275984   -.0052337
x_he_2018_age1 |   .0505087   .0221456     2.28   0.023     .0070042    .0940131
x_he_2018_age2 |   .0078117   .0063455     1.23   0.219    -.0046539    .0202773
x_he_2018_age3 |  -.0017967   .0052058    -0.35   0.730    -.0120233    .0084299
x_he_2018_age4 |  -.0097562   .0047554    -2.05   0.041    -.0190982   -.0004143
x_he_2021_age1 |   .0215699    .018647     1.16   0.248    -.0150617    .0582016
x_he_2021_age2 |    .014234    .008882     1.60   0.110    -.0032145    .0316825
x_he_2021_age3 |   -.013449   .0048548    -2.77   0.006    -.0229862   -.0039118
x_he_2021_age4 |  -.0101919   .0048891    -2.08   0.038    -.0197964   -.0005874
x_he_2022_age1 |   .0461065   .0243754     1.89   0.059    -.0017785    .0939914
x_he_2022_age2 |   .0075859   .0045514     1.67   0.096    -.0013552    .0165271
x_he_2022_age3 |    -.00631   .0049506    -1.27   0.203    -.0160354    .0034154
x_he_2022_age4 |  -.0148865   .0043394    -3.43   0.001    -.0234111   -.0063619
x_he_2023_age1 |   .0351077   .0242859     1.45   0.149    -.0126014    .0828168
x_he_2023_age2 |  -.0017451   .0064692    -0.27   0.787    -.0144536    .0109634
x_he_2023_age3 |  -.0129433    .005223    -2.48   0.014    -.0232037   -.0026829
x_he_2023_age4 |   -.011994    .006906    -1.74   0.083    -.0255606    .0015726
x_he_2024_age1 |   .0150043   .0169593     0.88   0.377    -.0183118    .0483204
x_he_2024_age2 |  -.0059065   .0058455    -1.01   0.313    -.0173899    .0055768
x_he_2024_age3 |  -.0081108   .0046358    -1.75   0.081    -.0172177    .0009961
x_he_2024_age4 |  -.0101322   .0062411    -1.62   0.105    -.0223927    .0021282
         _cons |   .0155967   .0008909    17.51   0.000     .0138465    .0173469
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         8           1           7     |
      fips_o |       528         528           0    *|
     cat_age |         4           1           3     |
     cat_sex |         2           1           1    ?|
 cat_married |         4           1           3    ?|
   cat_child |         4           1           3    ?|
   cat_yngch |         5           2           3    ?|
    cat_educ |         4           1           3    ?|
-----------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates store es_age_in_48

. 
. ********************************************************************************
. ** EVENT STUDY BY AGE PLOTS
. ********************************************************************************
. 
. 
.         clear

.         set obs 9
Number of observations (_N) was 0, now 9.

.         gen year = 2015 + _n

. 
.         ** Create coefficient variables for each age group and sample
.         forvalues a = 1/4 {
  2.                 foreach s in "out" "in_west" "in_48" {
  3.                         gen `s'_coef_age`a' = .
  4.                         gen `s'_ci_lo_age`a' = .
  5.                         gen `s'_ci_hi_age`a' = .
  6.                 }
  7.         }
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)
(9 missing values generated)

. 
.         ** Fill in coefficients
.         foreach y in 2016 2017 2018 2021 2022 2023 2024 {
  2.                 forvalues a = 1/4 {
  3. 
.                         ** Out-migration
.                         estimates restore es_age_out
  4.                         capture {
  5.                                 replace out_coef_age`a' = _b[x_he_`y'_age`a'] if year == `y'
  6.                                 replace out_ci_lo_age`a' = _b[x_he_`y'_age`a'] - 1.96 * _se[x_he_`y'
> _age`a'] if year == `y'
  7.                                 replace out_ci_hi_age`a' = _b[x_he_`y'_age`a'] + 1.96 * _se[x_he_`y'
> _age`a'] if year == `y'
  8.                         }
  9. 
.                         ** In-migration (West Coast)
.                         estimates restore es_age_in_west
 10.                         capture {
 11.                                 replace in_west_coef_age`a' = _b[x_he_`y'_age`a'] if year == `y'
 12.                                 replace in_west_ci_lo_age`a' = _b[x_he_`y'_age`a'] - 1.96 * _se[x_he
> _`y'_age`a'] if year == `y'
 13.                                 replace in_west_ci_hi_age`a' = _b[x_he_`y'_age`a'] + 1.96 * _se[x_he
> _`y'_age`a'] if year == `y'
 14.                         }
 15. 
.                         ** In-migration (Lower 48)
.                         estimates restore es_age_in_48
 16.                         capture {
 17.                                 replace in_48_coef_age`a' = _b[x_he_`y'_age`a'] if year == `y'
 18.                                 replace in_48_ci_lo_age`a' = _b[x_he_`y'_age`a'] - 1.96 * _se[x_he_`
> y'_age`a'] if year == `y'
 19.                                 replace in_48_ci_hi_age`a' = _b[x_he_`y'_age`a'] + 1.96 * _se[x_he_`
> y'_age`a'] if year == `y'
 20.                         }
 21. 
.                 }
 22.         }
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)
(results es_age_out are active now)
(results es_age_in_west are active now)
(results es_age_in_48 are active now)

. 
.         ** Base year (2019) = 0; 2020 excluded (no coefficient)
.         forvalues a = 1/4 {
  2.                 foreach s in "out" "in_west" "in_48" {
  3.                         foreach v in coef ci_lo ci_hi {
  4.                                 replace `s'_`v'_age`a' = 0 if year == 2019
  5.                         }
  6.                 }
  7.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
.         ** Offset years slightly for visibility across age groups
.         gen year_age1 = year - 0.225

.         gen year_age2 = year - 0.075

.         gen year_age3 = year + 0.075

.         gen year_age4 = year + 0.225

. 
.         ** Plot 1: Out-migration event study by age
.         twoway  (rcap out_ci_lo_age1 out_ci_hi_age1 year_age1, lc(navy))                               
>          ///
>                         (scatter out_coef_age1 year_age1, mc(navy) ms(O))                              
>  ///
>                         (rcap out_ci_lo_age2 out_ci_hi_age2 year_age2, lc(maroon))                     
>          ///
>                         (scatter out_coef_age2 year_age2, mc(maroon) ms(T))                     ///
>                         (rcap out_ci_lo_age3 out_ci_hi_age3 year_age3, lc(forest_green))               
>          ///
>                         (scatter out_coef_age3 year_age3, mc(forest_green) ms(S)) ///
>                         (rcap out_ci_lo_age4 out_ci_hi_age4 year_age4, lc(dkorange))                   
>          ///
>                         (scatter out_coef_age4 year_age4, mc(dkorange) ms(D)),          ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>                                          ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>                                          ///
>                 xlabel(2016(1)2024)                                                                    
>                                                  ///
>                 ytitle("Effect on Out-Migration (pp)")                                                 
>                                  ///
>                 xtitle("Year")                                                                         
>                                                          ///
>                 legend(order(2 "18-24" 4 "25-44" 6 "45-64" 8 "65+") pos(6) rows(1))                    
>  ///
>                 title("Out-Migration from Multnomah County by Age")                                    
>                          ///
>                 subtitle("College Degree vs. No College Degree")                                       
>                          ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_age_out_migration.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_age_out_migration.png
    saved as PNG format

. 
.         ** Plot 2: In-migration (West Coast) event study by age
.         twoway  (rcap in_west_ci_lo_age1 in_west_ci_hi_age1 year_age1, lc(navy))                       
>  ///
>                         (scatter in_west_coef_age1 year_age1, mc(navy)  ms(O))                  ///
>                         (rcap in_west_ci_lo_age2 in_west_ci_hi_age2 year_age2, lc(maroon))             
>  ///
>                         (scatter in_west_coef_age2 year_age2, mc(maroon) ms(T))                 ///
>                         (rcap in_west_ci_lo_age3 in_west_ci_hi_age3 year_age3, lc(forest_green))       
>  ///
>                         (scatter in_west_coef_age3 year_age3, mc(forest_green) ms(S)) ///
>                         (rcap in_west_ci_lo_age4 in_west_ci_hi_age4 year_age4, lc(dkorange))           
>  ///
>                         (scatter in_west_coef_age4 year_age4, mc(dkorange) ms(D)),      ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>                                          ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>                                          ///
>                 xlabel(2016(1)2024)                                                                    
>                                                  ///
>                 ytitle("Effect on In-Migration (pp)")                                                  
>                                  ///
>                 xtitle("Year")                                                                         
>                                                          ///
>                 legend(order(2 "18-24" 4 "25-44" 6 "45-64" 8 "65+") pos(6) rows(1))                    
>  ///
>                 title("In-Migration to Multnomah (West Coast) by Age")                                 
>                  ///
>                 subtitle("College Degree vs. No College Degree")                                       
>                          ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_age_in_migration_west.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_age_in_migration_west.png
    saved as PNG format

. 
.         ** Plot 3: In-migration (Lower 48 + DC) event study by age
.         twoway  (rcap in_48_ci_lo_age1 in_48_ci_hi_age1 year_age1, lc(navy))                           
>  ///
>                         (scatter in_48_coef_age1 year_age1, mc(navy) ms(O))                     ///
>                         (rcap in_48_ci_lo_age2 in_48_ci_hi_age2 year_age2, lc(maroon))                 
>  ///
>                         (scatter in_48_coef_age2 year_age2, mc(maroon) ms(T))           ///
>                         (rcap in_48_ci_lo_age3 in_48_ci_hi_age3 year_age3, lc(forest_green))           
>  ///
>                         (scatter in_48_coef_age3 year_age3, mc(forest_green) ms(S)) ///
>                         (rcap in_48_ci_lo_age4 in_48_ci_hi_age4 year_age4, lc(dkorange))               
>          ///
>                         (scatter in_48_coef_age4 year_age4, mc(dkorange) ms(D)),        ///
>                 yline(0, lc(gs10) lp(dash))                                                            
>                                          ///
>                 xline(2020.5, lc(black) lp(solid))                                                     
>                                          ///
>                 xlabel(2016(1)2024)                                                                    
>                                                  ///
>                 ytitle("Effect on In-Migration (pp)")                                                  
>                                  ///
>                 xtitle("Year")                                                                         
>                                                          ///
>                 legend(order(2 "18-24" 4 "25-44" 6 "45-64" 8 "65+") pos(6) rows(1))                    
>  ///
>                 title("In-Migration to Multnomah (Lower 48 + DC) by Age")                              
>                  ///
>                 subtitle("College Degree vs. No College Degree")                                       
>                          ///
>                 note("Base year: 2019. 2020 excluded. Vertical line indicates tax implementation.")    
>  ///
>                 graphregion(color(white))

. 
.         graph export "${results}did/fig_es_age_in_migration_48.png", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/did/fig_es_age_in_migration_48.png
    saved as PNG format

. 
. 
. ********************************************************************************
. ** CLEANUP
. ********************************************************************************
. 
. ** Close log
. clear

. log close log_02
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_did_2026-02-05.log
  log type:  text
 closed on:   5 Feb 2026, 23:32:00
---------------------------------------------------------------------------------------------------------

. 
end of do-file

. 
. ** Synthetic Difference-in-Difference Analysis
. *do ${code}02_sdid_analysis_parallel.do 
. do ${code}02_sdid_analysis.do 

. /*******************************************************************************
> File Name:              02_sdid_analysis.do
> Creator:                John Iselin
> Date Update:    January 2026
> 
> Called by: 00_multnomah.do
> 
> Purpose: Perform synthetic difference-in-difference estimation.
>          Supports both sequential and parallel processing modes.
> 
> Requirements (for parallel mode):
> - parallel package: net install parallel, from(https://raw.github.com/gvegayon/parallel/stable/) replac
> e
> 
> Outputs:
> - sdid_weights.dta/xlsx: Synthetic control weights for each specification
> - sdid_results.dta/xlsx: Treatment effects, SEs, p-values for each specification
> - fig_speccurve_*.pdf/jpg: Specification curve plots
> 
> TODO:
> 1) Recreate IRS sample with solely counties in ACS sample.
> 
> Authors: John Iselin
> 
> For more information, contact john.iselin@yale.edu
> 
> *******************************************************************************/
. 
. 
. ** Start log file
. capture log close log_02

. log using "${logs}02_log_sdid_${date}", replace text name(log_02)
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_sdid_2026-02-05.log not
    found)
---------------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_sdid_2026-02-05.log
  log type:  text
 opened on:   5 Feb 2026, 23:32:00

. 
. ** =============================================================================
. ** CONFIGURATION
. ** =============================================================================
. 
. ** Number of parallel clusters (only used if use_parallel == 1)
. ** Use fewer than total cores to leave resources for system
. local n_clusters = 6

. 
. ** Number of bootstrap replications for SDID
. local reps = 100

. 
. ** Initialize parallel processing if enabled
. if ${use_parallel} == 1 {
.         parallel initialize `n_clusters', force
N Child processes: 6
Stata dir:  C:\Program Files\StataNow19/StataMP-64.exe
. }

. 
. ** =============================================================================
. ** DATA PREPARATION
. ** =============================================================================
. 
. ** Load data
. use "${data}working/irs_county_gross", replace

. 
. ** Keep required variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3 *_net_5 *_in_5 *_out_5

. order year fips state* county*

. 
. ** Merge with ACS Data
. merge 1:1 year fips using "${data}working/acs_county_gross_18plus", gen(merge_acs_1)
(variable fips was float, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        20,771
        from master                    18,963  (merge_acs_1==1)
        from using                      1,808  (merge_acs_1==2)

    Matched                             3,017  (merge_acs_1==3)
    -----------------------------------------

. 
. ** Keep require variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3 *_net_5 *_in_5 *_out_5 merge_acs_*

. 
. ** Label acs samples
. rename persons_* acs1_persons_*

. rename households_* acs1_households_*

. rename dollars_* acs1_dollars_*

. 
. ** Merge with ACS Data
. merge 1:1 year fips using "${data}working/acs_county_gross_college", gen(merge_acs_2)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,963
        from master                    18,963  (merge_acs_2==1)
        from using                          0  (merge_acs_2==2)

    Matched                             4,825  (merge_acs_2==3)
    -----------------------------------------

. 
. ** Keep require variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3 *_net_5 *_in_5 *_out_5 merge_acs_*

. 
. ** Label acs samples
. rename persons_* acs2_persons_*

. rename households_* acs2_households_*

. rename dollars_* acs2_dollars_*

. 
. ** Drop "other counties"
. drop if county_fips == 0
(483 observations deleted)

. drop if year == 2015
(430 observations deleted)

. 
. ** Merge with Demographic data
. merge m:1 fips using "${data}working/demographics_2020",        ///
>         gen(demo_merge) keep(master match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            27
        from master                        27  (demo_merge==1)
        from using                          0  (demo_merge==2)

    Matched                            22,848  (demo_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name demo_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
                     |        21          0 |        21 
             Alabama |         0        479 |       479 
              Alaska |         6        198 |       204 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         0         34 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |         0        951 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |        27     22,848 |    22,875 

. tab year demo_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         0      3,140 |     3,140 
      2017 |         0      3,140 |     3,140 
      2018 |         0      3,140 |     3,140 
      2019 |         0      3,140 |     3,140 
      2020 |         2      3,140 |     3,142 
      2021 |         2      3,141 |     3,143 
      2022 |         9      3,133 |     3,142 
      2023 |         7        437 |       444 
      2024 |         7        437 |       444 
-----------+----------------------+----------
     Total |        27     22,848 |    22,875 

. 
. ** Keep if matched
. keep if demo_merge == 3
(27 observations deleted)

. drop demo_merge

. 
. ** Rename
. rename population pop_census

. 
. ** Merge with Demographic data
. merge m:1 year fips using "${data}working/bea_economics",       ///
>         gen(econ_merge) keep(master match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           366
        from master                       366  (econ_merge==1)
        from using                          0  (econ_merge==2)

    Matched                            22,482  (econ_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name econ_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
             Alabama |         0        479 |       479 
              Alaska |         0        198 |       198 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         9         25 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |       357        594 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |       366     22,482 |    22,848 

. tab year econ_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |        52      3,088 |     3,140 
      2017 |        52      3,088 |     3,140 
      2018 |        52      3,088 |     3,140 
      2019 |        52      3,088 |     3,140 
      2020 |        52      3,088 |     3,140 
      2021 |        53      3,088 |     3,141 
      2022 |        53      3,080 |     3,133 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |       366     22,482 |    22,848 

. 
. ** Keep if matched
. keep if econ_merge == 3
(366 observations deleted)

. drop econ_merge

. 
. ** Merge with COVID-19 Data
. merge m:1 fips using ${data}working/covid_cleaned_wide.dta,     ///
>         gen(covid_merge) keep(master match )
(variable state_name was str20, now str24 to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            73
        from master                        73  (covid_merge==1)
        from using                          0  (covid_merge==2)

    Matched                            22,409  (covid_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name covid_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |         0        479 |       479 
               Alaska |        28        170 |       198 
              Arizona |         0        113 |       113 
             Arkansas |         0        531 |       531 
           California |         0        474 |       474 
             Colorado |         0        452 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |         0        535 |       535 
              Georgia |         0      1,157 |     1,157 
               Hawaii |         0         25 |        25 
                Idaho |         0        310 |       310 
             Illinois |         0        740 |       740 
              Indiana |         0        676 |       676 
                 Iowa |         0        703 |       703 
               Kansas |         0        741 |       741 
             Kentucky |         0        854 |       854 
            Louisiana |         0        462 |       462 
                Maine |         0        116 |       116 
             Maryland |         0        190 |       190 
        Massachusetts |         0        116 |       116 
             Michigan |         0        613 |       613 
            Minnesota |         0        625 |       625 
          Mississippi |         0        580 |       580 
             Missouri |         0        819 |       819 
              Montana |         0        394 |       394 
             Nebraska |         0        657 |       657 
               Nevada |         0        123 |       123 
        New Hampshire |         0         70 |        70 
           New Jersey |         0        181 |       181 
           New Mexico |         0        235 |       235 
             New York |        45        431 |       476 
       North Carolina |         0        736 |       736 
         North Dakota |         0        373 |       373 
                 Ohio |         0        658 |       658 
             Oklahoma |         0        547 |       547 
               Oregon |         0        268 |       268 
         Pennsylvania |         0        509 |       509 
         Rhode Island |         0         41 |        41 
       South Carolina |         0        338 |       338 
         South Dakota |         0        462 |       462 
            Tennessee |         0        687 |       687 
                Texas |         0      1,854 |     1,854 
                 Utah |         0        213 |       213 
              Vermont |         0        100 |       100 
             Virginia |         0        594 |       594 
           Washington |         0        293 |       293 
        West Virginia |         0        387 |       387 
            Wisconsin |         0        530 |       530 
              Wyoming |         0        163 |       163 
----------------------+----------------------+----------
                Total |        73     22,409 |    22,482 

. tab year covid_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         9      3,079 |     3,088 
      2017 |         9      3,079 |     3,088 
      2018 |         9      3,079 |     3,088 
      2019 |         9      3,079 |     3,088 
      2020 |         9      3,079 |     3,088 
      2021 |         9      3,079 |     3,088 
      2022 |         9      3,071 |     3,080 
      2023 |         5        432 |       437 
      2024 |         5        432 |       437 
-----------+----------------------+----------
     Total |        73     22,409 |    22,482 

. 
. ** Merge with Property Tax Rates (time-varying)
. merge m:1 year fips using "${data}working/property_tax_rates_overall", ///
>         gen(proptx_merge) keep(master match) keepusing(prop_rate_mean prop_rate_se)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,591
        from master                    18,591  (proptx_merge==1)
        from using                          0  (proptx_merge==2)

    Matched                             3,891  (proptx_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name proptx_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |       422         57 |       479 
               Alaska |       189          9 |       198 
              Arizona |        71         42 |       113 
             Arkansas |       498         33 |       531 
           California |       168        306 |       474 
             Colorado |       440         12 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |       268        267 |       535 
              Georgia |       971        186 |     1,157 
               Hawaii |         7         18 |        25 
                Idaho |       301          9 |       310 
             Illinois |       593        147 |       740 
              Indiana |       532        144 |       676 
                 Iowa |       664         39 |       703 
               Kansas |       714         27 |       741 
             Kentucky |       803         51 |       854 
            Louisiana |       393         69 |       462 
                Maine |        92         24 |       116 
             Maryland |        85        105 |       190 
        Massachusetts |        77         39 |       116 
             Michigan |       469        144 |       613 
            Minnesota |       553         72 |       625 
          Mississippi |       553         27 |       580 
             Missouri |       756         63 |       819 
              Montana |       391          3 |       394 
             Nebraska |       630         27 |       657 
               Nevada |       105         18 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        28        153 |       181 
           New Mexico |       211         24 |       235 
             New York |       287        189 |       476 
       North Carolina |       562        174 |       736 
         North Dakota |       364          9 |       373 
                 Ohio |       469        189 |       658 
             Oklahoma |       517         30 |       547 
               Oregon |       196         72 |       268 
         Pennsylvania |       329        180 |       509 
         Rhode Island |        14         27 |        41 
       South Carolina |       290         48 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       600         87 |       687 
                Texas |     1,512        342 |     1,854 
                 Utah |       168         45 |       213 
              Vermont |        97          3 |       100 
             Virginia |       504         90 |       594 
           Washington |       209         84 |       293 
        West Virginia |       384          3 |       387 
            Wisconsin |       413        117 |       530 
              Wyoming |       160          3 |       163 
----------------------+----------------------+----------
                Total |    18,591      3,891 |    22,482 

. tab year proptx_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |     2,658        430 |     3,088 
      2017 |     2,658        430 |     3,088 
      2018 |     2,658        430 |     3,088 
      2019 |     2,658        430 |     3,088 
      2020 |     2,658        430 |     3,088 
      2021 |     2,658        430 |     3,088 
      2022 |     2,643        437 |     3,080 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |    18,591      3,891 |    22,482 

. 
. ** Rename for clarity
. rename prop_rate_mean prop_tax_rate

. rename prop_rate_se prop_tax_rate_se

. label var prop_tax_rate "Mean property tax rate (% of home value)"

. label var prop_tax_rate_se "SE of property tax rate"

. 
. ** Organize data
. order year fips state_* county_*

. sort fips year

. isid fips year

. 
. ** Keep only sample with non-missing base populations
. tab county_name year if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022

                      |  Tax year
                      |   (year
                      |   before
                      |   move)
          County name |      2017 |     Total
----------------------+-----------+----------
        Loving County |         1 |         1 
----------------------+-----------+----------
                Total |         1 |         1 

. drop if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022
(1 observation deleted)

. 
. ** Keep only sample with observations in each year
. bysort fips: gen ct = _N

. tab county_name state_name if ct < 7

                      |      State name
          County name | Connect..      Texas |     Total
----------------------+----------------------+----------
     Fairfield County |         6          0 |         6 
      Hartford County |         6          0 |         6 
    Litchfield County |         6          0 |         6 
        Loving County |         0          6 |         6 
     Middlesex County |         6          0 |         6 
     New Haven County |         6          0 |         6 
    New London County |         6          0 |         6 
       Tolland County |         6          0 |         6 
       Windham County |         6          0 |         6 
----------------------+----------------------+----------
                Total |        48          6 |        54 

. drop if ct < 7
(54 observations deleted)

. drop ct

. 
. ** Generate IRS sample
. gen irs_sample_1 = inrange(year, 2016, 2022)

. gen irs_sample_2 = inrange(year, 2016, 2022) & merge_acs_1 != 1

. 
. ** Generate ACS Period Indicators
. gen acs_period_1 = merge_acs_1 != 1 & inrange(year, 2016, 2022)

. gen acs_period_2 = merge_acs_1 != 1

. 
. ** Make sure we have a balanced panel of ACS counties
. gen tmp = merge_acs_1 != 1

. bysort fips: egen ct_tmp = total(tmp)

. replace acs_period_1 = 0 if ct_tmp != 9
(246 real changes made)

. replace acs_period_2 = 0 if ct_tmp != 9
(342 real changes made)

. replace irs_sample_2 = 0 if ct_tmp != 9
(246 real changes made)

. drop tmp ct_tmp

. 
. tab year irs_sample_1

  Tax year |
     (year |
    before |     irs_sample_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |         0      3,079 |     3,079 
      2017 |         0      3,079 |     3,079 
      2018 |         0      3,079 |     3,079 
      2019 |         0      3,079 |     3,079 
      2020 |         0      3,079 |     3,079 
      2021 |         0      3,079 |     3,079 
      2022 |         0      3,079 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |       874     21,553 |    22,427 

. tab year irs_sample_2

  Tax year |
     (year |
    before |     irs_sample_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_1

  Tax year |
     (year |
    before |     acs_period_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_2

  Tax year |
     (year |
    before |     acs_period_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |        48        389 |       437 
      2024 |        48        389 |       437 
-----------+----------------------+----------
     Total |    18,926      3,501 |    22,427 

. tab state_name acs_period_1

                      |     acs_period_1
           State name |         0          1 |     Total
----------------------+----------------------+----------
              Alabama |       458         21 |       479 
               Alaska |       191          7 |       198 
              Arizona |        92         21 |       113 
             Arkansas |       510         21 |       531 
           California |       236        238 |       474 
             Colorado |       445          7 |       452 
             Delaware |         6         21 |        27 
 District of Columbia |         2          7 |         9 
              Florida |       339        196 |       535 
              Georgia |     1,017        140 |     1,157 
               Hawaii |        11         14 |        25 
                Idaho |       303          7 |       310 
             Illinois |       656         84 |       740 
              Indiana |       564        112 |       676 
                 Iowa |       675         28 |       703 
               Kansas |       720         21 |       741 
             Kentucky |       819         35 |       854 
            Louisiana |       413         49 |       462 
                Maine |       102         14 |       116 
             Maryland |       113         77 |       190 
        Massachusetts |       102         14 |       116 
             Michigan |       501        112 |       613 
            Minnesota |       583         42 |       625 
          Mississippi |       559         21 |       580 
             Missouri |       784         35 |       819 
              Montana |       394          0 |       394 
             Nebraska |       636         21 |       657 
               Nevada |       109         14 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        62        119 |       181 
           New Mexico |       221         14 |       235 
             New York |       336        140 |       476 
       North Carolina |       610        126 |       736 
         North Dakota |       366          7 |       373 
                 Ohio |       525        133 |       658 
             Oklahoma |       526         21 |       547 
               Oregon |       219         49 |       268 
         Pennsylvania |       369        140 |       509 
         Rhode Island |        20         21 |        41 
       South Carolina |       331          7 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       638         49 |       687 
                Texas |     1,581        266 |     1,847 
                 Utah |       178         35 |       213 
              Vermont |       100          0 |       100 
             Virginia |       531         63 |       594 
           Washington |       230         63 |       293 
        West Virginia |       387          0 |       387 
            Wisconsin |       439         91 |       530 
              Wyoming |       163          0 |       163 
----------------------+----------------------+----------
                Total |    19,704      2,723 |    22,427 

. 
. ** Define treated state
. gen multnomah = state_fips == 41 & county_fips == 51

. label var multnomah "Indicator for Multnomah County, Oregon"

. 
. ** Define treatment indicator
. gen Treated = multnomah == 1 & year > 2020

. label var Treated "Treatment indicator for Multnomah County, Oregon"

. 
. ** Define sample 1: All counties
. gen sample_all = 1

. label var sample_all "All counties (excluding AK, CA, HI OR, WA)"

. 
. ** Define sample 2: Counties in top 95 percent
. summ percent_urban if year == 2020, de

            Percent of population in urban areas
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs               3,079
25%            0              0       Sum of wgt.       3,079

50%     .3256337                      Mean           .3521437
                        Largest       Std. dev.       .332065
75%     .6326353              1
90%      .847923              1       Variance       .1102672
95%     .9372299              1       Skewness       .3661052
99%     .9972304              1       Kurtosis       1.763629

. local cutoff = r(p95)

. tab state_name multnomah if percent_urban >= `cutoff' & year == 2020

                      |     Indicator for
                      |   Multnomah County,
                      |        Oregon
           State name |         0          1 |     Total
----------------------+----------------------+----------
               Alaska |         1          0 |         1 
              Arizona |         1          0 |         1 
           California |        15          0 |        15 
             Colorado |         4          0 |         4 
             Delaware |         1          0 |         1 
 District of Columbia |         1          0 |         1 
              Florida |        13          0 |        13 
              Georgia |         8          0 |         8 
               Hawaii |         1          0 |         1 
                Idaho |         1          0 |         1 
             Illinois |         5          0 |         5 
              Indiana |         3          0 |         3 
                 Iowa |         1          0 |         1 
               Kansas |         2          0 |         2 
             Kentucky |         2          0 |         2 
            Louisiana |         3          0 |         3 
             Maryland |         3          0 |         3 
        Massachusetts |         5          0 |         5 
             Michigan |         3          0 |         3 
            Minnesota |         3          0 |         3 
             Missouri |         4          0 |         4 
             Nebraska |         2          0 |         2 
               Nevada |         3          0 |         3 
           New Jersey |        10          0 |        10 
           New Mexico |         2          0 |         2 
             New York |         9          0 |         9 
       North Carolina |         4          0 |         4 
                 Ohio |         6          0 |         6 
             Oklahoma |         1          0 |         1 
               Oregon |         1          1 |         2 
         Pennsylvania |         4          0 |         4 
         Rhode Island |         2          0 |         2 
            Tennessee |         2          0 |         2 
                Texas |        11          0 |        11 
                 Utah |         4          0 |         4 
             Virginia |        10          0 |        10 
           Washington |         1          0 |         1 
            Wisconsin |         1          0 |         1 
----------------------+----------------------+----------
                Total |       153          1 |       154 

. gen sample_urban95 = percent_urban >= `cutoff' // All counties

. label var sample_urban95 "Urban counties (top 5%) (excluding AK, CA, HI OR, WA)"

. tab sample_urban95 if year == 2020

      Urban |
   counties |
   (top 5%) |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,925       95.00       95.00
          1 |        154        5.00      100.00
------------+-----------------------------------
      Total |      3,079      100.00

. 
. ** Define sample 3: Counties in top 98 percent
. local cutoff = .9864539 //

. tab state_name multnomah if percent_urban >= `cutoff' & year == 2020

                      |     Indicator for
                      |   Multnomah County,
                      |        Oregon
           State name |         0          1 |     Total
----------------------+----------------------+----------
           California |         6          0 |         6 
             Colorado |         2          0 |         2 
 District of Columbia |         1          0 |         1 
              Florida |         4          0 |         4 
              Georgia |         5          0 |         5 
             Illinois |         2          0 |         2 
              Indiana |         1          0 |         1 
            Louisiana |         1          0 |         1 
             Maryland |         1          0 |         1 
        Massachusetts |         1          0 |         1 
             Michigan |         1          0 |         1 
            Minnesota |         1          0 |         1 
             Missouri |         1          0 |         1 
               Nevada |         1          0 |         1 
           New Jersey |         6          0 |         6 
             New York |         7          0 |         7 
       North Carolina |         1          0 |         1 
                 Ohio |         1          0 |         1 
               Oregon |         0          1 |         1 
         Pennsylvania |         2          0 |         2 
         Rhode Island |         1          0 |         1 
                Texas |         3          0 |         3 
                 Utah |         2          0 |         2 
             Virginia |         8          0 |         8 
            Wisconsin |         1          0 |         1 
----------------------+----------------------+----------
                Total |        60          1 |        61 

. gen sample_urban98 = percent_urban >= `cutoff' // All counties

. label var sample_urban98 "Urban counties (top 1%) (excluding AK, CA, HI OR, WA)"

. tab sample_urban98 if year == 2020

      Urban |
   counties |
   (top 1%) |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,018       98.02       98.02
          1 |         61        1.98      100.00
------------+-----------------------------------
      Total |      3,079      100.00

. 
. ** Define Sample of States
. drop if state_name == "Alaska"
(198 observations deleted)

. drop if state_name == "Hawaii"
(25 observations deleted)

. drop if state_name == "California"
(474 observations deleted)

. drop if state_name == "Washington"
(293 observations deleted)

. drop if state_name == "Oregon" & multnomah == 0
(259 observations deleted)

. 
. ** Define sample 4: Counties in top 95 + covid
. cluster kmeans cases_cum* deaths_cum* if        ///
>         sample_urban95 == 1 & year == 2020 & covid_merge == 3 , k(5) gen(kmean)
cluster name: _clus_1

. bysort fips: egen kmean_group = mean(kmean)
(20,046 missing values generated)

. 
. ** Pull out kmeans cluster with Multnoma
. gen tmp1 = kmean if sample_urban95 == 1 & year == 2020 & covid_merge == 3 & multnomah == 1
(21,177 missing values generated)

. egen tmp2 = mean(tmp1)

. gen sample_urban95_covid = sample_urban95 == 1 & kmean_group == tmp2

. drop tmp1 tmp2

. label var sample_urban95_covid "Urban counties (top 5%) w. Kmean Covid Match  (excluding AK, CA, HI OR,
>  WA)"

. tab sample_urban95_covid if year == 2020

      Urban |
   counties |
(top 5%) w. |
Kmean Covid |
      Match |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,879       98.73       98.73
          1 |         37        1.27      100.00
------------+-----------------------------------
      Total |      2,916      100.00

. 
. ** Show results across clusters
. preserve

. 
. ** Keep required variables
. keep if sample_urban95 == 1 & year == 2020 & covid_merge == 3
(21,048 observations deleted)

. keep kmean cases_cum* deaths_cum* population

. collapse (mean) cases_cum* deaths_cum* [fw = population], by(kmean)

. reshape long cases_cum deaths_cum, i(kmean) j(time)
(j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations                5   ->   145         
Number of variables                  59   ->   4           
j variable (29 values)                    ->   time
xij variables:
  cases_cum1 cases_cum2 ... cases_cum29   ->   cases_cum
deaths_cum1 deaths_cum2 ... deaths_cum29  ->   deaths_cum
-----------------------------------------------------------------------------

. xtset kmean time

Panel variable: kmean (strongly balanced)
 Time variable: time, 1 to 29
         Delta: 1 unit

. xtline cases_cum

. graph export "${results}sdid/fig_kmeans.jpg", as(jpg) name("Graph") quality(100) replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/fig_kmeans.jpg written in JPEG for
> mat

. clear

. 
. ** Restore
. restore

. 
. ** Define and standardize covariates
. ** Note: prop_tax_rate added for non-IRS full sample specifications
. local all_covariates "population per_capita_income prop_tax_rate"

. foreach v of local all_covariates {
  2.         egen tmp_v = std(`v')
  3.         replace `v' = tmp_v
  4.         drop tmp_v
  5. } // END COVAR LOOP
(21,178 real changes made)
(21,178 real changes made)
(17,815 missing values generated)
(3,363 real changes made)

. 
. ** Define outcome variables (IRS)
. foreach x in "n1" "n2" "agi" {
  2. 
.         if "`x'" == "n1" local xtxt "returns"
  3.         else if "`x'" == "n2" local xtxt "exemptions"
  4.         else if "`x'" == "agi" local xtxt "AGI"
  5. 
.         ** Loop over migration type
.         foreach y in "net" "in" "out" {
  6. 
.                         if "`y'" == "net" local ytxt "Net domestic migration"
  7.                         else if "`y'" == "in" local ytxt "Domestic in-migration"
  8.                         else if "`y'" == "out" local ytxt "Domestic out-migration"
  9. 
.                         ** Generate
.                         gen `x'_`y'_rate_irs = 100 * (`x'_`y'_3 / (`x'_out_1 + `x'_out_2))
 10. 
.                         ** Label var
.                         label var `x'_`y'_rate_irs      "`ytxt' rate, `xtxt' (%)"
 11. 
.         } // END MIGRATION TYPE LOOP
 12. 
. } // END OUTCOME TYPE LOOP
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)

. 
. ** Define outcome variables (IRS, interstate movers - type 5)
. foreach x in "n1" "n2" "agi" {
  2. 
.         if "`x'" == "n1" local xtxt "returns"
  3.         else if "`x'" == "n2" local xtxt "exemptions"
  4.         else if "`x'" == "agi" local xtxt "AGI"
  5. 
.         ** Loop over migration type
.         foreach y in "net" "in" "out" {
  6. 
.                         if "`y'" == "net" local ytxt "Net interstate migration"
  7.                         else if "`y'" == "in" local ytxt "Interstate in-migration"
  8.                         else if "`y'" == "out" local ytxt "Interstate out-migration"
  9. 
.                         ** Generate
.                         gen `x'_`y'_rate_irs5 = 100 * (`x'_`y'_5 / (`x'_out_1 + `x'_out_2))
 10. 
.                         ** Label var
.                         label var `x'_`y'_rate_irs5     "`ytxt' rate, `xtxt' (%)"
 11. 
.         } // END MIGRATION TYPE LOOP
 12. 
. } // END OUTCOME TYPE LOOP (IRS5)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)

. 
. ** Define outcome variables (ACS)
. 
. ** Rename for loop
. rename acs*_households_* acs*_n1_*

. rename acs*_persons_* acs*_n2_*

. rename acs*_dollars_* acs*_agi_*

. 
. ** Loop over sample
. ** (18+ = 1, college degree == 2, no college degree == 3)
. forvalues i = 1/2{
  2. 
.         if `i' == 1 local itxt ""
  3.         else if `i' == 2 local itxt " (College)"
  4.         else if `i' == 3 local itxt " (No College)"
  5. 
. 
.         ** Define outcome variables (IRS)
.         foreach x in "n1" "n2" "agi" {
  6. 
.                 if "`x'" == "n1" local xtxt "HHs"
  7.                 else if "`x'" == "n2" local xtxt "persons"
  8.                 else if "`x'" == "agi" local xtxt "total income"
  9. 
. 
.                 ** Loop over migration type
.                 foreach y in "net" "in" "out" {
 10. 
.                                 if "`y'" == "net" local ytxt "Net domestic migration"
 11.                                 else if "`y'" == "in" local ytxt "Domestic in-migration"
 12.                                 else if "`y'" == "out" local ytxt "Domestic out-migration"
 13. 
.                                 ** Generate
.                                 gen `x'_`y'_rate_acs`i' = 100 * (acs`i'_`x'_`y'_3 / (acs`i'_`x'_out_1 +
>  acs`i'_`x'_out_2))
 14. 
.                                 ** Label var
.                                 label var `x'_`y'_rate_acs`i' "`ytxt' rate, `xtxt'`itxt' (%)"
 15. 
.                 } // END MIGRATION TYPE LOOP
 16. 
.         } // END OUTCOME TYPE LOOP
 17. 
. } // END SAMPLE LOOP
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)

. 
. ** Declare panel
. xtset fips year

Panel variable: fips (unbalanced)
 Time variable: year, 2016 to 2024
         Delta: 1 unit

. 
. ** Tag unique fips
. egen unique = tag(fips)

. tab year unique

  Tax year |
     (year |
    before |       tag(fips)
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |         0      2,916 |     2,916 
      2017 |     2,916          0 |     2,916 
      2018 |     2,916          0 |     2,916 
      2019 |     2,916          0 |     2,916 
      2020 |     2,916          0 |     2,916 
      2021 |     2,916          0 |     2,916 
      2022 |     2,916          0 |     2,916 
      2023 |       383          0 |       383 
      2024 |       383          0 |       383 
-----------+----------------------+----------
     Total |    18,262      2,916 |    21,178 

. 
. ** Label var
. label var year "Year (destination)"

. 
. ** =============================================================================
. ** PARALLEL MODE: DEFINE PROGRAMS AND SETUP
. ** =============================================================================
. 
. if ${use_parallel} == 1 {
. 
.         ** Save main analysis data for parallel workers
.         save "${data}working/sdid_analysis_data.dta", replace
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/sdid_analysis_data.dta not
    found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/sdid_analysis_data.dta saved
. 
.         ** Create table-level specification grid
.         preserve
.         clear
. 
.         ** Table units are defined by:
.         ** - data_var (irs_sample_1, irs_sample_2, acs_period_1, acs_period_2)
.         ** - out_type (irs, acs1, acs2) - but tied to data_var
.         ** - samp_var (sample_all, sample_urban95, sample_urban95_covid)
.         ** - exclusion (0, 1)
.         ** - migr_type (net, in, out)
. 
.         local table_id = 0
. 
.         ** Initialize empty dataset
.         set obs 0
Number of observations (_N) was 0, now 0.
.         gen table_id = .
.         gen data_var = ""
.         gen out_type = ""
.         gen out_txt = ""
.         gen samp_var = ""
.         gen exclusion = .
.         gen migr_type = ""
. 
.         save "${data}working/table_grid.dta", replace
(dataset contains 0 observations)
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
. 
.         ** Build table grid
.         foreach data in "irs_sample_1" "irs_sample_2" "acs_period_1" "acs_period_2" {
  2. 
.                 ** Different sets of outcome variable types
.                 if "`data'" == "irs_sample_1" | "`data'" == "irs_sample_2" {
  3.                         local out_types "irs irs5"
  4.                 }
  5.                 else {
  6.                         local out_types "acs1 acs2"
  7.                 }
  8. 
.                 foreach type of local out_types {
  9. 
.                         ** Labels
.                         if "`data'" == "irs_sample_1" & "`type'" == "irs" local out_txt "irs_full_16_22
> "
 10.                         else if "`data'" == "irs_sample_1" & "`type'" == "irs5" local out_txt "irs5_
> full_16_22"
 11.                         else if "`data'" == "irs_sample_2" & "`type'" == "irs" local out_txt "irs_38
> 9_16_22"
 12.                         else if "`data'" == "irs_sample_2" & "`type'" == "irs5" local out_txt "irs5_
> 389_16_22"
 13.                         else if "`data'" == "acs_period_1" & "`type'" == "acs1" local out_txt "acs_1
> 6_22_all"
 14.                         else if "`data'" == "acs_period_1" & "`type'" == "acs2" local out_txt "acs_1
> 6_22_col"
 15.                         else if "`data'" == "acs_period_2" & "`type'" == "acs1" local out_txt "acs_1
> 6_24_all"
 16.                         else if "`data'" == "acs_period_2" & "`type'" == "acs2" local out_txt "acs_1
> 6_24_col"
 17. 
.                         foreach samp in "sample_all" "sample_urban95" "sample_urban95_covid" {
 18.                                 forvalues exl = 0/1 {
 19.                                         foreach migr in "net" "in" "out" {
 20. 
.                                                 local table_id = `table_id' + 1
 21. 
.                                                 ** Add row to grid
.                                                 clear
 22.                                                 set obs 1
 23.                                                 gen table_id = `table_id'
 24.                                                 gen data_var = "`data'"
 25.                                                 gen out_type = "`type'"
 26.                                                 gen out_txt = "`out_txt'"
 27.                                                 gen samp_var = "`samp'"
 28.                                                 gen exclusion = `exl'
 29.                                                 gen migr_type = "`migr'"
 30. 
.                                                 append using "${data}working/table_grid.dta"
 31.                                                 save "${data}working/table_grid.dta", replace
 32. 
.                                         }
 33.                                 }
 34.                         }
 35.                 }
 36.         }
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_type was str3, now str4 to accommodate using data's values)
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str14, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str15 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
. 
.         ** Load and verify grid
.         use "${data}working/table_grid.dta", clear
.         dis "Total table units: " _N
Total table units: 144
.         sort table_id
.         save "${data}working/table_grid.dta", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
. 
.         restore
. 
.         ** Define program to run all SDID specifications for one table
.         capture program drop run_sdid_table
.         program define run_sdid_table
  1.                 syntax, table_id(integer) data_path(string) results_path(string) reps(integer)
  2. 
.                 ** Load table specification from grid
.                 preserve
  3.                 use "`data_path'working/table_grid.dta", clear
  4.                 keep if table_id == `table_id'
  5. 
.                 ** Extract specification parameters
.                 local data_var = data_var[1]
  6.                 local out_type = out_type[1]
  7.                 local out_txt = out_txt[1]
  8.                 local samp_var = samp_var[1]
  9.                 local exl = exclusion[1]
 10.                 local migr = migr_type[1]
 11. 
.                 restore
 12. 
.                 ** Load main analysis data
.                 use "`data_path'working/sdid_analysis_data.dta", clear
 13. 
.                 ** Define sample
.                 gen sample = `samp_var' == 1 & `data_var' == 1
 14.                 if `exl' == 1 replace sample = 0 if year == 2020
 15. 
.                 ** Skip if no treated unit in sample
.                 qui count if multnomah == 1 & sample == 1
 16.                 if r(N) == 0 {
 17.                         dis "Skipping table `table_id': no treated unit in sample"
 18.                         exit
 19.                 }
 20. 
.                 ** Create output directory
.                 capture mkdir "`results_path'sdid/`out_txt'"
 21. 
.                 ** Define covariates
.                 if "`data_var'" == "irs_sample_1" local covariates "population per_capita_income"
 22.                 else local covariates "population per_capita_income prop_tax_rate"
 23. 
.                 ** Clear stored estimates
.                 eststo clear
 24. 
.                 ** Loop over outcomes (n1, n2, agi) and covariate settings (0, 1)
.                 foreach outvar in "n1" "n2" "agi" {
 25. 
.                         ** Full outcome variable name
.                         local outcome "`outvar'_`migr'_rate_`out_type'"
 26. 
.                         ** Store label
.                         local label : variable label `outcome'
 27. 
.                         ** Loop over covariate settings
.                         forvalues c = 0/1 {
 28. 
.                                 ** Covariates for sdid (supports 'projected' option)
.                                 if `c' == 0 local covars ""
 29.                                 else if `c' == 1 local covars "covariates(`covariates', projected)"
 30. 
.                                 ** Covariates for sdid_event (doesn't support 'projected' option)
.                                 if `c' == 0 local covars_event ""
 31.                                 else if `c' == 1 local covars_event "covariates(`covariates')"
 32. 
.                                 ** File paths for figures
.                                 if `exl' == 0 local path "`results_path'sdid/`out_txt'/fig_`out_txt'_`o
> utcome'_`c'_`samp_var'_"
 33.                                 if `exl' == 1 local path "`results_path'sdid/`out_txt'/fig_`out_txt'
> _`outcome'_`c'_`samp_var'_excl2020_"
 34. 
.                                 ** Run SDID
.                                 capture noisily {
 35.                                         eststo sdid_`outvar'_`c': sdid `outcome' fips year Treated  
>     ///
>                                                 if sample == 1,                         ///
>                                                 vce(placebo)                            ///
>                                                 `covars'                                        ///
>                                                 reps(`reps')                            ///
>                                                 graph graph_export("`path'", .pdf)
 36.                                 }
 37. 
.                                 ** Store results
.                                 local tmp_tau = e(ATT)
 38.                                 local tmp_se = e(se)
 39.                                 matrix omega = e(omega)
 40. 
.                                 ** Pre-treatment mean and county count
.                                 qui summ `outcome' if multnomah == 1 & Treated == 0
 41.                                 local tmp_premean = r(mean)
 42.                                 estadd scalar mean = r(mean)
 43. 
.                                 qui summ `outcome' if year == 2021 & sample == 1
 44.                                 local tmp_ncounties = r(N)
 45.                                 estadd scalar count = r(N)
 46. 
.                                 ** Save treatment effect results
.                                 preserve
 47.                                 clear
 48.                                 set obs 1
 49.                                 gen table_id = `table_id'
 50.                                 gen sample_data = "`out_txt'"
 51.                                 gen sample = "`samp_var'"
 52.                                 gen outcome = "`outcome'"
 53.                                 gen controls = `c'
 54.                                 gen exclusion = `exl'
 55.                                 gen tau = `tmp_tau'
 56.                                 gen se = `tmp_se'
 57.                                 gen pval = 2 * (1 - normal(abs(tau/se)))
 58.                                 gen ci_lower = tau - 1.96 * se
 59.                                 gen ci_upper = tau + 1.96 * se
 60.                                 gen n_counties = `tmp_ncounties'
 61.                                 gen pre_mean = `tmp_premean'
 62.                                 gen significant = abs(tau/se) > 1.96
 63.                                 save "`results_path'sdid/temp_results/results_`table_id'_`outvar'_`c
> '.dta", replace
 64.                                 restore
 65. 
.                                 ** Save weights
.                                 preserve
 66.                                 clear
 67.                                 svmat double omega, names(col)
 68.                                 rename c2 fips
 69.                                 rename c1 weight
 70.                                 gen table_id = `table_id'
 71.                                 gen sample_data = "`out_txt'"
 72.                                 gen out = "`outcome'"
 73.                                 gen sample = "`samp_var'"
 74.                                 gen controls = `c'
 75.                                 gen exclusion = `exl'
 76.                                 drop if weight == 0
 77.                                 drop if missing(fips)
 78.                                 save "`results_path'sdid/temp_weights/weights_`table_id'_`outvar'_`c
> '.dta", replace
 79.                                 restore
 80. 
.                                 ** Run event study
.                                 capture noisily {
 81.                                         sdid_event `outcome' fips year Treated  ///
>                                                 if sample == 1,                                        
>  ///
>                                                 `covars_event'                                         
>  ///
>                                                 vce(placebo)                                           
>  ///
>                                                 brep(`reps')                                           
>  ///
>                                                 placebo(all)
 82.                                 }
 83. 
.                                 local event_rc = _rc
 84. 
.                                 if `event_rc' == 0 {
 85. 
.                                         ** Store max year
.                                         qui summ year if multnomah == 1 & sample == 1
 86.                                         local max_yr = r(max)
 87. 
.                                         ** Move results from matrix to data
.                                         qui count if multnomah == 1 & sample == 1
 88.                                         local ct = r(N)
 89.                                         local ct = `ct' + 1
 90. 
.                                         ** Extract matrix
.                                         capture mat res = e(H)[2..`ct',1..5]
 91.                                         if _rc != 0 {
 92.                                                 continue
 93.                                         }
 94. 
.                                         ** Preserve data before plotting
.                                         preserve
 95. 
.                                         ** Move to data
.                                         svmat res
 96. 
.                                         ** Generate ID variable
.                                         gen id = `max_yr' - _n + 1 if !missing(res1)
 97. 
.                                         ** Handle exclusion year labeling
.                                         if `exl' == 1 {
 98.                                                 replace id = id - 1 if id <= 2020
 99.                                                 expand 2 if id == 2019, gen(tag)
100.                                                 replace id = 2020 if tag == 1
101.                                                 replace res1 = . if tag == 1
102.                                                 replace res3 = . if tag == 1
103.                                                 replace res4 = . if tag == 1
104.                                         }
105.                                         label var id "Year (destination)"
106. 
.                                         ** Sort
.                                         sort id
107. 
.                                         ** Plot
.                                         twoway  (rcap res3 res4 id, lc(gs10) fc(gs11%50))       ///
>                                                         (scatter res1 id, mc(black)),                  
>          ///
>                                                 legend(off) ytitle("`label'")                          
>          ///
>                                                 yline(0, lc(red) lp(-))                                
>                  ///
>                                                 xline(2020.5, lc(black) lp(solid))                     
>          ///
>                                                 ylabel(-10(2.5)10, format(%9.1f))
108. 
.                                         if `exl' == 1 local evpath "`results_path'sdid/`out_txt'/fig_`o
> ut_txt'_`outcome'_`c'_`samp_var'_excl2020_eventstudy.jpg"
109.                                         else local evpath "`results_path'sdid/`out_txt'/fig_`out_txt
> '_`outcome'_`c'_`samp_var'_eventstudy.jpg"
110. 
.                                         graph export "`evpath'", as(jpg) name("Graph") quality(100) rep
> lace
111. 
.                                         ** Restore data
.                                         restore
112. 
.                                 }
113. 
.                                 ** Clean up sdid_event internal variables
.                                 capture drop ever_treated*
114. 
.                         } // END COVAR LOOP
115. 
.                 } // END OUTCOME LOOP
116. 
.                 ** Generate table for this migration type (all 6 specs)
.                 if `exl' == 0 local tabpath "`results_path'sdid/`out_txt'/tab_sdid_`out_txt'_`migr'_`sa
> mp_var'.tex"
117.                 if `exl' == 1 local tabpath "`results_path'sdid/`out_txt'/tab_sdid_`out_txt'_`migr'_
> `samp_var'_excl2020.tex"
118. 
.                 ** Generate table based on data type
.                 if "`data_var'" == "irs_sample_1" | "`data_var'" == "irs_sample_2" {
119.                         capture noisily {
120.                                 esttab  sdid_n1_0 sdid_n1_1     ///
>                                                 sdid_n2_0 sdid_n2_1     ///
>                                                 sdid_agi_0 sdid_agi_1 ///
>                                         using "`tabpath'",                                             
>                  ///
>                                         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                ///
>                                         b(%-9.3f) se(%-9.3f) replace                                   
>  ///
>                                         mgroups("Returns" "Exemptions" "AGI",                   ///
>                                                 pattern(1 0 1 0 1 0) )                                 
>          ///
>                                         mtitle( "No Covariates" "Covariates"                    ///
>                                                         "No Covariates" "Covariates"                   
>  ///
>                                                         "No Covariates" "Covariates")                  
>  ///
>                                         stats(count mean,                                              
>                  ///
>                                                 fmt(%9.0fc %9.3fc)                                     
>                  ///
>                                                 labels("Number of Counties" "Pre-treatment mean"))
121.                         }
122.                 }
123.                 else {
124.                         capture noisily {
125.                                 esttab  sdid_n1_0 sdid_n1_1     ///
>                                                 sdid_n2_0 sdid_n2_1     ///
>                                                 sdid_agi_0 sdid_agi_1 ///
>                                         using "`tabpath'",                                             
>                  ///
>                                         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                ///
>                                         b(%-9.3f) se(%-9.3f) replace                                   
>  ///
>                                         mgroups("Households" "Adults" "Household Income",       ///
>                                                 pattern(1 0 1 0 1 0) )                                 
>          ///
>                                         mtitle( "No Covariates" "Covariates"                    ///
>                                                         "No Covariates" "Covariates"                   
>  ///
>                                                         "No Covariates" "Covariates")                  
>  ///
>                                         stats(count mean,                                              
>                  ///
>                                                 fmt(%9.0fc %9.3fc)                                     
>                  ///
>                                                 labels("Number of Counties" "Pre-treatment mean"))
126.                         }
127.                 }
128. 
.                 dis "Completed table `table_id': `out_txt' / `migr' / `samp_var' / excl=`exl'"
129. 
.         end
. 
.         ** Define wrapper program for parallel execution
.         capture program drop parallel_sdid_wrapper
.         program define parallel_sdid_wrapper
  1.                 ** Store all table_ids upfront (run_sdid_table will overwrite the dataset)
.                 local n_obs = _N
  2.                 forvalues i = 1/`n_obs' {
  3.                         local tid_`i' = table_id[`i']
  4.                 }
  5. 
.                 ** Now loop through and process each table
.                 forvalues i = 1/`n_obs' {
  6.                         dis "Worker processing table `tid_`i'' (`i' of `n_obs' in this chunk)"
  7.                         run_sdid_table, table_id(`tid_`i'') data_path("${data}") results_path("${res
> ults}") reps(100)
  8.                 }
  9.         end
. 
. } // END PARALLEL SETUP

. 
. ** =============================================================================
. ** MAIN ESTIMATION
. ** =============================================================================
. 
. if ${use_parallel} == 1 {
. 
.         ** =========================================================================
.         ** PARALLEL ESTIMATION
.         ** =========================================================================
. 
.         ** Create temp directories for results
.         capture mkdir "${results}sdid/temp_results"
.         capture mkdir "${results}sdid/temp_weights"
. 
.         ** Create subfolders for each output type
.         foreach out_txt in "irs_full_16_22" "irs5_full_16_22" "irs_389_16_22" "irs5_389_16_22" "acs_16_
> 22_all" "acs_16_22_col" "acs_16_24_all" "acs_16_24_col" {
  2.                 capture mkdir "${results}sdid/`out_txt'"
  3.         }
. 
.         ** Load table grid
.         use "${data}working/table_grid.dta", clear
.         local n_tables = _N
.         dis "Running `n_tables' table units in parallel (each with 6 SDID specs)..."
Running 144 table units in parallel (each with 6 SDID specs)...
. 
.         ** Save table IDs for parallel processing (shuffle to balance workload)
.         preserve
.         keep table_id
.         gen rand_order = runiform()
.         sort rand_order
.         drop rand_order
.         save "${data}working/table_ids.dta", replace
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_ids.dta not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_ids.dta saved
.         restore
. 
.         ** Load table IDs and run in parallel
.         use "${data}working/table_ids.dta", clear
. 
.         ** Run parallel estimation
.         dis "Starting parallel SDID estimation at $S_TIME..."
Starting parallel SDID estimation at 23:32:10...
.         timer clear 1
.         timer on 1
. 
.         parallel, prog(parallel_sdid_wrapper run_sdid_table): parallel_sdid_wrapper
--------------------------------------------------------------------------------
Exporting the following program(s): parallel_sdid_wrapper run_sdid_table

parallel_sdid_wrapper:
  1.                 local n_obs = _N
  2.                 forvalues i = 1/`n_obs' {
  3.                         local tid_`i' = table_id[`i']
  4.                 }
  5.                 forvalues i = 1/`n_obs' {
  6.                         dis "Worker processing table `tid_`i'' (`i' of `n_obs' in this chunk)"
  7.                         run_sdid_table, table_id(`tid_`i'') data_path("${data}") results_path("${res
> ults}") reps(100)
  8.                 }

run_sdid_table:
  1.                 syntax, table_id(integer) data_path(string) results_path(string) reps(integer)
  2.                 preserve
  3.                 use "`data_path'working/table_grid.dta", clear
  4.                 keep if table_id == `table_id'
  5.                 local data_var = data_var[1]
  6.                 local out_type = out_type[1]
  7.                 local out_txt = out_txt[1]
  8.                 local samp_var = samp_var[1]
  9.                 local exl = exclusion[1]
 10.                 local migr = migr_type[1]
 11.                 restore
 12.                 use "`data_path'working/sdid_analysis_data.dta", clear
 13.                 gen sample = `samp_var' == 1 & `data_var' == 1
 14.                 if `exl' == 1 replace sample = 0 if year == 2020
 15.                 qui count if multnomah == 1 & sample == 1
 16.                 if r(N) == 0 {
 17.                         dis "Skipping table `table_id': no treated unit in sample"
 18.                         exit
 19.                 }
 20.                 capture mkdir "`results_path'sdid/`out_txt'"
 21.                 if "`data_var'" == "irs_sample_1" local covariates "population per_capita_income"
 22.                 else local covariates "population per_capita_income prop_tax_rate"
 23.                 eststo clear
 24.                 foreach outvar in "n1" "n2" "agi" {
 25.                         local outcome "`outvar'_`migr'_rate_`out_type'"
 26.                         local label : variable label `outcome'
 27.                         forvalues c = 0/1 {
 28.                                 if `c' == 0 local covars ""
 29.                                 else if `c' == 1 local covars "covariates(`covariates', projected)"
 30.                                 if `c' == 0 local covars_event ""
 31.                                 else if `c' == 1 local covars_event "covariates(`covariates')"
 32.                                 if `exl' == 0 local path "`results_path'sdid/`out_txt'/fig_`out_txt'
> _`outcome'_`c'_`samp_var'_"
 33.                                 if `exl' == 1 local path "`results_path'sdid/`out_txt'/fig_`out_txt'
> _`outcome'_`c'_`samp_var'_excl2020_"
 34.                                 capture noisily {
 35.                                         eststo sdid_`outvar'_`c': sdid `outcome' fips year Treated i
> f sample == 1, vce(placebo) `covars' reps(`reps') graph graph_export("`path'", .pdf)
 36.                                 }
 37.                                 local tmp_tau = e(ATT)
 38.                                 local tmp_se = e(se)
 39.                                 matrix omega = e(omega)
 40.                                 qui summ `outcome' if multnomah == 1 & Treated == 0
 41.                                 local tmp_premean = r(mean)
 42.                                 estadd scalar mean = r(mean)
 43.                                 qui summ `outcome' if year == 2021 & sample == 1
 44.                                 local tmp_ncounties = r(N)
 45.                                 estadd scalar count = r(N)
 46.                                 preserve
 47.                                 clear
 48.                                 set obs 1
 49.                                 gen table_id = `table_id'
 50.                                 gen sample_data = "`out_txt'"
 51.                                 gen sample = "`samp_var'"
 52.                                 gen outcome = "`outcome'"
 53.                                 gen controls = `c'
 54.                                 gen exclusion = `exl'
 55.                                 gen tau = `tmp_tau'
 56.                                 gen se = `tmp_se'
 57.                                 gen pval = 2 * (1 - normal(abs(tau/se)))
 58.                                 gen ci_lower = tau - 1.96 * se
 59.                                 gen ci_upper = tau + 1.96 * se
 60.                                 gen n_counties = `tmp_ncounties'
 61.                                 gen pre_mean = `tmp_premean'
 62.                                 gen significant = abs(tau/se) > 1.96
 63.                                 save "`results_path'sdid/temp_results/results_`table_id'_`outvar'_`c
> '.dta", replace
 64.                                 restore
 65.                                 preserve
 66.                                 clear
 67.                                 svmat double omega, names(col)
 68.                                 rename c2 fips
 69.                                 rename c1 weight
 70.                                 gen table_id = `table_id'
 71.                                 gen sample_data = "`out_txt'"
 72.                                 gen out = "`outcome'"
 73.                                 gen sample = "`samp_var'"
 74.                                 gen controls = `c'
 75.                                 gen exclusion = `exl'
 76.                                 drop if weight == 0
 77.                                 drop if missing(fips)
 78.                                 save "`results_path'sdid/temp_weights/weights_`table_id'_`outvar'_`c
> '.dta", replace
 79.                                 restore
 80.                                 capture noisily {
 81.                                         sdid_event `outcome' fips year Treated if sample == 1, `cova
> rs_event' vce(placebo) brep(`reps') placebo(all)
 82.                                 }
 83.                                 local event_rc = _rc
 84.                                 if `event_rc' == 0 {
 85.                                         qui summ year if multnomah == 1 & sample == 1
 86.                                         local max_yr = r(max)
 87.                                         qui count if multnomah == 1 & sample == 1
 88.                                         local ct = r(N)
 89.                                         local ct = `ct' + 1
 90.                                         capture mat res = e(H)[2..`ct',1..5]
 91.                                         if _rc != 0 {
 92.                                                 continue
 93.                                         }
 94.                                         preserve
 95.                                         svmat res
 96.                                         gen id = `max_yr' - _n + 1 if !missing(res1)
 97.                                         if `exl' == 1 {
 98.                                                 replace id = id - 1 if id <= 2020
 99.                                                 expand 2 if id == 2019, gen(tag)
100.                                                 replace id = 2020 if tag == 1
101.                                                 replace res1 = . if tag == 1
102.                                                 replace res3 = . if tag == 1
103.                                                 replace res4 = . if tag == 1
104.                                         }
105.                                         label var id "Year (destination)"
106.                                         sort id
107.                                         twoway (rcap res3 res4 id, lc(gs10) fc(gs11%50)) (scatter re
> s1 id, mc(black)), legend(off) ytitle("`label'") yline(0, lc(red) lp(-)) xline(2020.5, lc(black) lp(sol
> id)) ylabel(-10(2.5)10, format(%9.1f))
108.                                         if `exl' == 1 local evpath "`results_path'sdid/`out_txt'/fig
> _`out_txt'_`outcome'_`c'_`samp_var'_excl2020_eventstudy.jpg"
109.                                         else local evpath "`results_path'sdid/`out_txt'/fig_`out_txt
> '_`outcome'_`c'_`samp_var'_eventstudy.jpg"
110.                                         graph export "`evpath'", as(jpg) name("Graph") quality(100) 
> replace
111.                                         restore
112.                                 }
113.                                 capture drop ever_treated*
114.                         }
115.                 }
116.                 if `exl' == 0 local tabpath "`results_path'sdid/`out_txt'/tab_sdid_`out_txt'_`migr'_
> `samp_var'.tex"
117.                 if `exl' == 1 local tabpath "`results_path'sdid/`out_txt'/tab_sdid_`out_txt'_`migr'_
> `samp_var'_excl2020.tex"
118.                 if "`data_var'" == "irs_sample_1" | "`data_var'" == "irs_sample_2" {
119.                         capture noisily {
120.                                 esttab sdid_n1_0 sdid_n1_1 sdid_n2_0 sdid_n2_1 sdid_agi_0 sdid_agi_1
>  using "`tabpath'", starlevel("*" 0.10 "**" 0.05 "***" 0.01) b(%-9.3f) se(%-9.3f) replace mgroups("Retu
> rns" "Exemptions" "AGI", pattern(1 0 1 0 1 0) ) mtitle( "No Covariates" "Covariates" "No Covariates" "C
> ovariates" "No Covariates" "Covariates") stats(count mean, fmt(%9.0fc %9.3fc) labels("Number of Countie
> s" "Pre-treatment mean"))
121.                         }
122.                 }
123.                 else {
124.                         capture noisily {
125.                                 esttab sdid_n1_0 sdid_n1_1 sdid_n2_0 sdid_n2_1 sdid_agi_0 sdid_agi_1
>  using "`tabpath'", starlevel("*" 0.10 "**" 0.05 "***" 0.01) b(%-9.3f) se(%-9.3f) replace mgroups("Hous
> eholds" "Adults" "Household Income", pattern(1 0 1 0 1 0) ) mtitle( "No Covariates" "Covariates" "No Co
> variates" "Covariates" "No Covariates" "Covariates") stats(count mean, fmt(%9.0fc %9.3fc) labels("Numbe
> r of Counties" "Pre-treatment mean"))
126.                         }
127.                 }
128.                 dis "Completed table `table_id': `out_txt' / `migr' / `samp_var' / excl=`exl'"
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
Parallel Computing with Stata
Child processes: 6
pll_id         : qasd6o3xk1
Running at     : C:\Users\ji252\Documents\GitHub\multnomah-county-tax
Randtype       : datetime
Waiting for the child processes to finish...
The user pressed -break-. Trying to stop the child processes...
Not able to remove temp dir
child process 0004 Exited with error -1- while running the command/dofile (view log)...
Not able to remove temp dir
Not able to remove temp dir
child process 0005 Exited with error -1- while running the command/dofile (view log)...
Not able to remove temp dir
child process 0006 Exited with error -1- while running the command/dofile (view log)...
child process 0001 Exited with error -1- while running the command/dofile (view log)...
child process 0002 Exited with error -1- while running the command/dofile (view log)...
child process 0003 Exited with error -1- while running the command/dofile (view log)...
--------------------------------------------------------------------------------
Enter -parallel printlog #- to checkout logfiles.
--------------------------------------------------------------------------------
6 child processes encountered errors. Throwing last error.
--Break--
r(1);
. 
.         timer off 1
.         timer list 1
.         dis "Parallel estimation completed at $S_TIME"
. 
.         ** Combine all treatment effect results
.         dis "Combining results from parallel workers..."
.         clear
.         local files : dir "${results}sdid/temp_results" files "results_*.dta"
.         local first = 1
. 
.         foreach f of local files {
  2.                 if `first' == 1 {
  3.                         use "${results}sdid/temp_results/`f'", clear
  4.                         local first = 0
  5.                 }
  6.                 else {
  7.                         append using "${results}sdid/temp_results/`f'"
  8.                 }
  9.         }
. 
.         ** Save combined results
.         order sample_data sample outcome controls exclusion tau se pval ci_lower ci_upper n_counties pre_mean significant
.         compress
.         save "${results}sdid/sdid_results.dta", replace
.         export excel using "${results}sdid/sdid_results.xlsx", firstrow(variables) replace
. 
.         ** Combine all weights
.         clear
.         local files : dir "${results}sdid/temp_weights" files "weights_*.dta"
.         local first = 1
. 
.         foreach f of local files {
  2.                 if `first' == 1 {
  3.                         use "${results}sdid/temp_weights/`f'", clear
  4.                         local first = 0
  5.                 }
  6.                 else {
  7.                         append using "${results}sdid/temp_weights/`f'"
  8.                 }
  9.         }
. 
.         ** Save combined weights
.         order sample_data sample out controls exclusion fips weight
.         sort sample_data sample out controls exclusion weight
.         compress
.         save "${results}sdid/sdid_weights.dta", replace
.         export excel using "${results}sdid/sdid_weights.xlsx", firstrow(variables) replace
. 
.         ** Clean up temp directories
.         shell rmdir "${results}sdid/temp_results" /s /q
.         shell rmdir "${results}sdid/temp_weights" /s /q
. 
.         ** Clean up temporary files
.         capture erase "${data}working/sdid_analysis_data.dta"
.         capture erase "${data}working/table_grid.dta"
.         capture erase "${data}working/table_ids.dta"
. 
.         dis "Parallel results combined and saved."
. 
. }
--Break--
r(1);

end of do-file
--Break--
r(1);

end of do-file

--Break--
r(1);

. clear

. exit, clear
