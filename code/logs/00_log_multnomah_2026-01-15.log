------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/00_log_multnomah_2026-01-1
> 5.log
  log type:  text
 opened on:  15 Jan 2026, 15:24:50

. 
. ** Set Seed 
. set seed 56403

. 
. ** Set scheme
. set scheme plotplainblind

. 
. ** Set parameters 
. local overwrite_csv = 1

. global start_year_acs = 2015

. global end_year_acs = 2024

. 
end of do-file

. do "C:\Users\ji252\AppData\Local\Temp\STD4058_000002.tmp"

. ** Synthetic Difference-in-Difference Analysis
. do ${code}02_sdid_analysis.do 

. /*******************************************************************************
> File Name:              02_sdid_analysis.do
> Creator:                John Iselin
> Date Update:    January 13, 2025
> 
> Called by: 00_multnomah.do
> 
> Purpose: Perform synthetic difference-in-difference estimation.
> 
> Outputs:
> - sdid_weights.dta/xlsx: Synthetic control weights for each specification
> - sdid_results.dta/xlsx: Treatment effects, SEs, p-values for each specification
> - fig_speccurve_*.pdf/jpg: Specification curve plots
> 
> TODO:
> 1) Recreate IRS sample with solely counties in ACS sample.
> 
> Authors: John Iselin
> 
> For more information, contact john.iselin@yale.edu
> 
> *******************************************************************************/
. 
. 
. ** Start log file 
. capture log close log_02

. log using "${logs}02_log_sdid_${date}", replace text name(log_02)
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_sdid_2026-01-15.log not
    found)
------------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_sdid_2026-01-15.log
  log type:  text
 opened on:  15 Jan 2026, 15:24:54

. 
. ** Parameters 
. local reps = 100

. 
. ** Load data 
. use "${data}working/irs_county_gross", replace 

. 
. ** Keep required variables 
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3

. order year fips state* county* 

. 
. ** Merge with ACS Data 
. merge 1:1 year fips using "${data}working/acs_county_gross_18plus", gen(merge_acs_1)
(variable fips was float, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        20,771
        from master                    18,963  (merge_acs_1==1)
        from using                      1,808  (merge_acs_1==2)

    Matched                             3,017  (merge_acs_1==3)
    -----------------------------------------

. 
. ** Keep require variables 
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3 merge_acs_*

. 
. ** Label acs samples 
. rename persons_* acs1_persons_* 

. rename households_* acs1_households_*

. rename dollars_* acs1_dollars_*

. 
. ** Merge with ACS Data 
. merge 1:1 year fips using "${data}working/acs_county_gross_college", gen(merge_acs_2)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,963
        from master                    18,963  (merge_acs_2==1)
        from using                          0  (merge_acs_2==2)

    Matched                             4,825  (merge_acs_2==3)
    -----------------------------------------

. 
. ** Keep require variables 
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3  merge_acs_*

. 
. ** Label acs samples 
. rename persons_* acs2_persons_*

. rename households_* acs2_households_*

. rename dollars_* acs2_dollars_*

. 
. ** Drop "other counties"
. drop if county_fips == 0
(483 observations deleted)

. drop if year == 2015 
(430 observations deleted)

. 
. ** Merge with Demographic data 
. merge m:1 fips using "${data}working/demographics_2020",        ///
>         gen(demo_merge) keep(master match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            27
        from master                        27  (demo_merge==1)
        from using                          0  (demo_merge==2)

    Matched                            22,848  (demo_merge==3)
    -----------------------------------------

.         
. ** Show match 
. tab state_name demo_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
                     |        21          0 |        21 
             Alabama |         0        479 |       479 
              Alaska |         6        198 |       204 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         0         34 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |         0        951 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |        27     22,848 |    22,875 

. tab year demo_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         0      3,140 |     3,140 
      2017 |         0      3,140 |     3,140 
      2018 |         0      3,140 |     3,140 
      2019 |         0      3,140 |     3,140 
      2020 |         2      3,140 |     3,142 
      2021 |         2      3,141 |     3,143 
      2022 |         9      3,133 |     3,142 
      2023 |         7        437 |       444 
      2024 |         7        437 |       444 
-----------+----------------------+----------
     Total |        27     22,848 |    22,875 

. 
. ** Keep if matched 
. keep if demo_merge == 3
(27 observations deleted)

. drop demo_merge

. 
. ** Rename 
. rename population pop_census

.         
. ** Merge with Demographic data 
. merge m:1 year fips using "${data}working/bea_economics",       ///
>         gen(econ_merge) keep(master match) 

    Result                      Number of obs
    -----------------------------------------
    Not matched                           366
        from master                       366  (econ_merge==1)
        from using                          0  (econ_merge==2)

    Matched                            22,482  (econ_merge==3)
    -----------------------------------------

.         
. ** Show match 
. tab state_name econ_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
             Alabama |         0        479 |       479 
              Alaska |         0        198 |       198 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         9         25 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |       357        594 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |       366     22,482 |    22,848 

. tab year econ_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |        52      3,088 |     3,140 
      2017 |        52      3,088 |     3,140 
      2018 |        52      3,088 |     3,140 
      2019 |        52      3,088 |     3,140 
      2020 |        52      3,088 |     3,140 
      2021 |        53      3,088 |     3,141 
      2022 |        53      3,080 |     3,133 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |       366     22,482 |    22,848 

. 
. ** Keep if matched 
. keep if econ_merge == 3
(366 observations deleted)

. drop econ_merge

. 
. ** Merge with COVID-19 Data
. merge m:1 fips using ${data}working/covid_cleaned_wide.dta,     ///
>         gen(covid_merge) keep(master match )
(variable state_name was str20, now str24 to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            73
        from master                        73  (covid_merge==1)
        from using                          0  (covid_merge==2)

    Matched                            22,409  (covid_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name covid_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |         0        479 |       479 
               Alaska |        28        170 |       198 
              Arizona |         0        113 |       113 
             Arkansas |         0        531 |       531 
           California |         0        474 |       474 
             Colorado |         0        452 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |         0        535 |       535 
              Georgia |         0      1,157 |     1,157 
               Hawaii |         0         25 |        25 
                Idaho |         0        310 |       310 
             Illinois |         0        740 |       740 
              Indiana |         0        676 |       676 
                 Iowa |         0        703 |       703 
               Kansas |         0        741 |       741 
             Kentucky |         0        854 |       854 
            Louisiana |         0        462 |       462 
                Maine |         0        116 |       116 
             Maryland |         0        190 |       190 
        Massachusetts |         0        116 |       116 
             Michigan |         0        613 |       613 
            Minnesota |         0        625 |       625 
          Mississippi |         0        580 |       580 
             Missouri |         0        819 |       819 
              Montana |         0        394 |       394 
             Nebraska |         0        657 |       657 
               Nevada |         0        123 |       123 
        New Hampshire |         0         70 |        70 
           New Jersey |         0        181 |       181 
           New Mexico |         0        235 |       235 
             New York |        45        431 |       476 
       North Carolina |         0        736 |       736 
         North Dakota |         0        373 |       373 
                 Ohio |         0        658 |       658 
             Oklahoma |         0        547 |       547 
               Oregon |         0        268 |       268 
         Pennsylvania |         0        509 |       509 
         Rhode Island |         0         41 |        41 
       South Carolina |         0        338 |       338 
         South Dakota |         0        462 |       462 
            Tennessee |         0        687 |       687 
                Texas |         0      1,854 |     1,854 
                 Utah |         0        213 |       213 
              Vermont |         0        100 |       100 
             Virginia |         0        594 |       594 
           Washington |         0        293 |       293 
        West Virginia |         0        387 |       387 
            Wisconsin |         0        530 |       530 
              Wyoming |         0        163 |       163 
----------------------+----------------------+----------
                Total |        73     22,409 |    22,482 

. tab year covid_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         9      3,079 |     3,088 
      2017 |         9      3,079 |     3,088 
      2018 |         9      3,079 |     3,088 
      2019 |         9      3,079 |     3,088 
      2020 |         9      3,079 |     3,088 
      2021 |         9      3,079 |     3,088 
      2022 |         9      3,071 |     3,080 
      2023 |         5        432 |       437 
      2024 |         5        432 |       437 
-----------+----------------------+----------
     Total |        73     22,409 |    22,482 

. 
. ** Merge with Property Tax Rates (time-varying)
. merge m:1 year fips using "${data}working/property_tax_rates_overall", ///
>         gen(proptx_merge) keep(master match) keepusing(prop_rate_mean prop_rate_se)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,591
        from master                    18,591  (proptx_merge==1)
        from using                          0  (proptx_merge==2)

    Matched                             3,891  (proptx_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name proptx_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |       422         57 |       479 
               Alaska |       189          9 |       198 
              Arizona |        71         42 |       113 
             Arkansas |       498         33 |       531 
           California |       168        306 |       474 
             Colorado |       440         12 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |       268        267 |       535 
              Georgia |       971        186 |     1,157 
               Hawaii |         7         18 |        25 
                Idaho |       301          9 |       310 
             Illinois |       593        147 |       740 
              Indiana |       532        144 |       676 
                 Iowa |       664         39 |       703 
               Kansas |       714         27 |       741 
             Kentucky |       803         51 |       854 
            Louisiana |       393         69 |       462 
                Maine |        92         24 |       116 
             Maryland |        85        105 |       190 
        Massachusetts |        77         39 |       116 
             Michigan |       469        144 |       613 
            Minnesota |       553         72 |       625 
          Mississippi |       553         27 |       580 
             Missouri |       756         63 |       819 
              Montana |       391          3 |       394 
             Nebraska |       630         27 |       657 
               Nevada |       105         18 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        28        153 |       181 
           New Mexico |       211         24 |       235 
             New York |       287        189 |       476 
       North Carolina |       562        174 |       736 
         North Dakota |       364          9 |       373 
                 Ohio |       469        189 |       658 
             Oklahoma |       517         30 |       547 
               Oregon |       196         72 |       268 
         Pennsylvania |       329        180 |       509 
         Rhode Island |        14         27 |        41 
       South Carolina |       290         48 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       600         87 |       687 
                Texas |     1,512        342 |     1,854 
                 Utah |       168         45 |       213 
              Vermont |        97          3 |       100 
             Virginia |       504         90 |       594 
           Washington |       209         84 |       293 
        West Virginia |       384          3 |       387 
            Wisconsin |       413        117 |       530 
              Wyoming |       160          3 |       163 
----------------------+----------------------+----------
                Total |    18,591      3,891 |    22,482 

. tab year proptx_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |     2,658        430 |     3,088 
      2017 |     2,658        430 |     3,088 
      2018 |     2,658        430 |     3,088 
      2019 |     2,658        430 |     3,088 
      2020 |     2,658        430 |     3,088 
      2021 |     2,658        430 |     3,088 
      2022 |     2,643        437 |     3,080 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |    18,591      3,891 |    22,482 

. 
. ** Rename for clarity
. rename prop_rate_mean prop_tax_rate

. rename prop_rate_se prop_tax_rate_se

. label var prop_tax_rate "Mean property tax rate (% of home value)"

. label var prop_tax_rate_se "SE of property tax rate"

. 
. ** Organize data 
. order year fips state_* county_* 

. sort fips year  

. isid fips year 

. 
. ** Keep only sample with non-missing base populations
. tab county_name year if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022

                      |  Tax year
                      |   (year
                      |   before
                      |   move)
          County name |      2017 |     Total
----------------------+-----------+----------
        Loving County |         1 |         1 
----------------------+-----------+----------
                Total |         1 |         1 

. drop if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022
(1 observation deleted)

. 
. ** Keep only sample with observations in each year 
. bysort fips: gen ct = _N

. tab county_name state_name if ct < 7 

                      |      State name
          County name | Connect..      Texas |     Total
----------------------+----------------------+----------
     Fairfield County |         6          0 |         6 
      Hartford County |         6          0 |         6 
    Litchfield County |         6          0 |         6 
        Loving County |         0          6 |         6 
     Middlesex County |         6          0 |         6 
     New Haven County |         6          0 |         6 
    New London County |         6          0 |         6 
       Tolland County |         6          0 |         6 
       Windham County |         6          0 |         6 
----------------------+----------------------+----------
                Total |        48          6 |        54 

. drop if ct < 7 
(54 observations deleted)

. drop ct 

. 
. ** Generate IRS sample 
. gen irs_sample_1 = inrange(year, 2016, 2022) 

. gen irs_sample_2 = inrange(year, 2016, 2022) & merge_acs_1 != 1 

. 
. ** Generate ACS Period Indicators 
. gen acs_period_1 = merge_acs_1 != 1 & inrange(year, 2016, 2022)

. gen acs_period_2 = merge_acs_1 != 1 

. 
. ** Make sure we have a balanced panel of ACS counties 
. gen tmp = merge_acs_1 != 1 

. bysort fips: egen ct_tmp = total(tmp)

. replace acs_period_1 = 0 if ct_tmp != 9 
(246 real changes made)

. replace acs_period_2 = 0 if ct_tmp != 9 
(342 real changes made)

. replace irs_sample_2 = 0 if ct_tmp != 9
(246 real changes made)

. drop tmp ct_tmp

. 
. tab year irs_sample_1 

  Tax year |
     (year |
    before |     irs_sample_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |         0      3,079 |     3,079 
      2017 |         0      3,079 |     3,079 
      2018 |         0      3,079 |     3,079 
      2019 |         0      3,079 |     3,079 
      2020 |         0      3,079 |     3,079 
      2021 |         0      3,079 |     3,079 
      2022 |         0      3,079 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |       874     21,553 |    22,427 

. tab year irs_sample_2 

  Tax year |
     (year |
    before |     irs_sample_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_1 

  Tax year |
     (year |
    before |     acs_period_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_2

  Tax year |
     (year |
    before |     acs_period_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |        48        389 |       437 
      2024 |        48        389 |       437 
-----------+----------------------+----------
     Total |    18,926      3,501 |    22,427 

. tab state_name acs_period_1     

                      |     acs_period_1
           State name |         0          1 |     Total
----------------------+----------------------+----------
              Alabama |       458         21 |       479 
               Alaska |       191          7 |       198 
              Arizona |        92         21 |       113 
             Arkansas |       510         21 |       531 
           California |       236        238 |       474 
             Colorado |       445          7 |       452 
             Delaware |         6         21 |        27 
 District of Columbia |         2          7 |         9 
              Florida |       339        196 |       535 
              Georgia |     1,017        140 |     1,157 
               Hawaii |        11         14 |        25 
                Idaho |       303          7 |       310 
             Illinois |       656         84 |       740 
              Indiana |       564        112 |       676 
                 Iowa |       675         28 |       703 
               Kansas |       720         21 |       741 
             Kentucky |       819         35 |       854 
            Louisiana |       413         49 |       462 
                Maine |       102         14 |       116 
             Maryland |       113         77 |       190 
        Massachusetts |       102         14 |       116 
             Michigan |       501        112 |       613 
            Minnesota |       583         42 |       625 
          Mississippi |       559         21 |       580 
             Missouri |       784         35 |       819 
              Montana |       394          0 |       394 
             Nebraska |       636         21 |       657 
               Nevada |       109         14 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        62        119 |       181 
           New Mexico |       221         14 |       235 
             New York |       336        140 |       476 
       North Carolina |       610        126 |       736 
         North Dakota |       366          7 |       373 
                 Ohio |       525        133 |       658 
             Oklahoma |       526         21 |       547 
               Oregon |       219         49 |       268 
         Pennsylvania |       369        140 |       509 
         Rhode Island |        20         21 |        41 
       South Carolina |       331          7 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       638         49 |       687 
                Texas |     1,581        266 |     1,847 
                 Utah |       178         35 |       213 
              Vermont |       100          0 |       100 
             Virginia |       531         63 |       594 
           Washington |       230         63 |       293 
        West Virginia |       387          0 |       387 
            Wisconsin |       439         91 |       530 
              Wyoming |       163          0 |       163 
----------------------+----------------------+----------
                Total |    19,704      2,723 |    22,427 

.         
. ** Define treated state 
. gen multnomah = state_fips == 41 & county_fips == 51

. label var multnomah "Indicator for Multnomah County, Oregon"    

. 
. ** Define treatment indicator 
. gen Treated = multnomah == 1 & year > 2020

. label var Treated "Treatment indicator for Multnomah County, Oregon"    

. 
. ** Define sample 1: All counties 
. gen sample_all = 1 

. label var sample_all "All counties (excluding AK, CA, HI OR, WA)"

. 
. ** Define sample 2: Counties in top 95 percent 
. summ percent_urban if year == 2020, de 

            Percent of population in urban areas
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs               3,079
25%            0              0       Sum of wgt.       3,079

50%     .3256337                      Mean           .3521437
                        Largest       Std. dev.       .332065
75%     .6326353              1
90%      .847923              1       Variance       .1102672
95%     .9372299              1       Skewness       .3661052
99%     .9972304              1       Kurtosis       1.763629

. local cutoff = r(p95) 

. tab state_name multnomah if percent_urban >= `cutoff' & year == 2020

                      |     Indicator for
                      |   Multnomah County,
                      |        Oregon
           State name |         0          1 |     Total
----------------------+----------------------+----------
               Alaska |         1          0 |         1 
              Arizona |         1          0 |         1 
           California |        15          0 |        15 
             Colorado |         4          0 |         4 
             Delaware |         1          0 |         1 
 District of Columbia |         1          0 |         1 
              Florida |        13          0 |        13 
              Georgia |         8          0 |         8 
               Hawaii |         1          0 |         1 
                Idaho |         1          0 |         1 
             Illinois |         5          0 |         5 
              Indiana |         3          0 |         3 
                 Iowa |         1          0 |         1 
               Kansas |         2          0 |         2 
             Kentucky |         2          0 |         2 
            Louisiana |         3          0 |         3 
             Maryland |         3          0 |         3 
        Massachusetts |         5          0 |         5 
             Michigan |         3          0 |         3 
            Minnesota |         3          0 |         3 
             Missouri |         4          0 |         4 
             Nebraska |         2          0 |         2 
               Nevada |         3          0 |         3 
           New Jersey |        10          0 |        10 
           New Mexico |         2          0 |         2 
             New York |         9          0 |         9 
       North Carolina |         4          0 |         4 
                 Ohio |         6          0 |         6 
             Oklahoma |         1          0 |         1 
               Oregon |         1          1 |         2 
         Pennsylvania |         4          0 |         4 
         Rhode Island |         2          0 |         2 
            Tennessee |         2          0 |         2 
                Texas |        11          0 |        11 
                 Utah |         4          0 |         4 
             Virginia |        10          0 |        10 
           Washington |         1          0 |         1 
            Wisconsin |         1          0 |         1 
----------------------+----------------------+----------
                Total |       153          1 |       154 

. gen sample_urban95 = percent_urban >= `cutoff' // All counties 

. label var sample_urban95 "Urban counties (top 5%) (excluding AK, CA, HI OR, WA)"

. tab sample_urban95 if year == 2020

      Urban |
   counties |
   (top 5%) |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,925       95.00       95.00
          1 |        154        5.00      100.00
------------+-----------------------------------
      Total |      3,079      100.00

. 
. ** Define sample 3: Counties in top 98 percent 
. local cutoff = .9864539 //

. tab state_name multnomah if percent_urban >= `cutoff' & year == 2020

                      |     Indicator for
                      |   Multnomah County,
                      |        Oregon
           State name |         0          1 |     Total
----------------------+----------------------+----------
           California |         6          0 |         6 
             Colorado |         2          0 |         2 
 District of Columbia |         1          0 |         1 
              Florida |         4          0 |         4 
              Georgia |         5          0 |         5 
             Illinois |         2          0 |         2 
              Indiana |         1          0 |         1 
            Louisiana |         1          0 |         1 
             Maryland |         1          0 |         1 
        Massachusetts |         1          0 |         1 
             Michigan |         1          0 |         1 
            Minnesota |         1          0 |         1 
             Missouri |         1          0 |         1 
               Nevada |         1          0 |         1 
           New Jersey |         6          0 |         6 
             New York |         7          0 |         7 
       North Carolina |         1          0 |         1 
                 Ohio |         1          0 |         1 
               Oregon |         0          1 |         1 
         Pennsylvania |         2          0 |         2 
         Rhode Island |         1          0 |         1 
                Texas |         3          0 |         3 
                 Utah |         2          0 |         2 
             Virginia |         8          0 |         8 
            Wisconsin |         1          0 |         1 
----------------------+----------------------+----------
                Total |        60          1 |        61 

. gen sample_urban98 = percent_urban >= `cutoff' // All counties 

. label var sample_urban98 "Urban counties (top 1%) (excluding AK, CA, HI OR, WA)"

. tab sample_urban98 if year == 2020

      Urban |
   counties |
   (top 1%) |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,018       98.02       98.02
          1 |         61        1.98      100.00
------------+-----------------------------------
      Total |      3,079      100.00

. 
. ** Define Sample of States      
. drop if state_name == "Alaska"
(198 observations deleted)

. drop if state_name == "Hawaii"
(25 observations deleted)

. drop if state_name == "California"
(474 observations deleted)

. drop if state_name == "Washington"
(293 observations deleted)

. drop if state_name == "Oregon" & multnomah == 0
(259 observations deleted)

. 
. ** Define sample 4: Counties in top 95 + covid 
. cluster kmeans cases_cum* deaths_cum* if        ///
>         sample_urban95 == 1 & year == 2020 & covid_merge == 3 , k(5) gen(kmean)
cluster name: _clus_1

. bysort fips: egen kmean_group = mean(kmean)
(20,046 missing values generated)

. 
. ** Pull out kmeans cluster with Multnoma
. gen tmp1 = kmean if sample_urban95 == 1 & year == 2020 & covid_merge == 3 & multnomah == 1 
(21,177 missing values generated)

. egen tmp2 = mean(tmp1)

. gen sample_urban95_covid = sample_urban95 == 1 & kmean_group == tmp2

. drop tmp1 tmp2 

. label var sample_urban95_covid "Urban counties (top 5%) w. Kmean Covid Match  (excluding AK, CA, HI 
> OR, WA)"

. tab sample_urban95_covid if year == 2020

      Urban |
   counties |
(top 5%) w. |
Kmean Covid |
      Match |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,879       98.73       98.73
          1 |         37        1.27      100.00
------------+-----------------------------------
      Total |      2,916      100.00

. 
. ** Show results across clusters 
. preserve 

. 
. ** Keep required variables 
. keep if sample_urban95 == 1 & year == 2020 & covid_merge == 3
(21,048 observations deleted)

. keep kmean cases_cum* deaths_cum* population

. collapse (mean) cases_cum* deaths_cum* [fw = population], by(kmean)

. reshape long cases_cum deaths_cum, i(kmean) j(time)
(j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations                5   ->   145         
Number of variables                  59   ->   4           
j variable (29 values)                    ->   time
xij variables:
  cases_cum1 cases_cum2 ... cases_cum29   ->   cases_cum
deaths_cum1 deaths_cum2 ... deaths_cum29  ->   deaths_cum
-----------------------------------------------------------------------------

. xtset kmean time 

Panel variable: kmean (strongly balanced)
 Time variable: time, 1 to 29
         Delta: 1 unit

. xtline cases_cum 

. graph export "${results}sdid/fig_kmeans.jpg", as(jpg) name("Graph") quality(100) replace            
>     
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/fig_kmeans.jpg written in JPEG 
> format

. clear  

. 
. ** Restore      
. restore 

. 
. ** Define covariates 
. local covariates "population per_capita_income"

. 
. ** Standardize covariates 
. foreach v of local covariates {
  2.         egen tmp_v = std(`v') 
  3.         replace `v' = tmp_v
  4.         drop tmp_v
  5. } // END COVAR LOOP 
(21,178 real changes made)
(21,178 real changes made)

. 
. ** Define outcome variables (IRS)
. foreach x in "n1" "n2" "agi" {
  2.         
.         if "`x'" == "n1" local xtxt "returns"
  3.         else if "`x'" == "n2" local xtxt "exemptions"
  4.         else if "`x'" == "agi" local xtxt "AGI"
  5.         
.         ** Loop over migration type 
.         foreach y in "net" "in" "out" {
  6.                 
.                         if "`y'" == "net" local ytxt "Net domestic migration"
  7.                         else if "`y'" == "in" local ytxt "Domestic in-migration"
  8.                         else if "`y'" == "out" local ytxt "Domestic out-migration"
  9.                 
.                         ** Generate
.                         gen `x'_`y'_rate_irs = 100 * (`x'_`y'_3 / (`x'_out_1 + `x'_out_2))
 10. 
.                         ** Label var 
.                         label var `x'_`y'_rate_irs      "`ytxt' rate, `xtxt' (%)"
 11.                         
.         } // END MIGRATION TYPE LOOP 
 12.         
. } // END OUTCOME TYPE LOOP 
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)

. 
. ** Define outcome variables (ACS)
. 
. ** Rename for loop 
. rename acs*_households_* acs*_n1_*

. rename acs*_persons_* acs*_n2_*

. rename acs*_dollars_* acs*_agi_*

. 
. ** Loop over sample 
. ** (18+ = 1, college degree == 2, no college degree == 3)
. forvalues i = 1/2{
  2.         
.         if `i' == 1 local itxt ""
  3.         else if `i' == 2 local itxt " (College)"
  4.         else if `i' == 3 local itxt " (No College)"
  5.         
. 
.         ** Define outcome variables (IRS)
.         foreach x in "n1" "n2" "agi" {
  6.                 
.                 if "`x'" == "n1" local xtxt "HHs"
  7.                 else if "`x'" == "n2" local xtxt "persons"
  8.                 else if "`x'" == "agi" local xtxt "total income"
  9.         
.                 
.                 ** Loop over migration type 
.                 foreach y in "net" "in" "out" {
 10.                         
.                                 if "`y'" == "net" local ytxt "Net domestic migration"
 11.                                 else if "`y'" == "in" local ytxt "Domestic in-migration"
 12.                                 else if "`y'" == "out" local ytxt "Domestic out-migration"
 13.                         
.                                 ** Generate
.                                 gen `x'_`y'_rate_acs`i' = 100 * (acs`i'_`x'_`y'_3 / (acs`i'_`x'_out_
> 1 + acs`i'_`x'_out_2))
 14. 
.                                 ** Label var 
.                                 label var `x'_`y'_rate_acs`i' "`ytxt' rate, `xtxt'`itxt' (%)"
 15.                                 
.                 } // END MIGRATION TYPE LOOP 
 16.                 
.         } // END OUTCOME TYPE LOOP 
 17.         
. } // END SAMPLE LOOP 
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)

. 
. ** Declare panel
. xtset fips year 

Panel variable: fips (unbalanced)
 Time variable: year, 2016 to 2024
         Delta: 1 unit

. 
. ** Tag unique fips 
. egen unique = tag(fips)

. tab year unique

  Tax year |
     (year |
    before |       tag(fips)
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |         0      2,916 |     2,916 
      2017 |     2,916          0 |     2,916 
      2018 |     2,916          0 |     2,916 
      2019 |     2,916          0 |     2,916 
      2020 |     2,916          0 |     2,916 
      2021 |     2,916          0 |     2,916 
      2022 |     2,916          0 |     2,916 
      2023 |       383          0 |       383 
      2024 |       383          0 |       383 
-----------+----------------------+----------
     Total |    18,262      2,916 |    21,178 

. 
. ** Label var 
. label var year "Year (destination)"

. 
. ** Before your loops, set up weights dataset
. preserve

. clear

. set obs 0
Number of observations (_N) was 0, now 0.

. gen fips = .

. gen weight = .

. gen sample_data = ""

. gen out = ""

. gen sample = ""

. gen controls = .

. gen exclusion = .

. save "${results}sdid/sdid_weights.dta", replace
(dataset contains 0 observations)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_weights.dta saved

. clear

. restore

. 
. ** Set up treatment effects dataset
. preserve

. clear

. set obs 0
Number of observations (_N) was 0, now 0.

. gen sample_data = ""

. gen sample = ""

. gen outcome = ""

. gen controls = .

. gen exclusion = .

. gen tau = .

. gen se = .

. gen pval = .

. gen ci_lower = .

. gen ci_upper = .

. gen n_counties = .

. gen pre_mean = .

. save "${results}sdid/sdid_results.dta", replace
(dataset contains 0 observations)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_results.dta saved

. clear

. restore 

. 
. ** Loop over IRS and ACS Samples  
. foreach data of varlist irs_sample_1 irs_sample_2 acs_period_1 acs_period_2  {
  2. 
.         ** Different sets of outcome variables 
.         if "`data'" == "irs_sample_1" local out_type "irs"
  3.         else if "`data'" == "irs_sample_2" local out_type "irs"
  4.         else local out_type "acs1 acs2"
  5. 
.         ** Loop over Outcome var type 
.         foreach type of local out_type {
  6.                 
.                 ** Labels 
.                 if "`data'" == "irs_sample_1" local out_txt "irs_full_16_22"
  7.                 if "`data'" == "irs_sample_2" local out_txt "irs_389_16_22"
  8.                 else if "`data'" == "acs_period_1" & "`type'" == "acs1" local out_txt "acs_16_22_
> all"
  9.                 else if "`data'" == "acs_period_1" & "`type'" == "acs2" local out_txt "acs_16_22_
> col"
 10.                 else if "`data'" == "acs_period_1" & "`type'" == "acs3" local out_txt "acs_16_22_
> noc"
 11.                 else if "`data'" == "acs_period_1" & "`type'" == "acs4" local out_txt "acs_16_22_
> 3D"
 12.                 else if "`data'" == "acs_period_2" & "`type'" == "acs1" local out_txt "acs_16_24_
> all"
 13.                 else if "`data'" == "acs_period_2" & "`type'" == "acs2" local out_txt "acs_16_24_
> col"
 14.                 else if "`data'" == "acs_period_2" & "`type'" == "acs3" local out_txt "acs_16_24_
> noc"
 15.                 else if "`data'" == "acs_period_2" & "`type'" == "acs4" local out_txt "acs_16_24_
> 3D"
 16. 
.                 ** Check if subfolder exists, create if not
.                 capture mkdir "${results}sdid/`out_txt'"
 17. 
.                 ** Loop over samples
.                 foreach samp of varlist sample_all sample_urban95 sample_urban95_covid {        
 18.                         
.                         ** Loop over exclusion of 2019-2020 period 
.                         forvalues exl = 1(-1)0 {
 19.                                 
.                                 ** Define sample        
.                                 gen sample = `samp' == 1 & `data' == 1 
 20.                                 if `exl' == 1 replace sample = 0 if year == 2020 
 21.                                 
.                                 ** Clear stored values 
.                                 eststo clear 
 22.                                 
.                                 ** Loop over migration type 
.                                 foreach migr in "net" "in" "out" {
 23.                                         
.                                         ** Loop over outcomes 
.                                         foreach out of varlist  n1_`migr'_rate_`type'   ///
>                                                                                         n2_`migr'_ra
> te_`type'   ///
>                                                                                         agi_`migr'_r
> ate_`type' {
 24.                                         
.                                                 ** Store label 
.                                                 local label : variable label `out'
 25.                                                 
.                                                 ** Loop over inclusion of covariates
.                                                 forvalues c = 0/1 {
 26.                                                 
.                                                         ** Covariates
.                                                         if `c' == 0 local covars ""
 27.                                                         else if `c' == 1 local covars "covariates
> (`covariates', projected)"
 28. 
.                                                         ** Covariates for sdid_event (doesn't suppor
> t 'projected' option)
.                                                         if `c' == 0 local covars_event ""
 29.                                                         else if `c' == 1 local covars_event "cova
> riates(`covariates')"
 30.                                                         
.                                                         ** File Name 
.                                                         if `exl' == 0 local path "${results}sdid/`ou
> t_txt'/fig_`out_txt'_`out'_`c'_`samp'_"
 31.                                                         if `exl' == 1 local path "${results}sdid/
> `out_txt'/fig_`out_txt'_`out'_`c'_`samp'_excl2020_"
 32.                 
.                                                         
.                                                         ** Run SDID
.                                                         eststo sdid_`out'_`c': sdid `out' fips year 
> Treated     ///
>                                                                 if sample == 1,                     
>     ///
>                                                                 vce(placebo)                        
>     ///
>                                                                 `covars'                            
>             ///
>                                                                 reps(`reps')                        
>     ///
>                                                                 graph graph_export("`path'", .pdf)
 33. 
.                                                         ** Store model output 
.                                                         local tmp_tau = e(ATT)
 34.                                                         local tmp_se = e(se)
 35.                                                         matrix omega = e(omega)
 36.                                                         
.                                                         ** Store pre-treatment means and county coun
> ts 
.                                                         qui summ `out' if multnomah == 1 & Treated =
> = 0
 37.                                                         local tmp_premean = r(mean)
 38.                                                         estadd scalar mean = r(mean)
 39.                                                         
.                                                         qui summ `out' if year == 2021 & sample == 1
 40.                                                         local tmp_ncounties = r(N)
 41.                                                         estadd scalar count = r(N)      
 42.                                                         
.                                                         ** Preserve ATE / SE 
.                                                         preserve
 43.                                                         clear
 44.                                                         qui set obs 1
 45.                                                         gen sample_data = "`out_txt'"
 46.                                                         gen sample = "`samp'"
 47.                                                         gen outcome = "`out'"
 48.                                                         gen controls = `c'
 49.                                                         gen exclusion = `exl'
 50.                                                         gen tau = `tmp_tau'
 51.                                                         gen se = `tmp_se'
 52.                                                         gen pval = 2 * (1 - normal(abs(tau/se)))
 53.                                                         gen ci_lower = tau - 1.96 * se
 54.                                                         gen ci_upper = tau + 1.96 * se
 55.                                                         gen n_counties = `tmp_ncounties'
 56.                                                         gen pre_mean = `tmp_premean'
 57.                                                         order sample_data sample outcome controls
>  exclusion     ///
>                                                                 tau se pval ci_lower ci_upper n_coun
> ties pre_mean
 58.                                                         append using "${results}sdid/sdid_results
> .dta"
 59.                                                         compress
 60.                                                         save "${results}sdid/sdid_results.dta", r
> eplace
 61.                                                         clear
 62.                                                         restore
 63.                                                         
.                                                         ** Store weights
.                                                         preserve
 64.                                                         clear
 65.                                                         svmat double omega, names(col)
 66.                                                         rename c2 fips
 67.                                                         rename c1 weight
 68.                                                         gen sample_data = "`out_txt'"
 69.                                                         gen out = "`out'"
 70.                                                         gen sample = "`samp'"
 71.                                                         gen controls = `c'
 72.                                                         gen exclusion = `exl'
 73.                                                         drop if weight == 0
 74.                                                         drop if missing(fips )
 75.                                                         order sample_data sample out controls exc
> lusion fips weight
 76.                                                         sort weight
 77.                                                         append using "${results}sdid/sdid_weights
> .dta"
 78.                                                         compress
 79.                                                         save "${results}sdid/sdid_weights.dta", r
> eplace
 80.                                                         clear 
 81.                                                         restore 
 82.                                                         
.                                                         ** Run event-study
.                                                         sdid_event `out' fips year Treated          
>             ///
>                                                                 if sample == 1,                     
>                     ///
>                                                                 `covars_event'                      
>                     ///
>                                                                 vce(placebo)                        
>                     ///
>                                                                 brep(`reps')                        
>                     ///
>                                                                 placebo(all)
 83. 
.                                                         ** Clean up sdid_event internal variables
.                                                         capture drop ever_treated*
 84.                                                         
.                                                         ** Create Figure
. 
.                                                         ** Store max year
.                                                         qui summ year if multnomah == 1 & sample == 
> 1
 85.                                                         local max_yr = r(max)
 86.                                                         dis "`max_yr'"
 87. 
.                                                         ** Move results from matrix to data
.                                                         qui count if multnomah == 1 & sample == 1
 88.                                                         local ct = r(N)
 89.                                                         local ct = `ct' + 1
 90.                                                         matrix list e(H)
 91.                                                         mat res = e(H)[2..`ct',1..5]
 92. 
.                                                         ** Preserve data before plotting (expand cre
> ates duplicate obs)
.                                                         preserve
 93. 
.                                                         ** Move Matrix results to data
.                                                         svmat res
 94. 
.                                                         ** Generate ID variable
.                                                         gen id = `max_yr' - _n + 1 if !missing(res1)
 95. 
.                                                         ** Update labeling for exclusion of 2020
.                                                         if `exl' == 1 {
 96.                                                                 replace id = id - 1 if id <= 2020
 97.                                                                 expand 2 if id == 2019, gen(tag)
 98.                                                                 replace id = 2020 if tag == 1
 99.                                                                 replace res1 = . if tag == 1
100.                                                                 replace res3 = . if tag == 1
101.                                                                 replace res4 = . if tag == 1
102.                                                         }
103.                                                         label var id "Year (destination)"
104. 
.                                                         ** Sort
.                                                         sort id
105. 
.                                                         ** Plot
.                                                         twoway  (rcap res3 res4 id, lc(gs10) fc(gs11
> %50))       ///
>                                                                         (scatter res1 id, mc(black))
> ,                           ///
>                                                                 legend(off) ytitle("`label'")       
>                             ///
>                                                                 yline(0, lc(red) lp(-))             
>                                     ///
>                                                                 xline(2020.5, lc(black) lp(solid))  
>                             ///
>                                                                 ylabel(-10(2.5)10, format(%9.1f))
106. 
.                                                         if `exl' == 0 local path "${results}sdid/`ou
> t_txt'/fig_`out_txt'_`out'_`c'_`samp'_eventstudy.jpg"
107.                                                         if `exl' == 1 local path "${results}sdid/
> `out_txt'/fig_`out_txt'_`out'_`c'_`samp'_excl2020_eventstudy.jpg"
108. 
.                                                         graph export "`path'",  ///
>                                                                 as(jpg) name("Graph") quality(100) r
> eplace
109. 
.                                                         ** Restore data (removes expanded rows and t
> emp variables)
.                                                         restore 
110.                                                                                         
.                                                 } // END COVAR LOOP 
111.                                         
.                                         } // END OUTCOME LOOP 
112.                                         
.                                         ** Determine name
.                                         if `exl' == 0 local path "${results}sdid/`out_txt'/tab_sdid_
> `out_txt'_`migr'_`samp'.tex"
113.                                         if `exl' == 1 local path "${results}sdid/`out_txt'/tab_sd
> id_`out_txt'_`migr'_`samp'_excl2020.tex"
114.                                         
. 
.                                         ** Table of results 
.                                         if "`data'" == "irs_sample1" |  "`data'" == "irs_sample2" | 
>  {
115.                                         
.                                         esttab  sdid_n1_`migr'_rate_`type'_0 sdid_n1_`migr'_rate_`ty
> pe'_1       ///
>                                                         sdid_n2_`migr'_rate_`type'_0 sdid_n2_`migr'_
> rate_`type'_1       ///
>                                                         sdid_agi_`migr'_rate_`type'_0 sdid_agi_`migr
> '_rate_`type'_1 ///
>                                                 using "`path'",                                     
>                     ///
>                                         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                ///
>                                         b(%-9.3f) se(%-9.3f) replace                                
>     ///
>                                         mgroups("Returns" "Exemptions" "AGI",                   ///
>                                                 pattern(1 0 1 0 1 0) )                              
>             ///
>                                         mtitle( "No Covariates" "Covariates"                    ///
>                                                         "No Covariates" "Covariates"                
>     ///
>                                                         "No Covariates" "Covariates")               
>     ///
>                                         stats(count mean,                                           
>                     ///
>                                                 fmt(%9.0fc %9.3fc)                                  
>                     ///
>                                                 labels("Number of Counties" "Pre-treatment mean"))
116.                                         }
117.                                         else {
118.                                         esttab  sdid_n1_`migr'_rate_`type'_0 sdid_n1_`migr'_rate_
> `type'_1       ///
>                                                         sdid_n2_`migr'_rate_`type'_0 sdid_n2_`migr'_
> rate_`type'_1       ///
>                                                         sdid_agi_`migr'_rate_`type'_0 sdid_agi_`migr
> '_rate_`type'_1 ///
>                                                 using "`path'",                                     
>                     ///
>                                         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                ///
>                                         b(%-9.3f) se(%-9.3f) replace                                
>     ///
>                                         mgroups("Households" "Adults" "Household Income",       ///
>                                                 pattern(1 0 1 0 1 0) )                              
>             ///
>                                         mtitle( "No Covariates" "Covariates"                    ///
>                                                         "No Covariates" "Covariates"                
>     ///
>                                                         "No Covariates" "Covariates")               
>     ///
>                                         stats(count mean,                                           
>                     ///
>                                                 fmt(%9.0fc %9.3fc)                                  
>                     ///
>                                                 labels("Number of Counties" "Pre-treatment mean"))
119.                                                 
.                                         }
120. 
.                                 
.                                 } // END MIGRATION TYPE LOOP 
121.                                 
.                                 ** Drop sample var 
.                                 drop sample 
122.                                 
.                         } // END EXCLUSION LOOP 
123.                         
.                 } // END SAMPLE LOOP 
124.         
.         } // END OUT TYPE 
125.         
. } // END DATA LOOP 
(2,916 real changes made)
Placebo replications (100). This may take some time.
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5
..................................................     50
..................................................     100


Synthetic Difference-in-Differences Estimator

-----------------------------------------------------------------------------
n1_net_rat~s |     ATT     Std. Err.     t      P>|t|    [95% Conf. Interval]
-------------+---------------------------------------------------------------
     Treated |  -1.92529    1.24382    -1.55    0.122    -4.36313     0.51256
-----------------------------------------------------------------------------
95% CIs and p-values are based on large-sample approximations.
Refer to Arkhangelsky et al., (2021) for theoretical derivations.
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_full_16
    > _22_n1_net_rate_irs_0_sample_all_excl2020_trends2021.pdf saved as PDF format

added scalar:
               e(mean) =  .1434552

added scalar:
              e(count) =  2916
  variable controls was float now byte
  variable exclusion was float now byte
  variable n_counties was float now int
  (8 bytes saved)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_results.dta saved
number of observations will be reset to 2916
Press any key to continue, or Break to abort
Number of observations (_N) was 0, now 2,916.
(1,160 observations deleted)
(1 observation deleted)
  variable controls was float now byte
  variable exclusion was float now byte
  variable fips was double now long
  (17,550 bytes saved)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_weights.dta saved
Synthetic Difference-in-differences

Boostrap replications (100), placebo mode.
|0% ----------------------------------------- 100%|
|.................................................|


             |  Estimate         SE      LB CI      UB CI  Switchers 
-------------+------------------------------------------------------
         ATT | -1.925286   .9799859  -3.846059  -.0045139          1 
    Effect_1 | -2.430048   1.609459  -5.584588   .7244928          1 
    Effect_2 | -1.420525   1.092514  -3.561852   .7208026          1 
   Placebo_1 |  .0018158   .3910818  -.7647045   .7683362          1 
   Placebo_2 | -.0017198   .3671603  -.7213541   .7179145          1 
   Placebo_3 | -.0060693   .1190669  -.2394405   .2273018          1 
   Placebo_4 |  .0088023   .1596918  -.3041936   .3217981          1 
2022

e(H)[7,5]
             Estimate          SE       LB CI       UB CI   Switchers
      ATT  -1.9252863   .97998589  -3.8460586  -.00451393           1
 Effect_1  -2.4300477   1.6094594  -5.5845883   .72449278           1
 Effect_2  -1.4205248    1.092514  -3.5618522   .72080263           1
Placebo_1   .00181583   .39108179  -.76470448   .76833615           1
Placebo_2  -.00171981   .36716034  -.72135408   .71791446           1
Placebo_3  -.00606931   .11906692  -.23944047   .22730184           1
Placebo_4   .00880226   .15969177  -.30419361   .32179814           1
(21,172 missing values generated)
(4 real changes made)
(1 observation created)
(1 real change made)
(1 real change made, 1 to missing)
(1 real change made, 1 to missing)
(1 real change made, 1 to missing)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_full_16_
> 22_n1_net_rate_irs_0_sample_all_excl2020_eventstudy.jpg written in JPEG format
Placebo replications (100). This may take some time.
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5
............--Break--
r(1);

end of do-file
--Break--
r(1);

end of do-file

--Break--
r(1);

. do "C:\Users\ji252\Documents\GitHub\multnomah-county-tax\code\01_clean_data.do"

. /*****************************************************************************
> * Program:                      01_clean_data.do 
> * Author(s):            John Iselin 
> * Date Updated:         October 19, 2025
> 
> **** Data that has been / will be automatically download
> 
> ** Demographic data via IPUMS NHGIS 
> ** Via https://www.nhgis.org/
> ** Downloaded on October 19, 2025
> ** EXTRACT DETAILS in "nhgis0031_ts_nominal_county_codebook"
> 
> ** Economic data via BEA Regional Economic Accounts (CAINC1)
> ** Via https://apps.bea.gov/regional/downloadzip.htm
> 
> ** ACS individual data via IPUMS USA 
> ** Via https://usa.ipums.org/usa/index.shtml
> ** Downloaded via R program 
> 
> ** IRS SOI County-Level Migration Files
> ** Via https://www.irs.gov/statistics/soi-tax-stats-migration-data
> 
> ** IRS SOI County-Level Files
> ** Via https://www.irs.gov/statistics/soi-tax-stats-county-data
> 
> ** NYTimes COVID Cases and Deaths 
> ** Via https://github.com/nytimes/covid-19-data
> 
> **** Data that must be manually downloaded
> 
> ** DOL Childcare Cost Data 
> ** Via www.dol.gov/sites/dolgov/files/WB/NDCP2022.xlsx
> 
> ** BLS Unemployment data 
> ** Via https://download.bls.gov/pub/time.series/la/la.data.64.County 
> 
> ** County Centroids (center of population)
> ** Via https://arc-gis-hub-home-arcgishub.hub.arcgis.com/datasets/myUTK::popcenterstate-us-csv/about
> 
> *******************************************************************************/
. 
. ** Start log file 
. capture log close log_01

. log using "${logs}01_log_data_clean_${pr_name}_${date}", replace text name(log_01)
(file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/01_log_data_clean_multnomah_2026-
    > 01-15.log not found)
------------------------------------------------------------------------------------------------------
      name:  log_01
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/01_log_data_clean_multnoma
> h_2026-01-15.log
  log type:  text
 opened on:  15 Jan 2026, 16:16:13

. 
. //--------------------------------------------------
. // STEP 0: Preliminary Set-Up 
. //--------------------------------------------------
. 
. ** Define labels 
. label define lb_move_type       0 "ERROR"                               ///
>                                                         1 "Non-movers"                  ///
>                                                         2 "All movers"                  ///
>                                                         3 "Domestic movers"             ///
>                                                         4 "Within-state movers" ///
>                                                         5 "Inter-state movers"  ///
>                                                         6 "Foreign movers", modify

.                                                         
. label define lb_agi             1 "Under $1"                    ///
>                                                         2 "$1 under $10K"               ///
>                                                         3 "$10K under $25K"             ///
>                                                         4 "$25K under $50K"             ///
>                                                         5 "$50K under $75K"             ///
>                                                         6 "$75K under $100K"    ///
>                                                         7 "$100K under $200K"   ///
>                                                         8 "$200K or more", modify                   
>                                     

. 
. 
. ** Define Programs
. 
. ** Make FIPS code from state and county fips codes 
. capture program drop make_fips

. program define make_fips
  1.     syntax varlist(min=2 max=2 numeric), GEN(name)
  2. 
.     quietly {
  3.         tempvar s c
  4. 
.         local v1 : word 1 of `varlist'
  5.         local v2 : word 2 of `varlist'
  6. 
.         gen `s' = string(`v1', "%02.0f")
  7.         gen `c' = string(`v2', "%03.0f")
  8. 
.         gen `gen' = real(`s' + `c')
  9.     }
 10. end

. 
. ** Reclassify suppressed values as 0 
. 
. capture program drop unsuppress

. program define unsuppress
  1.     syntax varlist
  2. 
.     foreach v of varlist `varlist' {
  3.         replace `v' = 0 if `v' == -1
  4.     }
  5. end

. 
. 
. ** Create a gross-migration file via ACS 
. capture program drop acs_make_gross_migration

. program define acs_make_gross_migration
  1.     version 16.0
  2.     /*
>       Build county-year gross migration totals from ACS microdata with origin/destination counties.
> 
>       Outputs (wide):
>         persons_in_*, persons_out_*, persons_net_*
>         households_in_*, households_out_*, households_net_*
>         dollars_in_*, dollars_out_*, dollars_net_*
> 
>       Move-type indices (mirrors your IRS convention as closely as possible):
>         1 = Non-movers (same county)
>         2 = All movers (different county) = 4 + 5
>         3 = Domestic movers (same as 2 here; foreign already dropped upstream)
>         4 = Within-state movers (different county, same state)
>         5 = Inter-state movers (different state)
>     */
. 
.     syntax using/ [if] [in], SAVING(string) [REPLACE] ///
>         [ IDSFILE(string) ///
>           YEARVAR(name) ORIGFIPS(name) DESTFIPS(name) ///
>           PERSONWT(name) HHWT(name) HHPERWT(name) HEADVAR(name) INCOME(name) SAMPLE(string)]
  3. 
.     // Defaults consistent with your 01_clean_data.do
.     if "`idsfile'"  == "" local idsfile  "${data}working/ids"
  4.     if "`yearvar'"  == "" local yearvar  year
  5.     if "`origfips'" == "" local origfips fips_o
  6.     if "`destfips'" == "" local destfips fips_d
  7.         if "`personwt'" == "" local personwt perwt
  8.     if "`hhperwt'"  == "" local hhperwt  hh_perwt
  9.     if "`hhwt'"     == "" local hhwt     hhwt
 10.     if "`headvar'"  == "" local headvar  hh_head
 11.     if "`income'"   == "" local income   inctot
 12. 
.     // Load microdata (optionally subset via if/in)
.     use "`using'" `if' `in', clear
 13.         
.         if "`sample'" != "" keep if `sample'
 14. 
.     // Basic checks
.     foreach v in `yearvar' `origfips' `destfips' `personwt' `hhwt' `headvar' `income' {
 15.         capture confirm variable `v'
 16.         if _rc {
 17.             di as err "Required variable `v' not found in `using'."
 18.             exit 198
 19.         }
 20.     }
 21. 
.     // Keep only valid year/origin/destination
.     drop if missing(`yearvar') | missing(`origfips') | missing(`destfips')
 22. 
.     // Income: treat missing as 0 (keep negatives as reported)
.     replace `income' = 0 if missing(`income')
 23. 
.     // Build weighted components at the person level
.     gen double persons_wt = `hhperwt' if `headvar' == 1
 24.     gen double dollars_wt = `income' * `personwt'
 25.     gen double households_wt = `hhwt' if `headvar' == 1
 26.     replace households_wt = 0 if missing(households_wt)
 27. 
.     // Collapse to origin-destination-year flow first
.     keep `yearvar' `origfips' `destfips' persons_wt dollars_wt households_wt
 28.     collapse (sum) persons=persons_wt dollars=dollars_wt households=households_wt, ///
>         by(`yearvar' `origfips' `destfips')
 29. 
.     // Derive state/county components for mover-type logic
.     gen int state_o  = floor(`origfips'/1000)
 30.     gen int state_d  = floor(`destfips'/1000)
 31. 
.     gen byte same_county = (`origfips' == `destfips')
 32.     gen byte same_state  = (state_o == state_d)
 33.     gen byte within_state_mover = same_state & !same_county
 34.     gen byte inter_state_mover  = !same_state
 35. 
.     // -----------------------
.     // IN-MIGRATION (by destination county)
.     // -----------------------
.     preserve
 36.         gen long fips = `destfips'
 37.         gen int state_fips  = floor(fips/1000)
 38.         gen int county_fips = mod(fips, 1000)
 39. 
.         // type 1/4/5 components
.         foreach m in persons households dollars {
 40.             gen double `m'_1 = `m' if same_county
 41.             gen double `m'_4 = `m' if within_state_mover
 42.             gen double `m'_5 = `m' if inter_state_mover
 43.         }
 44. 
.         collapse (sum) persons_1 persons_4 persons_5 ///
>                        households_1 households_4 households_5 ///
>                        dollars_1 dollars_4 dollars_5, ///
>                 by(`yearvar' fips state_fips county_fips)
 45. 
.         // build 2 and 3
.         gen double persons_2    = persons_4 + persons_5
 46.         gen double persons_3    = persons_2
 47.         gen double households_2 = households_4 + households_5
 48.         gen double households_3 = households_2
 49.         gen double dollars_2    = dollars_4 + dollars_5
 50.         gen double dollars_3    = dollars_2
 51. 
.         // rename to *_in_*
.         foreach t in 1 2 3 4 5 {
 52.             rename persons_`t'    persons_in_`t'
 53.             rename households_`t' households_in_`t'
 54.             rename dollars_`t'    dollars_in_`t'
 55.         }
 56. 
.         tempfile __in
 57.         save `__in', replace
 58.     restore
 59. 
.     // -----------------------
.     // OUT-MIGRATION (by origin county)
.     // -----------------------
.     preserve
 60.         gen long fips = `origfips'
 61.         gen int state_fips  = floor(fips/1000)
 62.         gen int county_fips = mod(fips, 1000)
 63. 
.         foreach m in persons households dollars {
 64.             gen double `m'_1 = `m' if same_county
 65.             gen double `m'_4 = `m' if within_state_mover
 66.             gen double `m'_5 = `m' if inter_state_mover
 67.         }
 68. 
.         collapse (sum) persons_1 persons_4 persons_5 ///
>                        households_1 households_4 households_5 ///
>                        dollars_1 dollars_4 dollars_5, ///
>                 by(`yearvar' fips state_fips county_fips)
 69. 
.         gen double persons_2    = persons_4 + persons_5
 70.         gen double persons_3    = persons_2
 71.         gen double households_2 = households_4 + households_5
 72.         gen double households_3 = households_2
 73.         gen double dollars_2    = dollars_4 + dollars_5
 74.         gen double dollars_3    = dollars_2
 75. 
.         foreach t in 1 2 3 4 5 {
 76.             rename persons_`t'    persons_out_`t'
 77.             rename households_`t' households_out_`t'
 78.             rename dollars_`t'    dollars_out_`t'
 79.         }
 80. 
.         tempfile __out
 81.         save `__out', replace
 82.     restore
 83. 
.     // -----------------------
.     // Merge in/out; compute net
.     // -----------------------
.     use `__in', clear
 84.     merge 1:1 `yearvar' fips state_fips county_fips using `__out', nogen
 85. 
.     // Replace missings with 0 prior to net calcs (counties can be only in or only out)
.     foreach m in persons households dollars {
 86.         foreach t in 1 2 3 4 5 {
 87.             replace `m'_in_`t'  = 0 if missing(`m'_in_`t')
 88.             replace `m'_out_`t' = 0 if missing(`m'_out_`t')
 89.         }
 90.     }
 91. 
.     // Net = in - out (types 2/3/4/5 are the meaningful migration nets; 1 will be ~0 by construction
> )
.     foreach m in persons households dollars {
 92.         foreach t in 2 3 4 5 {
 93.             gen double `m'_net_`t' = `m'_in_`t' - `m'_out_`t'
 94.         }
 95.     }
 96. 
.     // Merge names
.     merge m:1 state_fips county_fips using "`idsfile'", keep(master match) nogen
 97. 
.     // Labels
.     label var fips "County FIPS (state*1000 + county)"
 98.     label var state_fips "State FIPS"
 99.     label var county_fips "County FIPS"
100. 
.     label var persons_in_2  "Persons, in-migration, all movers"
101.     label var persons_out_2 "Persons, out-migration, all movers"
102.     label var persons_net_2 "Persons, net migration, all movers"
103. 
.     label var households_in_2  "Households, in-migration, all movers (HH heads)"
104.     label var households_out_2 "Households, out-migration, all movers (HH heads)"
105.     label var households_net_2 "Households, net migration, all movers (HH heads)"
106. 
.     label var dollars_in_2  "Dollars, in-migration, all movers (INCTOT*PERWT)"
107.     label var dollars_out_2 "Dollars, out-migration, all movers (INCTOT*PERWT)"
108.     label var dollars_net_2 "Dollars, net migration, all movers (INCTOT*PERWT)"
109. 
.     order `yearvar' fips state_fips county_fips state_name county_name, first
110.     sort `yearvar' state_fips county_fips
111.     compress
112. 
.     // Save
.     save "`saving'", `replace'
113.         clear
114.         
. end

. 
. ********************************************************************************
. ** STEP 1: Download and check non-IPUMS data 
. ********************************************************************************
. 
. ** Ensure expected directory structure exists
. capture mkdir "${data}"

. capture mkdir "${data}working"

. capture mkdir "${data}demographic"

. capture mkdir "${data}demographic/CAINC1"

. capture mkdir "${data}demographic/nhgis0031_csv"

. capture mkdir "${data}demographic/dol"

. capture mkdir "${data}demographic/bls"

. capture mkdir "${data}irs"

. capture mkdir "${data}covid"

. 
. ** This block downloads public-use source data directly from official URLs if 
. ** not present locally.
. /*
> Automated downloads included:
>   - IRS SOI county-to-county migration: countyinflowYYZZ.csv / countyoutflowYYZZ.csv
>   - IRS SOI county data: YYincyallagi.csv
>   - BEA Regional Economic Accounts (CAINC1): CAINC1.zip (unzips to CAINC1__ALL_AREAS_*.csv and relat
> ed files)
> */
. 
. * ----------------------------
. * IRS SOI: migration files
. * ----------------------------
. local irs_base "https://www.irs.gov/pub/irs-soi"

. 
. forvalues yy = 15/21 {
  2.     local zz = `yy' + 1
  3.     local fn_out "countyoutflow`yy'`zz'.csv"
  4.     local fn_in  "countyinflow`yy'`zz'.csv"
  5. 
.     capture confirm file "${data}irs/`fn_out'"
  6.     if _rc {
  7.         di as txt "Downloading (IRS SOI) `fn_out' ..."
  8.         copy "`irs_base'/`fn_out'" "${data}irs/`fn_out'", replace
  9.     }
 10. 
.     capture confirm file "${data}irs/`fn_in'"
 11.     if _rc {
 12.         di as txt "Downloading (IRS SOI) `fn_in' ..."
 13.         copy "`irs_base'/`fn_in'" "${data}irs/`fn_in'", replace
 14.     }
 15. }

. 
. * ----------------------------
. * IRS SOI: county income (AGI) files
. * ----------------------------
. forvalues yy = 15/22 {
  2.     local fn_inc "`yy'incyallagi.csv"
  3. 
.     capture confirm file "${data}irs/`fn_inc'"
  4.     if _rc {
  5.         di as txt "Downloading (IRS SOI) `fn_inc' ..."
  6.         copy "`irs_base'/`fn_inc'" "${data}irs/`fn_inc'", replace
  7.     }
  8. }

. 
. * ----------------------------
. * BEA Regional: CAINC1.zip
. * ----------------------------
. local bea_dir "${data}demographic/CAINC1"

. local bea_url "https://apps.bea.gov/regional/zip/CAINC1.zip"

. local bea_zip "`bea_dir'/CAINC1.zip"

. 
. * If we don't already have a CAINC1 "_ALL_AREAS" file, download + unzip the ZIP.
. local bea_files : dir "`bea_dir'" files "CAINC1__ALL_AREAS_*.csv"

. if "`bea_files'"=="" {
.     local bea_files : dir "`bea_dir'" files "CAINC1__ALL_STATES_*.csv"
. }

. 
. if "`bea_files'"=="" {
.     di as txt "Downloading (BEA) CAINC1.zip ..."
Downloading (BEA) CAINC1.zip ...
.     copy "`bea_url'" "`bea_zip'", replace
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/demographic/CAINC1/CAINC1.zip not
    found)
. 
.     local curdir "`c(pwd)'"
.     cd "`bea_dir'"
C:\Users\ji252\Documents\GitHub\multnomah-county-tax\data\demographic\CAINC1
.     unzipfile "CAINC1.zip", replace
    inflating: CAINC1__ALL_AREAS_1969_2023.csv
    inflating: CAINC1__definition.xml
    inflating: CAINC1__Footnotes.html
    inflating: CAINC1_AK_1969_2023.csv
    inflating: CAINC1_AL_1969_2023.csv
    inflating: CAINC1_AR_1969_2023.csv
    inflating: CAINC1_AZ_1969_2023.csv
    inflating: CAINC1_CA_1969_2023.csv
    inflating: CAINC1_CO_1969_2023.csv
    inflating: CAINC1_CSA_1969_2023.csv
    inflating: CAINC1_CT_1969_2023.csv
    inflating: CAINC1_DC_1969_2023.csv
    inflating: CAINC1_DE_1969_2023.csv
    inflating: CAINC1_FL_1969_2023.csv
    inflating: CAINC1_GA_1969_2023.csv
    inflating: CAINC1_HI_1969_2023.csv
    inflating: CAINC1_IA_1969_2023.csv
    inflating: CAINC1_ID_1969_2023.csv
    inflating: CAINC1_IL_1969_2023.csv
    inflating: CAINC1_IN_1969_2023.csv
    inflating: CAINC1_KS_1969_2023.csv
    inflating: CAINC1_KY_1969_2023.csv
    inflating: CAINC1_LA_1969_2023.csv
    inflating: CAINC1_MA_1969_2023.csv
    inflating: CAINC1_MD_1969_2023.csv
    inflating: CAINC1_MDIV_1969_2023.csv
    inflating: CAINC1_ME_1969_2023.csv
    inflating: CAINC1_MI_1969_2023.csv
    inflating: CAINC1_MIC_1969_2023.csv
    inflating: CAINC1_MN_1969_2023.csv
    inflating: CAINC1_MO_1969_2023.csv
    inflating: CAINC1_MS_1969_2023.csv
    inflating: CAINC1_MSA_1969_2023.csv
    inflating: CAINC1_MT_1969_2023.csv
    inflating: CAINC1_NC_1969_2023.csv
    inflating: CAINC1_ND_1969_2023.csv
    inflating: CAINC1_NE_1969_2023.csv
    inflating: CAINC1_NH_1969_2023.csv
    inflating: CAINC1_NJ_1969_2023.csv
    inflating: CAINC1_NM_1969_2023.csv
    inflating: CAINC1_NV_1969_2023.csv
    inflating: CAINC1_NY_1969_2023.csv
    inflating: CAINC1_OH_1969_2023.csv
    inflating: CAINC1_OK_1969_2023.csv
    inflating: CAINC1_OR_1969_2023.csv
    inflating: CAINC1_PA_1969_2023.csv
    inflating: CAINC1_PORT_1969_2023.csv
    inflating: CAINC1_RI_1969_2023.csv
    inflating: CAINC1_SC_1969_2023.csv
    inflating: CAINC1_SD_1969_2023.csv
    inflating: CAINC1_TN_1969_2023.csv
    inflating: CAINC1_TX_1969_2023.csv
    inflating: CAINC1_US_1969_2023.csv
    inflating: CAINC1_UT_1969_2023.csv
    inflating: CAINC1_VA_1969_2023.csv
    inflating: CAINC1_VT_1969_2023.csv
    inflating: CAINC1_WA_1969_2023.csv
    inflating: CAINC1_WI_1969_2023.csv
    inflating: CAINC1_WV_1969_2023.csv
    inflating: CAINC1_WY_1969_2023.csv

successfully unzipped CAINC1.zip to current directory
total processed:  60
        skipped:  0
      extracted:  60
.     cd "`curdir'"
C:\Users\ji252\Documents\GitHub\multnomah-county-tax
. 
.     capture erase "`bea_zip'"
. }

. 
. * ----------------------------
. * NYTimes COVID Data 
. * ----------------------------
. local covid_dir "${data}covid"

. local covid_url "https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv"

. 
. * If we don't already have a COVID file, download.
. local covid_file : dir "`covid_dir'" files "covid_nyt.csv"

. if "`covid_file'"=="" {
.     local covid_file : dir "`covid_dir'" files "covid_nyt.csv"
. }

. 
. if "`covid_file'"=="" {
.     di as txt "Downloading (COVID)  ..."
Downloading (COVID)  ...
.     copy "`covid_url'" "`covid_dir'/covid_nyt.csv", replace
. }

. 
. ** This block checks that non-automatically downloaded data are present: 
. /*
> Non-automtated downloads included:
>   - DOL childcare data (through 2022)
>   - BLS unemployment data 
> */
. 
. ** Define paths 
. local dol_dir "${data}demographic/dol/NDCP2022.xlsx"

. local bls_dir "${data}demographic/bls/la.data.64.County" 

. 
. capture confirm file `dol_dir' // Check if the file exists

. 
. if _rc != 0 {
.     display "Error: The file `dol_dir' was not found."
.     display "Execution of the do-file is stopping."
.     exit // Stops the do-file/program
. }

. 
. capture confirm file `bls_dir' // Check if the file exists

. 
. if _rc != 0 {
.     display "Error: The file `bls_dir' was not found."
.     display "Execution of the do-file is stopping."
.     exit // Stops the do-file/program
. }

. 
. 
. 
. ********************************************************************************
. ** STEP 2: Clean demographic + economic data via IPUMS, BLS, and BEA 
. ********************************************************************************
. 
. ** Import data 
. import delimited        ///
>         "${data}demographic/nhgis0031_csv/nhgis0031_ts_nominal_county.csv", clear 
(encoding automatically selected: ISO-8859-1)
(15 vars, 54,673 obs)

. 
. ** Describe data 
. des 

Contains data
 Observations:        54,673                  
    Variables:            15                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
gisjoin         str8    %9s                   GISJOIN
year            str9    %9s                   YEAR
state           str20   %20s                  STATE
statefp         byte    %8.0g                 STATEFP
statenh         int     %8.0g                 STATENH
county          str46   %46s                  COUNTY
countyfp        int     %8.0g                 COUNTYFP
countynh        int     %8.0g                 COUNTYNH
name            str59   %59s                  NAME
av0aa           long    %12.0g                AV0AA
d15aa           long    %12.0g                D15AA
d15ab           long    %12.0g                D15AB
b79aa           long    %12.0g                B79AA
av0aam          long    %12.0g                AV0AAM
b79aam          long    %12.0g                B79AAM
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.

. 
. ** Drop unnecc variables 
. drop gisjoin statenh countynh name 

. 
. ** Rename 
. rename state state_name 

. rename statefp state_fips 

. rename county county_name 

. rename countyfp county_fips 

. rename av0aa population 

. rename d15aa pop_urban 

. rename d15ab pop_rural 

. rename b79aa median_income 

. rename av0aam population_margin

. rename b79aam median_income_margin 

. 
. ** Create urban percent 
. gen percent_urban = pop_urban / population
(45,090 missing values generated)

. 
. ** Label variables 
. label var state_name "State name"

. label var state_fips "State FIPS code"

. label var county_name "County name"

. label var county_fips "County FIPS code"

. label var population "Population count"

. label var pop_rural "Rural population count"

. label var pop_urban "Urban population count"

. label var percent_urban "Percent of population in urban areas"

. label var median_income "Median household income (prior year)"

. label var population_margin "ACS margin for error: population"

. label var median_income_margin "ACS margin for error: median income"

. 
. ** Save as temporary file 
. tempfile demo

. save `demo'
file C:\Users\ji252\AppData\Local\Temp\ST_4058_000001.tmp saved as .dta format

. 
. ** Create three datasets 
. 
. ** (1) Basic state and county IDs 
. keep if year == "2020" 
(51,452 observations deleted)

. keep state* county* 

. 
. ** Make FIPS 
. make_fips state_fips county_fips, gen(fips)

. 
. ** Save as state and county Ids 
. save "${data}working/ids", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/ids.dta saved

. 
. ** Save state IDS 
. keep state_fips state_name 

. duplicates drop 

Duplicates in terms of all variables

(3,169 observations deleted)

. 
. ** Save as state and county Ids 
. save "${data}working/state_ids", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/state_ids.dta saved

. 
. clear  

. 
. ** (2) Population data 
. use `demo'

. keep if !missing(pop_urban) 
(45,090 observations deleted)

. tab year 

       YEAR |      Freq.     Percent        Cum.
------------+-----------------------------------
       2000 |      3,141       32.78       32.78
       2010 |      3,221       33.61       66.39
       2020 |      3,221       33.61      100.00
------------+-----------------------------------
      Total |      9,583      100.00

. 
. ** Keep 2020 
. keep if year == "2020"
(6,362 observations deleted)

. drop year median_income* population_margin

. 
. ** Make FIPS 
. make_fips state_fips county_fips, gen(fips)

. 
. ** Save data
. save "${data}working/population_2020", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/population_2020.dta saved

. clear  

. 
. ** (3) 2015-2019 ACS data 
. use `demo'

. keep if !missing(median_income) 
(6,447 observations deleted)

. tab year 

       YEAR |      Freq.     Percent        Cum.
------------+-----------------------------------
       2000 |      3,141        6.51        6.51
  2006-2010 |      3,221        6.68       13.19
  2007-2011 |      3,221        6.68       19.87
  2008-2012 |      3,221        6.68       26.55
  2009-2013 |      3,221        6.68       33.23
  2010-2014 |      3,220        6.68       39.91
  2011-2015 |      3,219        6.67       46.58
  2012-2016 |      3,220        6.68       53.26
  2013-2017 |      3,220        6.68       59.93
  2014-2018 |      3,219        6.67       66.61
  2015-2019 |      3,220        6.68       73.29
  2016-2020 |      3,220        6.68       79.96
  2017-2021 |      3,220        6.68       86.64
  2018-2022 |      3,221        6.68       93.32
  2019-2023 |      3,222        6.68      100.00
------------+-----------------------------------
      Total |     48,226      100.00

. 
. ** Keep 2020 
. keep if year == "2015-2019"
(45,006 observations deleted)

. drop year pop_rural pop_urban percent_urban

. 
. ** Make FIPS 
. make_fips state_fips county_fips, gen(fips)

. 
. ** Save data
. save "${data}working/acs_2015_2019_data", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/acs_2015_2019_data.dta saved

. 
. ** Rename for merge 
. rename population population_acs

. 
. ** Merge with other data 
. merge 1:1 state_fips county_fips using "${data}working/population_2020",                ///
>         keep(match) nogen 

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             3,219  
    -----------------------------------------

. 
. ** Save data
. save "${data}working/demographics_2020", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/demographics_2020.dta saved

. 
. ** Load BEA Data 
. import delimited "${data}demographic/CAINC1/CAINC1__ALL_AREAS_1969_2023.csv",   ///
>         clear 
(encoding automatically selected: ISO-8859-1)
(63 vars, 9,604 obs)

. 
. ** Drop unnecc variables 
. drop region tablename industryclassification unit geoname 

. 
. ** Drop empty cells 
. drop if missing(linecode)
(4 observations deleted)

. 
. ** Update names 
. rename geofips fips 

. replace fips = subinstr(fips, `"""', "", .)
(9,600 real changes made)

. destring fips, replace 
fips: all characters numeric; replaced as long

. 
. ** Keep population and per-capita income, dropping personal income (total)
. tab description linecode

                      |             LineCode
          Description |         1          2          3 |     Total
----------------------+---------------------------------+----------
Per capita personal.. |         0          0      3,200 |     3,200 
Personal income (th.. |     3,200          0          0 |     3,200 
Population (persons.. |         0      3,200          0 |     3,200 
----------------------+---------------------------------+----------
                Total |     3,200      3,200      3,200 |     9,600 

. drop if linecode == 1   
(3,200 observations deleted)

. drop description

.         
. ** Get V* to be in terms of years 
. ** V9 == 1969 
. forvalues i = 9/63 {
  2.         
.         local j = 1960 + `i'
  3.         rename v`i' value`j'
  4.         
. } // END I LOOP 

. 
. ** Reshape 
. reshape long value, i(fips linecode) j(year)
(j = 1969 1970 1971 1972 1973 1974 1975 1976 1977 1978 1979 1980 1981 1982 1983 1984 1985 1986 1987 19
> 88 1989 1990 1991 1992 1993 1994 1995 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 20
> 08 2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021 2022 2023)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations            6,400   ->   352,000     
Number of variables                  57   ->   4           
j variable (55 values)                    ->   year
xij variables:
      value1969 value1970 ... value2023   ->   value
-----------------------------------------------------------------------------

. reshape wide value, i(fips year ) j(linecode)
(j = 2 3)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations          352,000   ->   176,000     
Number of variables                   4   ->   4           
j variable (2 values)          linecode   ->   (dropped)
xij variables:
                                  value   ->   value2 value3
-----------------------------------------------------------------------------

. 
. ** Keep years 
. keep if inrange(year, 2015, ${end_year_acs})
(147,200 observations deleted)

. 
. ** Rename values 
. rename value2 population 

. rename value3 per_capita_income

. 
. ** Drop if missing values 
. drop if population == "(NA)"
(239 observations deleted)

. 
. ** Keep only counties with all observations 
. bysort fips: gen ct = _N 

. tab ct

         ct |      Freq.     Percent        Cum.
------------+-----------------------------------
          4 |          8        0.03        0.03
          5 |          5        0.02        0.05
          9 |     28,548       99.95      100.00
------------+-----------------------------------
      Total |     28,561      100.00

. keep if ct == 9
(13 observations deleted)

. drop ct

. 
. ** Destring 
. destring population, replace 
population: all characters numeric; replaced as long

. destring per_capita_income, replace 
per_capita_income: all characters numeric; replaced as long

. 
. ** Extrapolate through 2024 
. expand 2 if year == 2023, gen(tag)
(3,172 observations created)

. replace year = 2024 if tag == 1 
(3,172 real changes made)

. replace population = . if tag == 1 
(3,172 real changes made, 3,172 to missing)

. replace per_capita_income = . if tag == 1 
(3,172 real changes made, 3,172 to missing)

. 
. ** Get list of all counties 
. qui levelsof fips, local(fips)

. 
. ** Loop over variables
. foreach v of varlist population per_capita_income {
  2.         
.         ** Loop over all FIPS 
.     foreach c of local fips {
  3.                 
.                 quietly{
  4.                         
.                         regress `v' year if fips == `c' & tag != 1 
  5.                         predict `v'_hat
  6.                         replace `v' = `v'_hat if fips == `c' & year == 2024
  7.                         drop `v'_hat
  8.                         
.                 } // END QUIET
  9.     } // END FIPS LOOP 
 10. } // END VAR LOOP 

. 
. ** Drop tag 
. drop tag

. 
. ** Save data
. save "${data}working/bea_economics", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/bea_economics.dta saved

. 
. ** Load BLS Unemployment data 
. import delimited "${data}demographic\bls\la.data.64.County", clear 
(encoding automatically selected: ISO-8859-1)
(5 vars, 5,974,328 obs)

. 
. ** Keep annual average 
. keep if period == "M13"
(5,523,684 observations deleted)

. drop period 

. 
. ** Keep only Unemployment Rate 
. gen measure = substr(series_id, 20,1)

. keep if measure == "3"
(337,983 observations deleted)

. drop measure 

. 
. ** Keep years 
. keep if inrange(year, 2015, ${end_year_acs})
(80,456 observations deleted)

. tab year 

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       2015 |      3,220       10.00       10.00
       2016 |      3,220       10.00       20.00
       2017 |      3,220       10.00       30.00
       2018 |      3,220       10.00       39.99
       2019 |      3,220       10.00       49.99
       2020 |      3,221       10.00       59.99
       2021 |      3,221       10.00       70.00
       2022 |      3,221       10.00       80.00
       2023 |      3,221       10.00       90.00
       2024 |      3,221       10.00      100.00
------------+-----------------------------------
      Total |     32,205      100.00

. 
. ** Define counties 
. gen fips = substr(series_id, 6,5)

. destring fips, replace 
fips: all characters numeric; replaced as long

. drop series_id 

. isid fips year 

. 
. ** Drop PR 
. drop if fips > 60000
(780 observations deleted)

. drop footnote_codes 

. 
. ** Update names 
. rename value unemp 

. order year fips unemp 

. 
. destring unemp, replace 
unemp: all characters numeric; replaced as double

. 
. ** Save data
. save "${data}working/bls_unemployment", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/bls_unemployment.dta saved

. 
. ** Load County Centroids 
. import delimited "${data}demographic\PopCenterCounty_US.csv", clear 
(encoding automatically selected: UTF-8)
(18 vars, 9,673 obs)

. 
. ** Keep required years (2010)
. keep if year == 2010 
(6,452 observations deleted)

. 
. ** Keep required variables 
. keep geographicindentifier latitude longitude 

. 
. ** Rename 
. rename geographicindentifier fips 

. rename latitude lat 

. rename longitude lon 

. 
. ** Drop PR 
. drop if fips > 60000
(78 observations deleted)

. 
. ** Save data
. save "${data}working/pop_centers", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/pop_centers.dta saved

. 
. 
. 
. 
. ********************************************************************************
. ** STEP 3: Import and Clean NYTimes COVID-19 Data 
. ********************************************************************************
. 
. ** Import data 
. import delimited using "${data}covid/covid_nyt.csv", varnames(1) clear case(lower) 
(encoding automatically selected: ISO-8859-1)
(6 vars, 2,502,832 obs)

. 
. ** Describe data 
. des 

Contains data
 Observations:     2,502,832                  
    Variables:             6                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
date            str10   %10s                  
county          str35   %35s                  
state           str24   %24s                  
fips            long    %12.0g                
cases           long    %12.0g                
deaths          long    %8.0g                 
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.

. 
. ** Set up date information 
. generate num_date = date(date, "YMD")

. format num_date %td

. drop date 

. 
. ** Rename 
. rename state state_name 

. rename county county_name 

. rename num_date date 

. 
. ** keep only counties 
. keep if !missing(fips)
(23,678 observations deleted)

. 
. ** Keep in 50 states 
. drop if state_name == "Puerto Rico"
(57,605 observations deleted)

. drop if state_name == "Virgin Islands"
(2,304 observations deleted)

. drop if state_name == "Northern Mariana Islands"
(1,452 observations deleted)

. 
. ** Sort 
. sort date fips 

. 
. ** Create panel 
. xtset fips date

Panel variable: fips (unbalanced)
 Time variable: date, 21jan2020 to 13may2022, but with gaps
         Delta: 1 day

. 
. ** Fill in panel 
. tsfill, full 

. 
. ** Fill in missing values 
. replace cases = 0 if missing(cases)
(228,991 real changes made)

. replace deaths = 0 if missing(deaths)
(228,991 real changes made)

. 
. ** Preserve data 
. preserve 

. 
. ** Preserve fips codes and names 
. keep if !missing(state_name)
(228,991 observations deleted)

. keep if !missing(county_name)
(0 observations deleted)

. duplicates drop fips state_name county_name, force 

Duplicates in terms of fips state_name county_name

(2,414,657 observations deleted)

. 
. ** Save as temporary data 
. tempfile state_county_names 

. save `state_county_names'
file C:\Users\ji252\AppData\Local\Temp\ST_4058_000003.tmp saved as .dta format

. clear 

. 
. ** Restore 
. restore 

. 
. ** Drop and merge in names 
. drop state_name county_name

. merge m:1 fips using `state_county_names', keep(master match) nogen 

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                         2,646,784  
    -----------------------------------------

. 
. ** Get year, month, day 
. gen year = year(date)

. gen month = month(date)

. gen day = day(date)

. 
. ** Order data 
. order date year month day fips state county cases deaths 

. 
. ** Calculate cumulative cases and deaths 
. bysort fips (date): gen cases_cum = sum(cases)

. bysort fips (date): gen deaths_cum = sum(deaths)

. 
. ** Merge population data (2020)
. merge m:1 fips using "${data}working/population_2020", keep(match) nogen  
(variable county_name was str35, now str46 to accommodate using data's values)
(variable fips was long, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                         2,643,408  
    -----------------------------------------

. 
. ** Save file 
. save ${data}working/covid_cleaned.dta, replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/covid_cleaned.dta saved

. 
. ** Keep one observation per month 
. keep year month fips state_name county_name cases deaths population

. collapse (sum) cases deaths (mean) population, by(year month fips state_name county_name) 

. sort year month fips 

. egen date = group(year month)

. drop year month 

. 
. ** Calculate cumulative cases and deaths 
. bysort fips (date): gen cases_cum = sum(cases)

. bysort fips (date): gen deaths_cum = sum(deaths)

. 
. ** Generate per capita figures
. replace cases_cum = 1000 * cases_cum / population
(82,955 real changes made)

. replace cases_cum = 1000 * cases_cum / population
(82,955 real changes made)

. drop population cases deaths

. 
. ** Reshape wide 
. reshape wide cases_cum deaths_cum, i(fips state_name county_name) j(date)
(j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations           90,828   ->   3,132       
Number of variables                   6   ->   61          
j variable (29 values)             date   ->   (dropped)
xij variables:
                              cases_cum   ->   cases_cum1 cases_cum2 ... cases_cum29
                             deaths_cum   ->   deaths_cum1 deaths_cum2 ... deaths_cum29
-----------------------------------------------------------------------------

. 
. ** Save file 
. save ${data}working/covid_cleaned_wide.dta, replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/covid_cleaned_wide.dta saved

. clear

. 
. 
. ********************************************************************************
. ** STEP 4: Import and Clean IPUMS ACS Data via IPUMS 
. ********************************************************************************
. 
. ** Load data 
. forvalues y = 2015(1)$end_year_acs {
  2.         
.         ** Import CSV
.         import delimited using "${data}acs/acs_`y'", varnames(1) clear case(lower)
  3.         
.         ** Save as temporary data 
.         tempfile acs_`y'
  4.         save `acs_`y''
  5.         clear 
  6.         
. } // END YEAR LOOP 
(encoding automatically selected: ISO-8859-1)
(68 vars, 2,997,503 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_000004.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(68 vars, 3,007,847 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_000005.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(68 vars, 3,038,696 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_000006.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(68 vars, 3,060,442 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_000007.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(68 vars, 3,087,291 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_000008.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(68 vars, 2,454,160 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_000009.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(68 vars, 3,092,079 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000a.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(68 vars, 3,190,848 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000b.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(68 vars, 3,228,659 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000c.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(67 vars, 3,238,311 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000d.tmp saved as .dta format

. 
. ** Append data 
. forvalues y = 2015(1)$end_year_acs {
  2.         
.         append using `acs_`y''  
  3.         
. } // END YEAR LOOP 
(variable cbserial was long, now double to accommodate using data's values)
(variable proptx99 was byte, now int to accommodate using data's values)

. 
. ** Des 
. tab year 

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       2015 |  2,997,503        9.86        9.86
       2016 |  3,007,847        9.90       19.76
       2017 |  3,038,696       10.00       29.75
       2018 |  3,060,442       10.07       39.82
       2019 |  3,087,291       10.16       49.98
       2020 |  2,454,160        8.07       58.05
       2021 |  3,092,079       10.17       68.23
       2022 |  3,190,848       10.50       78.72
       2023 |  3,228,659       10.62       89.35
       2024 |  3,238,311       10.65      100.00
------------+-----------------------------------
      Total | 30,395,836      100.00

. 
. ** Define # of adults and kids in HHs 
. gen adult = age >= 18 

. gen child = age < 18 

. bysort year serial: gen hh_size = _N 

. bysort year serial: egen hh_adult_ct = total(adult)

. bysort year serial: egen hh_child_ct = total(child)

. 
. ** Define HH-wide indicators for creation of gross migration files 
. gen college = educd >= 0 

. gen hh_any_child = hh_child_ct > 0

. bysort year serial: egen hh_any_college = max(college)

. 
. ** Define weighted # of people 
. bysort year serial: egen hh_perwt = total(perwt)

. 
. ** Sample 18+
. drop if child == 1 
(6,257,228 observations deleted)

. drop child adult 

. 
. ** Sample not living abroad last year 
. drop if migplac1 > 56 
(123,571 observations deleted)

. drop if migrate1 == 4 
(0 observations deleted)

. 
. ** Rename variables 
. rename statefip state_fips_d

. rename countyfip county_fips_d 

. 
. ** Set up origin data 
. fre migrate1

migrate1
-----------------------------------------------------------
              |      Freq.    Percent      Valid       Cum.
--------------+--------------------------------------------
Valid   1     |   2.15e+07      89.70      89.70      89.70
        2     |    1990266       8.29       8.29      97.99
        3     |     483752       2.01       2.01     100.00
        Total |   2.40e+07     100.00     100.00           
-----------------------------------------------------------

. drop migrate1d

. tab migplac1

   migplac1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 21,541,019       89.70       89.70
          1 |     34,638        0.14       89.84
          2 |      6,437        0.03       89.87
          4 |     60,713        0.25       90.12
          5 |     23,837        0.10       90.22
          6 |    286,432        1.19       91.41
          8 |     58,203        0.24       91.66
          9 |     23,742        0.10       91.76
         10 |      5,887        0.02       91.78
         11 |      9,506        0.04       91.82
         12 |    169,310        0.71       92.52
         13 |     78,921        0.33       92.85
         15 |     10,884        0.05       92.90
         16 |     15,101        0.06       92.96
         17 |     94,301        0.39       93.35
         18 |     52,715        0.22       93.57
         19 |     23,702        0.10       93.67
         20 |     24,542        0.10       93.77
         21 |     35,053        0.15       93.92
         22 |     31,495        0.13       94.05
         23 |      8,677        0.04       94.09
         24 |     43,943        0.18       94.27
         25 |     53,708        0.22       94.49
         26 |     71,355        0.30       94.79
         27 |     38,594        0.16       94.95
         28 |     18,617        0.08       95.03
         29 |     49,703        0.21       95.24
         30 |      8,315        0.03       95.27
         31 |     14,930        0.06       95.33
         32 |     27,276        0.11       95.45
         33 |      9,634        0.04       95.49
         34 |     55,622        0.23       95.72
         35 |     13,589        0.06       95.77
         36 |    130,573        0.54       96.32
         37 |     78,068        0.33       96.64
         38 |      6,435        0.03       96.67
         39 |     89,408        0.37       97.04
         40 |     31,763        0.13       97.18
         41 |     39,836        0.17       97.34
         42 |     83,639        0.35       97.69
         44 |      7,189        0.03       97.72
         45 |     37,090        0.15       97.87
         46 |      6,736        0.03       97.90
         47 |     53,208        0.22       98.12
         48 |    219,556        0.91       99.04
         49 |     28,598        0.12       99.16
         50 |      4,493        0.02       99.18
         51 |     70,723        0.29       99.47
         53 |     71,202        0.30       99.77
         54 |     11,625        0.05       99.81
         55 |     39,001        0.16       99.98
         56 |      5,493        0.02      100.00
------------+-----------------------------------
      Total | 24,015,037      100.00

. rename migplac1 state_fips_o

. tab migcounty1

 migcounty1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 22,397,212       93.26       93.26
          1 |     38,852        0.16       93.43
          3 |     63,981        0.27       93.69
          5 |     23,554        0.10       93.79
          7 |     14,942        0.06       93.85
          9 |     13,176        0.05       93.91
         11 |     25,896        0.11       94.01
         13 |     59,788        0.25       94.26
         15 |      8,049        0.03       94.30
         17 |     24,998        0.10       94.40
         19 |     25,974        0.11       94.51
         20 |      2,285        0.01       94.52
         21 |     14,712        0.06       94.58
         23 |      8,687        0.04       94.62
         25 |     23,269        0.10       94.71
         27 |     16,916        0.07       94.78
         29 |     35,798        0.15       94.93
         31 |     63,004        0.26       95.19
         33 |     37,066        0.15       95.35
         35 |     27,440        0.11       95.46
         37 |     79,114        0.33       95.79
         39 |     11,614        0.05       95.84
         41 |      9,685        0.04       95.88
         43 |      9,722        0.04       95.92
         45 |      6,865        0.03       95.95
         47 |     25,074        0.10       96.06
         49 |     23,558        0.10       96.15
         51 |     19,026        0.08       96.23
         53 |     19,452        0.08       96.31
         55 |     13,919        0.06       96.37
         57 |     20,272        0.08       96.46
         59 |     33,983        0.14       96.60
         61 |     34,892        0.15       96.74
         63 |     13,833        0.06       96.80
         65 |     20,464        0.09       96.89
         67 |     32,851        0.14       97.02
         69 |      4,704        0.02       97.04
         71 |     30,322        0.13       97.17
         73 |     40,463        0.17       97.34
         75 |     13,169        0.05       97.39
         77 |      9,062        0.04       97.43
         79 |      8,380        0.03       97.46
         81 |     33,279        0.14       97.60
         83 |     10,073        0.04       97.64
         85 |     32,160        0.13       97.78
         87 |      7,300        0.03       97.81
         89 |     11,560        0.05       97.86
         91 |     16,976        0.07       97.93
         93 |      5,920        0.02       97.95
         95 |     21,990        0.09       98.04
         97 |     21,423        0.09       98.13
         99 |     21,309        0.09       98.22
        101 |     15,847        0.07       98.29
        103 |     20,195        0.08       98.37
        105 |      8,157        0.03       98.41
        107 |      6,225        0.03       98.43
        109 |     11,773        0.05       98.48
        111 |     16,340        0.07       98.55
        113 |     33,983        0.14       98.69
        115 |      5,301        0.02       98.71
        117 |      8,478        0.04       98.75
        119 |     16,875        0.07       98.82
        121 |     12,017        0.05       98.87
        123 |      4,198        0.02       98.89
        125 |     10,142        0.04       98.93
        127 |      2,922        0.01       98.94
        129 |      1,975        0.01       98.95
        133 |      5,837        0.02       98.97
        135 |      8,815        0.04       99.01
        139 |      6,638        0.03       99.04
        141 |      7,621        0.03       99.07
        143 |      5,187        0.02       99.09
        145 |      2,074        0.01       99.10
        147 |      2,570        0.01       99.11
        149 |      2,427        0.01       99.12
        151 |      2,091        0.01       99.13
        153 |      5,916        0.02       99.15
        157 |     12,742        0.05       99.21
        159 |        807        0.00       99.21
        160 |        234        0.00       99.21
        161 |      5,166        0.02       99.23
        163 |     14,992        0.06       99.29
        165 |      2,647        0.01       99.31
        167 |      5,589        0.02       99.33
        169 |        921        0.00       99.33
        171 |        529        0.00       99.33
        173 |        362        0.00       99.34
        179 |      1,984        0.01       99.34
        183 |     12,753        0.05       99.40
        185 |        956        0.00       99.40
        187 |      2,572        0.01       99.41
        189 |      7,260        0.03       99.44
        191 |        855        0.00       99.45
        197 |      3,714        0.02       99.46
        201 |     32,347        0.13       99.60
        209 |      2,962        0.01       99.61
        215 |      3,501        0.01       99.62
        223 |        849        0.00       99.63
        227 |      1,037        0.00       99.63
        245 |      3,376        0.01       99.64
        251 |      1,136        0.00       99.65
        257 |        957        0.00       99.65
        303 |      3,683        0.02       99.67
        309 |      2,562        0.01       99.68
        313 |        525        0.00       99.68
        329 |      1,285        0.01       99.69
        339 |      3,566        0.01       99.70
        355 |      2,895        0.01       99.71
        367 |      1,109        0.00       99.72
        375 |      1,077        0.00       99.72
        381 |      1,335        0.01       99.73
        423 |      1,679        0.01       99.74
        439 |     16,294        0.07       99.80
        441 |      1,584        0.01       99.81
        451 |      1,056        0.00       99.81
        453 |     13,967        0.06       99.87
        479 |      1,416        0.01       99.88
        485 |      1,431        0.01       99.88
        491 |      4,607        0.02       99.90
        510 |     11,147        0.05       99.95
        550 |      1,187        0.00       99.96
        650 |      1,161        0.00       99.96
        700 |      1,586        0.01       99.97
        710 |        689        0.00       99.97
        760 |      3,068        0.01       99.98
        810 |      4,263        0.02      100.00
------------+-----------------------------------
      Total | 24,015,037      100.00

. rename migcounty1 county_fips_o

. 
. ** Use migrate1 to update values 
. 
. ** Within same house 
. replace state_fips_o = state_fips_d if migrate1 == 1
(21,541,019 real changes made)

. replace county_fips_o = county_fips_d if migrate1 == 1 
(13,111,570 real changes made)

. 
. ** Within same state 
. replace state_fips_o = state_fips_d if migrate1 == 2
(0 real changes made)

. 
. ** Generate county IDS 
. foreach x in "o" "d" {
  2.         
.         make_fips state_fips_`x' county_fips_`x', gen(fips_`x')
  3. 
. }

. 
. ** Check for within-state migration 
. gen same_county = fips_o == fips_d 

. tab year same_county

           |      same_county
      year |         0          1 |     Total
-----------+----------------------+----------
      2015 |    89,492  2,245,481 | 2,334,973 
      2016 |    91,109  2,255,901 | 2,347,010 
      2017 |    93,553  2,278,348 | 2,371,901 
      2018 |    96,080  2,306,022 | 2,402,102 
      2019 |    96,088  2,344,171 | 2,440,259 
      2020 |    71,827  1,877,155 | 1,948,982 
      2021 |    97,600  2,361,518 | 2,459,118 
      2022 |   106,231  2,430,426 | 2,536,657 
      2023 |    98,226  2,479,566 | 2,577,792 
      2024 |    93,040  2,503,203 | 2,596,243 
-----------+----------------------+----------
     Total |   933,246 23,081,791 |24,015,037 

. tab year same_county if migrate1 == 2

           |      same_county
      year |         0          1 |     Total
-----------+----------------------+----------
      2015 |    42,597    172,956 |   215,553 
      2016 |    43,823    172,091 |   215,914 
      2017 |    45,058    174,386 |   219,444 
      2018 |    46,477    173,182 |   219,659 
      2019 |    46,329    168,101 |   214,430 
      2020 |    34,625    119,307 |   153,932 
      2021 |    46,470    148,925 |   195,395 
      2022 |    50,584    141,717 |   192,301 
      2023 |    47,498    135,794 |   183,292 
      2024 |    46,033    134,313 |   180,346 
-----------+----------------------+----------
     Total |   449,494  1,540,772 | 1,990,266 

. 
. ** Tag HH head 
. gen byte hh_head = (relate == 1)

. 
. ** Compress file 
. compress 
  variable incwelfr was long now int
  variable incsupp was long now int
  variable state_fips_o was int now byte
  variable hh_size was float now byte
  variable hh_adult_ct was float now byte
  variable hh_child_ct was float now byte
  variable college was float now byte
  variable hh_any_child was float now byte
  variable hh_any_college was float now byte
  variable hh_perwt was float now int
  variable same_county was float now byte
  (672,421,036 bytes saved)

. 
. ** Save 
. save "${data}working/acs_migration_file", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/acs_migration_file.dta saved

. 
. ** Keep only observations with valid origin/destination counties and YEAR
. drop if missing(year) | missing(fips_o) | missing(fips_d)
(0 observations deleted)

. 
. ** Clean income (treat missing as 0; keep negative values as reported)
. replace inctot = 0 if missing(inctot)
(0 real changes made)

. gen double income_wt = inctot * perwt

. label var income_wt "Person income (INCTOT) weighted by PERWT"

. 
. ** Persons + income totals by origin/destination/year
. 
. preserve

. keep year fips_o fips_d perwt income_wt

. collapse (sum) persons=perwt income_total=income_wt, by(year fips_o fips_d)

. tempfile acs_pi

. save `acs_pi'
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000f.tmp saved as .dta format

. restore

. 
. ** Households by origin/destination/year
. ** Use HHWT among household heads (RELATE==1)
. 
. preserve

. keep if hh_head == 1 
(11,523,232 observations deleted)

. keep year fips_o fips_d hhwt

. collapse (sum) households=hhwt, by(year fips_o fips_d)

. tempfile acs_hh

. save `acs_hh'
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000h.tmp saved as .dta format

. restore

. 
. ** Merge persons/income with households
. use `acs_pi', clear

. merge 1:1 year fips_o fips_d using `acs_hh', nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                        50,330
        from master                    50,330  
        from using                          0  

    Matched                           181,401  
    -----------------------------------------

. 
. label var persons "Estimated number of persons (sum PERWT)"

. label var households "Estimated number of households (sum HHWT among heads)"

. label var income_total "Estimated total personal income (sum INCTOT*PERWT)"

. 
. ** Derive state/county components for merges with name crosswalk
. gen int state_fips_o  = floor(fips_o/1000)

. gen int county_fips_o = mod(fips_o,1000)

. gen int state_fips_d  = floor(fips_d/1000)

. gen int county_fips_d = mod(fips_d,1000)

. 
. label var state_fips_o "State FIPS (origin)"

. label var county_fips_o "County FIPS (origin)"

. label var state_fips_d "State FIPS (destination)"

. label var county_fips_d "County FIPS (destination)"

. 
. ** Merge in names (from NHGIS IDs snapshot)
. 
. 
. ** Loop over orgin and destination states
. foreach x in "d" "o" {
  2.         
.         preserve
  3.         
.         ** Load County IDs 
.         use "${data}working/ids", clear
  4.         
.         ** Rename 
.         rename  (state_fips county_fips state_name county_name) ///
>                         (state_fips_`x' county_fips_`x' state_name_`x' county_name_`x')
  5.                 
.         ** Save as temporary file       
.         tempfile ids_`x'
  6.         save `ids_`x''
  7.         
.         ** Restore and merge data 
.         restore
  8.         merge m:1 state_fips_`x' county_fips_`x' using `ids_`x'', keep(master match) nogen
  9. 
. } // END ORIGIN - DESTINATION LOOP 
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000j.tmp saved as .dta format

    Result                      Number of obs
    -----------------------------------------
    Not matched                        55,890
        from master                    55,890  
        from using                          0  

    Matched                           175,841  
    -----------------------------------------
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000l.tmp saved as .dta format

    Result                      Number of obs
    -----------------------------------------
    Not matched                        52,146
        from master                    52,146  
        from using                          0  

    Matched                           179,585  
    -----------------------------------------

. 
. ** Organize data 
. order year ///
>     state_fips_o county_fips_o state_name_o county_name_o fips_o ///
>     state_fips_d county_fips_d state_name_d county_name_d fips_d ///
>     persons households income_total

. 
. ** Sort data 
. sort year state_fips_o county_fips_o state_fips_d county_fips_d

. 
. ** Identify other counties (suppression)
. replace county_name_o = "Other" if county_fips_o == 0 
(52,066 real changes made)

. replace county_name_d = "Other" if county_fips_d == 0 
(55,163 real changes made)

. 
. ** Save data
. save "${data}working/acs_county_flow", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/acs_county_flow.dta saved

. clear 

. 
. ** Create gross-migration files for ACS 
. 
. ** All (18+)
. acs_make_gross_migration using "${data}working/acs_migration_file", ///
>     saving("${data}working/acs_county_gross_18plus") replace 
(0 observations deleted)
(0 real changes made)
(11,523,232 missing values generated)
(11,523,232 missing values generated)
(11,523,232 real changes made)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000n.tmp not found)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000n.tmp saved as .dta format
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000p.tmp not found)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000p.tmp saved as .dta format

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             4,825  
    -----------------------------------------
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(variable fips was long, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           504
        from master                       504  
        from using                          0  

    Matched                             4,321  
    -----------------------------------------
  variable state_fips was int now byte
  variable fips was double now long
  variable persons_in_1 was double now long
  variable persons_in_4 was double now long
  variable persons_in_5 was double now long
  variable households_in_1 was double now long
  variable households_in_4 was double now long
  variable households_in_5 was double now long
  variable persons_in_2 was double now long
  variable persons_in_3 was double now long
  variable households_in_2 was double now long
  variable households_in_3 was double now long
  variable persons_out_1 was double now long
  variable persons_out_4 was double now long
  variable persons_out_5 was double now long
  variable households_out_1 was double now long
  variable households_out_4 was double now long
  variable households_out_5 was double now long
  variable persons_out_2 was double now long
  variable persons_out_3 was double now long
  variable households_out_2 was double now long
  variable households_out_3 was double now long
  variable persons_net_2 was double now long
  variable persons_net_3 was double now long
  variable persons_net_4 was double now long
  variable persons_net_5 was double now long
  variable households_net_2 was double now long
  variable households_net_3 was double now long
  variable households_net_4 was double now long
  variable households_net_5 was double now long
  variable county_name was str46 now str23
  (675,500 bytes saved)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/acs_county_gross_18plus.dta
    saved

.         
. ** College-degrees 
. acs_make_gross_migration  using "${data}working/acs_migration_file", ///
>     saving("${data}working/acs_county_gross_college") replace sample("hh_any_college == 1")
(0 observations deleted)
(0 observations deleted)
(0 real changes made)
(11,523,232 missing values generated)
(11,523,232 missing values generated)
(11,523,232 real changes made)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000n.tmp not found)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000n.tmp saved as .dta format
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000p.tmp not found)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000p.tmp saved as .dta format

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             4,825  
    -----------------------------------------
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(variable fips was long, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           504
        from master                       504  
        from using                          0  

    Matched                             4,321  
    -----------------------------------------
  variable state_fips was int now byte
  variable fips was double now long
  variable persons_in_1 was double now long
  variable persons_in_4 was double now long
  variable persons_in_5 was double now long
  variable households_in_1 was double now long
  variable households_in_4 was double now long
  variable households_in_5 was double now long
  variable persons_in_2 was double now long
  variable persons_in_3 was double now long
  variable households_in_2 was double now long
  variable households_in_3 was double now long
  variable persons_out_1 was double now long
  variable persons_out_4 was double now long
  variable persons_out_5 was double now long
  variable households_out_1 was double now long
  variable households_out_4 was double now long
  variable households_out_5 was double now long
  variable persons_out_2 was double now long
  variable persons_out_3 was double now long
  variable households_out_2 was double now long
  variable households_out_3 was double now long
  variable persons_net_2 was double now long
  variable persons_net_3 was double now long
  variable persons_net_4 was double now long
  variable persons_net_5 was double now long
  variable households_net_2 was double now long
  variable households_net_3 was double now long
  variable households_net_4 was double now long
  variable households_net_5 was double now long
  variable county_name was str46 now str23
  (675,500 bytes saved)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/acs_county_gross_college.dta
    saved

.         
. ** No Kids
. acs_make_gross_migration using "${data}working/acs_migration_file", ///
>     saving("${data}working/acs_county_gross_nokids") replace sample("hh_any_child == 0")
(7,412,793 observations deleted)
(0 observations deleted)
(0 real changes made)
(7,460,825 missing values generated)
(7,460,825 missing values generated)
(7,460,825 real changes made)
(192,951 missing values generated)
(157,429 missing values generated)
(45,172 missing values generated)
(192,951 missing values generated)
(157,429 missing values generated)
(45,172 missing values generated)
(192,951 missing values generated)
(157,429 missing values generated)
(45,172 missing values generated)
(file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000n.tmp not found)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000n.tmp saved as .dta format
(192,951 missing values generated)
(157,429 missing values generated)
(45,172 missing values generated)
(192,951 missing values generated)
(157,429 missing values generated)
(45,172 missing values generated)
(192,951 missing values generated)
(157,429 missing values generated)
(45,172 missing values generated)
(file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000p.tmp not found)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000p.tmp saved as .dta format

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             4,825  
    -----------------------------------------
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(variable fips was long, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           504
        from master                       504  
        from using                          0  

    Matched                             4,321  
    -----------------------------------------
  variable state_fips was int now byte
  variable fips was double now long
  variable persons_in_1 was double now long
  variable persons_in_4 was double now long
  variable persons_in_5 was double now long
  variable households_in_1 was double now long
  variable households_in_4 was double now long
  variable households_in_5 was double now long
  variable persons_in_2 was double now long
  variable persons_in_3 was double now long
  variable households_in_2 was double now long
  variable households_in_3 was double now long
  variable persons_out_1 was double now long
  variable persons_out_4 was double now long
  variable persons_out_5 was double now long
  variable households_out_1 was double now long
  variable households_out_4 was double now long
  variable households_out_5 was double now long
  variable persons_out_2 was double now long
  variable persons_out_3 was double now long
  variable households_out_2 was double now long
  variable households_out_3 was double now long
  variable persons_net_2 was double now long
  variable persons_net_3 was double now long
  variable persons_net_4 was double now long
  variable persons_net_5 was double now long
  variable households_net_2 was double now long
  variable households_net_3 was double now long
  variable households_net_4 was double now long
  variable households_net_5 was double now int
  variable county_name was str46 now str23
  (685,150 bytes saved)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/acs_county_gross_nokids.dta
    saved

.         
. ********************************************************************************
. ** STEP 5: Import and Clean IRS Migration Data 
. ********************************************************************************
.         
. ** Loop over years 
. forvalues y = 16(1)22 {
  2.         
.         local start = `y' - 1
  3.         local end = `y'  
  4.         
.         ** Import data (out)
.         import delimited "${data}irs/countyoutflow`start'`end'.csv", clear 
  5.         
.         ** Describe data 
.         des 
  6.         
.         ** Generate year (end year)
.         gen year = 2000 + `y'
  7.         
.         ** Drop Regional Values 
.         drop if y2_state == "DS"
  8.         
.         ** Drop Foreign Migration 
.         drop if y2_state == "FR"
  9.         
.         ** Drop observations without a county
.         drop if y1_countyfips == 0 
 10.         
.         ** Deal with suppressed values 
.         unsuppress n1 n2 agi
 11.         
.         ** Drop unnecc variables 
.         drop y2_state y2_countyname
 12.                 
.         ** Create two versions: gross and net 
.         tempfile tmp
 13.         save `tmp'
 14.         
.         ** Gross first 
.         
.         ** Keep gross categories 
.         keep if ///
>                 (y1_statefips == y2_statefips & y1_countyfips == y2_countyfips) |       ///
>                 inlist(y2_statefips, 96, 97, 98)
 15. 
.         ** Clean up 
.         gen move_type = 0 
 16.         
.         ** Stayers 
.         replace move_type = 1 if        (y1_statefips == y2_statefips) &        ///
>                                                                 (y1_countyfips == y2_countyfips) 
 17.         
.         ** Movers
.         replace move_type = 2 if        y2_statefips == 96              // ALL 
 18.         replace move_type = 3 if        y2_statefips == 97 &    ///
>                                                                 y2_countyfips == 0              // D
> omestic Total
 19.         replace move_type = 4 if        y2_statefips == 97 &    ///
>                                                                 y2_countyfips == 1              // W
> ithin-state
 20.         replace move_type = 5 if        y2_statefips == 97 &    ///
>                                                                 y2_countyfips == 3              // B
> etween-states 
 21.         replace move_type = 6 if        y2_statefips == 98              // Foreign 
 22.         
.         ** Label movers 
.         label values move_type lb_move_type 
 23.         
.         ** Generate total category 
.         foreach var of varlist n1 n2 agi {
 24.                 
.                 gen tmp = `var' if inlist(move_type, 1, 2)
 25.                 bysort y1_statefips y1_countyfips: egen `var'_total = total(tmp)
 26.                 drop tmp 
 27.                 
.         } // END VAR LOOP 
 28.         
.         ** Drop unnecc variables 
.         drop y2_* 
 29.         
.         ** Sort 
.         sort year y1_statefips y1_countyfips move_type 
 30. 
.         ** Order 
.         order year y1_statefips y1_countyfips move_type 
 31.         
.         ** Rename 
.         rename y1_countyfips county_fips 
 32.         rename y1_statefips state_fips 
 33.         
.         ** Label variables 
.         label var year "Tax year (year before move)"
 34.         label var state_fips "State FIPS code (origin state)"
 35.         label var county_fips "County FIPS code (origin county)"
 36.         label var move_type "Mover category"
 37.         label var n1 "Number of returns"
 38.         label var n2 "Number of exemptions"
 39.         label var agi "Adjusted Gross Income"
 40.         label var n1_total "Number of returns, county total (origin)"
 41.         label var n2_total "Number of exemptions, county total (origin)"
 42.         label var agi_total "Adjusted Gross Income, county total (origin)"
 43.         
.         ** Save 
.         save "${data}working/irs_county_gross_out_`y'", replace 
 44.         
.         ** Create version for merge with net 
.         keep if move_type == 3 
 45.         
.         ** Rename variables 
.         rename n1 n1_mover
 46.         rename n2 n2_mover 
 47.         rename agi agi_mover 
 48.         
.         label var n1_mover "Number of domestic mover returns"
 49.         label var n2_mover "Number of domestic mover exemptions"
 50.         label var agi_mover "Adjusted Gross Income, domestic movers"
 51.         
.         ** Save as temp file 
.         tempfile merge 
 52.         save `merge'
 53.         clear 
 54.         
.         ** Next, create flow file 
.         use `tmp', clear 
 55.         
.         ** Drop aggregate values 
.         drop if inlist(y2_statefips, 96, 97, 98)
 56.         drop if (y1_statefips == y2_statefips & y1_countyfips == y2_countyfips) 
 57.         
.         ** Sort 
.         sort year y1_statefips y1_countyfips y2_statefips y2_countyfips 
 58. 
.         ** Order 
.         order year y1_statefips y1_countyfips y2_statefips y2_countyfips
 59. 
.         
.         ** Rename 
.         rename y1_countyfips county_fips 
 60.         rename y1_statefips state_fips 
 61.         rename y2_countyfips y2_county_fips 
 62.         rename y2_statefips y2_state_fips       
 63.         
.         ** Label variables 
.         label var year "Tax year (year before move)"
 64.         label var state_fips "State FIPS code (origin state)"
 65.         label var county_fips "County FIPS code (origin county)"
 66.         label var y2_state_fips "State FIPS code (dest. state)"
 67.         label var y2_county_fips "County FIPS code (dest. county)"      
 68.         label var n1 "Number of returns"
 69.         label var n2 "Number of exemptions"
 70.         label var agi "Adjusted Gross Income"
 71.         
.         ** Merge with county of origin data 
.         merge m:1 state_fips county_fips using `merge', nogen keep(master match)
 72.         
.         ** Rename 
.         rename state_fips state_fips_o
 73.         rename county_fips county_fips_o
 74.         rename y2_* *_d 
 75.         
.         ** Dropo unnecc variable 
.         drop move_type 
 76.         
.         ** Save 
.         save "${data}working/irs_county_flow_`y'", replace 
 77.         clear
 78.         
.         ** Import data (in)
.         import delimited "${data}irs/countyinflow`start'`end'.csv", clear 
 79.         
.         ** Describe data 
.         des 
 80. 
.         ** Generate year 
.         gen year = 2000 + `y' 
 81.         
.         ** Drop Regional Values 
.         drop if y1_state == "DS"
 82.         
.         ** Drop Foreign Migration 
.         drop if y1_state == "FR"
 83.         
.         ** Drop observations with no county ID 
.         drop if y2_countyfips == 0 
 84.         
.         ** Keep gross categories 
.         keep if ///
>                 (y1_statefips == y2_statefips & y1_countyfips == y2_countyfips) |       ///
>                 inlist(y1_statefips, 96, 97, 98)
 85. 
.         ** Clean up 
.         gen move_type = 0 
 86.         
.         ** Deal with suppressed values 
.         unsuppress n1 n2 agi
 87.         
.         ** Stayers 
.         replace move_type = 1 if        (y1_statefips == y2_statefips) &        ///
>                                                                 (y1_countyfips == y2_countyfips) 
 88.         
.         ** Movers
.         replace move_type = 2 if        y1_statefips == 96              // ALL 
 89.         replace move_type = 3 if        y1_statefips == 97 &    ///
>                                                                 y1_countyfips == 0              // D
> omestic Total
 90.         replace move_type = 4 if        y1_statefips == 97 &    ///
>                                                                 y1_countyfips == 1              // W
> ithin-state
 91.         replace move_type = 5 if        y1_statefips == 97 &    ///
>                                                                 y1_countyfips == 3              // B
> etween-states 
 92.         replace move_type = 6 if        y1_statefips == 98              // Foreign 
 93.         
.         ** Label move variable  
.         label values move_type lb_move_type 
 94.         
.         ** Generate total category 
.         foreach var of varlist n1 n2 agi {
 95.                 
.                 gen tmp = `var' if inlist(move_type, 1, 2)
 96.                 bysort y2_statefips y2_countyfips: egen `var'_total = total(tmp)
 97.                 drop tmp 
 98.                 
.         } // END VAR LOOP 
 99.         
.         ** Drop unnecc variables 
.         drop y1_*
100.         
.         ** Sort 
.         sort year y2_statefips y2_countyfips move_type 
101. 
.         ** Order 
.         order year y2_statefips y2_countyfips move_type 
102.         
.         ** Rename 
.         rename y2_countyfips county_fips 
103.         rename y2_statefips state_fips 
104.         
.         ** Label variables 
.         label var year "Tax year (year before move)"
105.         label var state_fips "State FIPS code (dest. state)"
106.         label var county_fips "County FIPS code (dest. county)"
107.         label var move_type "Mover category"
108.         label var n1 "Number of returns"
109.         label var n2 "Number of exemptions"
110.         label var agi "Adjusted Gross Income"
111.         label var n1_total "Number of returns, county total (dest.)"
112.         label var n2_total "Number of exemptions, county total (dest.)"
113.         label var agi_total "Adjusted Gross Income, county total (dest.)"
114.         
.         ** Save 
.         save "${data}working/irs_county_gross_in_`y'", replace 
115.         clear 
116.         
. } // END YEAR LOOP 
(encoding automatically selected: ISO-8859-1)
(9 vars, 86,481 obs)

Contains data
 Observations:        86,481                  
    Variables:             9                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y2_state        str2    %9s                   
y2_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,289 observations deleted)
(2,937 observations deleted)
(254 observations deleted)
(2,056 real changes made)
(2,056 real changes made)
(2,056 real changes made)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000m.tmp saved as .dta format
(50,007 observations deleted)
(3,141 real changes made)
(3,141 real changes made)
(3,141 real changes made)
(3,140 real changes made)
(3,140 real changes made)
(2,291 real changes made)
(11,712 missing values generated)
(11,712 missing values generated)
(11,712 missing values generated)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_out_16.dta
    saved
(14,853 observations deleted)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000n.tmp saved as .dta format
(14,853 observations deleted)
(3,141 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                            50,007  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_flow_16.dta saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 86,330 obs)

Contains data
 Observations:        86,330                  
    Variables:             9                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y1_state        str2    %9s                   
y1_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,315 observations deleted)
(2,814 observations deleted)
(254 observations deleted)
(50,005 observations deleted)
(2,041 real changes made)
(2,041 real changes made)
(2,041 real changes made)
(3,141 real changes made)
(3,141 real changes made)
(3,141 real changes made)
(3,140 real changes made)
(3,140 real changes made)
(2,239 real changes made)
(11,660 missing values generated)
(11,660 missing values generated)
(11,660 missing values generated)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_in_16.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 98,948 obs)

Contains data
 Observations:        98,948                  
    Variables:             9                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y2_state        str2    %9s                   
y2_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,372 observations deleted)
(2,360 observations deleted)
(254 observations deleted)
(1,877 real changes made)
(1,877 real changes made)
(1,877 real changes made)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000o.tmp saved as .dta format
(63,249 observations deleted)
(3,140 real changes made)
(3,141 real changes made)
(3,141 real changes made)
(3,140 real changes made)
(3,141 real changes made)
(2,010 real changes made)
(11,432 missing values generated)
(11,432 missing values generated)
(11,432 missing values generated)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_out_17.dta
    saved
(14,572 observations deleted)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000p.tmp saved as .dta format
(14,573 observations deleted)
(3,140 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                            63,249  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_flow_17.dta saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 98,874 obs)

Contains data
 Observations:        98,874                  
    Variables:             9                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y1_state        str2    %9s                   
y1_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,432 observations deleted)
(2,282 observations deleted)
(254 observations deleted)
(63,249 observations deleted)
(1,788 real changes made)
(1,788 real changes made)
(1,788 real changes made)
(3,140 real changes made)
(3,141 real changes made)
(3,141 real changes made)
(3,140 real changes made)
(3,140 real changes made)
(1,955 real changes made)
(11,376 missing values generated)
(11,376 missing values generated)
(11,376 missing values generated)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_in_17.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 87,820 obs)

Contains data
 Observations:        87,820                  
    Variables:             9                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y2_state        str2    %9s                   
y2_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,300 observations deleted)
(2,364 observations deleted)
(254 observations deleted)
(1,942 real changes made)
(1,942 real changes made)
(1,942 real changes made)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000q.tmp saved as .dta format
(52,173 observations deleted)
(3,141 real changes made)
(3,141 real changes made)
(3,141 real changes made)
(3,140 real changes made)
(3,140 real changes made)
(2,026 real changes made)
(11,447 missing values generated)
(11,447 missing values generated)
(11,447 missing values generated)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_out_18.dta
    saved
(14,588 observations deleted)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000r.tmp saved as .dta format
(14,588 observations deleted)
(3,141 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                            52,173  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_flow_18.dta saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 87,932 obs)

Contains data
 Observations:        87,932                  
    Variables:             9                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y1_state        str2    %9s                   
y1_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,368 observations deleted)
(2,403 observations deleted)
(254 observations deleted)
(52,174 observations deleted)
(1,919 real changes made)
(1,919 real changes made)
(1,919 real changes made)
(3,141 real changes made)
(3,141 real changes made)
(3,141 real changes made)
(3,140 real changes made)
(3,140 real changes made)
(2,030 real changes made)
(11,451 missing values generated)
(11,451 missing values generated)
(11,451 missing values generated)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_in_18.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 83,878 obs)

Contains data
 Observations:        83,878                  
    Variables:             9                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y2_state        str2    %9s                   
y2_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(14,919 observations deleted)
(2,298 observations deleted)
(0 observations deleted)
(53 real changes made)
(53 real changes made)
(53 real changes made)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000s.tmp saved as .dta format
(51,090 observations deleted)
(3,141 real changes made)
(3,107 real changes made)
(3,107 real changes made)
(3,103 real changes made)
(2,778 real changes made)
(335 real changes made)
(9,323 missing values generated)
(9,323 missing values generated)
(9,323 missing values generated)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_out_19.dta
    saved
(12,464 observations deleted)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000t.tmp saved as .dta format
(12,430 observations deleted)
(3,141 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            34
        from master                        34  
        from using                          0  

    Matched                            51,056  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_flow_19.dta saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 83,762 obs)

Contains data
 Observations:        83,762                  
    Variables:             9                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y1_state        str2    %9s                   
y1_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(14,890 observations deleted)
(2,290 observations deleted)
(0 observations deleted)
(51,090 observations deleted)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(3,141 real changes made)
(3,086 real changes made)
(3,086 real changes made)
(3,082 real changes made)
(2,729 real changes made)
(368 real changes made)
(9,265 missing values generated)
(9,265 missing values generated)
(9,265 missing values generated)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_in_19.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 87,325 obs)

Contains data
 Observations:        87,325                  
    Variables:             9                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y2_state        str2    %9s                   
y2_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(14,937 observations deleted)
(2,272 observations deleted)
(0 observations deleted)
(62 real changes made)
(62 real changes made)
(62 real changes made)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000u.tmp saved as .dta format
(54,560 observations deleted)
(3,142 real changes made)
(3,104 real changes made)
(3,104 real changes made)
(3,101 real changes made)
(2,773 real changes made)
(332 real changes made)
(9,310 missing values generated)
(9,310 missing values generated)
(9,310 missing values generated)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_out_20.dta
    saved
(12,452 observations deleted)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000v.tmp saved as .dta format
(12,414 observations deleted)
(3,142 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            38
        from master                        38  
        from using                          0  

    Matched                            54,522  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_flow_20.dta saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 87,552 obs)

Contains data
 Observations:        87,552                  
    Variables:             9                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y1_state        str2    %9s                   
y1_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,060 observations deleted)
(2,323 observations deleted)
(0 observations deleted)
(54,560 observations deleted)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(3,142 real changes made)
(3,102 real changes made)
(3,102 real changes made)
(3,097 real changes made)
(2,805 real changes made)
(361 real changes made)
(9,365 missing values generated)
(9,365 missing values generated)
(9,365 missing values generated)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_in_20.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 89,511 obs)

Contains data
 Observations:        89,511                  
    Variables:             9                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y2_state        str2    %9s                   
y2_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(14,963 observations deleted)
(2,175 observations deleted)
(0 observations deleted)
(79 real changes made)
(79 real changes made)
(79 real changes made)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000w.tmp saved as .dta format
(56,831 observations deleted)
(3,143 real changes made)
(3,097 real changes made)
(3,097 real changes made)
(3,094 real changes made)
(2,787 real changes made)
(324 real changes made)
(9,302 missing values generated)
(9,302 missing values generated)
(9,302 missing values generated)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_out_21.dta
    saved
(12,445 observations deleted)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000x.tmp saved as .dta format
(12,399 observations deleted)
(3,143 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            46
        from master                        46  
        from using                          0  

    Matched                            56,785  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_flow_21.dta saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 89,850 obs)

Contains data
 Observations:        89,850                  
    Variables:             9                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y1_state        str2    %9s                   
y1_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,132 observations deleted)
(2,263 observations deleted)
(0 observations deleted)
(56,835 observations deleted)
(1 real change made)
(1 real change made)
(1 real change made)
(3,143 real changes made)
(3,101 real changes made)
(3,101 real changes made)
(3,098 real changes made)
(2,838 real changes made)
(339 real changes made)
(9,376 missing values generated)
(9,376 missing values generated)
(9,376 missing values generated)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_in_21.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 90,409 obs)

Contains data
 Observations:        90,409                  
    Variables:             9                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y2_state        str2    %9s                   
y2_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(14,962 observations deleted)
(2,223 observations deleted)
(0 observations deleted)
(64 real changes made)
(64 real changes made)
(64 real changes made)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_000010.tmp saved as .dta format
(57,644 observations deleted)
(3,144 real changes made)
(3,107 real changes made)
(3,107 real changes made)
(3,103 real changes made)
(2,790 real changes made)
(329 real changes made)
(9,329 missing values generated)
(9,329 missing values generated)
(9,329 missing values generated)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_out_22.dta
    saved
(12,473 observations deleted)
file C:\Users\ji252\AppData\Local\Temp\ST_4058_000011.tmp saved as .dta format
(12,436 observations deleted)
(3,144 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            37
        from master                        37  
        from using                          0  

    Matched                            57,607  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_flow_22.dta saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 90,498 obs)

Contains data
 Observations:        90,498                  
    Variables:             9                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y1_state        str2    %9s                   
y1_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,093 observations deleted)
(2,179 observations deleted)
(0 observations deleted)
(57,640 observations deleted)
(1 real change made)
(1 real change made)
(1 real change made)
(3,144 real changes made)
(3,098 real changes made)
(3,098 real changes made)
(3,094 real changes made)
(2,822 real changes made)
(330 real changes made)
(9,344 missing values generated)
(9,344 missing values generated)
(9,344 missing values generated)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_in_22.dta
    saved

. 
. ** Append data 
. 
. ** Loop over datasets 
. foreach file in "irs_county_gross_in" "irs_county_gross_out" "irs_county_flow"{
  2.         
.                 
.         ** Loop over years 
.         forvalues y = 16(1)22 {
  3. 
.                 ** Append 
.                 append using "${data}working/`file'_`y'"
  4.                 
.         } // END YEAR LOOP 
  5.         
.         
.         ** Order and sort flow file 
.         if "`file'" == "irs_county_flow" {
  6.                 
.                 ** Loop over orgin and destination state 
.                 foreach x in "o" "d" {
  7.                         
.                         ** Rename 
.                         rename *_fips_`x' *_fips 
  8.                         
.                         ** Merge with county and state names 
.                         merge m:1 state_fips county_fips using "${data}working/ids",    ///
>                                 keep(match) nogen 
  9.                                 
.                         ** Rename 
.                         rename *_fips *_fips_`x' 
 10.                         rename *_name *_name_`x' 
 11.                         
.                         ** Generate county IDS 
.                         make_fips state_fips_`x' county_fips_`x', gen(fips_`x')
 12.                         
.                 } // END ORIGIN / DESTINATION LOOP 
 13.                 
.                 ** Order file 
.                 order year state_*_o county_*_o state_*_d county_*_d  
 14.                 sort year state_*_o county_*_o state_*_d county_*_d  
 15. 
.         } // END MIGRATION FLOW IF-STATEMENT 
 16.         
.         else {
 17.                 
.                 ** Merge with county and state names 
.                 merge m:1 state_fips county_fips using "${data}working/ids",    ///
>                                 keep(match) nogen 
 18.                                 
.                 ** Order 
.                 order year state_* county* move_type
 19.                 
.         } 
 20.         
.         ** Save file 
.         save "${data}working/`file'", replace 
 21.         clear 
 22.         
. } // END FILE LOOP 

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           115,567  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_in.dta saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           115,611  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_out.dta
    saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           384,896  
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           362,678  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_flow.dta saved

. 
. ** Create gross file with in and out migration 
. use "${data}working/irs_county_gross_in", clear 

. 
. ** Rename 
. rename n1 n1_in_

. rename n2 n2_in_

. rename agi agi_in_

. rename *_total *_total_in

. 
. ** Reshape 
. reshape wide n1_in_ n2_in_ agi_in_, i(year state_fips county_fips) j(move_type)
(j = 1 2 3 4 5 6)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations          115,567   ->   21,980      
Number of variables                  13   ->   27          
j variable (6 values)         move_type   ->   (dropped)
xij variables:
                                 n1_in_   ->   n1_in_1 n1_in_2 ... n1_in_6
                                 n2_in_   ->   n2_in_1 n2_in_2 ... n2_in_6
                                agi_in_   ->   agi_in_1 agi_in_2 ... agi_in_6
-----------------------------------------------------------------------------

. 
. ** Define locals 
. local txt1 "Non-movers"

. local txt2 "All movers"                 

. local txt3 "Domestic movers"            

. local txt4 "Within-state movers"        

. local txt5 "Inter-state movers" 

. local txt6 "Foreign movers"

. 
. ** Label variables, in loop 
. foreach n of numlist 1(1)6 {
  2.         
.         label var n1_in_`n' "Returns, in-migration, `txt`n''"
  3.         label var n2_in_`n' "Exemptions, in-migration, `txt`n''"
  4.         label var agi_in_`n' "AGI, in-migration, `txt`n''"
  5. 
. } // END NUMLIST LOOP 

. 
. ** Preserve 
. tempfile gross_in

. save `gross_in'
file C:\Users\ji252\AppData\Local\Temp\ST_4058_000012.tmp saved as .dta format

. clear

. 
. ** Create gross file with in and out migration 
. use "${data}working/irs_county_gross_out", clear 

. 
. ** Rename 
. rename n1 n1_out_

. rename n2 n2_out_

. rename agi agi_out_

. rename *_total *_total_out

. 
. ** Reshape 
. reshape wide n1_out_ n2_out_ agi_out_, i(year state_fips county_fips) j(move_type)
(j = 1 2 3 4 5 6)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations          115,611   ->   21,980      
Number of variables                  13   ->   27          
j variable (6 values)         move_type   ->   (dropped)
xij variables:
                                n1_out_   ->   n1_out_1 n1_out_2 ... n1_out_6
                                n2_out_   ->   n2_out_1 n2_out_2 ... n2_out_6
                               agi_out_   ->   agi_out_1 agi_out_2 ... agi_out_6
-----------------------------------------------------------------------------

. 
. ** Define locals 
. local txt1 "Non-movers"

. local txt2 "All movers"                 

. local txt3 "Domestic movers"            

. local txt4 "Within-state movers"        

. local txt5 "Inter-state movers" 

. local txt6 "Foreign movers"

. 
. ** Label variables, in loop 
. foreach n of numlist 1(1)6 {
  2.         
.         label var n1_out_`n' "Returns, out-migration, `txt`n''"
  3.         label var n2_out_`n' "Exemptions, out-migration, `txt`n''"
  4.         label var agi_out_`n' "AGI, out-migration, `txt`n''"
  5. 
. } // END NUMLIST LOOP 

. 
. ** Merge data 
. merge 1:1 year state_fips county_fips using `gross_in', keep(match) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                            21,980  
    -----------------------------------------

. 
. ** Text for correct matching (non-movers should match perfectly)
. summ n*_*_1 agi_*_1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    n1_out_1 |     21,979    37461.71    123155.4          0    3944880
    n2_out_1 |     21,979    78000.79    252081.2          0    7841705
     n1_in_1 |     21,979    37461.71    123155.4          0    3944880
     n2_in_1 |     21,979    78000.79    252081.2          0    7841705
   agi_out_1 |     21,979     3214755    1.23e+07      -8051   4.30e+08
-------------+---------------------------------------------------------
    agi_in_1 |     21,979     3214755    1.23e+07      -8051   4.30e+08

. 
. ** Define net migration variables 
. 
. ** Loop over variable
. foreach a in "n1" "n2" "agi" {
  2. 
.         if "`a'" == "n1" local txt "Returns"
  3.         else if "`a'" == "n2" local txt "Exemptions"
  4.         else if "`a'" == "agi" local txt "AGI"
  5. 
.         ** Loop over type of movers 
.         forvalues n = 2/6 {
  6.                 
.                 ** Clean up missing values 
.                 replace `a'_in_`n' = 0 if missing(`a'_in_`n')
  7.                 replace `a'_out_`n' = 0 if missing(`a'_out_`n')
  8. 
.                 ** Generate net 
.                 gen `a'_net_`n' = `a'_in_`n' - `a'_out_`n'
  9.                 label var `a'_net_`n' "`txt', net-migration, `txt`n''"
 10. 
.         } // END MOVER TYPE LOOP 
 11. 
. } // END VARIABLE LOOP 
(183 real changes made)
(155 real changes made)
(183 real changes made)
(155 real changes made)
(202 real changes made)
(172 real changes made)
(1,379 real changes made)
(1,444 real changes made)
(14,365 real changes made)
(14,342 real changes made)
(183 real changes made)
(155 real changes made)
(183 real changes made)
(155 real changes made)
(202 real changes made)
(172 real changes made)
(1,379 real changes made)
(1,444 real changes made)
(14,365 real changes made)
(14,342 real changes made)
(183 real changes made)
(155 real changes made)
(183 real changes made)
(155 real changes made)
(202 real changes made)
(172 real changes made)
(1,379 real changes made)
(1,444 real changes made)
(14,365 real changes made)
(14,342 real changes made)

. 
. ** Generate fips variable
. *make_fips state_fips county_fips, gen(fips)
. 
. ** Save file 
. save "${data}working/irs_county_gross", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross.dta saved

. clear

. 
. ********************************************************************************
. ** STEP 6: Import and Clean IRS County-Level Aggr. Data 
. ********************************************************************************
. 
. ** Loop over years 
. forvalues y = 15(1)22 {
  2.         
.         
.         ** Import data (out)
.         import delimited "${data}irs/`y'incyallagi.csv", clear 
  3. 
.         ** Describe data 
.         des 
  4.         
.         ** Generate year 
.         gen year = 2000 + `y' 
  5.         
.         ** Define AGI groups 
.         label var agi_stub "AGI Brackets"
  6.         label values agi_stub lb_agi 
  7.         
.         ** Define set of variables to keep 
.         keep state* county* agi_stub year n1 mars1 mars2 mars4 n2 elderly       ///
>                 a00100 n02650 a02650 n00200 a00200 
  8.                 
.         ** Rename variables 
.         rename a00100 agi 
  9.         rename n02650 n_total_inc
 10.         rename a02650 a_total_inc
 11.         rename n00200 n_wage
 12.         rename a00200 a_wage 
 13.         rename statefips state_fips
 14.         rename state state_abb 
 15.         rename countyfips county_fips 
 16.         rename countyname county_name 
 17.         
.         ** Rescale 
.         replace agi = 1000 * agi 
 18.         replace a_total_inc = 1000 * a_total_inc
 19.         replace a_wage = 1000 * a_wage 
 20.         
.         ** Label 
.         label var n1 "Number of returns"
 21.         label var mars1 "Number of single returns"
 22.         label var mars1 "Number of MFJ returns"
 23.         label var mars1 "Number of HoH returns"
 24.         label var n2 "Number of individuals"
 25.         label var elderly "Number of returns with one individual over 60"
 26.         label var agi "Adjusted Gross Income (AGI)"
 27.         label var n_total_inc "Number of returns with total income"
 28.         label var a_total_inc "Total income amount"
 29.         label var n_wage "Number of returns with wage income"
 30.         label var a_wage "Wage income amount"
 31.         
.         ** Sort 
.         sort year state_fips county_fips agi_stub 
 32.         
.         ** Order 
.         order year state* county* agi_stub 
 33.         
.         ** Save 
.         save "${data}working/irs_county_all_`y'", replace 
 34.         
.         clear 
 35.         
. } // END YEAR LOOP 
(encoding automatically selected: ISO-8859-1)
(132 vars, 25,536 obs)

Contains data
 Observations:        25,536                  
    Variables:           132                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
statefips       byte    %8.0g                 STATEFIPS
state           str2    %9s                   STATE
countyfips      int     %8.0g                 COUNTYFIPS
countyname      str20   %20s                  COUNTYNAME
agi_stub        byte    %8.0g                 
n1              long    %12.0g                N1
mars1           long    %12.0g                
mars2           long    %12.0g                MARS2
mars4           long    %12.0g                MARS4
prep            long    %12.0g                PREP
n2              long    %12.0g                N2
numdep          long    %12.0g                NUMDEP
total_vita      long    %12.0g                TOTAL_VITA
vita            long    %8.0g                 VITA
tce             long    %8.0g                 TCE
vita_eic        int     %8.0g                 VITA_EIC
ral             long    %8.0g                 RAL
rac             long    %12.0g                RAC
elderly         long    %12.0g                ELDERLY
a00100          long    %12.0g                A00100
n02650          long    %12.0g                N02650
a02650          long    %12.0g                A02650
n00200          long    %12.0g                N00200
a00200          long    %12.0g                A00200
n00300          long    %12.0g                N00300
a00300          long    %12.0g                A00300
n00600          long    %12.0g                N00600
a00600          long    %12.0g                A00600
n00650          long    %12.0g                N00650
a00650          long    %12.0g                A00650
n00700          long    %12.0g                N00700
a00700          long    %12.0g                A00700
n00900          long    %12.0g                N00900
a00900          long    %12.0g                A00900
n01000          long    %12.0g                N01000
a01000          long    %12.0g                A01000
n01400          long    %12.0g                N01400
a01400          long    %12.0g                A01400
n01700          long    %12.0g                N01700
a01700          long    %12.0g                A01700
schf            long    %8.0g                 SCHF
n02300          long    %12.0g                N02300
a02300          long    %12.0g                A02300
n02500          long    %12.0g                N02500
a02500          long    %12.0g                A02500
n26270          long    %12.0g                N26270
a26270          long    %12.0g                A26270
n02900          long    %12.0g                N02900
a02900          long    %12.0g                A02900
n03220          long    %12.0g                N03220
a03220          long    %8.0g                 A03220
n03300          long    %8.0g                 N03300
a03300          long    %12.0g                A03300
n03270          long    %8.0g                 N03270
a03270          long    %12.0g                A03270
n03150          long    %8.0g                 N03150
a03150          long    %12.0g                A03150
n03210          long    %12.0g                N03210
a03210          long    %12.0g                A03210
n03230          long    %8.0g                 N03230
a03230          long    %12.0g                A03230
n03240          int     %8.0g                 N03240
a03240          long    %12.0g                A03240
n04470          long    %12.0g                N04470
a04470          long    %12.0g                A04470
a00101          long    %12.0g                A00101
n18425          long    %12.0g                N18425
a18425          long    %12.0g                A18425
n18450          long    %12.0g                N18450
a18450          long    %12.0g                A18450
n18500          long    %12.0g                N18500
a18500          long    %12.0g                A18500
n18300          long    %12.0g                N18300
a18300          long    %12.0g                A18300
n19300          long    %12.0g                N19300
a19300          long    %12.0g                A19300
n19700          long    %12.0g                N19700
a19700          long    %12.0g                A19700
n04800          long    %12.0g                N04800
a04800          long    %12.0g                A04800
n05800          long    %12.0g                N05800
a05800          long    %12.0g                A05800
n09600          long    %12.0g                N09600
a09600          long    %12.0g                A09600
n05780          long    %8.0g                 N05780
a05780          long    %8.0g                 A05780
n07100          long    %12.0g                N07100
a07100          long    %12.0g                A07100
n07300          long    %12.0g                N07300
a07300          long    %12.0g                A07300
n07180          long    %12.0g                N07180
a07180          long    %8.0g                 A07180
n07230          long    %12.0g                N07230
a07230          long    %12.0g                A07230
n07240          long    %12.0g                N07240
a07240          long    %12.0g                A07240
n07220          long    %12.0g                N07220
a07220          long    %12.0g                A07220
n07260          long    %8.0g                 N07260
a07260          long    %8.0g                 A07260
n09400          long    %12.0g                N09400
a09400          long    %12.0g                A09400
n85770          long    %12.0g                N85770
a85770          long    %12.0g                A85770
n85775          long    %12.0g                N85775
a85775          long    %12.0g                A85775
n09750          long    %12.0g                N09750
a09750          long    %8.0g                 A09750
n10600          long    %12.0g                N10600
a10600          long    %12.0g                A10600
n59660          long    %12.0g                N59660
a59660          long    %12.0g                A59660
n59720          long    %12.0g                N59720
a59720          long    %12.0g                A59720
n11070          long    %12.0g                N11070
a11070          long    %12.0g                A11070
n10960          long    %12.0g                N10960
a10960          long    %12.0g                A10960
n11560          long    %8.0g                 N11560
a11560          long    %8.0g                 A11560
n06500          long    %12.0g                N06500
a06500          long    %12.0g                A06500
n10300          long    %12.0g                N10300
a10300          long    %12.0g                A10300
n85530          long    %12.0g                N85530
a85530          long    %12.0g                A85530
n85300          long    %12.0g                N85300
a85300          long    %12.0g                A85300
n11901          long    %12.0g                N11901
a11901          long    %12.0g                A11901
n11902          long    %12.0g                N11902
a11902          long    %12.0g                A11902
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
variable agi was long now double
(25,283 real changes made)
variable a_total_inc was long now double
(25,283 real changes made)
variable a_wage was long now double
(24,576 real changes made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all_15.dta saved
(encoding automatically selected: ISO-8859-1)
(148 vars, 25,536 obs)

Contains data
 Observations:        25,536                  
    Variables:           148                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
statefips       byte    %8.0g                 STATEFIPS
state           str2    %9s                   STATE
countyfips      int     %8.0g                 COUNTYFIPS
countyname      str20   %20s                  COUNTYNAME
agi_stub        byte    %8.0g                 
n1              long    %12.0g                N1
mars1           long    %12.0g                
mars2           long    %12.0g                MARS2
mars4           long    %12.0g                MARS4
prep            long    %12.0g                PREP
n2              long    %12.0g                N2
numdep          long    %12.0g                NUMDEP
total_vita      long    %12.0g                TOTAL_VITA
vita            long    %12.0g                VITA
tce             long    %12.0g                TCE
vita_eic        int     %8.0g                 VITA_EIC
ral             long    %12.0g                RAL
rac             long    %12.0g                RAC
elderly         long    %12.0g                ELDERLY
a00100          long    %12.0g                A00100
n02650          long    %12.0g                N02650
a02650          long    %12.0g                A02650
n00200          long    %12.0g                N00200
a00200          long    %12.0g                A00200
n00300          long    %12.0g                N00300
a00300          long    %12.0g                A00300
n00600          long    %12.0g                N00600
a00600          long    %12.0g                A00600
n00650          long    %12.0g                N00650
a00650          long    %12.0g                A00650
n00700          long    %12.0g                N00700
a00700          long    %12.0g                A00700
n00900          long    %12.0g                N00900
a00900          long    %12.0g                A00900
n01000          long    %12.0g                N01000
a01000          long    %12.0g                A01000
n01400          long    %12.0g                N01400
a01400          long    %12.0g                A01400
n01700          long    %12.0g                N01700
a01700          long    %12.0g                A01700
schf            long    %8.0g                 SCHF
n02300          long    %12.0g                N02300
a02300          long    %12.0g                A02300
n02500          long    %12.0g                N02500
a02500          long    %12.0g                A02500
n26270          long    %12.0g                N26270
a26270          long    %12.0g                A26270
n02900          long    %12.0g                N02900
a02900          long    %12.0g                A02900
n03220          long    %12.0g                N03220
a03220          long    %12.0g                A03220
n03300          long    %12.0g                N03300
a03300          long    %12.0g                A03300
n03270          long    %12.0g                N03270
a03270          long    %12.0g                A03270
n03150          long    %12.0g                N03150
a03150          long    %12.0g                A03150
n03210          long    %12.0g                N03210
a03210          long    %12.0g                A03210
n03230          long    %12.0g                N03230
a03230          long    %12.0g                A03230
n03240          int     %8.0g                 N03240
a03240          long    %12.0g                A03240
n04470          long    %12.0g                N04470
a04470          long    %12.0g                A04470
a00101          long    %12.0g                A00101
n17000          long    %12.0g                N17000
a17000          long    %12.0g                A17000
n18425          long    %12.0g                N18425
a18425          long    %12.0g                A18425
n18450          long    %12.0g                N18450
a18450          long    %12.0g                A18450
n18500          long    %12.0g                N18500
a18500          long    %12.0g                A18500
n18800          long    %12.0g                N18800
a18800          long    %12.0g                A18800
n18300          long    %12.0g                N18300
a18300          long    %12.0g                A18300
n19300          long    %12.0g                N19300
a19300          long    %12.0g                A19300
n19500          long    %12.0g                N19500
a19500          long    %12.0g                A19500
n19530          long    %12.0g                N19530
a19530          long    %12.0g                A19530
n19550          long    %12.0g                N19550
a19550          long    %12.0g                A19550
n19570          long    %12.0g                N19570
a19570          long    %12.0g                A19570
n19700          long    %12.0g                N19700
a19700          long    %12.0g                A19700
n20800          long    %12.0g                N20800
a20800          long    %12.0g                A20800
n21020          long    %12.0g                N21020
a21020          long    %12.0g                A21020
n04800          long    %12.0g                N04800
a04800          long    %12.0g                A04800
n05800          long    %12.0g                N05800
a05800          long    %12.0g                A05800
n09600          long    %12.0g                N09600
a09600          long    %12.0g                A09600
n05780          long    %12.0g                N05780
a05780          long    %12.0g                A05780
n07100          long    %12.0g                N07100
a07100          long    %12.0g                A07100
n07300          long    %12.0g                N07300
a07300          long    %12.0g                A07300
n07180          long    %12.0g                N07180
a07180          long    %12.0g                A07180
n07230          long    %12.0g                N07230
a07230          long    %12.0g                A07230
n07240          long    %12.0g                N07240
a07240          long    %12.0g                A07240
n07220          long    %12.0g                N07220
a07220          long    %12.0g                A07220
n07260          long    %12.0g                N07260
a07260          long    %12.0g                A07260
n09400          long    %12.0g                N09400
a09400          long    %12.0g                A09400
n85770          long    %12.0g                N85770
a85770          long    %12.0g                A85770
n85775          long    %12.0g                N85775
a85775          long    %12.0g                A85775
n09750          long    %12.0g                N09750
a09750          long    %12.0g                A09750
n10600          long    %12.0g                N10600
a10600          long    %12.0g                A10600
n59660          long    %12.0g                N59660
a59660          long    %12.0g                A59660
n59720          long    %12.0g                N59720
a59720          long    %12.0g                A59720
n11070          long    %12.0g                N11070
a11070          long    %12.0g                A11070
n10960          long    %12.0g                N10960
a10960          long    %12.0g                A10960
n11560          long    %12.0g                N11560
a11560          long    %12.0g                A11560
n06500          long    %12.0g                N06500
a06500          long    %12.0g                A06500
n10300          long    %12.0g                N10300
a10300          long    %12.0g                A10300
n85530          long    %12.0g                N85530
a85530          long    %12.0g                A85530
n85300          long    %12.0g                N85300
a85300          long    %12.0g                A85300
n11901          long    %12.0g                N11901
a11901          long    %12.0g                A11901
n11902          long    %12.0g                N11902
a11902          long    %12.0g                A11902
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
variable agi was long now double
(25,267 real changes made)
variable a_total_inc was long now double
(25,267 real changes made)
variable a_wage was long now double
(24,662 real changes made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all_16.dta saved
(encoding automatically selected: ISO-8859-1)
(154 vars, 25,536 obs)

Contains data
 Observations:        25,536                  
    Variables:           154                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
statefips       byte    %8.0g                 STATEFIPS
state           str2    %9s                   STATE
countyfips      int     %8.0g                 COUNTYFIPS
countyname      str20   %20s                  COUNTYNAME
agi_stub        byte    %8.0g                 
n1              long    %12.0g                N1
mars1           long    %12.0g                
mars2           long    %12.0g                MARS2
mars4           long    %12.0g                MARS4
elf             long    %12.0g                ELF
cprep           long    %12.0g                CPREP
prep            long    %12.0g                PREP
dir_dep         long    %12.0g                DIR_DEP
n2              long    %12.0g                N2
numdep          long    %12.0g                NUMDEP
total_vita      long    %12.0g                TOTAL_VITA
vita            long    %8.0g                 VITA
tce             long    %8.0g                 TCE
vita_eic        int     %8.0g                 VITA_EIC
rac             long    %12.0g                RAC
elderly         long    %12.0g                ELDERLY
a00100          long    %12.0g                A00100
n02650          long    %12.0g                N02650
a02650          long    %12.0g                A02650
n00200          long    %12.0g                N00200
a00200          long    %12.0g                A00200
n00300          long    %12.0g                N00300
a00300          long    %12.0g                A00300
n00600          long    %12.0g                N00600
a00600          long    %12.0g                A00600
n00650          long    %12.0g                N00650
a00650          long    %12.0g                A00650
n00700          long    %12.0g                N00700
a00700          long    %12.0g                A00700
n00900          long    %12.0g                N00900
a00900          long    %12.0g                A00900
n01000          long    %12.0g                N01000
a01000          long    %12.0g                A01000
n01400          long    %12.0g                N01400
a01400          long    %12.0g                A01400
n01700          long    %12.0g                N01700
a01700          long    %12.0g                A01700
schf            long    %8.0g                 SCHF
n02300          long    %12.0g                N02300
a02300          long    %12.0g                A02300
n02500          long    %12.0g                N02500
a02500          long    %12.0g                A02500
n26270          long    %12.0g                N26270
a26270          long    %12.0g                A26270
n02900          long    %12.0g                N02900
a02900          long    %12.0g                A02900
n03220          long    %12.0g                N03220
a03220          long    %8.0g                 A03220
n03300          long    %8.0g                 N03300
a03300          long    %12.0g                A03300
n03270          long    %8.0g                 N03270
a03270          long    %12.0g                A03270
n03150          long    %8.0g                 N03150
a03150          long    %12.0g                A03150
n03210          long    %12.0g                N03210
a03210          long    %12.0g                A03210
n03230          long    %8.0g                 N03230
a03230          long    %8.0g                 A03230
n03240          long    %8.0g                 N03240
a03240          long    %12.0g                A03240
n04470          long    %12.0g                N04470
a04470          long    %12.0g                A04470
a00101          long    %12.0g                A00101
n17000          long    %12.0g                N17000
a17000          long    %12.0g                A17000
n18425          long    %12.0g                N18425
a18425          long    %12.0g                A18425
n18450          long    %12.0g                N18450
a18450          long    %12.0g                A18450
n18500          long    %12.0g                N18500
a18500          long    %12.0g                A18500
n18800          long    %12.0g                N18800
a18800          long    %12.0g                A18800
n18300          long    %12.0g                N18300
a18300          long    %12.0g                A18300
n19300          long    %12.0g                N19300
a19300          long    %12.0g                A19300
n19500          long    %8.0g                 N19500
a19500          long    %8.0g                 A19500
n19530          long    %8.0g                 N19530
a19530          long    %8.0g                 A19530
n19550          long    %8.0g                 N19550
a19550          long    %8.0g                 A19550
n19570          long    %8.0g                 N19570
a19570          long    %12.0g                A19570
n19700          long    %12.0g                N19700
a19700          long    %12.0g                A19700
n20800          long    %12.0g                N20800
a20800          long    %12.0g                A20800
n20950          long    %8.0g                 N20950
a20950          long    %12.0g                A20950
n04800          long    %12.0g                N04800
a04800          long    %12.0g                A04800
n05800          long    %12.0g                N05800
a05800          long    %12.0g                A05800
n09600          long    %12.0g                N09600
a09600          long    %12.0g                A09600
n05780          long    %8.0g                 N05780
a05780          long    %8.0g                 A05780
n07100          long    %12.0g                N07100
a07100          long    %12.0g                A07100
n07300          long    %12.0g                N07300
a07300          long    %12.0g                A07300
n07180          long    %12.0g                N07180
a07180          long    %8.0g                 A07180
n07230          long    %12.0g                N07230
a07230          long    %12.0g                A07230
n07240          long    %12.0g                N07240
a07240          long    %12.0g                A07240
n07220          long    %12.0g                N07220
a07220          long    %12.0g                A07220
n07260          long    %8.0g                 N07260
a07260          long    %8.0g                 A07260
n09400          long    %12.0g                N09400
a09400          long    %12.0g                A09400
n85770          long    %12.0g                N85770
a85770          long    %12.0g                A85770
n85775          long    %12.0g                N85775
a85775          long    %12.0g                A85775
n09750          long    %12.0g                N09750
a09750          long    %12.0g                A09750
n10600          long    %12.0g                N10600
a10600          long    %12.0g                A10600
n59660          long    %12.0g                N59660
a59660          long    %12.0g                A59660
n59720          long    %12.0g                N59720
a59720          long    %12.0g                A59720
n11070          long    %12.0g                N11070
a11070          long    %12.0g                A11070
n10960          long    %12.0g                N10960
a10960          long    %12.0g                A10960
n11560          long    %8.0g                 N11560
a11560          long    %8.0g                 A11560
n06500          long    %12.0g                N06500
a06500          long    %12.0g                A06500
n10300          long    %12.0g                N10300
a10300          long    %12.0g                A10300
n85530          long    %12.0g                N85530
a85530          long    %12.0g                A85530
n85300          long    %12.0g                N85300
a85300          long    %12.0g                A85300
n11901          long    %12.0g                N11901
a11901          long    %12.0g                A11901
n11900          long    %12.0g                N11900
a11900          long    %12.0g                A11900
n11902          long    %12.0g                N11902
a11902          long    %12.0g                A11902
n12000          long    %12.0g                N12000
a12000          long    %12.0g                A12000
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
variable agi was long now double
(25,280 real changes made)
variable a_total_inc was long now double
(25,280 real changes made)
variable a_wage was long now double
(24,634 real changes made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all_17.dta saved
(encoding automatically selected: ISO-8859-1)
(154 vars, 25,536 obs)

Contains data
 Observations:        25,536                  
    Variables:           154                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
statefips       byte    %8.0g                 STATEFIPS
state           str2    %9s                   STATE
countyfips      int     %8.0g                 COUNTYFIPS
countyname      str20   %20s                  COUNTYNAME
agi_stub        byte    %8.0g                 
n1              long    %12.0g                N1
mars1           long    %12.0g                
mars2           long    %12.0g                MARS2
mars4           long    %12.0g                MARS4
elf             long    %12.0g                ELF
cprep           long    %12.0g                CPREP
prep            long    %12.0g                PREP
dir_dep         long    %12.0g                DIR_DEP
n2              long    %12.0g                N2
numdep          long    %12.0g                NUMDEP
total_vita      long    %12.0g                TOTAL_VITA
vita            long    %8.0g                 VITA
tce             long    %8.0g                 TCE
vita_eic        int     %8.0g                 VITA_EIC
rac             long    %12.0g                RAC
elderly         long    %12.0g                ELDERLY
a00100          long    %12.0g                A00100
n02650          long    %12.0g                N02650
a02650          long    %12.0g                A02650
n00200          long    %12.0g                N00200
a00200          long    %12.0g                A00200
n00300          long    %12.0g                N00300
a00300          long    %12.0g                A00300
n00600          long    %12.0g                N00600
a00600          long    %12.0g                A00600
n00650          long    %12.0g                N00650
a00650          long    %12.0g                A00650
n00700          long    %12.0g                N00700
a00700          long    %12.0g                A00700
n00900          long    %12.0g                N00900
a00900          long    %12.0g                A00900
n01000          long    %12.0g                N01000
a01000          long    %12.0g                A01000
n01750          long    %12.0g                N01750
a01750          long    %12.0g                A01750
schf            long    %8.0g                 SCHF
n02300          long    %12.0g                N02300
a02300          long    %12.0g                A02300
n02500          long    %12.0g                N02500
a02500          long    %12.0g                A02500
n26270          long    %12.0g                N26270
a26270          long    %12.0g                A26270
n02900          long    %12.0g                N02900
a02900          long    %12.0g                A02900
n03220          long    %12.0g                N03220
a03220          long    %8.0g                 A03220
n03300          long    %8.0g                 N03300
a03300          long    %12.0g                A03300
n03270          long    %8.0g                 N03270
a03270          long    %12.0g                A03270
n03150          long    %8.0g                 N03150
a03150          long    %12.0g                A03150
n03210          long    %12.0g                N03210
a03210          long    %12.0g                A03210
n04450          long    %12.0g                N04450
a04450          long    %12.0g                A04450
n04100          long    %12.0g                N04100
a04100          long    %12.0g                A04100
n04200          long    %12.0g                N04200
a04200          long    %12.0g                A04200
n04470          long    %12.0g                N04470
a04470          long    %12.0g                A04470
a00101          long    %12.0g                A00101
n17000          long    %8.0g                 N17000
a17000          long    %12.0g                A17000
n18425          long    %12.0g                N18425
a18425          long    %12.0g                A18425
n18450          long    %8.0g                 N18450
a18450          long    %8.0g                 A18450
n18500          long    %12.0g                N18500
a18500          long    %12.0g                A18500
n18800          long    %12.0g                N18800
a18800          long    %8.0g                 A18800
n18460          long    %12.0g                N18460
a18460          long    %12.0g                A18460
n18300          long    %12.0g                N18300
a18300          long    %12.0g                A18300
n19300          long    %12.0g                N19300
a19300          long    %12.0g                A19300
n19500          long    %8.0g                 N19500
a19500          long    %8.0g                 A19500
n19530          long    %8.0g                 N19530
a19530          long    %8.0g                 A19530
n19570          long    %8.0g                 N19570
a19570          long    %12.0g                A19570
n19700          long    %12.0g                N19700
a19700          long    %12.0g                A19700
n20950          long    %8.0g                 N20950
a20950          long    %12.0g                A20950
n04475          long    %12.0g                N04475
a04475          long    %12.0g                A04475
n04800          long    %12.0g                N04800
a04800          long    %12.0g                A04800
n05800          long    %12.0g                N05800
a05800          long    %12.0g                A05800
n09600          long    %8.0g                 N09600
a09600          long    %12.0g                A09600
n05780          long    %8.0g                 N05780
a05780          long    %8.0g                 A05780
n07100          long    %12.0g                N07100
a07100          long    %12.0g                A07100
n07300          long    %12.0g                N07300
a07300          long    %12.0g                A07300
n07180          long    %12.0g                N07180
a07180          long    %12.0g                A07180
n07230          long    %12.0g                N07230
a07230          long    %12.0g                A07230
n07240          long    %12.0g                N07240
a07240          long    %12.0g                A07240
n07225          long    %12.0g                N07225
a07225          long    %12.0g                A07225
n07260          long    %8.0g                 N07260
a07260          long    %8.0g                 A07260
n09400          long    %12.0g                N09400
a09400          long    %12.0g                A09400
n85770          long    %12.0g                N85770
a85770          long    %12.0g                A85770
n85775          long    %12.0g                N85775
a85775          long    %12.0g                A85775
n09750          long    %12.0g                N09750
a09750          long    %8.0g                 A09750
n10600          long    %12.0g                N10600
a10600          long    %12.0g                A10600
n59660          long    %12.0g                N59660
a59660          long    %12.0g                A59660
n59720          long    %12.0g                N59720
a59720          long    %12.0g                A59720
n11070          long    %12.0g                N11070
a11070          long    %12.0g                A11070
n10960          long    %12.0g                N10960
a10960          long    %12.0g                A10960
n11560          long    %8.0g                 N11560
a11560          long    %8.0g                 A11560
n06500          long    %12.0g                N06500
a06500          long    %12.0g                A06500
n10300          long    %12.0g                N10300
a10300          long    %12.0g                A10300
n85530          long    %12.0g                N85530
a85530          long    %12.0g                A85530
n85300          long    %12.0g                N85300
a85300          long    %12.0g                A85300
n11901          long    %12.0g                N11901
a11901          long    %12.0g                A11901
n11900          long    %12.0g                N11900
a11900          long    %12.0g                A11900
n11902          long    %12.0g                N11902
a11902          long    %12.0g                A11902
n12000          long    %12.0g                N12000
a12000          long    %12.0g                A12000
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
variable agi was long now double
(25,325 real changes made)
variable a_total_inc was long now double
(25,325 real changes made)
variable a_wage was long now double
(24,672 real changes made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all_18.dta saved
(encoding automatically selected: ISO-8859-1)
(153 vars, 25,544 obs)

Contains data
 Observations:        25,544                  
    Variables:           153                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
statefips       byte    %8.0g                 STATEFIPS
state           str2    %9s                   STATE
countyfips      int     %8.0g                 COUNTYFIPS
countyname      str24   %24s                  COUNTYNAME
agi_stub        byte    %8.0g                 
n1              long    %12.0g                N1
mars1           long    %12.0g                
mars2           long    %12.0g                MARS2
mars4           long    %12.0g                MARS4
elf             long    %12.0g                ELF
cprep           long    %8.0g                 CPREP
prep            long    %12.0g                PREP
dir_dep         long    %12.0g                DIR_DEP
n2              long    %12.0g                N2
total_vita      long    %8.0g                 TOTAL_VITA
vita            long    %8.0g                 VITA
tce             int     %8.0g                 TCE
vita_eic        int     %8.0g                 VITA_EIC
rac             long    %12.0g                RAC
elderly         long    %12.0g                ELDERLY
a00100          long    %12.0g                A00100
n02650          long    %12.0g                N02650
a02650          float   %9.0g                 A02650
n00200          long    %12.0g                N00200
a00200          long    %12.0g                A00200
n00300          long    %12.0g                N00300
a00300          long    %12.0g                A00300
n00600          long    %12.0g                N00600
a00600          long    %12.0g                A00600
n00650          long    %12.0g                N00650
a00650          long    %12.0g                A00650
n00700          long    %12.0g                N00700
a00700          long    %12.0g                A00700
n00900          long    %12.0g                N00900
a00900          long    %12.0g                A00900
n01000          long    %12.0g                N01000
a01000          long    %12.0g                A01000
n01400          long    %12.0g                N01400
a01400          long    %12.0g                A01400
n01700          long    %12.0g                N01700
a01700          long    %12.0g                A01700
schf            long    %8.0g                 SCHF
n02300          long    %8.0g                 N02300
a02300          long    %12.0g                A02300
n02500          long    %12.0g                N02500
a02500          long    %12.0g                A02500
n26270          long    %12.0g                N26270
a26270          long    %12.0g                A26270
n02900          long    %12.0g                N02900
a02900          long    %12.0g                A02900
n03220          long    %8.0g                 N03220
a03220          long    %8.0g                 A03220
n03300          long    %8.0g                 N03300
a03300          long    %12.0g                A03300
n03270          long    %8.0g                 N03270
a03270          long    %12.0g                A03270
n03150          long    %8.0g                 N03150
a03150          long    %12.0g                A03150
n03210          long    %12.0g                N03210
a03210          long    %12.0g                A03210
n04450          long    %12.0g                N04450
a04450          long    %12.0g                A04450
n04100          long    %12.0g                N04100
a04100          long    %12.0g                A04100
n04200          long    %12.0g                N04200
a04200          long    %12.0g                A04200
n04470          long    %12.0g                N04470
a04470          long    %12.0g                A04470
a00101          long    %12.0g                A00101
n17000          long    %8.0g                 N17000
a17000          long    %12.0g                A17000
n18425          long    %12.0g                N18425
a18425          long    %12.0g                A18425
n18450          long    %8.0g                 N18450
a18450          long    %8.0g                 A18450
n18500          long    %12.0g                N18500
a18500          long    %12.0g                A18500
n18800          long    %12.0g                N18800
a18800          long    %8.0g                 A18800
n18460          long    %12.0g                N18460
a18460          long    %12.0g                A18460
n18300          long    %12.0g                N18300
a18300          long    %12.0g                A18300
n19300          long    %12.0g                N19300
a19300          long    %12.0g                A19300
n19500          long    %8.0g                 N19500
a19500          long    %8.0g                 A19500
n19530          long    %8.0g                 N19530
a19530          long    %8.0g                 A19530
n19570          long    %8.0g                 N19570
a19570          long    %12.0g                A19570
n19700          long    %12.0g                N19700
a19700          long    %12.0g                A19700
n20950          long    %8.0g                 N20950
a20950          long    %12.0g                A20950
n04475          long    %12.0g                N04475
a04475          long    %12.0g                A04475
n04800          long    %12.0g                N04800
a04800          long    %12.0g                A04800
n05800          long    %12.0g                N05800
a05800          long    %12.0g                A05800
n09600          int     %8.0g                 N09600
a09600          long    %8.0g                 A09600
n05780          long    %8.0g                 N05780
a05780          long    %8.0g                 A05780
n07100          long    %12.0g                N07100
a07100          long    %12.0g                A07100
n07300          long    %8.0g                 N07300
a07300          long    %12.0g                A07300
n07180          long    %8.0g                 N07180
a07180          long    %8.0g                 A07180
n07230          long    %12.0g                N07230
a07230          long    %12.0g                A07230
n07240          long    %12.0g                N07240
a07240          long    %8.0g                 A07240
n07225          long    %12.0g                N07225
a07225          long    %12.0g                A07225
n07260          long    %8.0g                 N07260
a07260          long    %8.0g                 A07260
n09400          long    %12.0g                N09400
a09400          long    %12.0g                A09400
n85770          long    %12.0g                N85770
a85770          long    %12.0g                A85770
n85775          long    %12.0g                N85775
a85775          long    %12.0g                A85775
n10600          long    %12.0g                N10600
a10600          long    %12.0g                A10600
n59660          long    %12.0g                N59660
a59660          long    %12.0g                A59660
n59720          long    %12.0g                N59720
a59720          long    %12.0g                A59720
n11070          long    %12.0g                N11070
a11070          long    %12.0g                A11070
n10960          long    %12.0g                N10960
a10960          long    %12.0g                A10960
n11560          long    %8.0g                 N11560
a11560          long    %8.0g                 A11560
n06500          long    %12.0g                N06500
a06500          long    %12.0g                A06500
n10300          long    %12.0g                N10300
a10300          long    %12.0g                A10300
n85530          long    %8.0g                 N85530
a85530          long    %12.0g                A85530
n85300          long    %12.0g                N85300
a85300          long    %12.0g                A85300
n11901          long    %12.0g                N11901
a11901          long    %12.0g                A11901
n11900          long    %12.0g                N11900
a11900          long    %12.0g                A11900
n11902          long    %12.0g                N11902
a11902          long    %12.0g                A11902
n12000          long    %8.0g                 N12000
a12000          long    %12.0g                A12000
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
variable agi was long now double
(25,363 real changes made)
(25,363 real changes made)
variable a_wage was long now double
(24,724 real changes made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all_19.dta saved
(encoding automatically selected: ISO-8859-1)
(166 vars, 25,545 obs)

Contains data
 Observations:        25,545                  
    Variables:           166                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
statefips       byte    %8.0g                 STATEFIPS
state           str2    %9s                   STATE
countyfips      int     %8.0g                 COUNTYFIPS
countyname      str20   %20s                  COUNTYNAME
agi_stub        byte    %8.0g                 
n1              long    %12.0g                N1
mars1           long    %12.0g                
mars2           long    %12.0g                MARS2
mars4           long    %12.0g                MARS4
elf             long    %12.0g                ELF
cprep           long    %8.0g                 CPREP
prep            long    %12.0g                PREP
dir_dep         long    %12.0g                DIR_DEP
vrtcrind        long    %8.0g                 VRTCRIND
n2              long    %12.0g                N2
total_vita      long    %8.0g                 TOTAL_VITA
vita            long    %8.0g                 VITA
tce             int     %8.0g                 TCE
vita_eic        int     %8.0g                 VITA_EIC
rac             long    %12.0g                RAC
elderly         long    %12.0g                ELDERLY
a00100          long    %12.0g                A00100
n02650          long    %12.0g                N02650
a02650          float   %9.0g                 A02650
n00200          long    %12.0g                N00200
a00200          long    %12.0g                A00200
n00300          long    %12.0g                N00300
a00300          long    %12.0g                A00300
n00600          long    %12.0g                N00600
a00600          long    %12.0g                A00600
n00650          long    %12.0g                N00650
a00650          long    %12.0g                A00650
n00700          long    %12.0g                N00700
a00700          long    %12.0g                A00700
n00900          long    %12.0g                N00900
a00900          long    %12.0g                A00900
n01000          long    %12.0g                N01000
a01000          long    %12.0g                A01000
n01400          long    %12.0g                N01400
a01400          long    %12.0g                A01400
n01700          long    %12.0g                N01700
a01700          long    %12.0g                A01700
schf            float   %9.0g                 SCHF
n02300          long    %12.0g                N02300
a02300          long    %12.0g                A02300
n02500          long    %12.0g                N02500
a02500          long    %12.0g                A02500
n26270          long    %12.0g                N26270
a26270          long    %12.0g                A26270
n02900          long    %12.0g                N02900
a02900          long    %12.0g                A02900
n03220          long    %12.0g                N03220
a03220          long    %8.0g                 A03220
n03300          long    %8.0g                 N03300
a03300          long    %12.0g                A03300
n03270          long    %8.0g                 N03270
a03270          long    %12.0g                A03270
n03150          long    %8.0g                 N03150
a03150          long    %12.0g                A03150
n03210          long    %12.0g                N03210
a03210          long    %12.0g                A03210
n02910          long    %12.0g                N02910
a02910          long    %12.0g                A02910
n04450          long    %12.0g                N04450
a04450          long    %12.0g                A04450
n04100          long    %12.0g                N04100
a04100          long    %12.0g                A04100
n04200          long    %12.0g                N04200
a04200          long    %12.0g                A04200
n04470          long    %12.0g                N04470
a04470          long    %12.0g                A04470
a00101          long    %12.0g                A00101
n17000          long    %8.0g                 N17000
a17000          long    %12.0g                A17000
n18425          long    %12.0g                N18425
a18425          long    %12.0g                A18425
n18450          long    %8.0g                 N18450
a18450          long    %8.0g                 A18450
n18500          long    %12.0g                N18500
a18500          long    %12.0g                A18500
n18800          long    %12.0g                N18800
a18800          long    %8.0g                 A18800
n18460          long    %12.0g                N18460
a18460          long    %12.0g                A18460
n18300          long    %12.0g                N18300
a18300          long    %12.0g                A18300
n19300          long    %12.0g                N19300
a19300          long    %12.0g                A19300
n19500          int     %8.0g                 N19500
a19500          long    %8.0g                 A19500
n19530          long    %8.0g                 N19530
a19530          long    %8.0g                 A19530
n19550          long    %8.0g                 N19550
a19550          long    %8.0g                 A19550
n19570          long    %8.0g                 N19570
a19570          long    %12.0g                A19570
n19700          long    %12.0g                N19700
a19700          long    %12.0g                A19700
n20950          long    %8.0g                 N20950
a20950          long    %12.0g                A20950
n04475          long    %12.0g                N04475
a04475          long    %12.0g                A04475
n04800          long    %12.0g                N04800
a04800          long    %12.0g                A04800
n05800          long    %12.0g                N05800
a05800          long    %12.0g                A05800
n09600          int     %8.0g                 N09600
a09600          long    %8.0g                 A09600
n05780          long    %8.0g                 N05780
a05780          long    %8.0g                 A05780
n07100          long    %12.0g                N07100
a07100          long    %12.0g                A07100
n07300          long    %12.0g                N07300
a07300          long    %12.0g                A07300
n07180          long    %12.0g                N07180
a07180          long    %8.0g                 A07180
n07230          long    %12.0g                N07230
a07230          long    %12.0g                A07230
n07240          long    %12.0g                N07240
a07240          long    %12.0g                A07240
n07225          long    %12.0g                N07225
a07225          long    %12.0g                A07225
n07260          long    %8.0g                 N07260
a07260          long    %8.0g                 A07260
n09400          long    %12.0g                N09400
a09400          long    %12.0g                A09400
n85770          long    %8.0g                 N85770
a85770          long    %12.0g                A85770
n85775          long    %8.0g                 N85775
a85775          long    %12.0g                A85775
n10600          long    %12.0g                N10600
a10600          long    %12.0g                A10600
n59660          long    %12.0g                N59660
a59660          long    %12.0g                A59660
n59720          long    %12.0g                N59720
a59720          long    %12.0g                A59720
n11070          long    %12.0g                N11070
a11070          long    %12.0g                A11070
n10960          long    %12.0g                N10960
a10960          long    %12.0g                A10960
n11560          long    %8.0g                 N11560
a11560          long    %8.0g                 A11560
n11450          long    %8.0g                 N11450
a11450          long    %8.0g                 A11450
n10970          long    %12.0g                N10970
a10970          long    %12.0g                A10970
n10971          long    %12.0g                N10971
a10971          long    %12.0g                A10971
n10973          long    %12.0g                N10973
a10973          long    %12.0g                A10973
n06500          long    %12.0g                N06500
a06500          long    %12.0g                A06500
n10300          long    %12.0g                N10300
a10300          long    %12.0g                A10300
n85530          long    %12.0g                N85530
a85530          long    %12.0g                A85530
n85300          long    %12.0g                N85300
a85300          long    %12.0g                A85300
n11901          long    %12.0g                N11901
a11901          long    %12.0g                A11901
n11900          long    %12.0g                N11900
a11900          long    %12.0g                A11900
n11902          long    %12.0g                N11902
a11902          long    %12.0g                A11902
n12000          long    %12.0g                N12000
a12000          long    %12.0g                A12000
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
variable agi was long now double
(25,410 real changes made)
(25,410 real changes made)
variable a_wage was long now double
(24,896 real changes made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all_20.dta saved
(encoding automatically selected: ISO-8859-1)
(168 vars, 25,552 obs)

Contains data
 Observations:        25,552                  
    Variables:           168                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
statefips       byte    %8.0g                 STATEFIPS
state           str2    %9s                   STATE
countyfips      int     %8.0g                 COUNTYFIPS
countyname      str20   %20s                  COUNTYNAME
agi_stub        byte    %8.0g                 
n1              long    %12.0g                N1
mars1           long    %12.0g                
mars2           long    %12.0g                MARS2
mars4           long    %12.0g                MARS4
elf             long    %12.0g                ELF
cprep           long    %12.0g                CPREP
prep            long    %12.0g                PREP
dir_dep         long    %12.0g                DIR_DEP
vrtcrind        long    %12.0g                VRTCRIND
n2              long    %12.0g                N2
total_vita      long    %8.0g                 TOTAL_VITA
vita            long    %8.0g                 VITA
tce             int     %8.0g                 TCE
vita_eic        int     %8.0g                 VITA_EIC
rac             long    %12.0g                RAC
elderly         long    %12.0g                ELDERLY
a00100          long    %12.0g                A00100
n02650          long    %12.0g                N02650
a02650          float   %9.0g                 A02650
n00200          long    %12.0g                N00200
a00200          long    %12.0g                A00200
n00300          long    %12.0g                N00300
a00300          long    %12.0g                A00300
n00600          long    %12.0g                N00600
a00600          long    %12.0g                A00600
n00650          long    %12.0g                N00650
a00650          long    %12.0g                A00650
n00700          long    %12.0g                N00700
a00700          long    %12.0g                A00700
n00900          long    %12.0g                N00900
a00900          long    %12.0g                A00900
n01000          long    %12.0g                N01000
a01000          long    %12.0g                A01000
n01400          long    %12.0g                N01400
a01400          long    %12.0g                A01400
n01700          long    %12.0g                N01700
a01700          long    %12.0g                A01700
schf            float   %9.0g                 SCHF
n02300          long    %12.0g                N02300
a02300          long    %12.0g                A02300
n02500          long    %12.0g                N02500
a02500          long    %12.0g                A02500
n26270          long    %12.0g                N26270
a26270          long    %12.0g                A26270
n02900          long    %12.0g                N02900
a02900          long    %12.0g                A02900
n03220          long    %12.0g                N03220
a03220          long    %8.0g                 A03220
n03300          long    %8.0g                 N03300
a03300          long    %12.0g                A03300
n03270          long    %8.0g                 N03270
a03270          long    %12.0g                A03270
n03150          long    %8.0g                 N03150
a03150          long    %12.0g                A03150
n03210          long    %12.0g                N03210
a03210          long    %12.0g                A03210
n02910          long    %12.0g                N02910
a02910          long    %12.0g                A02910
n04450          long    %12.0g                N04450
a04450          long    %12.0g                A04450
n04100          long    %12.0g                N04100
a04100          long    %12.0g                A04100
n04200          long    %12.0g                N04200
a04200          long    %12.0g                A04200
n04470          long    %12.0g                N04470
a04470          long    %12.0g                A04470
a00101          long    %12.0g                A00101
n17000          long    %8.0g                 N17000
a17000          long    %12.0g                A17000
n18425          long    %12.0g                N18425
a18425          long    %12.0g                A18425
n18450          long    %8.0g                 N18450
a18450          long    %8.0g                 A18450
n18500          long    %12.0g                N18500
a18500          long    %12.0g                A18500
n18800          long    %8.0g                 N18800
a18800          long    %8.0g                 A18800
n18460          long    %12.0g                N18460
a18460          long    %12.0g                A18460
n18300          long    %12.0g                N18300
a18300          long    %12.0g                A18300
n19300          long    %12.0g                N19300
a19300          long    %12.0g                A19300
n19500          int     %8.0g                 N19500
a19500          long    %8.0g                 A19500
n19530          long    %8.0g                 N19530
a19530          long    %8.0g                 A19530
n19550          long    %8.0g                 N19550
a19550          long    %8.0g                 A19550
n19570          long    %8.0g                 N19570
a19570          long    %12.0g                A19570
n19700          long    %12.0g                N19700
a19700          long    %12.0g                A19700
n20950          long    %8.0g                 N20950
a20950          long    %12.0g                A20950
n04475          long    %12.0g                N04475
a04475          long    %12.0g                A04475
n04800          long    %12.0g                N04800
a04800          long    %12.0g                A04800
n05800          long    %12.0g                N05800
a05800          long    %12.0g                A05800
n09600          long    %8.0g                 N09600
a09600          long    %12.0g                A09600
n05780          long    %8.0g                 N05780
a05780          long    %8.0g                 A05780
n07100          long    %12.0g                N07100
a07100          long    %12.0g                A07100
n07300          long    %12.0g                N07300
a07300          long    %12.0g                A07300
n07180          int     %8.0g                 N07180
a07180          long    %8.0g                 A07180
n07230          long    %12.0g                N07230
a07230          long    %12.0g                A07230
n07240          long    %12.0g                N07240
a07240          long    %12.0g                A07240
n07225          long    %12.0g                N07225
a07225          long    %12.0g                A07225
n07260          long    %8.0g                 N07260
a07260          long    %8.0g                 A07260
n09400          long    %12.0g                N09400
a09400          long    %12.0g                A09400
n85770          long    %12.0g                N85770
a85770          long    %12.0g                A85770
n85775          long    %12.0g                N85775
a85775          long    %12.0g                A85775
n10600          long    %12.0g                N10600
a10600          long    %12.0g                A10600
n59660          long    %12.0g                N59660
a59660          long    %12.0g                A59660
n59720          long    %12.0g                N59720
a59720          long    %12.0g                A59720
n11070          long    %12.0g                N11070
a11070          long    %12.0g                A11070
n10960          long    %12.0g                N10960
a10960          long    %12.0g                A10960
n11560          long    %8.0g                 N11560
a11560          long    %8.0g                 A11560
n11450          long    %8.0g                 N11450
a11450          long    %12.0g                A11450
n11520          long    %12.0g                N11520
a11520          long    %12.0g                A11520
n11530          long    %8.0g                 N11530
a11530          long    %12.0g                A11530
n10970          long    %12.0g                N10970
a10970          long    %12.0g                A10970
n10971          long    %12.0g                N10971
a10971          long    %12.0g                A10971
n06500          long    %12.0g                N06500
a06500          long    %12.0g                A06500
n10300          long    %12.0g                N10300
a10300          long    %12.0g                A10300
n85530          long    %12.0g                N85530
a85530          long    %12.0g                A85530
n85300          long    %12.0g                N85300
a85300          long    %12.0g                A85300
n11901          long    %12.0g                N11901
a11901          long    %12.0g                A11901
n11900          long    %12.0g                N11900
a11900          long    %12.0g                A11900
n11902          long    %12.0g                N11902
a11902          long    %12.0g                A11902
n12000          long    %12.0g                N12000
a12000          long    %12.0g                A12000
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
variable agi was long now double
(25,456 real changes made)
(25,456 real changes made)
variable a_wage was long now double
(24,659 real changes made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all_21.dta saved
(encoding automatically selected: ISO-8859-1)
(166 vars, 25,552 obs)

Contains data
 Observations:        25,552                  
    Variables:           166                  
------------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
------------------------------------------------------------------------------------------------------
statefips       byte    %8.0g                 STATEFIPS
state           str2    %9s                   STATE
countyfips      int     %8.0g                 COUNTYFIPS
countyname      str20   %20s                  COUNTYNAME
agi_stub        byte    %8.0g                 
n1              long    %12.0g                N1
mars1           long    %12.0g                
mars2           long    %12.0g                MARS2
mars4           long    %12.0g                MARS4
elf             long    %12.0g                ELF
cprep           long    %8.0g                 CPREP
prep            long    %12.0g                PREP
dir_dep         long    %12.0g                DIR_DEP
vrtcrind        long    %8.0g                 VRTCRIND
n2              long    %12.0g                N2
total_vita      long    %8.0g                 TOTAL_VITA
vita            long    %8.0g                 VITA
tce             int     %8.0g                 TCE
vita_eic        int     %8.0g                 VITA_EIC
rac             long    %12.0g                RAC
elderly         long    %12.0g                ELDERLY
a00100          long    %12.0g                A00100
n02650          long    %12.0g                N02650
a02650          long    %12.0g                A02650
n00200          long    %12.0g                N00200
a00200          long    %12.0g                A00200
n00300          long    %12.0g                N00300
a00300          long    %12.0g                A00300
n00400          long    %12.0g                N00400
a00400          long    %12.0g                A00400
n00600          long    %12.0g                N00600
a00600          long    %12.0g                A00600
n00650          long    %12.0g                N00650
a00650          long    %12.0g                A00650
n00700          long    %8.0g                 N00700
a00700          long    %8.0g                 A00700
n00900          long    %12.0g                N00900
a00900          long    %12.0g                A00900
n01000          long    %12.0g                N01000
a01000          long    %12.0g                A01000
n01400          long    %12.0g                N01400
a01400          long    %12.0g                A01400
n01700          long    %12.0g                N01700
a01700          long    %12.0g                A01700
schf            long    %8.0g                 SCHF
n02300          long    %12.0g                N02300
a02300          long    %12.0g                A02300
n02500          long    %12.0g                N02500
a02500          long    %12.0g                A02500
n26270          long    %12.0g                N26270
a26270          long    %12.0g                A26270
n25870          long    %12.0g                N25870
a25870          long    %12.0g                A25870
n02900          long    %12.0g                N02900
a02900          long    %12.0g                A02900
n03220          long    %12.0g                N03220
a03220          long    %8.0g                 A03220
n03300          long    %8.0g                 N03300
a03300          long    %12.0g                A03300
n03270          long    %8.0g                 N03270
a03270          long    %12.0g                A03270
n03150          long    %8.0g                 N03150
a03150          long    %12.0g                A03150
n03210          long    %12.0g                N03210
a03210          long    %12.0g                A03210
n04450          long    %12.0g                N04450
a04450          long    %12.0g                A04450
n04100          long    %12.0g                N04100
a04100          long    %12.0g                A04100
n04200          long    %12.0g                N04200
a04200          long    %12.0g                A04200
n04470          long    %12.0g                N04470
a04470          long    %12.0g                A04470
a00101          long    %12.0g                A00101
n17000          long    %8.0g                 N17000
a17000          long    %12.0g                A17000
n18425          long    %12.0g                N18425
a18425          long    %12.0g                A18425
n18450          long    %8.0g                 N18450
a18450          long    %8.0g                 A18450
n18500          long    %12.0g                N18500
a18500          long    %12.0g                A18500
n18800          long    %12.0g                N18800
a18800          long    %8.0g                 A18800
n18460          long    %12.0g                N18460
a18460          long    %12.0g                A18460
n18300          long    %12.0g                N18300
a18300          long    %12.0g                A18300
n19300          long    %12.0g                N19300
a19300          long    %12.0g                A19300
n19500          int     %8.0g                 N19500
a19500          long    %8.0g                 A19500
n19530          long    %8.0g                 N19530
a19530          long    %8.0g                 A19530
n19570          long    %8.0g                 N19570
a19570          long    %12.0g                A19570
n19700          long    %12.0g                N19700
a19700          long    %12.0g                A19700
n20950          long    %8.0g                 N20950
a20950          long    %12.0g                A20950
n04475          long    %12.0g                N04475
a04475          long    %12.0g                A04475
n04800          long    %12.0g                N04800
a04800          long    %12.0g                A04800
n05800          long    %12.0g                N05800
a05800          long    %12.0g                A05800
n09600          int     %8.0g                 N09600
a09600          long    %12.0g                A09600
n05780          long    %12.0g                N05780
a05780          long    %12.0g                A05780
n07100          long    %12.0g                N07100
a07100          long    %12.0g                A07100
n07300          long    %12.0g                N07300
a07300          long    %12.0g                A07300
n07180          long    %12.0g                N07180
a07180          long    %12.0g                A07180
n07230          long    %12.0g                N07230
a07230          long    %12.0g                A07230
n07240          long    %12.0g                N07240
a07240          long    %12.0g                A07240
n07225          long    %12.0g                N07225
a07225          long    %12.0g                A07225
n07260          long    %8.0g                 N07260
a07260          long    %12.0g                A07260
n09400          long    %12.0g                N09400
a09400          long    %12.0g                A09400
n85770          long    %12.0g                N85770
a85770          long    %12.0g                A85770
n85775          long    %12.0g                N85775
a85775          long    %12.0g                A85775
n10600          long    %12.0g                N10600
a10600          long    %12.0g                A10600
n59660          long    %12.0g                N59660
a59660          long    %12.0g                A59660
n59661          long    %12.0g                N59661
a59661          long    %12.0g                A59661
n59662          long    %12.0g                N59662
a59662          long    %12.0g                A59662
n59663          long    %12.0g                N59663
a59663          long    %12.0g                A59663
n59664          long    %12.0g                N59664
a59664          long    %12.0g                A59664
n59720          long    %12.0g                N59720
a59720          long    %12.0g                A59720
n11070          long    %12.0g                N11070
a11070          long    %12.0g                A11070
n10960          long    %12.0g                N10960
a10960          long    %12.0g                A10960
n11560          long    %8.0g                 N11560
a11560          long    %8.0g                 A11560
n06500          long    %12.0g                N06500
a06500          long    %12.0g                A06500
n10300          long    %12.0g                N10300
a10300          long    %12.0g                A10300
n85530          long    %12.0g                N85530
a85530          long    %12.0g                A85530
n85300          long    %12.0g                N85300
a85300          long    %12.0g                A85300
n11901          long    %12.0g                N11901
a11901          long    %12.0g                A11901
n11900          long    %12.0g                N11900
a11900          long    %12.0g                A11900
n11902          long    %12.0g                N11902
a11902          long    %12.0g                A11902
n12000          long    %12.0g                N12000
a12000          long    %12.0g                A12000
------------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
variable agi was long now double
(25,400 real changes made)
variable a_total_inc was long now double
(25,400 real changes made)
variable a_wage was long now double
(24,693 real changes made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all_22.dta saved

. 
. ** Append data 
. 
. ** Loop over years 
. forvalues y = 15(1)22 {
  2. 
.         ** Append 
.         append using "${data}working/irs_county_all_`y'"
  3.                 
.         } // END YEAR LOOP 
(variable county_name was str20, now str24 to accommodate using data's values)

.         
. ** Save file 
. save "${data}working/irs_county_all", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all.dta saved

.         
. ** Generate fips variable
. make_fips state_fips county_fips, gen(fips)

. 
. ** Save file 
. save "${data}working/irs_county_all", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all.dta saved

. 
. ********************************************************************************
. ** STEP 7: Import and Clean DOL Childcare Cost Data 
. ********************************************************************************
. 
. ** Import data 
. import excel using "${data}demographic/dol/NDCP2022.xlsx", firstrow case(lower) clear
(370 vars, 48,308 obs)

. 
. ** Drop if not in 50 states + DC 
. drop if state_fips == 72
(1,170 observations deleted)

. 
. ** Keep in year range 
. keep if inrange(studyyear, 2015, 2022)
(21,999 observations deleted)

. 
. ** Keep required variables 
. keep county_fips_code studyyear me      ///
>         mcinfant mctoddler mcpreschool  ///
>         mfccinfant mfcctoddler mfccpreschool

.         
. rename county_fips fips 

. rename studyyear year 

. 
. ** Fill-in missing variables 
. xtset fips year 

Panel variable: fips (unbalanced)
 Time variable: year, 2015 to 2022
         Delta: 1 unit

. tsfill, full

. 
. ** Interpotate
. foreach var of varlist me mc* mf* {
  2.         bys fips: ipolate `var' year, g(tmp1)
  3.         replace `var' = tmp1 if missing(`var')
  4.         drop tmp1
  5. } // END VAR LOOP 
(13 missing values generated)
(0 real changes made)
(2857 missing values generated)
(752 real changes made)
(2840 missing values generated)
(748 real changes made)
(2823 missing values generated)
(749 real changes made)
(3280 missing values generated)
(743 real changes made)
(3287 missing values generated)
(743 real changes made)
(3275 missing values generated)
(743 real changes made)

. 
. ** Generate value as a percent of median income 
. gen mc_infant_med = mcinfant / me 
(2,857 missing values generated)

. gen mc_toddler_med = mctoddler / me 
(2,840 missing values generated)

. gen mc_preschool_med = mcpreschool / me 
(2,823 missing values generated)

. gen mf_infant_med = mfccinfant / me 
(3,280 missing values generated)

. gen mf_toddler_med = mfcctoddler / me 
(3,287 missing values generated)

. gen mf_preschool_med = mfccpreschool / me 
(3,275 missing values generated)

. 
. ** Drop unnecc. variables 
. drop me mcinfant mctoddler mcpreschool mfcc* 

. 
. ** Inflate forwards by two years, by county and variable 
. local ct = ${end_year_acs} - 2022 + 1 

. expand `ct' if year == 2022
(6,288 observations created)

. by fips year, sort: replace year = year + _n - 1 if year == 2022 & _n > 1
(6,288 real changes made)

. 
. ** Get list of all counties 
. qui levelsof fips, local(fips)

. 
. ** Loop over variables
. foreach v of varlist mc_* mf_* {
  2.         
.         ** Replace 2023 + 2024 values with missings 
.     replace `v' = . if year > 2022
  3.         
.         ** Loop over all FIPS 
.     foreach c of local fips {
  4.                 
.                 quietly{
  5.                         
.                         ** Run if not missing too many observations 
.                         count if !missing(`v') & fips == `c' 
  6.                         if `r(N)' > 3 {
  7.                                 regress `v' year if fips == `c'
  8.                                 predict `v'_hat
  9.                                 replace `v' = `v'_hat if fips == `c' & year > 2022
 10.                                 drop `v'_hat
 11.                         } // END IF-STATEMENT
 12.                         else drop if fips == `c'
 13.                 } // END QUIET
 14.     } // END FIPS LOOP 
 15. } // END VAR LOOP 
(5,322 real changes made, 5,322 to missing)
(5,310 real changes made, 5,310 to missing)
(5,324 real changes made, 5,324 to missing)
(5,152 real changes made, 5,152 to missing)
(5,140 real changes made, 5,140 to missing)
(5,152 real changes made, 5,152 to missing)

. 
. ** Save file
. save "${data}working/dol_childcare", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/dol_childcare.dta saved

. 
. 
. ********************************************************************************
. ** STEP 8: Calculate County-Level Property Tax Rates from ACS Data
. ********************************************************************************
. 
. ** Load ACS migration file (contains proptx99, valueh, qproptx99, qvalueh)
. use "${data}working/acs_migration_file", clear

. 
. ** Keep household heads only (relate == 1 for household reference person)
. keep if relate == 1
(11,523,232 observations deleted)

. 
. ** Generate FIPS code for destination county
. gen fips = fips_d

. 
. ** Drop if missing FIPS
. drop if missing(fips)
(0 observations deleted)

. 
. ** Drop observations where PROPTX99 == 0 (N/A - not applicable)
. drop if proptx99 == 0
(3,538,913 observations deleted)

. 
. ** Convert PROPTX99 codes to dollar midpoint values
. ** Based on IPUMS coding scheme: https://usa.ipums.org/usa-action/variables/PROPTX99#codes_section
. gen proptx_dollars = .
(8,952,892 missing values generated)

. 
. ** Code 1: None (0)
. replace proptx_dollars = 0 if proptx99 == 1
(419,640 real changes made)

. 
. ** Code 2: $1-49 -> midpoint $25
. replace proptx_dollars = 25 if proptx99 == 2
(66,151 real changes made)

. 
. ** Codes 3-12: $50-99, $100-149, ... $500-549 (increments of 50, midpoints)
. forvalues i = 3/12 {
  2.     local lower = (`i' - 3) * 50 + 50
  3.     local upper = `lower' + 49
  4.     local midpoint = (`lower' + `upper') / 2
  5.     replace proptx_dollars = `midpoint' if proptx99 == `i'
  6. }
(61,747 real changes made)
(68,476 real changes made)
(59,441 real changes made)
(77,852 real changes made)
(62,086 real changes made)
(95,651 real changes made)
(71,811 real changes made)
(99,356 real changes made)
(67,217 real changes made)
(125,470 real changes made)

. 
. ** Codes 13-22: $550-599, $600-699, ... $1000-1099 (transitioning to $100 increments)
. replace proptx_dollars = 575 if proptx99 == 13
(58,866 real changes made)

. replace proptx_dollars = 650 if proptx99 == 14
(133,020 real changes made)

. replace proptx_dollars = 750 if proptx99 == 15
(66,547 real changes made)

. replace proptx_dollars = 850 if proptx99 == 16
(110,304 real changes made)

. replace proptx_dollars = 950 if proptx99 == 17
(65,921 real changes made)

. replace proptx_dollars = 1050 if proptx99 == 18
(144,998 real changes made)

. replace proptx_dollars = 1150 if proptx99 == 19
(61,433 real changes made)

. replace proptx_dollars = 1250 if proptx99 == 20
(116,654 real changes made)

. replace proptx_dollars = 1350 if proptx99 == 21
(59,011 real changes made)

. replace proptx_dollars = 1450 if proptx99 == 22
(226,521 real changes made)

. 
. ** Codes 23+: Higher ranges with $100 increments then $500/$1000 at top
. ** $1500-1599, $1600-1699, ... up to high values
. forvalues i = 23/62 {
  2.     local lower = (`i' - 23) * 100 + 1500
  3.     local upper = `lower' + 99
  4.     local midpoint = (`lower' + `upper') / 2
  5.     replace proptx_dollars = `midpoint' if proptx99 == `i'
  6. }
(131,332 real changes made)
(336,659 real changes made)
(165,059 real changes made)
(163,982 real changes made)
(243,773 real changes made)
(153,651 real changes made)
(127,376 real changes made)
(187,760 real changes made)
(101,576 real changes made)
(318,173 real changes made)
(89,835 real changes made)
(125,362 real changes made)
(101,814 real changes made)
(139,349 real changes made)
(222,116 real changes made)
(94,845 real changes made)
(77,048 real changes made)
(106,250 real changes made)
(54,428 real changes made)
(300,072 real changes made)
(46,524 real changes made)
(98,363 real changes made)
(57,043 real changes made)
(61,714 real changes made)
(164,160 real changes made)
(88,141 real changes made)
(48,743 real changes made)
(73,708 real changes made)
(37,840 real changes made)
(242,752 real changes made)
(30,279 real changes made)
(59,165 real changes made)
(37,313 real changes made)
(36,840 real changes made)
(0 real changes made)
(114,171 real changes made)
(35,379 real changes made)
(27,958 real changes made)
(54,035 real changes made)
(23,313 real changes made)

. 
. ** Codes 63+: Higher brackets ($5500+)
. replace proptx_dollars = 5750 if proptx99 == 63
(326,858 real changes made)

. replace proptx_dollars = 6250 if proptx99 == 64
(157,452 real changes made)

. replace proptx_dollars = 6750 if proptx99 == 65
(386,770 real changes made)

. replace proptx_dollars = 7250 if proptx99 == 66
(248,309 real changes made)

. replace proptx_dollars = 7750 if proptx99 == 67
(209,153 real changes made)

. replace proptx_dollars = 8500 if proptx99 == 68
(133,804 real changes made)

. replace proptx_dollars = 9500 if proptx99 == 69
(221,304 real changes made)

. 
. ** For codes 70+: Use approximate midpoints for higher brackets
. ** These are $10000+ ranges
. forvalues i = 70/100 {
  2.     if proptx_dollars == . & proptx99 == `i' {
  3.         local midpoint = 10000 + (`i' - 70) * 1000
  4.         replace proptx_dollars = `midpoint' if proptx99 == `i'
  5.     }
  6. }

. 
. ** Top codes (very high property taxes)
. replace proptx_dollars = 75000 if proptx99 >= 140 & proptx99 < 159
(0 real changes made)

. replace proptx_dollars = 100000 if proptx99 == 159
(0 real changes made)

. 
. ** Label variable
. label var proptx_dollars "Property tax ($ midpoint from PROPTX99 codes)"

. 
. ** Drop if property tax could not be assigned or home value is missing/zero
. drop if missing(proptx_dollars)
(373,168 observations deleted)

. drop if missing(valueh) | valueh == 0 | valueh == 9999999
(0 observations deleted)

. 
. ** Calculate property tax rate (as percentage of home value)
. gen prop_rate = 100 * proptx_dollars / valueh

. label var prop_rate "Property tax rate (% of home value)"

. 
. ** ============================================================================
. ** VERSION 1: Overall (all observations)
. ** ============================================================================
. preserve

. 
. ** Collapse to county X year, weighted by household weight
. collapse (mean) prop_rate_mean = prop_rate ///
>          (semean) prop_rate_se = prop_rate ///
>          (count) prop_rate_n = prop_rate ///
>          [fw = hhwt], by(year fips)

. 
. ** Label variables
. label var prop_rate_mean "Mean property tax rate (% of home value)"

. label var prop_rate_se "SE of property tax rate"

. label var prop_rate_n "Number of observations"

. 
. ** Generate state and county FIPS
. gen state_fips = floor(fips / 1000)

. gen county_fips = mod(fips, 1000)

. 
. ** Merge with county names
. merge m:1 state_fips county_fips using "${data}working/ids", keep(master match) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                           504
        from master                       504  
        from using                          0  

    Matched                             4,321  
    -----------------------------------------

. 
. ** Handle suppressed counties (county_fips == 0): merge state names and set county to "Other"
. merge m:1 state_fips using "${data}working/state_ids", keep(master match) update nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0

    Matched                             4,321
        not updated                     4,321  
        missing updated                     0  
        nonmissing conflict                 0  
    -----------------------------------------

. replace county_name = "Other" if county_fips == 0
(0 real changes made)

. 
. ** Order variables
. order year fips state_fips county_fips state_name county_name prop_rate_mean prop_rate_se prop_rate_
> n

. 
. ** Sort
. sort fips year

. 
. ** Save overall version
. save "${data}working/property_tax_rates_overall", replace
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/property_tax_rates_overall.dta
    saved

. 
. ** Export to CSV
. export delimited using "${data}working/property_tax_rates_overall.csv", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/property_tax_rates_overall.csv 
> saved

. 
. restore

. 
. ** ============================================================================
. ** VERSION 2: Excluding allocated values (qproptx99 != 4, qvalueh != 4)
. ** ============================================================================
. 
. ** Drop observations where values are allocated (quality flag == 4)
. drop if qprotx99 == 4
(1,223,562 observations deleted)

. drop if qvalueh == 4
(319,989 observations deleted)

. 
. ** Collapse to county X year, weighted by household weight
. collapse (mean) prop_rate_mean = prop_rate ///
>          (semean) prop_rate_se = prop_rate ///
>          (count) prop_rate_n = prop_rate ///
>          [fw = hhwt], by(year fips)

. 
. ** Label variables
. label var prop_rate_mean "Mean property tax rate (% of home value, excl. allocated)"

. label var prop_rate_se "SE of property tax rate (excl. allocated)"

. label var prop_rate_n "Number of observations (excl. allocated)"

. 
. ** Generate state and county FIPS
. gen state_fips = floor(fips / 1000)

. gen county_fips = mod(fips, 1000)

. 
. ** Merge with county names
. merge m:1 state_fips county_fips using "${data}working/ids", keep(master match) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                           504
        from master                       504  
        from using                          0  

    Matched                             4,321  
    -----------------------------------------

. 
. ** Handle suppressed counties (county_fips == 0): merge state names and set county to "Other"
. merge m:1 state_fips using "${data}working/state_ids", keep(master match) update nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0

    Matched                             4,321
        not updated                     4,321  
        missing updated                     0  
        nonmissing conflict                 0  
    -----------------------------------------

. replace county_name = "Other" if county_fips == 0
(0 real changes made)

. 
. ** Order variables
. order year fips state_fips county_fips state_name county_name prop_rate_mean prop_rate_se prop_rate_
> n

. 
. ** Sort
. sort fips year

. 
. ** Save version excluding allocated
. save "${data}working/property_tax_rates_excl_allocated", replace
(file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/property_tax_rates_excl_alloca
    > ted.dta not found)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/property_tax_rates_excl_alloca
    > ted.dta saved

. 
. ** Export to CSV
. export delimited using "${data}working/property_tax_rates_excl_allocated.csv", replace
(file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/property_tax_rates_excl_alloca
    > ted.csv not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/property_tax_rates_excl_allocat
> ed.csv saved

. 
. ** Display summary
. dis "Property tax rate calculation complete."
Property tax rate calculation complete.

. dis "Overall version saved to: ${data}working/property_tax_rates_overall.dta"
Overall version saved to: C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/property_t
> ax_rates_overall.dta

. dis "Excluding allocated saved to: ${data}working/property_tax_rates_excl_allocated.dta"
Excluding allocated saved to: C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/proper
> ty_tax_rates_excl_allocated.dta

. 
. clear

. 
. 
. ** Close log
. log close log_01
      name:  log_01
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/01_log_data_clean_multnoma
> h_2026-01-15.log
  log type:  text
 closed on:  15 Jan 2026, 16:34:05
------------------------------------------------------------------------------------------------------

. 
end of do-file

. do "C:\Users\ji252\Documents\GitHub\multnomah-county-tax\code\02_descriptives.do"

. /*******************************************************************************
> File Name:              02_descriptives.do
> Creator:                John Iselin
> Date Update:    January 15, 2026
> 
> Called by: 00_multnomah.do
> 
> Purpose: Perform descriptive analysis
> 
> Outputs:
> - multnomah_flow_comparison_[n1|n2|agi].dta/csv: Pre-post flow comparison with:
>   - Raw flows (out_pre, out_post, in_pre, in_post)
>   - Multnomah baseline population (pop_pre, pop_post)
>   - Migration rates as % of Multnomah population (out_rate_*, in_rate_*)
>   - Rate changes in percentage points (out_rate_change, in_rate_change, net_rate_change)
> 
> Authors: John Iselin
> 
> For more information, contact john.iselin@yale.edu
> 
> *******************************************************************************/
. 
. ** Start log file 
. capture log close log_02

. log using "${logs}02_log_descriptives_${date}", replace text name(log_02)
(file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_descriptives_2026-01-15.lo
    > g not found)
------------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_descriptives_2026-0
> 1-15.log
  log type:  text
 opened on:  15 Jan 2026, 16:36:42

. 
. ** Determine set of common in- and out-migration counties for Multnomah
. use ${data}working/irs_county_flow.dta, clear 

. 
. ** Tag Multnomah
. gen multnomah_o = (state_fips_o == 41 & county_fips_o == 51)

. gen multnomah_d = (state_fips_d == 41 & county_fips_d == 51)

. 
. ** Loop over samples 
. foreach x in "o" "d" {
  2.         
.         ** Preserve 
.         preserve 
  3.         
.         ** Keep Multnomah
.         keep if multnomah_`x' == 1 
  4.         
.         ** Export data 
.         export excel using "${data}multnomah.xlsx",     ///
>                 sheet(irs_`x', replace ) firstrow(variables) 
  5.                 
.         ** Clear and restore 
.         clear 
  6.         restore
  7.                 
. } // END ORIGIN-DESTINATION LOOP 
(361,546 observations deleted)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/multnomah.xlsx saved
(361,434 observations deleted)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/multnomah.xlsx saved

. 
. ** Determine set of common in- and out-migration counties for Multnomah
. use ${data}working/acs_county_flow.dta, clear 

. 
. ** Tag Multnomah
. gen multnomah_o = (state_fips_o == 41 & county_fips_o == 51)

. gen multnomah_d = (state_fips_d == 41 & county_fips_d == 51)

. 
. ** Loop over samples 
. foreach x in "o" "d" {
  2.         
.         ** Preserve 
.         preserve 
  3.         
.         ** Keep Multnomah
.         keep if multnomah_`x' == 1 
  4.         
.         ** Export data 
.         export excel using "${data}multnomah.xlsx",     ///
>                 sheet(acs_`x', replace ) firstrow(variables) 
  5.                 
.         ** Clear and restore 
.         clear 
  6.         restore
  7.                 
. } // END ORIGIN-DESTINATION LOOP 
(230,904 observations deleted)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/multnomah.xlsx saved
(230,847 observations deleted)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/multnomah.xlsx saved

. 
. /*******************************************************************************
> SECTION 2: PRE-POST FLOW COMPARISON (2018-2019 vs 2021-2022)
> Purpose: Compare IRS migration flows to/from Multnomah County before and after
>          the 2020 tax change. Creates datasets and exports CSVs for mapping.
>          Includes both raw flows and rates (flow / Multnomah population).
> *******************************************************************************/
. 
. ** ----------------------------------------------------------------
. ** GET MULTNOMAH BASELINE POPULATION FOR RATE CALCULATIONS
. ** ----------------------------------------------------------------
. 
. ** Load gross data to get Multnomah's total population by period
. use "${data}working/irs_county_gross", clear

. 
. ** Keep only Multnomah County
. keep if state_fips == 41 & county_fips == 51
(21,973 observations deleted)

. 
. ** Keep only pre and post periods
. gen period = ""
(7 missing values generated)

. replace period = "pre" if inlist(year, 2018, 2019)
variable period was str1 now str3
(2 real changes made)

. replace period = "post" if inlist(year, 2021, 2022)
variable period was str3 now str4
(2 real changes made)

. keep if period != ""
(3 observations deleted)

. 
. ** Calculate base population (non-movers + all movers = total filers)
. gen n1_base = n1_out_1 + n1_out_2

. gen n2_base = n2_out_1 + n2_out_2

. gen agi_base = agi_out_1 + agi_out_2

. 
. ** Collapse to get average by period
. collapse (mean) n1_base n2_base agi_base, by(period)

. 
. ** Store population values in locals for later use
. summ n1_base if period == "pre", meanonly

. local n1_pop_pre = r(mean)

. summ n1_base if period == "post", meanonly

. local n1_pop_post = r(mean)

. 
. summ n2_base if period == "pre", meanonly

. local n2_pop_pre = r(mean)

. summ n2_base if period == "post", meanonly

. local n2_pop_post = r(mean)

. 
. summ agi_base if period == "pre", meanonly

. local agi_pop_pre = r(mean)

. summ agi_base if period == "post", meanonly

. local agi_pop_post = r(mean)

. 
. ** Display population values for log
. dis "Multnomah County baseline populations:"
Multnomah County baseline populations:

. dis "  n1 (returns): pre = `n1_pop_pre', post = `n1_pop_post'"
  n1 (returns): pre = 339804, post = 352539.5

. dis "  n2 (exemptions): pre = `n2_pop_pre', post = `n2_pop_post'"
  n2 (exemptions): pre = 619925.5, post = 611226

. dis "  agi: pre = `agi_pop_pre', post = `agi_pop_post'"
  agi: pre = 28851868, post = 33774184

. 
. clear

. 
. ** ----------------------------------------------------------------
. ** LOAD FLOW DATA AND CREATE COMPARISON DATASETS
. ** ----------------------------------------------------------------
. 
. ** Load IRS flow data
. use ${data}working/irs_county_flow.dta, clear

. 
. ** Define Multnomah County FIPS
. local multnomah_fips = 41051

. 
. ** Define pre and post periods
. local pre_years "2018 2019"

. local post_years "2021 2022"

. 
. ** Create period indicator
. gen period = ""
(362,678 missing values generated)

. replace period = "pre" if inlist(year, 2018, 2019)
variable period was str1 now str3
(97,023 real changes made)

. replace period = "post" if inlist(year, 2021, 2022)
variable period was str3 now str4
(107,196 real changes made)

. 
. ** Keep only pre and post periods
. keep if period != ""
(158,459 observations deleted)

. 
. ** Loop over each measure to create separate datasets
. foreach measure in "n1" "n2" "agi" {
  2. 
.         ** Display status
.         dis "Creating flow comparison dataset for `measure'..."
  3. 
.         ** Preserve original data
.         preserve
  4. 
.         ** ----------------------------------------------------------------
.         ** OUT-MIGRATION: Flows FROM Multnomah TO other counties
.         ** ----------------------------------------------------------------
. 
.         ** Keep flows where Multnomah is the origin
.         keep if fips_o == `multnomah_fips'
  5. 
.         ** Collapse to sum flows by destination county and period
.         collapse (sum) `measure', by(fips_d period)
  6. 
.         ** Reshape to wide format (pre and post as columns)
.         reshape wide `measure', i(fips_d) j(period) string
  7. 
.         ** Rename for clarity
.         rename fips_d fips
  8.         rename `measure'pre out_pre
  9.         rename `measure'post out_post
 10. 
.         ** Save temp file for out-migration
.         tempfile out_flows
 11.         save `out_flows'
 12. 
.         ** ----------------------------------------------------------------
.         ** IN-MIGRATION: Flows TO Multnomah FROM other counties
.         ** ----------------------------------------------------------------
. 
.         ** Restore and start fresh
.         restore
 13.         preserve
 14. 
.         ** Keep flows where Multnomah is the destination
.         keep if fips_d == `multnomah_fips'
 15. 
.         ** Collapse to sum flows by origin county and period
.         collapse (sum) `measure', by(fips_o period)
 16. 
.         ** Reshape to wide format
.         reshape wide `measure', i(fips_o) j(period) string
 17. 
.         ** Rename for clarity
.         rename fips_o fips
 18.         rename `measure'pre in_pre
 19.         rename `measure'post in_post
 20. 
.         ** ----------------------------------------------------------------
.         ** MERGE: Combine in and out flows
.         ** ----------------------------------------------------------------
. 
.         ** Merge with out-migration flows
.         merge 1:1 fips using `out_flows', nogen
 21. 
.         ** Replace missing with 0 (counties with flows in only one direction)
.         foreach var of varlist out_pre out_post in_pre in_post {
 22.                 replace `var' = 0 if missing(`var')
 23.         }
 24. 
.         ** ----------------------------------------------------------------
.         ** ADD MULTNOMAH BASELINE POPULATION
.         ** ----------------------------------------------------------------
. 
.         ** Add Multnomah population for pre and post periods
.         gen pop_pre = ``measure'_pop_pre'
 25.         gen pop_post = ``measure'_pop_post'
 26. 
.         ** ----------------------------------------------------------------
.         ** CALCULATE RATES (flow / population * 100)
.         ** ----------------------------------------------------------------
. 
.         ** Out-migration rates (% of Multnomah population moving to each county)
.         gen out_rate_pre = 100 * out_pre / pop_pre
 27.         gen out_rate_post = 100 * out_post / pop_post
 28. 
.         ** In-migration rates (% of Multnomah population represented by in-migrants)
.         gen in_rate_pre = 100 * in_pre / pop_pre
 29.         gen in_rate_post = 100 * in_post / pop_post
 30. 
.         ** Calculate rate changes
.         gen out_rate_change = out_rate_post - out_rate_pre
 31.         gen in_rate_change = in_rate_post - in_rate_pre
 32.         gen net_rate_change = in_rate_change - out_rate_change
 33. 
.         ** Order columns
.         order fips pop_pre pop_post ///
>                 out_pre out_post out_rate_pre out_rate_post out_rate_change ///
>                 in_pre in_post in_rate_pre in_rate_post in_rate_change net_rate_change
 34. 
.         ** Sort by fips
.         sort fips
 35. 
.         ** Label variables
.         label var fips "County FIPS code"
 36.         label var pop_pre "Multnomah baseline population (2018-2019 avg)"
 37.         label var pop_post "Multnomah baseline population (2021-2022 avg)"
 38.         label var out_pre "Out-migration from Multnomah (2018-2019)"
 39.         label var out_post "Out-migration from Multnomah (2021-2022)"
 40.         label var out_rate_pre "Out-migration rate (%, 2018-2019)"
 41.         label var out_rate_post "Out-migration rate (%, 2021-2022)"
 42.         label var out_rate_change "Change in out-migration rate (pp)"
 43.         label var in_pre "In-migration to Multnomah (2018-2019)"
 44.         label var in_post "In-migration to Multnomah (2021-2022)"
 45.         label var in_rate_pre "In-migration rate (%, 2018-2019)"
 46.         label var in_rate_post "In-migration rate (%, 2021-2022)"
 47.         label var in_rate_change "Change in in-migration rate (pp)"
 48.         label var net_rate_change "Change in net migration rate (pp)"
 49. 
.         ** Save Stata dataset to working directory (for R mapping)
.         save "${data}working/multnomah_flow_comparison_`measure'.dta", replace
 50. 
.         ** Export to CSV for R mapping
.         export delimited using "${data}working/multnomah_flow_comparison_`measure'.csv", replace
 51. 
.         ** Display summary statistics
.         dis "Summary for `measure' - Raw flows:"
 52.         summ out_pre out_post in_pre in_post
 53. 
.         dis "Summary for `measure' - Rates (%):"
 54.         summ out_rate_pre out_rate_post in_rate_pre in_rate_post
 55. 
.         dis "Summary for `measure' - Rate changes (pp):"
 56.         summ out_rate_change in_rate_change net_rate_change
 57. 
.         ** Restore original data for next measure
.         restore
 58. 
. } // END MEASURE LOOP
Creating flow comparison dataset for n1...
(203,572 observations deleted)
(j = post pre)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations              355   ->   202         
Number of variables                   3   ->   3           
j variable (2 values)            period   ->   (dropped)
xij variables:
                                     n1   ->   n1post n1pre
-----------------------------------------------------------------------------
file C:\Users\ji252\AppData\Local\Temp\ST_4058_000006.tmp saved as .dta format
(203,528 observations deleted)
(j = post pre)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations              379   ->   202         
Number of variables                   3   ->   3           
j variable (2 values)            period   ->   (dropped)
xij variables:
                                     n1   ->   n1post n1pre
-----------------------------------------------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                            58
        from master                        29  
        from using                         29  

    Matched                               173  
    -----------------------------------------
(75 real changes made)
(32 real changes made)
(36 real changes made)
(47 real changes made)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_n1.d
    > ta saved
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_n1.cs
> v saved
Summary for n1 - Raw flows:

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     out_pre |        231     217.658     999.888          0      10579
    out_post |        231    258.5541    1107.284          0      11770
      in_pre |        231    223.6537    835.9653          0       8773
     in_post |        231    225.6753    816.5126          0       8572
Summary for n1 - Rates (%):

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
out_rate_pre |        231     .064054    .2942543          0   3.113265
out_rate_p~t |        231    .0733405    .3140879          0   3.338633
 in_rate_pre |        231    .0658184     .246014          0   2.581782
in_rate_post |        231    .0640142    .2316088          0   2.431501
Summary for n1 - Rate changes (pp):

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
out_rate_c~e |        231    .0092865    .0249054  -.0161129   .2473493
in_rate_ch~e |        231   -.0018042    .0197721  -.1981459   .0960742
net_rate_c~e |        231   -.0110907    .0391617  -.4235137   .0636027
Creating flow comparison dataset for n2...
(203,572 observations deleted)
(j = post pre)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations              355   ->   202         
Number of variables                   3   ->   3           
j variable (2 values)            period   ->   (dropped)
xij variables:
                                     n2   ->   n2post n2pre
-----------------------------------------------------------------------------
file C:\Users\ji252\AppData\Local\Temp\ST_4058_000009.tmp saved as .dta format
(203,528 observations deleted)
(j = post pre)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations              379   ->   202         
Number of variables                   3   ->   3           
j variable (2 values)            period   ->   (dropped)
xij variables:
                                     n2   ->   n2post n2pre
-----------------------------------------------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                            58
        from master                        29  
        from using                         29  

    Matched                               173  
    -----------------------------------------
(75 real changes made)
(32 real changes made)
(36 real changes made)
(47 real changes made)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_n2.d
    > ta saved
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_n2.cs
> v saved
Summary for n2 - Raw flows:

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     out_pre |        231    345.1342    1677.485          0      18690
    out_post |        231    398.8095    1806.828          0      20381
      in_pre |        231    322.4978    1252.515          0      12631
     in_post |        231    310.0649    1160.729          0      11789
Summary for n2 - Rates (%):

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
out_rate_pre |        231    .0556735    .2705946          0   3.014879
out_rate_p~t |        231    .0652475    .2956072          0   3.334446
 in_rate_pre |        231     .052022    .2020428          0   2.037503
in_rate_post |        231    .0507284    .1899018          0   1.928746
Summary for n2 - Rate changes (pp):

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
out_rate_c~e |        231     .009574    .0280899  -.0120743   .3195674
in_rate_ch~e |        231   -.0012937    .0163673  -.1644121   .0814157
net_rate_c~e |        231   -.0108676    .0414007  -.4839796   .0637089
Creating flow comparison dataset for agi...
(203,572 observations deleted)
(j = post pre)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations              355   ->   202         
Number of variables                   3   ->   3           
j variable (2 values)            period   ->   (dropped)
xij variables:
                                    agi   ->   agipost agipre
-----------------------------------------------------------------------------
file C:\Users\ji252\AppData\Local\Temp\ST_4058_00000c.tmp saved as .dta format
(203,528 observations deleted)
(j = post pre)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations              379   ->   202         
Number of variables                   3   ->   3           
j variable (2 values)            period   ->   (dropped)
xij variables:
                                    agi   ->   agipost agipre
-----------------------------------------------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                            58
        from master                        29  
        from using                         29  

    Matched                               173  
    -----------------------------------------
(75 real changes made)
(32 real changes made)
(36 real changes made)
(47 real changes made)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_agi.
    > dta saved
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_agi.c
> sv saved
Summary for agi - Raw flows:

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     out_pre |        231     15245.4    71845.05          0     727846
    out_post |        231    24860.27    109864.8          0    1170383
      in_pre |        231    14641.75     53537.6          0     592707
     in_post |        231    16286.22    58385.22          0     662028
Summary for agi - Rates (%):

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
out_rate_pre |        231    .0528403    .2490135          0     2.5227
out_rate_p~t |        231    .0736073    .3252922          0   3.465318
 in_rate_pre |        231     .050748    .1855602          0   2.054311
in_rate_post |        231    .0482209    .1728694          0    1.96016
Summary for agi - Rate changes (pp):

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
out_rate_c~e |        231     .020767    .0989045  -.0461846   .9903069
in_rate_ch~e |        231   -.0025271    .0244645  -.2139035   .0881895
net_rate_c~e |        231   -.0232941      .11679  -1.170827   .1055987

. 
. dis "Flow comparison datasets created and exported to ${results}flows/"
Flow comparison datasets created and exported to C:/Users/ji252/Documents/GitHub/multnomah-county-tax/
> results/flows/

. 
. ** Close log
. clear

. log close log_02
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_descriptives_2026-0
> 1-15.log
  log type:  text
 closed on:  15 Jan 2026, 16:36:44
------------------------------------------------------------------------------------------------------

. 
end of do-file

. do "C:\Users\ji252\AppData\Local\Temp\STD4058_000003.tmp"

. /*******************************************************************************
> File Name:              02_flow_analysis.do
> Creator:                John Iselin
> Date Update:    January 15, 2026
> 
> Called by: 00_multnomah.do
> 
> Purpose: Perform flow-based analysis on IRS data.
> 
> Outputs:
> - county_did_coefficients.dta/csv: DiD coefficients for all counties
>   (b_out, b_in, se_out, se_in, t-stats, p-values, percentile ranks)
> - fig_multnomah_post_*.png: DiD coefficient plots for Multnomah
> - fig_hist_out_coef.png: Histogram of out-migration coefficients
> - fig_hist_in_coef.png: Histogram of in-migration coefficients
> - fig_scatter_out_in_coef.png: Scatter plot of out vs in coefficients
> - fig_multnomah_out_*.png: Event study plots for out-migration
> - fig_multnomah_in_*.png: Event study plots for in-migration
> - fig_multnomah_both_*.png: Combined event study plots
> 
> Authors: John Iselin
> 
> For more information, contact john.iselin@yale.edu
> 
> *******************************************************************************/
. 
. 
. ** Start log file
. capture log close log_02

. log using "${logs}02_log_flow_${date}", replace text name(log_02)
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_flow_2026-01-15.log not
    found)
------------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_flow_2026-01-15.log
  log type:  text
 opened on:  15 Jan 2026, 16:49:02

. 
. ** Parameters
. local reps = 100

. 
. ** Load IRS Data
. use "${data}working/irs_county_flow.dta", clear

. 
. ** Sample restrictions
. drop if inlist(state_fips_o, 2, 15)     // Alaska and Hawaii
(3,109 observations deleted)

. drop if inlist(state_fips_d, 2, 15)     // Alaska and Hawaii
(2,293 observations deleted)

. 
. ** Clean up variables
. drop fips

. 
. ** Merge with time-varying controls
. 
. ** Keep if in donor pool in both origin and destination
. foreach x in "o" "d" {
  2. 
.         ** Merge with relevent variables
.         gen fips = fips_`x'
  3.         merge m:1 year fips using "${data}working/bls_unemployment",    ///
>                 keep(match) gen(merge_bls_`x')
  4.         merge m:1 year fips using "${data}working/bea_economics",               ///
>                 keep(match) gen(merge_bea_`x')
  5. 
.         ** Rename
.         rename unemp unemp_`x'
  6.         rename population pop_`x'
  7.         rename per_capita_income per_capita_income_`x'
  8.         drop fips
  9. 
. } // END ORIGIN-DESTINATION LOOP
(variable fips was float, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           353,742  (merge_bls_o==3)
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           348,116  (merge_bea_o==3)
    -----------------------------------------
(variable fips was float, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           345,941  (merge_bls_d==3)
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           342,102  (merge_bea_d==3)
    -----------------------------------------

. 
. 
. ** Mover indicators
. gen mover = fips_o != fips_d

. 
. ** Generate flow id
. egen flow_id = group(fips_d fips_o)

. 
. ** Multnomah indicators
. gen out_multnomah = (state_fips_o == 41 & county_fips_o == 51)

. gen in_multnomah = (state_fips_d == 41 & county_fips_d == 51)

. 
. ** Post-indicators
. gen post = year > 2020

. 
. ** Interactions
. gen in_multnomah_post = in_multnomah * post

. gen out_multnomah_post = out_multnomah * post

. 
. ** Create interactions manually (base year = 2020)
. forvalues y = 2016/2022 {
  2.         gen x_out_`y' = out_multnomah * (year == `y')
  3.         gen x_in_`y' = in_multnomah * (year == `y')
  4. }

. 
. ** Drop base year (2020)
. drop x_out_2020 x_in_2020  

. 
. ********************************************************************************
. ** REGRESSION 1: Multnomah X Post (DiD)
. ********************************************************************************
. 
. ** Data cleaning 
. replace agi = 0 if agi < 0 
(86 real changes made)

. 
. ** Loop over outcome variables
. foreach outcome in n1 n2 agi {
  2. 
.         ** Set outcome label for graphs
.         if "`outcome'" == "n1" local outcome_label "Number of Returns"
  3.         if "`outcome'" == "n2" local outcome_label "Number of Exemptions"
  4.         if "`outcome'" == "agi" local outcome_label "Adjusted Gross Income"
  5. 
.         ** Regression 1a: With covariates
.         ppmlhdfe `outcome' i.out_multnomah_post i.in_multnomah_post     ///
>                 unemp_* pop_* per_capita_income_*                                                   
>     ///
>                 if mover == 1,                                                                      
>                     ///
>                 absorb(year flow_id) vce(cluster flow_id)
  6.         estimates store `outcome'_with_covars
  7. 
.         ** Regression 1b: Without covariates
.         ppmlhdfe `outcome' i.out_multnomah_post i.in_multnomah_post     ///
>                 if mover == 1,                                                                      
>                     ///
>                 absorb(year flow_id) vce(cluster flow_id)
  8.         estimates store `outcome'_no_covars
  9.         
.         ** Plot both regressions
.         coefplot        (`outcome'_with_covars, label("With Covariates")        ///
>                                         mc(navy) ciopts(lc(navy)))                                  
>             ///
>                                 (`outcome'_no_covars, label("Without Covariates")       ///
>                                         mc(maroon) ciopts(lc(maroon))),                             
>     ///
>                 keep(1.out_multnomah_post 1.in_multnomah_post)                          ///
>                 ciopts(recast(rcap))                                                                
>             ///
>                 yline(0, lc(gs10) lp(dash))                                                         
>     ///
>                 xline(0, lc(gs10) lp(dash))                                                         
>     ///
>                 coeflabels(     1.out_multnomah_post = "Out-migration"                  ///
>                                         1.in_multnomah_post = "In-migration")                   ///
>                 ytitle("Coefficient")                                                               
>             ///
>                 xtitle("")                                                                          
>                             ///
>                 legend(pos(6) rows(1))                                                              
>             ///
>                 title("Migration Flows: Multnomah County x Post")                       ///
>                 subtitle("`outcome_label'")                                                         
>             ///
>                 graphregion(color(white))
 10. 
.         graph export "${results}flows/fig_multnomah_post_`outcome'.png", replace
 11. 
. 
. } // END OUTCOME LOOP
(dropped 10447 observations that are either singletons or separated by a fixed effect)
Iteration 1:   deviance = 2.8754e+06  eps = .         iters = 4    tol = 1.0e-04  min(eta) =  -2.82  P
>    
Iteration 2:   deviance = 6.3174e+05  eps = 3.55e+00  iters = 3    tol = 1.0e-04  min(eta) =  -3.25   
>    
Iteration 3:   deviance = 5.8911e+05  eps = 7.24e-02  iters = 3    tol = 1.0e-04  min(eta) =  -3.39   
>    
Iteration 4:   deviance = 5.8906e+05  eps = 8.34e-05  iters = 2    tol = 1.0e-04  min(eta) =  -3.40   
>    
Iteration 5:   deviance = 5.8906e+05  eps = 5.95e-10  iters = 2    tol = 1.0e-05  min(eta) =  -3.40   
>    
Iteration 6:   deviance = 5.8906e+05  eps = 1.93e-16  iters = 1    tol = 1.0e-06  min(eta) =  -3.40   
> S  
Iteration 7:   deviance = 5.8906e+05  eps = 0.00e+00  iters = 1    tol = 1.0e-09  min(eta) =  -3.40   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 7 iterations and 16 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    331,655
Absorbing 2 HDFE groups                           Residual df     =     57,484
Statistics robust to heteroskedasticity           Wald chi2(8)    =    1117.95
Deviance             =  589060.4702               Prob > chi2     =     0.0000
Log pseudolikelihood = -1266915.146               Pseudo R2       =     0.9778

Number of clusters (flow_id)=     57,485
                                   (Std. err. adjusted for 57,485 clusters in flow_id)
--------------------------------------------------------------------------------------
                     |               Robust
                  n1 | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
---------------------+----------------------------------------------------------------
1.out_multnomah_post |   .0112807    .022745     0.50   0.620    -.0332988    .0558601
 1.in_multnomah_post |  -.0763629   .0162191    -4.71   0.000    -.1081518    -.044574
             unemp_o |   .0234736   .0009508    24.69   0.000     .0216101     .025337
             unemp_d |  -.0210478    .000978   -21.52   0.000    -.0229646   -.0191309
               pop_o |   6.38e-08   3.11e-08     2.05   0.040     2.80e-09    1.25e-07
               pop_d |   3.63e-07   3.24e-08    11.20   0.000     3.00e-07    4.27e-07
 per_capita_income_o |   2.13e-06   3.64e-07     5.86   0.000     1.42e-06    2.84e-06
 per_capita_income_d |  -1.56e-06   2.83e-07    -5.51   0.000    -2.12e-06   -1.01e-06
               _cons |   5.640978   .0535479   105.34   0.000     5.536026     5.74593
--------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     57485       57485           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 10447 observations that are either singletons or separated by a fixed effect)
Iteration 1:   deviance = 2.9001e+06  eps = .         iters = 4    tol = 1.0e-04  min(eta) =  -2.75  P
>    
Iteration 2:   deviance = 6.5484e+05  eps = 3.43e+00  iters = 3    tol = 1.0e-04  min(eta) =  -3.22   
>    
Iteration 3:   deviance = 6.1220e+05  eps = 6.97e-02  iters = 3    tol = 1.0e-04  min(eta) =  -3.36   
>    
Iteration 4:   deviance = 6.1215e+05  eps = 8.01e-05  iters = 2    tol = 1.0e-04  min(eta) =  -3.37   
>    
Iteration 5:   deviance = 6.1215e+05  eps = 5.70e-10  iters = 2    tol = 1.0e-05  min(eta) =  -3.37   
>    
Iteration 6:   deviance = 6.1215e+05  eps = 0.00e+00  iters = 1    tol = 1.0e-06  min(eta) =  -3.37   
> S  
Iteration 7:   deviance = 6.1215e+05  eps = 1.86e-16  iters = 1    tol = 1.0e-09  min(eta) =  -3.37   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 7 iterations and 16 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    331,655
Absorbing 2 HDFE groups                           Residual df     =     57,484
Statistics robust to heteroskedasticity           Wald chi2(2)    =      32.03
Deviance             =  612152.2382               Prob > chi2     =     0.0000
Log pseudolikelihood =  -1278461.03               Pseudo R2       =     0.9776

Number of clusters (flow_id)=     57,485
                                   (Std. err. adjusted for 57,485 clusters in flow_id)
--------------------------------------------------------------------------------------
                     |               Robust
                  n1 | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
---------------------+----------------------------------------------------------------
1.out_multnomah_post |   .0182474   .0234116     0.78   0.436    -.0276384    .0641333
 1.in_multnomah_post |  -.0863437   .0154255    -5.60   0.000    -.1165772   -.0561103
               _cons |   6.165859   .0000373  1.7e+05   0.000     6.165786    6.165932
--------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     57485       57485           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_multnomah_post_n1.png
    saved as PNG format
(dropped 10447 observations that are either singletons or separated by a fixed effect)
Iteration 1:   deviance = 5.4787e+06  eps = .         iters = 4    tol = 1.0e-04  min(eta) =  -2.91  P
>    
Iteration 2:   deviance = 1.4132e+06  eps = 2.88e+00  iters = 3    tol = 1.0e-04  min(eta) =  -3.54   
>    
Iteration 3:   deviance = 1.3306e+06  eps = 6.20e-02  iters = 3    tol = 1.0e-04  min(eta) =  -3.81   
>    
Iteration 4:   deviance = 1.3305e+06  eps = 1.14e-04  iters = 2    tol = 1.0e-04  min(eta) =  -3.85   
>    
Iteration 5:   deviance = 1.3305e+06  eps = 4.79e-09  iters = 1    tol = 1.0e-04  min(eta) =  -3.85   
>    
Iteration 6:   deviance = 1.3305e+06  eps = 1.67e-14  iters = 1    tol = 1.0e-05  min(eta) =  -3.85   
> S  
Iteration 7:   deviance = 1.3305e+06  eps = 1.55e-16  iters = 2    tol = 1.0e-09  min(eta) =  -3.85   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 7 iterations and 16 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    331,655
Absorbing 2 HDFE groups                           Residual df     =     57,484
Statistics robust to heteroskedasticity           Wald chi2(8)    =    1091.86
Deviance             =   1330486.72               Prob > chi2     =     0.0000
Log pseudolikelihood = -1733747.739               Pseudo R2       =     0.9830

Number of clusters (flow_id)=     57,485
                                   (Std. err. adjusted for 57,485 clusters in flow_id)
--------------------------------------------------------------------------------------
                     |               Robust
                  n2 | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
---------------------+----------------------------------------------------------------
1.out_multnomah_post |    .015437    .020791     0.74   0.458    -.0253127    .0561866
 1.in_multnomah_post |  -.0740198   .0154241    -4.80   0.000    -.1042505   -.0437892
             unemp_o |   .0221146   .0009958    22.21   0.000     .0201629    .0240664
             unemp_d |  -.0230597   .0010507   -21.95   0.000    -.0251189   -.0210004
               pop_o |   5.15e-08   3.16e-08     1.63   0.103    -1.04e-08    1.13e-07
               pop_d |   3.62e-07   3.00e-08    12.05   0.000     3.03e-07    4.20e-07
 per_capita_income_o |   2.54e-06   3.76e-07     6.76   0.000     1.80e-06    3.28e-06
 per_capita_income_d |  -2.02e-06   3.03e-07    -6.64   0.000    -2.61e-06   -1.42e-06
               _cons |   6.280974    .053925   116.48   0.000     6.175282    6.386665
--------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     57485       57485           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 10447 observations that are either singletons or separated by a fixed effect)
Iteration 1:   deviance = 5.5233e+06  eps = .         iters = 4    tol = 1.0e-04  min(eta) =  -2.89  P
>    
Iteration 2:   deviance = 1.4553e+06  eps = 2.80e+00  iters = 3    tol = 1.0e-04  min(eta) =  -3.50   
>    
Iteration 3:   deviance = 1.3728e+06  eps = 6.01e-02  iters = 3    tol = 1.0e-04  min(eta) =  -3.76   
>    
Iteration 4:   deviance = 1.3726e+06  eps = 1.10e-04  iters = 2    tol = 1.0e-04  min(eta) =  -3.80   
>    
Iteration 5:   deviance = 1.3726e+06  eps = 4.60e-09  iters = 1    tol = 1.0e-04  min(eta) =  -3.80   
>    
Iteration 6:   deviance = 1.3726e+06  eps = 1.60e-14  iters = 1    tol = 1.0e-05  min(eta) =  -3.80   
> S  
Iteration 7:   deviance = 1.3726e+06  eps = 0.00e+00  iters = 1    tol = 1.0e-09  min(eta) =  -3.80   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 7 iterations and 15 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    331,655
Absorbing 2 HDFE groups                           Residual df     =     57,484
Statistics robust to heteroskedasticity           Wald chi2(2)    =      35.14
Deviance             =  1372638.294               Prob > chi2     =     0.0000
Log pseudolikelihood = -1754823.525               Pseudo R2       =     0.9828

Number of clusters (flow_id)=     57,485
                                   (Std. err. adjusted for 57,485 clusters in flow_id)
--------------------------------------------------------------------------------------
                     |               Robust
                  n2 | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
---------------------+----------------------------------------------------------------
1.out_multnomah_post |   .0218918   .0207797     1.05   0.292    -.0188356    .0626192
 1.in_multnomah_post |  -.0864384    .014852    -5.82   0.000    -.1155479    -.057329
               _cons |   6.749585   .0000282  2.4e+05   0.000      6.74953     6.74964
--------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     57485       57485           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_multnomah_post_n2.png
    saved as PNG format
(dropped 10447 observations that are either singletons or separated by a fixed effect)
Iteration 1:   deviance = 4.0054e+08  eps = .         iters = 4    tol = 1.0e-04  min(eta) =  -3.59  P
>    
Iteration 2:   deviance = 1.6976e+08  eps = 1.36e+00  iters = 3    tol = 1.0e-04  min(eta) =  -4.22   
>    
Iteration 3:   deviance = 1.6099e+08  eps = 5.44e-02  iters = 3    tol = 1.0e-04  min(eta) =  -5.14   
>    
Iteration 4:   deviance = 1.6087e+08  eps = 7.90e-04  iters = 2    tol = 1.0e-04  min(eta) =  -5.94   
>    
Iteration 5:   deviance = 1.6086e+08  eps = 3.38e-06  iters = 2    tol = 1.0e-04  min(eta) =  -6.50   
>    
Iteration 6:   deviance = 1.6086e+08  eps = 5.80e-08  iters = 2    tol = 1.0e-05  min(eta) =  -6.73   
> S  
Iteration 7:   deviance = 1.6086e+08  eps = 6.22e-10  iters = 2    tol = 1.0e-07  min(eta) =  -6.76   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 7 iterations and 18 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    331,655
Absorbing 2 HDFE groups                           Residual df     =     57,484
Statistics robust to heteroskedasticity           Wald chi2(8)    =     369.69
Deviance             =  160864664.2               Prob > chi2     =     0.0000
Log pseudolikelihood = -82077725.61               Pseudo R2       =     0.9826

Number of clusters (flow_id)=     57,485
                                   (Std. err. adjusted for 57,485 clusters in flow_id)
--------------------------------------------------------------------------------------
                     |               Robust
                 agi | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
---------------------+----------------------------------------------------------------
1.out_multnomah_post |   .1613764   .0553811     2.91   0.004     .0528315    .2699214
 1.in_multnomah_post |  -.1838134   .0212845    -8.64   0.000    -.2255303   -.1420964
             unemp_o |   .0423607   .0054837     7.72   0.000     .0316128    .0531085
             unemp_d |  -.0442395   .0038193   -11.58   0.000    -.0517253   -.0367538
               pop_o |  -2.80e-07   6.37e-08    -4.39   0.000    -4.05e-07   -1.55e-07
               pop_d |   4.64e-07   7.73e-08     6.00   0.000     3.12e-07    6.15e-07
 per_capita_income_o |   8.22e-06   9.26e-07     8.88   0.000     6.41e-06      .00001
 per_capita_income_d |   1.41e-06   8.43e-07     1.67   0.095    -2.46e-07    3.06e-06
               _cons |   9.822877   .1427415    68.82   0.000     9.543109    10.10264
--------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     57485       57485           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 10447 observations that are either singletons or separated by a fixed effect)
Iteration 1:   deviance = 4.1413e+08  eps = .         iters = 4    tol = 1.0e-04  min(eta) =  -3.29  P
>    
Iteration 2:   deviance = 1.7950e+08  eps = 1.31e+00  iters = 3    tol = 1.0e-04  min(eta) =  -4.22   
>    
Iteration 3:   deviance = 1.7046e+08  eps = 5.30e-02  iters = 3    tol = 1.0e-04  min(eta) =  -5.14   
>    
Iteration 4:   deviance = 1.7033e+08  eps = 7.55e-04  iters = 2    tol = 1.0e-04  min(eta) =  -5.94   
>    
Iteration 5:   deviance = 1.7033e+08  eps = 3.11e-06  iters = 2    tol = 1.0e-04  min(eta) =  -6.50   
>    
Iteration 6:   deviance = 1.7033e+08  eps = 5.48e-08  iters = 2    tol = 1.0e-05  min(eta) =  -6.73   
> S  
Iteration 7:   deviance = 1.7033e+08  eps = 5.88e-10  iters = 2    tol = 1.0e-07  min(eta) =  -6.76   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 7 iterations and 18 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    331,655
Absorbing 2 HDFE groups                           Residual df     =     57,484
Statistics robust to heteroskedasticity           Wald chi2(2)    =      83.73
Deviance             =  170331590.8               Prob > chi2     =     0.0000
Log pseudolikelihood = -86811188.95               Pseudo R2       =     0.9816

Number of clusters (flow_id)=     57,485
                                   (Std. err. adjusted for 57,485 clusters in flow_id)
--------------------------------------------------------------------------------------
                     |               Robust
                 agi | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
---------------------+----------------------------------------------------------------
1.out_multnomah_post |   .1691276   .0589561     2.87   0.004     .0535757    .2846795
 1.in_multnomah_post |  -.1838849     .02136    -8.61   0.000    -.2257498     -.14202
               _cons |     10.648    .000114  9.3e+04   0.000     10.64778    10.64822
--------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     57485       57485           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_multnomah_post_agi.png
    saved as PNG format

. 
. ********************************************************************************
. ** REGRESSION 1b: Loop over all counties (Permutation-style analysis)
. ** Purpose: Run same DiD regression for each county to create distribution
. **          of treatment effects for comparison with Multnomah
. ********************************************************************************
. 
. ** Preserve data for later use in REGRESSION 2
. preserve

. 
. ** Get list of unique origin fips codes
. levelsof fips_o, local(fips_list)
1001 1003 1005 1007 1009 1011 1013 1015 1017 1019 1021 1023 1025 1027 1029 1031 1033 1035 1037 1039 10
> 41 1043 1045 1047 1049 1051 1053 1055 1057 1059 1061 1063 1065 1067 1069 1071 1073 1075 1077 1079 10
> 81 1083 1085 1087 1089 1091 1093 1095 1097 1099 1101 1103 1105 1107 1109 1111 1113 1115 1117 1119 11
> 21 1123 1125 1127 1129 1131 1133 4001 4003 4005 4007 4009 4011 4012 4013 4015 4017 4019 4021 4023 40
> 25 4027 5001 5003 5005 5007 5009 5011 5013 5015 5017 5019 5021 5023 5025 5027 5029 5031 5033 5035 50
> 37 5039 5041 5043 5045 5047 5049 5051 5053 5055 5057 5059 5061 5063 5065 5067 5069 5071 5073 5075 50
> 77 5079 5081 5083 5085 5087 5089 5091 5093 5095 5097 5099 5101 5103 5105 5107 5109 5111 5113 5115 51
> 17 5119 5121 5123 5125 5127 5129 5131 5133 5135 5137 5139 5141 5143 5145 5147 5149 6001 6005 6007 60
> 09 6011 6013 6015 6017 6019 6021 6023 6025 6027 6029 6031 6033 6035 6037 6039 6041 6043 6045 6047 60
> 49 6051 6053 6055 6057 6059 6061 6063 6065 6067 6069 6071 6073 6075 6077 6079 6081 6083 6085 6087 60
> 89 6091 6093 6095 6097 6099 6101 6103 6105 6107 6109 6111 6113 6115 8001 8003 8005 8007 8011 8013 80
> 14 8015 8019 8021 8023 8025 8027 8029 8031 8035 8037 8039 8041 8043 8045 8047 8049 8051 8055 8059 80
> 65 8067 8069 8071 8073 8075 8077 8081 8083 8085 8087 8089 8091 8093 8095 8097 8099 8101 8103 8105 81
> 07 8109 8113 8117 8119 8121 8123 8125 10001 10003 10005 11001 12001 12003 12005 12007 12009 12011 12
> 013 12015 12017 12019 12021 12023 12027 12029 12031 12033 12035 12037 12039 12041 12043 12045 12047 
> 12049 12051 12053 12055 12057 12059 12061 12063 12065 12067 12069 12071 12073 12075 12077 12079 1208
> 1 12083 12085 12086 12087 12089 12091 12093 12095 12097 12099 12101 12103 12105 12107 12109 12111 12
> 113 12115 12117 12119 12121 12123 12125 12127 12129 12131 12133 13001 13003 13005 13007 13009 13011 
> 13013 13015 13017 13019 13021 13023 13025 13027 13029 13031 13033 13035 13037 13039 13043 13045 1304
> 7 13049 13051 13053 13055 13057 13059 13063 13065 13067 13069 13071 13073 13075 13077 13079 13081 13
> 083 13085 13087 13089 13091 13093 13095 13097 13099 13101 13103 13105 13107 13109 13111 13113 13115 
> 13117 13119 13121 13123 13127 13129 13131 13133 13135 13137 13139 13141 13143 13145 13147 13149 1315
> 1 13153 13155 13157 13159 13161 13163 13165 13167 13169 13171 13173 13175 13177 13179 13181 13183 13
> 185 13187 13189 13191 13193 13195 13197 13199 13201 13205 13207 13209 13211 13213 13215 13217 13219 
> 13221 13223 13225 13227 13229 13231 13233 13235 13237 13239 13241 13243 13245 13247 13249 13251 1325
> 3 13255 13257 13259 13261 13263 13267 13269 13271 13273 13275 13277 13279 13281 13283 13285 13287 13
> 289 13291 13293 13295 13297 13299 13301 13303 13305 13309 13311 13313 13315 13317 13319 13321 16001 
> 16003 16005 16007 16009 16011 16013 16015 16017 16019 16021 16027 16029 16031 16035 16039 16041 1604
> 3 16045 16047 16049 16051 16053 16055 16057 16059 16061 16063 16065 16067 16069 16071 16073 16075 16
> 077 16079 16081 16083 16085 16087 17001 17003 17005 17007 17009 17011 17013 17015 17017 17019 17021 
> 17023 17025 17027 17029 17031 17033 17035 17037 17039 17041 17043 17045 17047 17049 17051 17053 1705
> 5 17057 17059 17061 17063 17065 17067 17069 17071 17073 17075 17077 17079 17081 17083 17085 17087 17
> 089 17091 17093 17095 17097 17099 17101 17103 17105 17107 17109 17111 17113 17115 17117 17119 17121 
> 17123 17125 17127 17129 17131 17133 17135 17137 17139 17141 17143 17145 17147 17149 17151 17153 1715
> 5 17157 17159 17161 17163 17165 17167 17169 17171 17173 17175 17177 17179 17181 17183 17185 17187 17
> 189 17191 17193 17195 17197 17199 17201 17203 18001 18003 18005 18007 18009 18011 18013 18015 18017 
> 18019 18021 18023 18025 18027 18029 18031 18033 18035 18037 18039 18041 18043 18045 18047 18049 1805
> 1 18053 18055 18057 18059 18061 18063 18065 18067 18069 18071 18073 18075 18077 18079 18081 18083 18
> 085 18087 18089 18091 18093 18095 18097 18099 18101 18103 18105 18107 18109 18111 18113 18115 18117 
> 18119 18121 18123 18125 18127 18129 18131 18133 18135 18137 18139 18141 18143 18145 18147 18149 1815
> 1 18153 18155 18157 18159 18161 18163 18165 18167 18169 18171 18173 18175 18177 18179 18181 18183 19
> 001 19003 19005 19007 19009 19011 19013 19015 19017 19019 19021 19023 19025 19027 19029 19031 19033 
> 19035 19037 19039 19041 19043 19045 19047 19049 19051 19053 19055 19057 19059 19061 19063 19065 1906
> 7 19069 19071 19073 19075 19077 19079 19081 19083 19085 19087 19089 19091 19093 19095 19097 19099 19
> 101 19103 19105 19107 19109 19111 19113 19115 19117 19119 19121 19123 19125 19127 19129 19131 19133 
> 19135 19137 19139 19141 19143 19145 19147 19149 19151 19153 19155 19157 19159 19161 19163 19165 1916
> 7 19169 19171 19173 19175 19177 19179 19181 19183 19185 19187 19189 19191 19193 19195 19197 20001 20
> 003 20005 20009 20011 20013 20015 20017 20019 20021 20027 20029 20031 20035 20037 20041 20043 20045 
> 20051 20053 20055 20057 20059 20061 20067 20069 20073 20077 20079 20085 20087 20091 20093 20095 2009
> 9 20103 20105 20107 20109 20111 20113 20115 20117 20119 20121 20125 20131 20133 20139 20143 20145 20
> 149 20151 20155 20157 20159 20161 20163 20165 20167 20169 20171 20173 20175 20177 20185 20191 20193 
> 20195 20197 20201 20205 20207 20209 21001 21003 21005 21007 21009 21011 21013 21015 21017 21019 2102
> 1 21023 21025 21027 21029 21031 21033 21035 21037 21039 21041 21043 21045 21047 21049 21051 21053 21
> 055 21057 21059 21061 21063 21065 21067 21069 21071 21073 21075 21077 21079 21081 21083 21085 21087 
> 21089 21091 21093 21095 21097 21099 21101 21103 21105 21107 21109 21111 21113 21115 21117 21119 2112
> 1 21123 21125 21127 21129 21131 21133 21135 21137 21139 21141 21143 21145 21147 21149 21151 21153 21
> 155 21157 21159 21161 21163 21165 21167 21169 21171 21173 21175 21177 21179 21181 21183 21185 21187 
> 21191 21193 21195 21197 21199 21203 21205 21207 21209 21211 21213 21215 21217 21219 21221 21223 2122
> 5 21227 21229 21231 21233 21235 21237 21239 22001 22003 22005 22007 22009 22011 22013 22015 22017 22
> 019 22021 22023 22025 22027 22029 22031 22033 22035 22037 22039 22041 22043 22045 22047 22049 22051 
> 22053 22055 22057 22059 22061 22063 22065 22067 22069 22071 22073 22075 22077 22079 22081 22083 2208
> 5 22087 22089 22091 22093 22095 22097 22099 22101 22103 22105 22109 22111 22113 22115 22117 22119 22
> 121 22123 22125 22127 23001 23003 23005 23007 23009 23011 23013 23015 23017 23019 23021 23023 23025 
> 23027 23029 23031 24001 24003 24005 24009 24011 24013 24015 24017 24019 24021 24023 24025 24027 2402
> 9 24031 24033 24035 24037 24039 24041 24043 24045 24047 24510 25001 25003 25005 25007 25009 25011 25
> 013 25015 25017 25019 25021 25023 25025 25027 26001 26003 26005 26007 26009 26011 26013 26015 26017 
> 26019 26021 26023 26025 26027 26029 26031 26033 26035 26037 26039 26041 26043 26045 26047 26049 2605
> 1 26053 26055 26057 26059 26061 26063 26065 26067 26069 26071 26073 26075 26077 26079 26081 26083 26
> 085 26087 26089 26091 26093 26097 26099 26101 26103 26105 26107 26109 26111 26113 26115 26117 26119 
> 26121 26123 26125 26127 26129 26133 26135 26137 26139 26141 26143 26145 26147 26149 26151 26153 2615
> 5 26157 26159 26161 26163 26165 27001 27003 27005 27007 27009 27011 27013 27015 27017 27019 27021 27
> 023 27025 27027 27029 27031 27033 27035 27037 27039 27041 27043 27045 27047 27049 27051 27053 27055 
> 27057 27059 27061 27063 27065 27067 27071 27073 27075 27077 27079 27081 27083 27085 27087 27089 2709
> 1 27093 27095 27097 27099 27101 27103 27105 27107 27109 27111 27113 27115 27117 27119 27121 27123 27
> 125 27127 27129 27131 27133 27135 27137 27139 27141 27143 27145 27147 27149 27151 27153 27157 27159 
> 27161 27163 27165 27167 27169 27171 27173 28001 28003 28005 28007 28009 28011 28013 28015 28017 2801
> 9 28021 28023 28025 28027 28029 28031 28033 28035 28037 28039 28041 28043 28045 28047 28049 28051 28
> 053 28057 28059 28061 28063 28065 28067 28069 28071 28073 28075 28077 28079 28081 28083 28085 28087 
> 28089 28091 28093 28095 28097 28099 28101 28103 28105 28107 28109 28111 28113 28115 28117 28119 2812
> 1 28123 28125 28127 28129 28131 28133 28135 28137 28139 28141 28143 28145 28147 28149 28151 28153 28
> 155 28157 28159 28161 28163 29001 29003 29007 29009 29011 29013 29015 29017 29019 29021 29023 29025 
> 29027 29029 29031 29033 29035 29037 29039 29041 29043 29045 29047 29049 29051 29053 29055 29057 2905
> 9 29061 29063 29065 29067 29069 29071 29073 29075 29077 29079 29081 29083 29085 29087 29089 29091 29
> 093 29095 29097 29099 29101 29103 29105 29107 29109 29111 29113 29115 29117 29119 29121 29123 29125 
> 29127 29131 29133 29135 29137 29139 29141 29143 29145 29147 29149 29151 29153 29155 29157 29159 2916
> 1 29163 29165 29167 29169 29171 29173 29175 29177 29179 29181 29183 29185 29186 29187 29189 29195 29
> 197 29199 29201 29203 29205 29207 29209 29211 29213 29215 29217 29219 29221 29223 29225 29229 29510 
> 30001 30003 30005 30007 30009 30013 30015 30017 30021 30023 30027 30029 30031 30035 30039 30041 3004
> 3 30047 30049 30051 30053 30057 30061 30063 30065 30067 30073 30077 30081 30083 30085 30087 30089 30
> 093 30095 30097 30099 30101 30105 30111 31001 31003 31011 31013 31019 31021 31023 31025 31027 31033 
> 31035 31037 31039 31041 31043 31045 31047 31051 31053 31055 31059 31061 31063 31065 31067 31073 3107
> 9 31081 31087 31089 31093 31095 31097 31099 31101 31105 31107 31109 31111 31119 31121 31123 31125 31
> 127 31131 31137 31139 31141 31143 31145 31147 31151 31153 31155 31157 31159 31161 31163 31167 31169 
> 31173 31177 31179 31181 31185 32001 32003 32005 32007 32011 32013 32015 32017 32019 32021 32023 3202
> 7 32029 32031 32033 32510 33001 33003 33005 33007 33009 33011 33013 33015 33017 33019 34001 34003 34
> 005 34007 34009 34011 34013 34015 34017 34019 34021 34023 34025 34027 34029 34031 34033 34035 34037 
> 34039 34041 35001 35005 35006 35007 35009 35013 35015 35017 35019 35025 35027 35028 35029 35031 3503
> 3 35035 35037 35039 35041 35043 35045 35047 35049 35051 35053 35055 35057 35061 36001 36003 36005 36
> 007 36009 36011 36013 36015 36017 36019 36021 36023 36025 36027 36029 36031 36033 36035 36037 36039 
> 36041 36043 36045 36047 36049 36051 36053 36055 36057 36059 36061 36063 36065 36067 36069 36071 3607
> 3 36075 36077 36079 36081 36083 36085 36087 36089 36091 36093 36095 36097 36099 36101 36103 36105 36
> 107 36109 36111 36113 36115 36117 36119 36121 36123 37001 37003 37005 37007 37009 37011 37013 37015 
> 37017 37019 37021 37023 37025 37027 37029 37031 37033 37035 37037 37039 37041 37043 37045 37047 3704
> 9 37051 37053 37055 37057 37059 37061 37063 37065 37067 37069 37071 37073 37075 37077 37079 37081 37
> 083 37085 37087 37089 37091 37093 37095 37097 37099 37101 37103 37105 37107 37109 37111 37113 37115 
> 37117 37119 37121 37123 37125 37127 37129 37131 37133 37135 37137 37139 37141 37143 37145 37147 3714
> 9 37151 37153 37155 37157 37159 37161 37163 37165 37167 37169 37171 37173 37175 37177 37179 37181 37
> 183 37185 37187 37189 37191 37193 37195 37197 37199 38003 38005 38009 38013 38015 38017 38021 38025 
> 38029 38035 38041 38043 38045 38049 38053 38055 38057 38059 38061 38067 38071 38073 38075 38077 3807
> 9 38081 38085 38089 38093 38097 38099 38101 38105 39001 39003 39005 39007 39009 39011 39013 39015 39
> 017 39019 39021 39023 39025 39027 39029 39031 39033 39035 39037 39039 39041 39043 39045 39047 39049 
> 39051 39053 39055 39057 39059 39061 39063 39065 39067 39069 39071 39073 39075 39077 39079 39081 3908
> 3 39085 39087 39089 39091 39093 39095 39097 39099 39101 39103 39105 39107 39109 39111 39113 39115 39
> 117 39119 39121 39123 39125 39127 39129 39131 39133 39135 39137 39139 39141 39143 39145 39147 39149 
> 39151 39153 39155 39157 39159 39161 39163 39165 39167 39169 39171 39173 39175 40001 40003 40005 4000
> 7 40009 40011 40013 40015 40017 40019 40021 40023 40027 40029 40031 40033 40035 40037 40039 40041 40
> 043 40045 40047 40049 40051 40053 40055 40059 40061 40063 40065 40067 40069 40071 40073 40075 40077 
> 40079 40081 40083 40085 40087 40089 40091 40093 40095 40097 40099 40101 40103 40105 40107 40109 4011
> 1 40113 40115 40117 40119 40121 40123 40125 40127 40129 40131 40133 40135 40137 40139 40141 40143 40
> 145 40147 40149 40151 40153 41001 41003 41005 41007 41009 41011 41013 41015 41017 41019 41025 41027 
> 41029 41031 41033 41035 41037 41039 41041 41043 41045 41047 41049 41051 41053 41057 41059 41061 4106
> 3 41065 41067 41071 42001 42003 42005 42007 42009 42011 42013 42015 42017 42019 42021 42023 42025 42
> 027 42029 42031 42033 42035 42037 42039 42041 42043 42045 42047 42049 42051 42053 42055 42057 42059 
> 42061 42063 42065 42067 42069 42071 42073 42075 42077 42079 42081 42083 42085 42087 42089 42091 4209
> 3 42095 42097 42099 42101 42103 42105 42107 42109 42111 42113 42115 42117 42119 42121 42123 42125 42
> 127 42129 42131 42133 44001 44003 44005 44007 44009 45001 45003 45005 45007 45009 45011 45013 45015 
> 45017 45019 45021 45023 45025 45027 45029 45031 45033 45035 45037 45039 45041 45043 45045 45047 4504
> 9 45051 45053 45055 45057 45059 45061 45063 45065 45067 45069 45071 45073 45075 45077 45079 45081 45
> 083 45085 45087 45089 45091 46003 46005 46007 46009 46011 46013 46015 46019 46023 46025 46027 46029 
> 46033 46035 46037 46039 46041 46045 46047 46051 46057 46061 46065 46067 46071 46077 46079 46081 4608
> 3 46085 46087 46089 46091 46093 46099 46101 46102 46103 46109 46111 46115 46117 46121 46125 46127 46
> 135 47001 47003 47005 47007 47009 47011 47013 47015 47017 47019 47021 47023 47025 47027 47029 47031 
> 47033 47035 47037 47039 47041 47043 47045 47047 47049 47051 47053 47055 47057 47059 47061 47063 4706
> 5 47067 47069 47071 47073 47075 47077 47079 47081 47083 47085 47087 47089 47091 47093 47095 47097 47
> 099 47101 47103 47105 47107 47109 47111 47113 47115 47117 47119 47121 47123 47125 47127 47129 47131 
> 47133 47137 47139 47141 47143 47145 47147 47149 47151 47153 47155 47157 47159 47161 47163 47165 4716
> 7 47169 47171 47173 47175 47177 47179 47181 47183 47185 47187 47189 48001 48003 48005 48007 48009 48
> 011 48013 48015 48017 48019 48021 48023 48025 48027 48029 48031 48035 48037 48039 48041 48043 48047 
> 48049 48051 48053 48055 48057 48059 48061 48063 48065 48067 48069 48071 48073 48077 48079 48081 4808
> 3 48085 48089 48091 48093 48095 48097 48099 48103 48105 48107 48111 48113 48115 48117 48119 48121 48
> 123 48127 48129 48131 48133 48135 48139 48141 48143 48145 48147 48149 48151 48153 48157 48159 48161 
> 48163 48165 48167 48169 48171 48175 48177 48179 48181 48183 48185 48187 48189 48193 48197 48199 4820
> 1 48203 48205 48207 48209 48213 48215 48217 48219 48221 48223 48225 48227 48229 48231 48233 48235 48
> 237 48239 48241 48245 48247 48249 48251 48253 48255 48257 48259 48265 48267 48273 48277 48279 48281 
> 48283 48285 48287 48289 48291 48293 48295 48297 48299 48303 48305 48307 48309 48313 48315 48317 4832
> 1 48323 48325 48329 48331 48333 48335 48337 48339 48341 48343 48347 48349 48351 48353 48355 48357 48
> 359 48361 48363 48365 48367 48369 48371 48373 48375 48377 48379 48381 48383 48387 48389 48391 48395 
> 48397 48399 48401 48403 48405 48407 48409 48413 48415 48417 48419 48423 48425 48427 48429 48435 4843
> 7 48439 48441 48445 48449 48451 48453 48455 48457 48459 48461 48463 48465 48467 48469 48471 48473 48
> 475 48477 48479 48481 48483 48485 48487 48489 48491 48493 48495 48497 48499 48501 48503 48505 48507 
> 49001 49003 49005 49007 49011 49013 49015 49017 49019 49021 49023 49025 49027 49029 49035 49037 4903
> 9 49041 49043 49045 49047 49049 49051 49053 49057 50001 50003 50005 50007 50009 50011 50013 50015 50
> 017 50019 50021 50023 50025 50027 51001 51007 51009 51011 51013 51019 51021 51023 51025 51027 51029 
> 51033 51036 51037 51041 51043 51047 51049 51051 51057 51061 51063 51065 51067 51071 51073 51075 5107
> 7 51079 51083 51085 51087 51093 51097 51099 51101 51103 51105 51107 51109 51111 51113 51115 51117 51
> 119 51125 51127 51131 51133 51135 51137 51139 51141 51145 51147 51155 51157 51159 51167 51169 51171 
> 51173 51179 51181 51183 51185 51187 51193 51197 51510 51550 51650 51700 51710 51740 51760 51770 5180
> 0 51810 53001 53003 53005 53007 53009 53011 53013 53015 53017 53019 53021 53025 53027 53029 53031 53
> 033 53035 53037 53039 53041 53043 53045 53047 53049 53051 53053 53055 53057 53059 53061 53063 53065 
> 53067 53069 53071 53073 53075 53077 54001 54003 54005 54007 54009 54011 54013 54015 54017 54019 5402
> 1 54023 54025 54027 54029 54031 54033 54035 54037 54039 54041 54043 54045 54047 54049 54051 54053 54
> 055 54057 54059 54061 54063 54065 54067 54069 54071 54073 54075 54077 54079 54081 54083 54085 54087 
> 54089 54091 54093 54095 54097 54099 54101 54103 54105 54107 54109 55001 55003 55005 55007 55009 5501
> 1 55013 55015 55017 55019 55021 55023 55025 55027 55029 55031 55033 55035 55037 55039 55041 55043 55
> 045 55047 55049 55051 55053 55055 55057 55059 55061 55063 55065 55067 55069 55071 55073 55075 55077 
> 55078 55079 55081 55083 55085 55087 55089 55091 55093 55095 55097 55099 55101 55103 55105 55107 5510
> 9 55111 55113 55115 55117 55119 55121 55123 55125 55127 55129 55131 55133 55135 55137 55139 55141 56
> 001 56003 56005 56007 56009 56011 56013 56015 56019 56021 56023 56025 56029 56031 56033 56035 56037 
> 56039 56041 56043 56045

. local n_fips : word count `fips_list'

. dis "Running regressions for `n_fips' counties..."
Running regressions for 2849 counties...

. 
. ** Initialize tempfile to store results
. tempfile county_results

. postfile county_coefs fips b_out se_out b_in se_in using `county_results', replace
(file C:\Users\ji252\AppData\Local\Temp\ST_4058_000002.tmp not found)

. 
. ** Counter for display
. local ct = 1

. 
. foreach f of local fips_list {
  2. 
.         ** Display status every 100 counties
.         if mod(`ct', 100) == 0 {
  3.                 dis "Processing county `ct' of `n_fips' (fips = `f')..."
  4.         }
  5. 
.         ** Generate treatment vars
.         gen out_tmp = fips_o == `f'
  6.         gen in_tmp = fips_d == `f'
  7. 
.         ** Interactions
.         gen out_post_tmp = out_tmp * post
  8.         gen in_post_tmp = in_tmp * post
  9. 
.         ** Run regression with capture to handle potential errors
.         capture {
 10.                 ** Regression: With covariates
.                 quietly ppmlhdfe agi i.out_post_tmp i.in_post_tmp       ///
>                         unemp_* pop_* per_capita_income_*                               ///
>                         if mover == 1,                                                              
>     ///
>                         absorb(year flow_id) vce(cluster flow_id)
 11. 
.                 ** Store coefficients and SEs
.                 local tmp_b_out = _b[1.out_post_tmp]
 12.                 local tmp_se_out = _se[1.out_post_tmp]
 13.                 local tmp_b_in = _b[1.in_post_tmp]
 14.                 local tmp_se_in = _se[1.in_post_tmp]
 15. 
.                 ** Post results
.                 post county_coefs (`f') (`tmp_b_out') (`tmp_se_out') (`tmp_b_in') (`tmp_se_in')
 16.         }
 17. 
.         ** If regression failed, post missing values
.         if _rc != 0 {
 18.                 post county_coefs (`f') (.) (.) (.) (.)
 19.                 dis "Warning: Regression failed for fips `f'"
 20.         }
 21. 
.         ** Drop temporary vars
.         drop out_tmp in_tmp out_post_tmp in_post_tmp
 22. 
.         ** Update count
.         local ct = `ct' + 1
 23. 
. } // END FIPS LOOP
Warning: Regression failed for fips 1023
Processing county 100 of 2849 (fips = 5035)...
Warning: Regression failed for fips 6049
Processing county 200 of 2849 (fips = 6087)...
Warning: Regression failed for fips 6091
Warning: Regression failed for fips 8023
Warning: Regression failed for fips 8025
Warning: Regression failed for fips 8095
Warning: Regression failed for fips 8099
Warning: Regression failed for fips 8113
Warning: Regression failed for fips 8121
Warning: Regression failed for fips 8125
Processing county 300 of 2849 (fips = 12057)...
Warning: Regression failed for fips 13007
Warning: Regression failed for fips 13037
Warning: Regression failed for fips 13065
Processing county 400 of 2849 (fips = 13127)...
Warning: Regression failed for fips 13243
Warning: Regression failed for fips 13259
Warning: Regression failed for fips 13317
Warning: Regression failed for fips 16007
Processing county 500 of 2849 (fips = 16011)...
Warning: Regression failed for fips 16071
Warning: Regression failed for fips 17013
Warning: Regression failed for fips 17069
Processing county 600 of 2849 (fips = 17131)...
Warning: Regression failed for fips 17151
Warning: Regression failed for fips 17153
Processing county 700 of 2849 (fips = 18127)...
Warning: Regression failed for fips 19003
Warning: Regression failed for fips 19009
Warning: Regression failed for fips 19093
Processing county 800 of 2849 (fips = 19143)...
Warning: Regression failed for fips 19159
Warning: Regression failed for fips 20019
Warning: Regression failed for fips 20067
Warning: Regression failed for fips 20105
Warning: Regression failed for fips 20109
Warning: Regression failed for fips 20119
Warning: Regression failed for fips 20165
Warning: Regression failed for fips 20171
Warning: Regression failed for fips 20185
Warning: Regression failed for fips 20193
Warning: Regression failed for fips 20195
Warning: Regression failed for fips 20201
Processing county 900 of 2849 (fips = 20207)...
Warning: Regression failed for fips 20207
Warning: Regression failed for fips 21057
Warning: Regression failed for fips 21129
Warning: Regression failed for fips 21159
Processing county 1000 of 2849 (fips = 21199)...
Warning: Regression failed for fips 21237
Processing county 1100 of 2849 (fips = 24003)...
Processing county 1200 of 2849 (fips = 26129)...
Warning: Regression failed for fips 26135
Warning: Regression failed for fips 26153
Warning: Regression failed for fips 27011
Warning: Regression failed for fips 27077
Warning: Regression failed for fips 27149
Processing county 1300 of 2849 (fips = 27169)...
Warning: Regression failed for fips 28053
Warning: Regression failed for fips 28125
Warning: Regression failed for fips 29033
Processing county 1400 of 2849 (fips = 29035)...
Warning: Regression failed for fips 29075
Warning: Regression failed for fips 29081
Warning: Regression failed for fips 29103
Warning: Regression failed for fips 29171
Warning: Regression failed for fips 29179
Warning: Regression failed for fips 29199
Processing county 1500 of 2849 (fips = 30009)...
Warning: Regression failed for fips 30051
Warning: Regression failed for fips 30085
Warning: Regression failed for fips 30097
Warning: Regression failed for fips 30101
Warning: Regression failed for fips 30105
Warning: Regression failed for fips 31011
Warning: Regression failed for fips 31027
Warning: Regression failed for fips 31033
Warning: Regression failed for fips 31045
Warning: Regression failed for fips 31061
Warning: Regression failed for fips 31063
Warning: Regression failed for fips 31065
Warning: Regression failed for fips 31073
Warning: Regression failed for fips 31089
Warning: Regression failed for fips 31105
Warning: Regression failed for fips 31147
Warning: Regression failed for fips 31161
Warning: Regression failed for fips 31163
Warning: Regression failed for fips 31169
Warning: Regression failed for fips 31173
Processing county 1600 of 2849 (fips = 31185)...
Warning: Regression failed for fips 32011
Warning: Regression failed for fips 32021
Warning: Regression failed for fips 36041
Processing county 1700 of 2849 (fips = 36049)...
Warning: Regression failed for fips 37005
Warning: Regression failed for fips 37075
Warning: Regression failed for fips 37095
Processing county 1800 of 2849 (fips = 37125)...
Warning: Regression failed for fips 37177
Warning: Regression failed for fips 38013
Warning: Regression failed for fips 38021
Warning: Regression failed for fips 38041
Warning: Regression failed for fips 38043
Warning: Regression failed for fips 38045
Warning: Regression failed for fips 38085
Processing county 1900 of 2849 (fips = 39059)...
Warning: Regression failed for fips 40043
Warning: Regression failed for fips 40059
Processing county 2000 of 2849 (fips = 40087)...
Warning: Regression failed for fips 40151
Warning: Regression failed for fips 41025
Warning: Regression failed for fips 42023
Processing county 2100 of 2849 (fips = 42069)...
Warning: Regression failed for fips 46003
Warning: Regression failed for fips 46007
Warning: Regression failed for fips 46015
Warning: Regression failed for fips 46023
Warning: Regression failed for fips 46037
Processing county 2200 of 2849 (fips = 46041)...
Warning: Regression failed for fips 46041
Warning: Regression failed for fips 46051
Warning: Regression failed for fips 46071
Warning: Regression failed for fips 46085
Warning: Regression failed for fips 46089
Warning: Regression failed for fips 46091
Warning: Regression failed for fips 46109
Warning: Regression failed for fips 46111
Warning: Regression failed for fips 47067
Processing county 2300 of 2849 (fips = 47143)...
Warning: Regression failed for fips 48023
Warning: Regression failed for fips 48079
Warning: Regression failed for fips 48105
Warning: Regression failed for fips 48129
Warning: Regression failed for fips 48151
Processing county 2400 of 2849 (fips = 48171)...
Warning: Regression failed for fips 48197
Warning: Regression failed for fips 48247
Warning: Regression failed for fips 48267
Warning: Regression failed for fips 48295
Warning: Regression failed for fips 48333
Warning: Regression failed for fips 48357
Warning: Regression failed for fips 48383
Processing county 2500 of 2849 (fips = 48405)...
Warning: Regression failed for fips 48413
Warning: Regression failed for fips 48429
Warning: Regression failed for fips 48435
Warning: Regression failed for fips 48461
Warning: Regression failed for fips 48483
Warning: Regression failed for fips 49017
Processing county 2600 of 2849 (fips = 51043)...
Warning: Regression failed for fips 51051
Processing county 2700 of 2849 (fips = 53075)...
Warning: Regression failed for fips 54013
Warning: Regression failed for fips 54071
Warning: Regression failed for fips 54075
Processing county 2800 of 2849 (fips = 55085)...
Warning: Regression failed for fips 56043

. 
. ** Close postfile
. postclose county_coefs

. 
. ** Load results
. use `county_results', clear

. 
. ** Add identifiers
. gen multnomah = (fips == 41051)

. label var fips "County FIPS code"

. label var b_out "Out-migration coefficient (County x Post)"

. label var se_out "Out-migration SE"

. label var b_in "In-migration coefficient (County x Post)"

. label var se_in "In-migration SE"

. label var multnomah "Multnomah County indicator"

. 
. ** Calculate t-statistics and p-values
. gen t_out = b_out / se_out
(132 missing values generated)

. gen t_in = b_in / se_in
(132 missing values generated)

. gen p_out = 2 * (1 - normal(abs(t_out)))
(132 missing values generated)

. gen p_in = 2 * (1 - normal(abs(t_in)))
(132 missing values generated)

. 
. label var t_out "Out-migration t-statistic"

. label var t_in "In-migration t-statistic"

. label var p_out "Out-migration p-value"

. label var p_in "In-migration p-value"

. 
. ** Calculate percentile ranks for Multnomah
. egen rank_b_out = rank(b_out)
(131 missing values generated)

. egen rank_b_in = rank(b_in)
(131 missing values generated)

. qui count if !missing(b_out)

. gen pctile_out = 100 * rank_b_out / r(N)
(131 missing values generated)

. qui count if !missing(b_in)

. gen pctile_in = 100 * rank_b_in / r(N)
(131 missing values generated)

. 
. label var pctile_out "Percentile rank of out-migration coef"

. label var pctile_in "Percentile rank of in-migration coef"

. 
. ** Display Multnomah's position
. dis ""


. dis "=========================================="
==========================================

. dis "Multnomah County Results:"
Multnomah County Results:

. dis "=========================================="
==========================================

. summ b_out b_in pctile_out pctile_in if multnomah == 1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
       b_out |          1    .1613764           .   .1613764   .1613764
        b_in |          1   -.1838134           .  -.1838134  -.1838134
  pctile_out |          1    96.61516           .   96.61516   96.61516
   pctile_in |          1     15.6365           .    15.6365    15.6365

. 
. ** Display distribution summary
. dis ""


. dis "Distribution of coefficients (all counties):"
Distribution of coefficients (all counties):

. summ b_out b_in, detail

          Out-migration coefficient (County x Post)
-------------------------------------------------------------
      Percentiles      Smallest
 1%    -.5383406       -1.19288
 5%     -.335157      -1.137723
10%    -.2648458      -.9571632       Obs               2,718
25%    -.1752968      -.9061099       Sum of wgt.       2,718

50%    -.0950147                      Mean          -.0984475
                        Largest       Std. dev.      .1510096
75%    -.0148651       .5249667
90%     .0715168       .5295028       Variance       .0228039
95%     .1318129        .657543       Skewness      -.6088189
99%     .2670831       .6877741       Kurtosis       7.821162

          In-migration coefficient (County x Post)
-------------------------------------------------------------
      Percentiles      Smallest
 1%    -.5200218      -2.103586
 5%    -.3129183      -1.267102
10%     -.228109      -1.263287       Obs               2,718
25%     -.137919      -.9308209       Sum of wgt.       2,718

50%    -.0514831                      Mean          -.0449492
                        Largest       Std. dev.      .1779624
75%     .0539701       .6841459
90%     .1609409       .9048778       Variance       .0316706
95%     .2288452       1.068451       Skewness      -.6283486
99%     .3718513       1.437353       Kurtosis       14.50795

. 
. ** Save county coefficients dataset
. compress
  variable multnomah was float now byte
  variable rank_b_out was float now int
  variable rank_b_in was float now int
  (19,943 bytes saved)

. save "${data}working/county_did_coefficients.dta", replace
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/county_did_coefficients.dta
    not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/county_did_coefficients.dta
    saved

. export delimited using "${data}working/county_did_coefficients.csv", replace
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/county_did_coefficients.csv
    not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/county_did_coefficients.csv sav
> ed

. 
. dis "County coefficients saved to ${data}working/county_did_coefficients.dta"
County coefficients saved to C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/county_
> did_coefficients.dta

. 
. ** Restore original data for REGRESSION 2
. restore

. 
. ********************************************************************************
. ** SECTION: Multnomah vs Distribution Plots (Histogram Comparison)
. ** Purpose: Plot Multnomah's coefficients against distribution of all counties
. ********************************************************************************
. 
. ** Load the county coefficients
. preserve

. use "${data}working/county_did_coefficients.dta", clear

. 
. ** Store Multnomah's coefficients for reference lines
. summ b_out if multnomah == 1, meanonly

. local multnomah_b_out = r(mean)

. summ b_in if multnomah == 1, meanonly

. local multnomah_b_in = r(mean)

. summ pctile_out if multnomah == 1, meanonly

. local multnomah_pctile_out = r(mean)

. summ pctile_in if multnomah == 1, meanonly

. local multnomah_pctile_in = r(mean)

. 
. ** Plot 1: Out-migration coefficient distribution with Multnomah
. histogram b_out if !missing(b_out),                                                             ///
>         bin(50)                                                                                     
>                             ///
>         fcolor(navy%50) lcolor(navy)                                                                
>     ///
>         xline(`multnomah_b_out', lcolor(red) lwidth(thick) lpattern(solid)) ///
>         xtitle("Out-migration Coefficient (County x Post)")                     ///
>         ytitle("Frequency")                                                                         
>             ///
>         title("Distribution of Out-Migration Effects")                                  ///
>         subtitle("Red line = Multnomah County (percentile: `: display %4.1f `multnomah_pctile_out'')
> ") ///
>         note("N = `: count if !missing(b_out)' counties")                               ///
>         graphregion(color(white))
count not allowed
(bin=50, start=-1.1928804, width=.03761309)

. 
. graph export "${results}flows/fig_hist_out_coef.png", replace
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_hist_out_coef.png not
    found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_hist_out_coef.png saved
    as PNG format

. 
. ** Plot 2: In-migration coefficient distribution with Multnomah
. histogram b_in if !missing(b_in),                                                                   
>     ///
>         bin(50)                                                                                     
>                             ///
>         fcolor(maroon%50) lcolor(maroon)                                                            
>     ///
>         xline(`multnomah_b_in', lcolor(red) lwidth(thick) lpattern(solid)) ///
>         xtitle("In-migration Coefficient (County x Post)")                              ///
>         ytitle("Frequency")                                                                         
>             ///
>         title("Distribution of In-Migration Effects")                                   ///
>         subtitle("Red line = Multnomah County (percentile: `: display %4.1f `multnomah_pctile_in'')"
> ) ///
>         note("N = `: count if !missing(b_in)' counties")                                ///
>         graphregion(color(white))
count not allowed
(bin=50, start=-2.103586, width=.07081878)

. 
. graph export "${results}flows/fig_hist_in_coef.png", replace
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_hist_in_coef.png not
    found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_hist_in_coef.png saved
    as PNG format

. 
. ** Plot 3: Combined scatter of out vs in coefficients
. twoway  (scatter b_in b_out if multnomah == 0,                                          ///
>                         mc(navy%30) ms(O) msize(small))                                             
>     ///
>                 (scatter b_in b_out if multnomah == 1,                                          ///
>                         mc(red) ms(D) msize(large)),                                                
>     ///
>         xline(0, lc(gs10) lp(dash))                                                                 
>     ///
>         yline(0, lc(gs10) lp(dash))                                                                 
>     ///
>         xtitle("Out-migration Coefficient")                                                     ///
>         ytitle("In-migration Coefficient")                                                          
>     ///
>         title("Out- vs In-Migration Effects by County")                                 ///
>         legend(order(1 "Other Counties" 2 "Multnomah County") pos(6) rows(1)) ///
>         graphregion(color(white))

. 
. graph export "${results}flows/fig_scatter_out_in_coef.png", replace
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_scatter_out_in_coef.png
    not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_scatter_out_in_coef.png
    saved as PNG format

. 
. ** Restore and continue
. restore

. 
. ********************************************************************************
. ** REGRESSION 2: Multnomah X Year (Event Study)
. ********************************************************************************
. 
. ** Loop over outcome variables
. foreach outcome in n1 n2 agi {
  2. 
.         ** Set outcome label for graphs
.         if "`outcome'" == "n1" local outcome_label "Number of Returns"
  3.         if "`outcome'" == "n2" local outcome_label "Number of Exemptions"
  4.         if "`outcome'" == "agi" local outcome_label "Adjusted Gross Income"
  5. 
.         ** Regression 2a: With covariates
.         ppmlhdfe `outcome' x_out_* x_in_*                                                           
>     ///
>                 unemp_* pop_* per_capita_income_*                                                   
>     ///
>                 if mover == 1,                                                                      
>                     ///
>                 absorb(year flow_id) vce(cluster flow_id)
  6.         estimates store `outcome'_es_with_covars
  7. 
.         ** Regression 2b: Without covariates
.         ppmlhdfe `outcome' x_out_* x_in_*                                                           
>     ///
>                 if mover == 1,                                                                      
>                     ///
>                 absorb(year flow_id) vce(cluster flow_id)
  8.         estimates store `outcome'_es_no_covars
  9. 
.         ** Extract coefficients into a dataset and plot
.         preserve
 10.                 clear
 11.                 set obs 7
 12.                 gen year = 2015 + _n
 13. 
.                 ** Out-migration coefficients (with covariates)
.                 gen out_coef_wc = .
 14.                 gen out_ci_lo_wc = .
 15.                 gen out_ci_hi_wc = .
 16. 
.                 ** In-migration coefficients (with covariates)
.                 gen in_coef_wc = .
 17.                 gen in_ci_lo_wc = .
 18.                 gen in_ci_hi_wc = .
 19. 
.                 ** Out-migration coefficients (without covariates)
.                 gen out_coef_nc = .
 20.                 gen out_ci_lo_nc = .
 21.                 gen out_ci_hi_nc = .
 22. 
.                 ** In-migration coefficients (without covariates)
.                 gen in_coef_nc = .
 23.                 gen in_ci_lo_nc = .
 24.                 gen in_ci_hi_nc = .
 25. 
.                 ** Fill in coefficients (2020 = base year = 0)
.                 foreach y in 2016 2017 2018 2019 2021 2022 {
 26. 
.                         ** With covariates
.                         estimates restore `outcome'_es_with_covars
 27.                         replace out_coef_wc = _b[x_out_`y'] if year == `y'
 28.                         replace out_ci_lo_wc = _b[x_out_`y'] - 1.96 * _se[x_out_`y'] if year == `
> y'
 29.                         replace out_ci_hi_wc = _b[x_out_`y'] + 1.96 * _se[x_out_`y'] if year == `
> y'
 30. 
.                         replace in_coef_wc = _b[x_in_`y'] if year == `y'
 31.                         replace in_ci_lo_wc = _b[x_in_`y'] - 1.96 * _se[x_in_`y'] if year == `y'
 32.                         replace in_ci_hi_wc = _b[x_in_`y'] + 1.96 * _se[x_in_`y'] if year == `y'
 33. 
.                         ** Without covariates
.                         estimates restore `outcome'_es_no_covars
 34.                         replace out_coef_nc = _b[x_out_`y'] if year == `y'
 35.                         replace out_ci_lo_nc = _b[x_out_`y'] - 1.96 * _se[x_out_`y'] if year == `
> y'
 36.                         replace out_ci_hi_nc = _b[x_out_`y'] + 1.96 * _se[x_out_`y'] if year == `
> y'
 37. 
.                         replace in_coef_nc = _b[x_in_`y'] if year == `y'
 38.                         replace in_ci_lo_nc = _b[x_in_`y'] - 1.96 * _se[x_in_`y'] if year == `y'
 39.                         replace in_ci_hi_nc = _b[x_in_`y'] + 1.96 * _se[x_in_`y'] if year == `y'
 40.                 }
 41. 
.                 ** Base year (2020) = 0
.                 foreach v in out_coef_wc out_ci_lo_wc out_ci_hi_wc                      ///
>                                          in_coef_wc in_ci_lo_wc in_ci_hi_wc                     ///
>                                          out_coef_nc out_ci_lo_nc out_ci_hi_nc                  ///
>                                          in_coef_nc in_ci_lo_nc in_ci_hi_nc {
 42.                         replace `v' = 0 if year == 2020
 43.                 }
 44. 
.                 ** Offset years slightly for visibility
.                 gen year_out = year - 0.1
 45.                 gen year_in = year + 0.1
 46. 
.                 ** Plot 1: Out-migration (with and without covariates)
.                 twoway  (rcap out_ci_lo_wc out_ci_hi_wc year_out, lc(navy))                     ///
>                                 (connected out_coef_wc year_out, mc(navy) lc(navy) ms(O))           
>     ///
>                                 (rcap out_ci_lo_nc out_ci_hi_nc year_in, lc(maroon))                
>     ///
>                                 (connected out_coef_nc year_in, mc(maroon) lc(maroon) ms(T)),   ///
>                         yline(0, lc(gs10) lp(dash))                                                 
>                             ///
>                         xline(2020.5, lc(black) lp(solid))                                          
>                             ///
>                         xlabel(2016(1)2022)                                                         
>                                     ///
>                         ytitle("Coefficient (relative to 2020)")                                    
>                     ///
>                         xtitle("Year")                                                              
>                                             ///
>                         legend(order(2 "With Covariates" 4 "Without Covariates")                    
>     ///
>                                 pos(6) rows(1))                                                     
>                                             ///
>                         title("Out-Migration from Multnomah County")                                
>             ///
>                         subtitle("`outcome_label'")                                                 
>                                     ///
>                         graphregion(color(white))
 47. 
.                 graph export "${results}flows/fig_multnomah_out_`outcome'.png", replace
 48. 
.                 ** Plot 2: In-migration (with and without covariates)
.                 twoway  (rcap in_ci_lo_wc in_ci_hi_wc year_out, lc(navy))                           
>     ///
>                                 (connected in_coef_wc year_out, mc(navy) lc(navy) ms(O))            
>     ///
>                                 (rcap in_ci_lo_nc in_ci_hi_nc year_in, lc(maroon))                  
>             ///
>                                 (connected in_coef_nc year_in, mc(maroon) lc(maroon) ms(T)),    ///
>                         yline(0, lc(gs10) lp(dash))                                                 
>                             ///
>                         xline(2020.5, lc(black) lp(solid))                                          
>                             ///
>                         xlabel(2016(1)2022)                                                         
>                                     ///
>                         ytitle("Coefficient (relative to 2020)")                                    
>                     ///
>                         xtitle("Year")                                                              
>                                             ///
>                         legend(order(2 "With Covariates" 4 "Without Covariates")                    
>     ///
>                                 pos(6) rows(1))                                                     
>                                             ///
>                         title("In-Migration to Multnomah County")                                   
>                     ///
>                         subtitle("`outcome_label'")                                                 
>                                     ///
>                         graphregion(color(white))
 49. 
.                 graph export "${results}flows/fig_multnomah_in_`outcome'.png", replace
 50. 
.                 ** Plot 3: Both flows (with covariates only, as in original)
.                 twoway  (rcap out_ci_lo_wc out_ci_hi_wc year_out, lc(navy))                         
>     ///
>                                 (connected out_coef_wc year_out, mc(navy) lc(navy) ms(O))           
>     ///
>                                 (rcap in_ci_lo_wc in_ci_hi_wc year_in, lc(maroon))                  
>             ///
>                                 (connected in_coef_wc year_in, mc(maroon) lc(maroon) ms(T)),    ///
>                         yline(0, lc(gs10) lp(dash))                                                 
>                             ///
>                         xline(2020.5, lc(black) lp(solid))                                          
>                             ///
>                         xlabel(2016(1)2022)                                                         
>                                     ///
>                         ytitle("Coefficient (relative to 2020)")                                    
>                     ///
>                         xtitle("Year")                                                              
>                                             ///
>                         legend(order(2 "Out-migration" 4 "In-migration")                            
>             ///
>                                 pos(6) rows(1))                                                     
>                                             ///
>                         title("Migration Flows: Multnomah County")                                  
>                     ///
>                         subtitle("`outcome_label'")                                                 
>                                     ///
>                         graphregion(color(white))
 51. 
.                 graph export "${results}flows/fig_multnomah_both_`outcome'.png", replace
 52. 
.         restore
 53. 
. } // END OUTCOME LOOP
(dropped 10447 observations that are either singletons or separated by a fixed effect)
Iteration 1:   deviance = 2.8750e+06  eps = .         iters = 4    tol = 1.0e-04  min(eta) =  -2.82  P
>    
Iteration 2:   deviance = 6.3143e+05  eps = 3.55e+00  iters = 3    tol = 1.0e-04  min(eta) =  -3.25   
>    
Iteration 3:   deviance = 5.8880e+05  eps = 7.24e-02  iters = 3    tol = 1.0e-04  min(eta) =  -3.39   
>    
Iteration 4:   deviance = 5.8875e+05  eps = 8.34e-05  iters = 2    tol = 1.0e-04  min(eta) =  -3.40   
>    
Iteration 5:   deviance = 5.8875e+05  eps = 5.95e-10  iters = 2    tol = 1.0e-05  min(eta) =  -3.40   
>    
Iteration 6:   deviance = 5.8875e+05  eps = 0.00e+00  iters = 1    tol = 1.0e-06  min(eta) =  -3.40   
> S  
Iteration 7:   deviance = 5.8875e+05  eps = 0.00e+00  iters = 1    tol = 1.0e-09  min(eta) =  -3.40   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 7 iterations and 16 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    331,655
Absorbing 2 HDFE groups                           Residual df     =     57,484
Statistics robust to heteroskedasticity           Wald chi2(18)   =    1369.29
Deviance             =  588750.1864               Prob > chi2     =     0.0000
Log pseudolikelihood = -1266760.004               Pseudo R2       =     0.9778

Number of clusters (flow_id)=     57,485
                                  (Std. err. adjusted for 57,485 clusters in flow_id)
-------------------------------------------------------------------------------------
                    |               Robust
                 n1 | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
--------------------+----------------------------------------------------------------
         x_out_2016 |   .0077922   .0263958     0.30   0.768    -.0439427    .0595271
         x_out_2017 |    .078197   .0134486     5.81   0.000     .0518383    .1045556
         x_out_2018 |   .0010925   .0126651     0.09   0.931    -.0237307    .0259157
         x_out_2019 |  -.0124979   .0145334    -0.86   0.390    -.0409829     .015987
         x_out_2021 |   .0528212   .0139452     3.79   0.000     .0254891    .0801534
         x_out_2022 |   .0054972   .0268138     0.21   0.838    -.0470568    .0580512
          x_in_2016 |   .0867557   .0192393     4.51   0.000     .0490474    .1244641
          x_in_2017 |   .0339171   .0187846     1.81   0.071       -.0029    .0707342
          x_in_2018 |   .0101895   .0126008     0.81   0.419    -.0145077    .0348866
          x_in_2019 |   .0288109   .0121896     2.36   0.018     .0049198    .0527021
          x_in_2021 |  -.0504132   .0153158    -3.29   0.001    -.0804316   -.0203949
          x_in_2022 |  -.0390371   .0274721    -1.42   0.155    -.0928814    .0148073
            unemp_o |   .0234832   .0009523    24.66   0.000     .0216166    .0253497
            unemp_d |  -.0209885   .0009798   -21.42   0.000    -.0229089   -.0190681
              pop_o |   6.38e-08   3.11e-08     2.05   0.040     2.82e-09    1.25e-07
              pop_d |   3.63e-07   3.24e-08    11.21   0.000     3.00e-07    4.27e-07
per_capita_income_o |   2.14e-06   3.64e-07     5.87   0.000     1.42e-06    2.85e-06
per_capita_income_d |  -1.55e-06   2.83e-07    -5.48   0.000    -2.11e-06   -9.99e-07
              _cons |   5.639644   .0535688   105.28   0.000     5.534651    5.744637
-------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     57485       57485           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 10447 observations that are either singletons or separated by a fixed effect)
Iteration 1:   deviance = 2.8997e+06  eps = .         iters = 4    tol = 1.0e-04  min(eta) =  -2.76  P
>    
Iteration 2:   deviance = 6.5448e+05  eps = 3.43e+00  iters = 3    tol = 1.0e-04  min(eta) =  -3.22   
>    
Iteration 3:   deviance = 6.1184e+05  eps = 6.97e-02  iters = 3    tol = 1.0e-04  min(eta) =  -3.36   
>    
Iteration 4:   deviance = 6.1179e+05  eps = 8.02e-05  iters = 2    tol = 1.0e-04  min(eta) =  -3.37   
>    
Iteration 5:   deviance = 6.1179e+05  eps = 5.70e-10  iters = 2    tol = 1.0e-05  min(eta) =  -3.37   
>    
Iteration 6:   deviance = 6.1179e+05  eps = 0.00e+00  iters = 1    tol = 1.0e-06  min(eta) =  -3.37   
> S  
Iteration 7:   deviance = 6.1179e+05  eps = 0.00e+00  iters = 1    tol = 1.0e-09  min(eta) =  -3.37   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 7 iterations and 16 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    331,655
Absorbing 2 HDFE groups                           Residual df     =     57,484
Statistics robust to heteroskedasticity           Wald chi2(12)   =     292.60
Deviance             =   611790.574               Prob > chi2     =     0.0000
Log pseudolikelihood = -1278280.198               Pseudo R2       =     0.9776

Number of clusters (flow_id)=     57,485
                           (Std. err. adjusted for 57,485 clusters in flow_id)
------------------------------------------------------------------------------
             |               Robust
          n1 | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
  x_out_2016 |  -.0207227   .0251516    -0.82   0.410    -.0700189    .0285734
  x_out_2017 |   .0514417   .0139207     3.70   0.000     .0241575    .0787258
  x_out_2018 |   -.021128   .0145344    -1.45   0.146    -.0496149    .0073588
  x_out_2019 |  -.0355977   .0163706    -2.17   0.030    -.0676835   -.0035119
  x_out_2021 |   .0427475   .0150927     2.83   0.005     .0131664    .0723286
  x_out_2022 |  -.0103509   .0297355    -0.35   0.728    -.0686313    .0479295
   x_in_2016 |   .1133658   .0169213     6.70   0.000     .0802007     .146531
   x_in_2017 |   .0587878   .0183291     3.21   0.001     .0228634    .0947122
   x_in_2018 |   .0297679   .0136095     2.19   0.029     .0030937    .0564421
   x_in_2019 |   .0488322   .0129534     3.77   0.000      .023444    .0742204
   x_in_2021 |  -.0419343   .0139285    -3.01   0.003    -.0692337   -.0146349
   x_in_2022 |  -.0308355   .0237204    -1.30   0.194    -.0773267    .0156557
       _cons |   6.165648    .000064  9.6e+04   0.000     6.165522    6.165773
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     57485       57485           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
Number of observations (_N) was 0, now 7.
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(results n1_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n1_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n1_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n1_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n1_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n1_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n1_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n1_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n1_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n1_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n1_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n1_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_multnomah_out_n1.png
    saved as PNG format
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_multnomah_in_n1.png
    saved as PNG format
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_multnomah_both_n1.png
    saved as PNG format
(dropped 10447 observations that are either singletons or separated by a fixed effect)
Iteration 1:   deviance = 5.4779e+06  eps = .         iters = 4    tol = 1.0e-04  min(eta) =  -2.91  P
>    
Iteration 2:   deviance = 1.4125e+06  eps = 2.88e+00  iters = 3    tol = 1.0e-04  min(eta) =  -3.54   
>    
Iteration 3:   deviance = 1.3300e+06  eps = 6.20e-02  iters = 3    tol = 1.0e-04  min(eta) =  -3.81   
>    
Iteration 4:   deviance = 1.3298e+06  eps = 1.14e-04  iters = 2    tol = 1.0e-04  min(eta) =  -3.85   
>    
Iteration 5:   deviance = 1.3298e+06  eps = 4.79e-09  iters = 1    tol = 1.0e-04  min(eta) =  -3.85   
>    
Iteration 6:   deviance = 1.3298e+06  eps = 1.65e-14  iters = 1    tol = 1.0e-05  min(eta) =  -3.85   
> S  
Iteration 7:   deviance = 1.3298e+06  eps = 0.00e+00  iters = 2    tol = 1.0e-09  min(eta) =  -3.85   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 7 iterations and 16 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    331,655
Absorbing 2 HDFE groups                           Residual df     =     57,484
Statistics robust to heteroskedasticity           Wald chi2(18)   =    1380.66
Deviance             =  1329800.732               Prob > chi2     =     0.0000
Log pseudolikelihood = -1733404.744               Pseudo R2       =     0.9830

Number of clusters (flow_id)=     57,485
                                  (Std. err. adjusted for 57,485 clusters in flow_id)
-------------------------------------------------------------------------------------
                    |               Robust
                 n2 | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
--------------------+----------------------------------------------------------------
         x_out_2016 |   .0411434   .0274745     1.50   0.134    -.0127056    .0949924
         x_out_2017 |   .0971678   .0161089     6.03   0.000     .0655949    .1287408
         x_out_2018 |   .0054287   .0136316     0.40   0.690    -.0212887    .0321462
         x_out_2019 |  -.0150577   .0178773    -0.84   0.400    -.0500966    .0199811
         x_out_2021 |   .0711657   .0125455     5.67   0.000     .0465769    .0957545
         x_out_2022 |   .0177255   .0236654     0.75   0.454    -.0286578    .0641089
          x_in_2016 |   .1040875   .0203277     5.12   0.000      .064246    .1439291
          x_in_2017 |   .0401574   .0159455     2.52   0.012     .0089047      .07141
          x_in_2018 |    .025335   .0133579     1.90   0.058     -.000846     .051516
          x_in_2019 |   .0410372   .0114538     3.58   0.000     .0185883    .0634862
          x_in_2021 |  -.0404705   .0162094    -2.50   0.013    -.0722403   -.0087006
          x_in_2022 |  -.0238473   .0266927    -0.89   0.372     -.076164    .0284693
            unemp_o |   .0221362    .000997    22.20   0.000      .020182    .0240904
            unemp_d |  -.0230047   .0010524   -21.86   0.000    -.0250674    -.020942
              pop_o |   5.15e-08   3.16e-08     1.63   0.103    -1.04e-08    1.13e-07
              pop_d |   3.62e-07   3.00e-08    12.05   0.000     3.03e-07    4.20e-07
per_capita_income_o |   2.55e-06   3.77e-07     6.77   0.000     1.81e-06    3.29e-06
per_capita_income_d |  -2.00e-06   3.04e-07    -6.60   0.000    -2.60e-06   -1.41e-06
              _cons |   6.279335    .053955   116.38   0.000     6.173585    6.385084
-------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     57485       57485           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 10447 observations that are either singletons or separated by a fixed effect)
Iteration 1:   deviance = 5.5224e+06  eps = .         iters = 4    tol = 1.0e-04  min(eta) =  -2.89  P
>    
Iteration 2:   deviance = 1.4545e+06  eps = 2.80e+00  iters = 3    tol = 1.0e-04  min(eta) =  -3.50   
>    
Iteration 3:   deviance = 1.3720e+06  eps = 6.01e-02  iters = 3    tol = 1.0e-04  min(eta) =  -3.76   
>    
Iteration 4:   deviance = 1.3719e+06  eps = 1.11e-04  iters = 2    tol = 1.0e-04  min(eta) =  -3.80   
>    
Iteration 5:   deviance = 1.3719e+06  eps = 4.60e-09  iters = 1    tol = 1.0e-04  min(eta) =  -3.80   
>    
Iteration 6:   deviance = 1.3719e+06  eps = 1.60e-14  iters = 1    tol = 1.0e-05  min(eta) =  -3.80   
> S  
Iteration 7:   deviance = 1.3719e+06  eps = 3.00e-16  iters = 2    tol = 1.0e-09  min(eta) =  -3.80   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 7 iterations and 16 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    331,655
Absorbing 2 HDFE groups                           Residual df     =     57,484
Statistics robust to heteroskedasticity           Wald chi2(12)   =     310.12
Deviance             =  1371865.239               Prob > chi2     =     0.0000
Log pseudolikelihood = -1754436.998               Pseudo R2       =     0.9828

Number of clusters (flow_id)=     57,485
                           (Std. err. adjusted for 57,485 clusters in flow_id)
------------------------------------------------------------------------------
             |               Robust
          n2 | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
  x_out_2016 |   .0124671   .0247094     0.50   0.614    -.0359624    .0608965
  x_out_2017 |   .0712384   .0145931     4.88   0.000     .0426364    .0998404
  x_out_2018 |  -.0174078   .0139605    -1.25   0.212    -.0447699    .0099543
  x_out_2019 |  -.0386172   .0183871    -2.10   0.036    -.0746552   -.0025792
  x_out_2021 |   .0610758    .013507     4.52   0.000     .0346025     .087549
  x_out_2022 |   .0006962   .0267529     0.03   0.979    -.0517385     .053131
   x_in_2016 |   .1350954   .0178189     7.58   0.000     .1001709    .1700199
   x_in_2017 |   .0694252   .0153947     4.51   0.000     .0392521    .0995983
   x_in_2018 |    .048123    .015017     3.20   0.001     .0186902    .0775557
   x_in_2019 |   .0642632   .0130424     4.93   0.000     .0387007    .0898258
   x_in_2021 |  -.0315087   .0150406    -2.09   0.036    -.0609878   -.0020296
   x_in_2022 |  -.0147227    .023039    -0.64   0.523    -.0598784    .0304329
       _cons |   6.749325   .0000521  1.3e+05   0.000     6.749223    6.749427
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     57485       57485           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
Number of observations (_N) was 0, now 7.
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(results n2_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n2_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n2_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n2_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n2_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n2_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n2_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n2_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n2_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n2_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n2_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results n2_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_multnomah_out_n2.png
    saved as PNG format
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_multnomah_in_n2.png
    saved as PNG format
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_multnomah_both_n2.png
    saved as PNG format
(dropped 10447 observations that are either singletons or separated by a fixed effect)
Iteration 1:   deviance = 4.0051e+08  eps = .         iters = 4    tol = 1.0e-04  min(eta) =  -3.59  P
>    
Iteration 2:   deviance = 1.6973e+08  eps = 1.36e+00  iters = 3    tol = 1.0e-04  min(eta) =  -4.22   
>    
Iteration 3:   deviance = 1.6097e+08  eps = 5.44e-02  iters = 3    tol = 1.0e-04  min(eta) =  -5.14   
>    
Iteration 4:   deviance = 1.6084e+08  eps = 7.90e-04  iters = 2    tol = 1.0e-04  min(eta) =  -5.94   
>    
Iteration 5:   deviance = 1.6084e+08  eps = 3.38e-06  iters = 2    tol = 1.0e-04  min(eta) =  -6.50   
>    
Iteration 6:   deviance = 1.6084e+08  eps = 5.80e-08  iters = 2    tol = 1.0e-05  min(eta) =  -6.73   
> S  
Iteration 7:   deviance = 1.6084e+08  eps = 6.22e-10  iters = 2    tol = 1.0e-07  min(eta) =  -6.76   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 7 iterations and 18 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    331,655
Absorbing 2 HDFE groups                           Residual df     =     57,484
Statistics robust to heteroskedasticity           Wald chi2(18)   =     555.94
Deviance             =  160838134.5               Prob > chi2     =     0.0000
Log pseudolikelihood = -82064460.77               Pseudo R2       =     0.9826

Number of clusters (flow_id)=     57,485
                                  (Std. err. adjusted for 57,485 clusters in flow_id)
-------------------------------------------------------------------------------------
                    |               Robust
                agi | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
--------------------+----------------------------------------------------------------
         x_out_2016 |  -.0793981   .0751445    -1.06   0.291    -.2266786    .0678825
         x_out_2017 |   .0432722   .0553985     0.78   0.435     -.065307    .1518513
         x_out_2018 |  -.0030317   .0695915    -0.04   0.965    -.1394286    .1333652
         x_out_2019 |   .0206898   .0479097     0.43   0.666    -.0732114     .114591
         x_out_2021 |   .1602645   .0253912     6.31   0.000     .1104987    .2100304
         x_out_2022 |   .1649861     .05136     3.21   0.001     .0643222    .2656499
          x_in_2016 |    .115614   .0266841     4.33   0.000     .0633142    .1679138
          x_in_2017 |    .054514   .0317076     1.72   0.086    -.0076318    .1166597
          x_in_2018 |   .0203735   .0341646     0.60   0.551    -.0465879     .087335
          x_in_2019 |   .0596929    .028621     2.09   0.037     .0035968    .1157891
          x_in_2021 |  -.1288232   .0318561    -4.04   0.000      -.19126   -.0663863
          x_in_2022 |   -.141886   .0382333    -3.71   0.000     -.216822   -.0669501
            unemp_o |   .0423254   .0054902     7.71   0.000     .0315647    .0530861
            unemp_d |   -.044156   .0038263   -11.54   0.000    -.0516555   -.0366565
              pop_o |  -2.80e-07   6.37e-08    -4.39   0.000    -4.05e-07   -1.55e-07
              pop_d |   4.64e-07   7.73e-08     6.00   0.000     3.12e-07    6.15e-07
per_capita_income_o |   8.23e-06   9.26e-07     8.89   0.000     6.41e-06      .00001
per_capita_income_d |   1.41e-06   8.43e-07     1.67   0.095    -2.46e-07    3.06e-06
              _cons |   9.822058    .142746    68.81   0.000     9.542281    10.10183
-------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     57485       57485           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
(dropped 10447 observations that are either singletons or separated by a fixed effect)
Iteration 1:   deviance = 4.1408e+08  eps = .         iters = 4    tol = 1.0e-04  min(eta) =  -3.33  P
>    
Iteration 2:   deviance = 1.7946e+08  eps = 1.31e+00  iters = 3    tol = 1.0e-04  min(eta) =  -4.22   
>    
Iteration 3:   deviance = 1.7042e+08  eps = 5.30e-02  iters = 3    tol = 1.0e-04  min(eta) =  -5.14   
>    
Iteration 4:   deviance = 1.7029e+08  eps = 7.55e-04  iters = 2    tol = 1.0e-04  min(eta) =  -5.94   
>    
Iteration 5:   deviance = 1.7029e+08  eps = 3.11e-06  iters = 2    tol = 1.0e-04  min(eta) =  -6.50   
>    
Iteration 6:   deviance = 1.7029e+08  eps = 5.48e-08  iters = 2    tol = 1.0e-05  min(eta) =  -6.73   
> S  
Iteration 7:   deviance = 1.7029e+08  eps = 5.88e-10  iters = 2    tol = 1.0e-07  min(eta) =  -6.76   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 7 iterations and 18 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    331,655
Absorbing 2 HDFE groups                           Residual df     =     57,484
Statistics robust to heteroskedasticity           Wald chi2(12)   =     225.66
Deviance             =  170292619.8               Prob > chi2     =     0.0000
Log pseudolikelihood = -86791703.41               Pseudo R2       =     0.9816

Number of clusters (flow_id)=     57,485
                           (Std. err. adjusted for 57,485 clusters in flow_id)
------------------------------------------------------------------------------
             |               Robust
         agi | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
  x_out_2016 |  -.1365848   .0719544    -1.90   0.058    -.2776129    .0044433
  x_out_2017 |  -.0100139   .0529181    -0.19   0.850    -.1137315    .0937037
  x_out_2018 |  -.0457715   .0657346    -0.70   0.486    -.1746091     .083066
  x_out_2019 |  -.0224142   .0481263    -0.47   0.641      -.11674    .0719117
  x_out_2021 |   .1329048   .0280093     4.75   0.000     .0780075    .1878021
  x_out_2022 |   .1326738   .0570336     2.33   0.020     .0208899    .2444577
   x_in_2016 |    .145421   .0276229     5.26   0.000      .091281    .1995609
   x_in_2017 |   .0854908   .0351823     2.43   0.015     .0165347    .1544469
   x_in_2018 |   .0447531   .0380788     1.18   0.240    -.0298801    .1193862
   x_in_2019 |   .0868904   .0320241     2.71   0.007     .0241242    .1496565
   x_in_2021 |  -.1045955   .0305042    -3.43   0.001    -.1643825   -.0448085
   x_in_2022 |   -.121919   .0337755    -3.61   0.000    -.1881178   -.0557201
       _cons |   10.64789    .000167  6.4e+04   0.000     10.64756    10.64822
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     57485       57485           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
Number of observations (_N) was 0, now 7.
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(7 missing values generated)
(results agi_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results agi_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results agi_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results agi_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results agi_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results agi_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results agi_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results agi_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results agi_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results agi_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results agi_es_with_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(results agi_es_no_covars are active now)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_multnomah_out_agi.png
    saved as PNG format
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_multnomah_in_agi.png
    saved as PNG format
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_multnomah_both_agi.png
    saved as PNG format

. 
. 
. ** Close log
. clear

. log close log_02
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_flow_2026-01-15.log
  log type:  text
 closed on:  15 Jan 2026, 22:18:44
------------------------------------------------------------------------------------------------------

. 
end of do-file

. do "C:\Users\ji252\AppData\Local\Temp\STD4058_000004.tmp"

. local reps = 100

. 
. ** Load IRS Data
. use "${data}working/irs_county_flow.dta", clear

. 
. ** Sample restrictions
. drop if inlist(state_fips_o, 2, 15)     // Alaska and Hawaii
(3,109 observations deleted)

. drop if inlist(state_fips_d, 2, 15)     // Alaska and Hawaii
(2,293 observations deleted)

. 
. ** Clean up variables
. drop fips

. 
. ** Merge with time-varying controls
. 
. ** Keep if in donor pool in both origin and destination
. foreach x in "o" "d" {
  2. 
.         ** Merge with relevent variables
.         gen fips = fips_`x'
  3.         merge m:1 year fips using "${data}working/bls_unemployment",    ///
>                 keep(match) gen(merge_bls_`x')
  4.         merge m:1 year fips using "${data}working/bea_economics",               ///
>                 keep(match) gen(merge_bea_`x')
  5. 
.         ** Rename
.         rename unemp unemp_`x'
  6.         rename population pop_`x'
  7.         rename per_capita_income per_capita_income_`x'
  8.         drop fips
  9. 
. } // END ORIGIN-DESTINATION LOOP
(variable fips was float, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           353,742  (merge_bls_o==3)
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           348,116  (merge_bea_o==3)
    -----------------------------------------
(variable fips was float, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           345,941  (merge_bls_d==3)
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           342,102  (merge_bea_d==3)
    -----------------------------------------

. 
. 
. ** Mover indicators
. gen mover = fips_o != fips_d

. 
. ** Generate flow id
. egen flow_id = group(fips_d fips_o)

. 
. ** Multnomah indicators
. gen out_multnomah = (state_fips_o == 41 & county_fips_o == 51)

. gen in_multnomah = (state_fips_d == 41 & county_fips_d == 51)

. 
. ** Post-indicators
. gen post = year > 2020

. 
. ** Interactions
. gen in_multnomah_post = in_multnomah * post

. gen out_multnomah_post = out_multnomah * post

. 
. ** Create interactions manually (base year = 2020)
. forvalues y = 2016/2022 {
  2.         gen x_out_`y' = out_multnomah * (year == `y')
  3.         gen x_in_`y' = in_multnomah * (year == `y')
  4. }

. 
. ** Drop base year (2020)
. drop x_out_2020 x_in_2020  

. 
end of do-file

. gen out_tmp = fips_o == 54075

. gen in_tmp = fips_d == 54075

. do "C:\Users\ji252\AppData\Local\Temp\STD4058_000005.tmp"

.         gen out_post_tmp = out_tmp * post

.         gen in_post_tmp = in_tmp * post

. 
end of do-file

. do "C:\Users\ji252\AppData\Local\Temp\STD4058_000006.tmp"

.                 quietly ppmlhdfe agi i.out_post_tmp i.in_post_tmp       ///
>                         unemp_* pop_* per_capita_income_*                               ///
>                         if mover == 1,                                                              
>     ///
>                         absorb(year flow_id) vce(cluster flow_id)
r(459);

end of do-file

r(459);

. do "C:\Users\ji252\AppData\Local\Temp\STD4058_000007.tmp"

.                  ppmlhdfe agi i.out_post_tmp i.in_post_tmp      ///
>                         unemp_* pop_* per_capita_income_*                               ///
>                         if mover == 1,                                                              
>     ///
>                         absorb(year flow_id) vce(cluster flow_id)
(dropped 10447 observations that are either singletons or separated by a fixed effect)
agi must be greater than or equal to zero
r(459);

end of do-file

r(459);

. do "C:\Users\ji252\AppData\Local\Temp\STD4058_000008.tmp"

. replace agi = 0 if agi < 0 
(86 real changes made)

. 
end of do-file

. do "C:\Users\ji252\AppData\Local\Temp\STD4058_000007.tmp"

.                  ppmlhdfe agi i.out_post_tmp i.in_post_tmp      ///
>                         unemp_* pop_* per_capita_income_*                               ///
>                         if mover == 1,                                                              
>     ///
>                         absorb(year flow_id) vce(cluster flow_id)
(dropped 10447 observations that are either singletons or separated by a fixed effect)
note: 2 variables omitted because of collinearity: 0bn.out_post_tmp 0bn.in_post_tmp
Iteration 1:   deviance = 4.0074e+08  eps = .         iters = 4    tol = 1.0e-04  min(eta) =  -3.59  P
>    
Iteration 2:   deviance = 1.6994e+08  eps = 1.36e+00  iters = 3    tol = 1.0e-04  min(eta) =  -4.22   
>    
Iteration 3:   deviance = 1.6117e+08  eps = 5.44e-02  iters = 3    tol = 1.0e-04  min(eta) =  -5.14   
>    
Iteration 4:   deviance = 1.6104e+08  eps = 7.89e-04  iters = 2    tol = 1.0e-04  min(eta) =  -5.94   
>    
Iteration 5:   deviance = 1.6104e+08  eps = 3.38e-06  iters = 2    tol = 1.0e-04  min(eta) =  -6.50   
>    
Iteration 6:   deviance = 1.6104e+08  eps = 5.79e-08  iters = 2    tol = 1.0e-05  min(eta) =  -6.73   
> S  
Iteration 7:   deviance = 1.6104e+08  eps = 6.21e-10  iters = 2    tol = 1.0e-07  min(eta) =  -6.76   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 7 iterations and 18 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    331,655
Absorbing 2 HDFE groups                           Residual df     =     57,484
Statistics robust to heteroskedasticity           Wald chi2(6)    =     304.49
Deviance             =  161044060.2               Prob > chi2     =     0.0000
Log pseudolikelihood = -82167423.64               Pseudo R2       =     0.9826

Number of clusters (flow_id)=     57,485
                                  (Std. err. adjusted for 57,485 clusters in flow_id)
-------------------------------------------------------------------------------------
                    |               Robust
                agi | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
--------------------+----------------------------------------------------------------
     0.out_post_tmp |          0  (omitted)
      0.in_post_tmp |          0  (omitted)
            unemp_o |   .0425276   .0054822     7.76   0.000     .0317826    .0532725
            unemp_d |  -.0444139   .0038207   -11.62   0.000    -.0519024   -.0369254
              pop_o |  -2.80e-07   6.37e-08    -4.39   0.000    -4.05e-07   -1.55e-07
              pop_d |   4.65e-07   7.74e-08     6.01   0.000     3.14e-07    6.17e-07
per_capita_income_o |   8.19e-06   9.25e-07     8.85   0.000     6.37e-06      .00001
per_capita_income_d |   1.43e-06   8.42e-07     1.70   0.089    -2.17e-07    3.08e-06
              _cons |   9.821044   .1427937    68.78   0.000     9.541173    10.10091
-------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     57485       57485           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. 
end of do-file

. count if fips == 54075
fips ambiguous abbreviation
r(111);

. count if fips_o == 54075
  3

. count if fips_d == 54075
  0

. tab out_tmp

    out_tmp |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    342,099      100.00      100.00
          1 |          3        0.00      100.00
------------+-----------------------------------
      Total |    342,102      100.00

. bysort flow_id: gen ct = _N

. tab ct

         ct |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     10,447        3.05        3.05
          2 |     11,672        3.41        6.47
          3 |     13,200        3.86       10.32
          4 |     15,228        4.45       14.78
          5 |     18,945        5.54       20.31
          6 |     29,766        8.70       29.01
          7 |    242,844       70.99      100.00
------------+-----------------------------------
      Total |    342,102      100.00

. tab year

   Tax year |
      (year |
     before |
      move) |      Freq.     Percent        Cum.
------------+-----------------------------------
       2016 |     44,049       12.88       12.88
       2017 |     56,354       16.47       29.35
       2018 |     46,095       13.47       42.82
       2019 |     45,103       13.18       56.01
       2020 |     48,422       14.15       70.16
       2021 |     50,671       14.81       84.97
       2022 |     51,408       15.03      100.00
------------+-----------------------------------
      Total |    342,102      100.00

. do "C:\Users\ji252\AppData\Local\Temp\STD4058_000009.tmp"

. ** Synthetic Difference-in-Difference Analysis
. do ${code}02_sdid_analysis.do 

. /*******************************************************************************
> File Name:              02_sdid_analysis.do
> Creator:                John Iselin
> Date Update:    January 13, 2025
> 
> Called by: 00_multnomah.do
> 
> Purpose: Perform synthetic difference-in-difference estimation.
> 
> Outputs:
> - sdid_weights.dta/xlsx: Synthetic control weights for each specification
> - sdid_results.dta/xlsx: Treatment effects, SEs, p-values for each specification
> - fig_speccurve_*.pdf/jpg: Specification curve plots
> 
> TODO:
> 1) Recreate IRS sample with solely counties in ACS sample.
> 
> Authors: John Iselin
> 
> For more information, contact john.iselin@yale.edu
> 
> *******************************************************************************/
. 
. 
. ** Start log file 
. capture log close log_02

. log using "${logs}02_log_sdid_${date}", replace text name(log_02)
------------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_sdid_2026-01-15.log
  log type:  text
 opened on:  15 Jan 2026, 22:25:19

. 
. ** Parameters 
. local reps = 100

. 
. ** Load data 
. use "${data}working/irs_county_gross", replace 

. 
. ** Keep required variables 
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3

. order year fips state* county* 

. 
. ** Merge with ACS Data 
. merge 1:1 year fips using "${data}working/acs_county_gross_18plus", gen(merge_acs_1)
(variable fips was float, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        20,771
        from master                    18,963  (merge_acs_1==1)
        from using                      1,808  (merge_acs_1==2)

    Matched                             3,017  (merge_acs_1==3)
    -----------------------------------------

. 
. ** Keep require variables 
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3 merge_acs_*

. 
. ** Label acs samples 
. rename persons_* acs1_persons_* 

. rename households_* acs1_households_*

. rename dollars_* acs1_dollars_*

. 
. ** Merge with ACS Data 
. merge 1:1 year fips using "${data}working/acs_county_gross_college", gen(merge_acs_2)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,963
        from master                    18,963  (merge_acs_2==1)
        from using                          0  (merge_acs_2==2)

    Matched                             4,825  (merge_acs_2==3)
    -----------------------------------------

. 
. ** Keep require variables 
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3  merge_acs_*

. 
. ** Label acs samples 
. rename persons_* acs2_persons_*

. rename households_* acs2_households_*

. rename dollars_* acs2_dollars_*

. 
. ** Drop "other counties"
. drop if county_fips == 0
(483 observations deleted)

. drop if year == 2015 
(430 observations deleted)

. 
. ** Merge with Demographic data 
. merge m:1 fips using "${data}working/demographics_2020",        ///
>         gen(demo_merge) keep(master match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            27
        from master                        27  (demo_merge==1)
        from using                          0  (demo_merge==2)

    Matched                            22,848  (demo_merge==3)
    -----------------------------------------

.         
. ** Show match 
. tab state_name demo_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
                     |        21          0 |        21 
             Alabama |         0        479 |       479 
              Alaska |         6        198 |       204 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         0         34 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |         0        951 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |        27     22,848 |    22,875 

. tab year demo_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         0      3,140 |     3,140 
      2017 |         0      3,140 |     3,140 
      2018 |         0      3,140 |     3,140 
      2019 |         0      3,140 |     3,140 
      2020 |         2      3,140 |     3,142 
      2021 |         2      3,141 |     3,143 
      2022 |         9      3,133 |     3,142 
      2023 |         7        437 |       444 
      2024 |         7        437 |       444 
-----------+----------------------+----------
     Total |        27     22,848 |    22,875 

. 
. ** Keep if matched 
. keep if demo_merge == 3
(27 observations deleted)

. drop demo_merge

. 
. ** Rename 
. rename population pop_census

.         
. ** Merge with Demographic data 
. merge m:1 year fips using "${data}working/bea_economics",       ///
>         gen(econ_merge) keep(master match) 

    Result                      Number of obs
    -----------------------------------------
    Not matched                           366
        from master                       366  (econ_merge==1)
        from using                          0  (econ_merge==2)

    Matched                            22,482  (econ_merge==3)
    -----------------------------------------

.         
. ** Show match 
. tab state_name econ_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
             Alabama |         0        479 |       479 
              Alaska |         0        198 |       198 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         9         25 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |       357        594 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |       366     22,482 |    22,848 

. tab year econ_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |        52      3,088 |     3,140 
      2017 |        52      3,088 |     3,140 
      2018 |        52      3,088 |     3,140 
      2019 |        52      3,088 |     3,140 
      2020 |        52      3,088 |     3,140 
      2021 |        53      3,088 |     3,141 
      2022 |        53      3,080 |     3,133 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |       366     22,482 |    22,848 

. 
. ** Keep if matched 
. keep if econ_merge == 3
(366 observations deleted)

. drop econ_merge

. 
. ** Merge with COVID-19 Data
. merge m:1 fips using ${data}working/covid_cleaned_wide.dta,     ///
>         gen(covid_merge) keep(master match )
(variable state_name was str20, now str24 to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            73
        from master                        73  (covid_merge==1)
        from using                          0  (covid_merge==2)

    Matched                            22,409  (covid_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name covid_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |         0        479 |       479 
               Alaska |        28        170 |       198 
              Arizona |         0        113 |       113 
             Arkansas |         0        531 |       531 
           California |         0        474 |       474 
             Colorado |         0        452 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |         0        535 |       535 
              Georgia |         0      1,157 |     1,157 
               Hawaii |         0         25 |        25 
                Idaho |         0        310 |       310 
             Illinois |         0        740 |       740 
              Indiana |         0        676 |       676 
                 Iowa |         0        703 |       703 
               Kansas |         0        741 |       741 
             Kentucky |         0        854 |       854 
            Louisiana |         0        462 |       462 
                Maine |         0        116 |       116 
             Maryland |         0        190 |       190 
        Massachusetts |         0        116 |       116 
             Michigan |         0        613 |       613 
            Minnesota |         0        625 |       625 
          Mississippi |         0        580 |       580 
             Missouri |         0        819 |       819 
              Montana |         0        394 |       394 
             Nebraska |         0        657 |       657 
               Nevada |         0        123 |       123 
        New Hampshire |         0         70 |        70 
           New Jersey |         0        181 |       181 
           New Mexico |         0        235 |       235 
             New York |        45        431 |       476 
       North Carolina |         0        736 |       736 
         North Dakota |         0        373 |       373 
                 Ohio |         0        658 |       658 
             Oklahoma |         0        547 |       547 
               Oregon |         0        268 |       268 
         Pennsylvania |         0        509 |       509 
         Rhode Island |         0         41 |        41 
       South Carolina |         0        338 |       338 
         South Dakota |         0        462 |       462 
            Tennessee |         0        687 |       687 
                Texas |         0      1,854 |     1,854 
                 Utah |         0        213 |       213 
              Vermont |         0        100 |       100 
             Virginia |         0        594 |       594 
           Washington |         0        293 |       293 
        West Virginia |         0        387 |       387 
            Wisconsin |         0        530 |       530 
              Wyoming |         0        163 |       163 
----------------------+----------------------+----------
                Total |        73     22,409 |    22,482 

. tab year covid_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         9      3,079 |     3,088 
      2017 |         9      3,079 |     3,088 
      2018 |         9      3,079 |     3,088 
      2019 |         9      3,079 |     3,088 
      2020 |         9      3,079 |     3,088 
      2021 |         9      3,079 |     3,088 
      2022 |         9      3,071 |     3,080 
      2023 |         5        432 |       437 
      2024 |         5        432 |       437 
-----------+----------------------+----------
     Total |        73     22,409 |    22,482 

. 
. ** Merge with Property Tax Rates (time-varying)
. merge m:1 year fips using "${data}working/property_tax_rates_overall", ///
>         gen(proptx_merge) keep(master match) keepusing(prop_rate_mean prop_rate_se)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,591
        from master                    18,591  (proptx_merge==1)
        from using                          0  (proptx_merge==2)

    Matched                             3,891  (proptx_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name proptx_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |       422         57 |       479 
               Alaska |       189          9 |       198 
              Arizona |        71         42 |       113 
             Arkansas |       498         33 |       531 
           California |       168        306 |       474 
             Colorado |       440         12 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |       268        267 |       535 
              Georgia |       971        186 |     1,157 
               Hawaii |         7         18 |        25 
                Idaho |       301          9 |       310 
             Illinois |       593        147 |       740 
              Indiana |       532        144 |       676 
                 Iowa |       664         39 |       703 
               Kansas |       714         27 |       741 
             Kentucky |       803         51 |       854 
            Louisiana |       393         69 |       462 
                Maine |        92         24 |       116 
             Maryland |        85        105 |       190 
        Massachusetts |        77         39 |       116 
             Michigan |       469        144 |       613 
            Minnesota |       553         72 |       625 
          Mississippi |       553         27 |       580 
             Missouri |       756         63 |       819 
              Montana |       391          3 |       394 
             Nebraska |       630         27 |       657 
               Nevada |       105         18 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        28        153 |       181 
           New Mexico |       211         24 |       235 
             New York |       287        189 |       476 
       North Carolina |       562        174 |       736 
         North Dakota |       364          9 |       373 
                 Ohio |       469        189 |       658 
             Oklahoma |       517         30 |       547 
               Oregon |       196         72 |       268 
         Pennsylvania |       329        180 |       509 
         Rhode Island |        14         27 |        41 
       South Carolina |       290         48 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       600         87 |       687 
                Texas |     1,512        342 |     1,854 
                 Utah |       168         45 |       213 
              Vermont |        97          3 |       100 
             Virginia |       504         90 |       594 
           Washington |       209         84 |       293 
        West Virginia |       384          3 |       387 
            Wisconsin |       413        117 |       530 
              Wyoming |       160          3 |       163 
----------------------+----------------------+----------
                Total |    18,591      3,891 |    22,482 

. tab year proptx_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |     2,658        430 |     3,088 
      2017 |     2,658        430 |     3,088 
      2018 |     2,658        430 |     3,088 
      2019 |     2,658        430 |     3,088 
      2020 |     2,658        430 |     3,088 
      2021 |     2,658        430 |     3,088 
      2022 |     2,643        437 |     3,080 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |    18,591      3,891 |    22,482 

. 
. ** Rename for clarity
. rename prop_rate_mean prop_tax_rate

. rename prop_rate_se prop_tax_rate_se

. label var prop_tax_rate "Mean property tax rate (% of home value)"

. label var prop_tax_rate_se "SE of property tax rate"

. 
. ** Organize data 
. order year fips state_* county_* 

. sort fips year  

. isid fips year 

. 
. ** Keep only sample with non-missing base populations
. tab county_name year if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022

                      |  Tax year
                      |   (year
                      |   before
                      |   move)
          County name |      2017 |     Total
----------------------+-----------+----------
        Loving County |         1 |         1 
----------------------+-----------+----------
                Total |         1 |         1 

. drop if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022
(1 observation deleted)

. 
. ** Keep only sample with observations in each year 
. bysort fips: gen ct = _N

. tab county_name state_name if ct < 7 

                      |      State name
          County name | Connect..      Texas |     Total
----------------------+----------------------+----------
     Fairfield County |         6          0 |         6 
      Hartford County |         6          0 |         6 
    Litchfield County |         6          0 |         6 
        Loving County |         0          6 |         6 
     Middlesex County |         6          0 |         6 
     New Haven County |         6          0 |         6 
    New London County |         6          0 |         6 
       Tolland County |         6          0 |         6 
       Windham County |         6          0 |         6 
----------------------+----------------------+----------
                Total |        48          6 |        54 

. drop if ct < 7 
(54 observations deleted)

. drop ct 

. 
. ** Generate IRS sample 
. gen irs_sample_1 = inrange(year, 2016, 2022) 

. gen irs_sample_2 = inrange(year, 2016, 2022) & merge_acs_1 != 1 

. 
. ** Generate ACS Period Indicators 
. gen acs_period_1 = merge_acs_1 != 1 & inrange(year, 2016, 2022)

. gen acs_period_2 = merge_acs_1 != 1 

. 
. ** Make sure we have a balanced panel of ACS counties 
. gen tmp = merge_acs_1 != 1 

. bysort fips: egen ct_tmp = total(tmp)

. replace acs_period_1 = 0 if ct_tmp != 9 
(246 real changes made)

. replace acs_period_2 = 0 if ct_tmp != 9 
(342 real changes made)

. replace irs_sample_2 = 0 if ct_tmp != 9
(246 real changes made)

. drop tmp ct_tmp

. 
. tab year irs_sample_1 

  Tax year |
     (year |
    before |     irs_sample_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |         0      3,079 |     3,079 
      2017 |         0      3,079 |     3,079 
      2018 |         0      3,079 |     3,079 
      2019 |         0      3,079 |     3,079 
      2020 |         0      3,079 |     3,079 
      2021 |         0      3,079 |     3,079 
      2022 |         0      3,079 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |       874     21,553 |    22,427 

. tab year irs_sample_2 

  Tax year |
     (year |
    before |     irs_sample_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_1 

  Tax year |
     (year |
    before |     acs_period_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_2

  Tax year |
     (year |
    before |     acs_period_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |        48        389 |       437 
      2024 |        48        389 |       437 
-----------+----------------------+----------
     Total |    18,926      3,501 |    22,427 

. tab state_name acs_period_1     

                      |     acs_period_1
           State name |         0          1 |     Total
----------------------+----------------------+----------
              Alabama |       458         21 |       479 
               Alaska |       191          7 |       198 
              Arizona |        92         21 |       113 
             Arkansas |       510         21 |       531 
           California |       236        238 |       474 
             Colorado |       445          7 |       452 
             Delaware |         6         21 |        27 
 District of Columbia |         2          7 |         9 
              Florida |       339        196 |       535 
              Georgia |     1,017        140 |     1,157 
               Hawaii |        11         14 |        25 
                Idaho |       303          7 |       310 
             Illinois |       656         84 |       740 
              Indiana |       564        112 |       676 
                 Iowa |       675         28 |       703 
               Kansas |       720         21 |       741 
             Kentucky |       819         35 |       854 
            Louisiana |       413         49 |       462 
                Maine |       102         14 |       116 
             Maryland |       113         77 |       190 
        Massachusetts |       102         14 |       116 
             Michigan |       501        112 |       613 
            Minnesota |       583         42 |       625 
          Mississippi |       559         21 |       580 
             Missouri |       784         35 |       819 
              Montana |       394          0 |       394 
             Nebraska |       636         21 |       657 
               Nevada |       109         14 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        62        119 |       181 
           New Mexico |       221         14 |       235 
             New York |       336        140 |       476 
       North Carolina |       610        126 |       736 
         North Dakota |       366          7 |       373 
                 Ohio |       525        133 |       658 
             Oklahoma |       526         21 |       547 
               Oregon |       219         49 |       268 
         Pennsylvania |       369        140 |       509 
         Rhode Island |        20         21 |        41 
       South Carolina |       331          7 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       638         49 |       687 
                Texas |     1,581        266 |     1,847 
                 Utah |       178         35 |       213 
              Vermont |       100          0 |       100 
             Virginia |       531         63 |       594 
           Washington |       230         63 |       293 
        West Virginia |       387          0 |       387 
            Wisconsin |       439         91 |       530 
              Wyoming |       163          0 |       163 
----------------------+----------------------+----------
                Total |    19,704      2,723 |    22,427 

.         
. ** Define treated state 
. gen multnomah = state_fips == 41 & county_fips == 51

. label var multnomah "Indicator for Multnomah County, Oregon"    

. 
. ** Define treatment indicator 
. gen Treated = multnomah == 1 & year > 2020

. label var Treated "Treatment indicator for Multnomah County, Oregon"    

. 
. ** Define sample 1: All counties 
. gen sample_all = 1 

. label var sample_all "All counties (excluding AK, CA, HI OR, WA)"

. 
. ** Define sample 2: Counties in top 95 percent 
. summ percent_urban if year == 2020, de 

            Percent of population in urban areas
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs               3,079
25%            0              0       Sum of wgt.       3,079

50%     .3256337                      Mean           .3521437
                        Largest       Std. dev.       .332065
75%     .6326353              1
90%      .847923              1       Variance       .1102672
95%     .9372299              1       Skewness       .3661052
99%     .9972304              1       Kurtosis       1.763629

. local cutoff = r(p95) 

. tab state_name multnomah if percent_urban >= `cutoff' & year == 2020

                      |     Indicator for
                      |   Multnomah County,
                      |        Oregon
           State name |         0          1 |     Total
----------------------+----------------------+----------
               Alaska |         1          0 |         1 
              Arizona |         1          0 |         1 
           California |        15          0 |        15 
             Colorado |         4          0 |         4 
             Delaware |         1          0 |         1 
 District of Columbia |         1          0 |         1 
              Florida |        13          0 |        13 
              Georgia |         8          0 |         8 
               Hawaii |         1          0 |         1 
                Idaho |         1          0 |         1 
             Illinois |         5          0 |         5 
              Indiana |         3          0 |         3 
                 Iowa |         1          0 |         1 
               Kansas |         2          0 |         2 
             Kentucky |         2          0 |         2 
            Louisiana |         3          0 |         3 
             Maryland |         3          0 |         3 
        Massachusetts |         5          0 |         5 
             Michigan |         3          0 |         3 
            Minnesota |         3          0 |         3 
             Missouri |         4          0 |         4 
             Nebraska |         2          0 |         2 
               Nevada |         3          0 |         3 
           New Jersey |        10          0 |        10 
           New Mexico |         2          0 |         2 
             New York |         9          0 |         9 
       North Carolina |         4          0 |         4 
                 Ohio |         6          0 |         6 
             Oklahoma |         1          0 |         1 
               Oregon |         1          1 |         2 
         Pennsylvania |         4          0 |         4 
         Rhode Island |         2          0 |         2 
            Tennessee |         2          0 |         2 
                Texas |        11          0 |        11 
                 Utah |         4          0 |         4 
             Virginia |        10          0 |        10 
           Washington |         1          0 |         1 
            Wisconsin |         1          0 |         1 
----------------------+----------------------+----------
                Total |       153          1 |       154 

. gen sample_urban95 = percent_urban >= `cutoff' // All counties 

. label var sample_urban95 "Urban counties (top 5%) (excluding AK, CA, HI OR, WA)"

. tab sample_urban95 if year == 2020

      Urban |
   counties |
   (top 5%) |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,925       95.00       95.00
          1 |        154        5.00      100.00
------------+-----------------------------------
      Total |      3,079      100.00

. 
. ** Define sample 3: Counties in top 98 percent 
. local cutoff = .9864539 //

. tab state_name multnomah if percent_urban >= `cutoff' & year == 2020

                      |     Indicator for
                      |   Multnomah County,
                      |        Oregon
           State name |         0          1 |     Total
----------------------+----------------------+----------
           California |         6          0 |         6 
             Colorado |         2          0 |         2 
 District of Columbia |         1          0 |         1 
              Florida |         4          0 |         4 
              Georgia |         5          0 |         5 
             Illinois |         2          0 |         2 
              Indiana |         1          0 |         1 
            Louisiana |         1          0 |         1 
             Maryland |         1          0 |         1 
        Massachusetts |         1          0 |         1 
             Michigan |         1          0 |         1 
            Minnesota |         1          0 |         1 
             Missouri |         1          0 |         1 
               Nevada |         1          0 |         1 
           New Jersey |         6          0 |         6 
             New York |         7          0 |         7 
       North Carolina |         1          0 |         1 
                 Ohio |         1          0 |         1 
               Oregon |         0          1 |         1 
         Pennsylvania |         2          0 |         2 
         Rhode Island |         1          0 |         1 
                Texas |         3          0 |         3 
                 Utah |         2          0 |         2 
             Virginia |         8          0 |         8 
            Wisconsin |         1          0 |         1 
----------------------+----------------------+----------
                Total |        60          1 |        61 

. gen sample_urban98 = percent_urban >= `cutoff' // All counties 

. label var sample_urban98 "Urban counties (top 1%) (excluding AK, CA, HI OR, WA)"

. tab sample_urban98 if year == 2020

      Urban |
   counties |
   (top 1%) |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,018       98.02       98.02
          1 |         61        1.98      100.00
------------+-----------------------------------
      Total |      3,079      100.00

. 
. ** Define Sample of States      
. drop if state_name == "Alaska"
(198 observations deleted)

. drop if state_name == "Hawaii"
(25 observations deleted)

. drop if state_name == "California"
(474 observations deleted)

. drop if state_name == "Washington"
(293 observations deleted)

. drop if state_name == "Oregon" & multnomah == 0
(259 observations deleted)

. 
. ** Define sample 4: Counties in top 95 + covid 
. cluster kmeans cases_cum* deaths_cum* if        ///
>         sample_urban95 == 1 & year == 2020 & covid_merge == 3 , k(5) gen(kmean)
cluster name: _clus_1

. bysort fips: egen kmean_group = mean(kmean)
(20,046 missing values generated)

. 
. ** Pull out kmeans cluster with Multnoma
. gen tmp1 = kmean if sample_urban95 == 1 & year == 2020 & covid_merge == 3 & multnomah == 1 
(21,177 missing values generated)

. egen tmp2 = mean(tmp1)

. gen sample_urban95_covid = sample_urban95 == 1 & kmean_group == tmp2

. drop tmp1 tmp2 

. label var sample_urban95_covid "Urban counties (top 5%) w. Kmean Covid Match  (excluding AK, CA, HI 
> OR, WA)"

. tab sample_urban95_covid if year == 2020

      Urban |
   counties |
(top 5%) w. |
Kmean Covid |
      Match |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,879       98.73       98.73
          1 |         37        1.27      100.00
------------+-----------------------------------
      Total |      2,916      100.00

. 
. ** Show results across clusters 
. preserve 

. 
. ** Keep required variables 
. keep if sample_urban95 == 1 & year == 2020 & covid_merge == 3
(21,048 observations deleted)

. keep kmean cases_cum* deaths_cum* population

. collapse (mean) cases_cum* deaths_cum* [fw = population], by(kmean)

. reshape long cases_cum deaths_cum, i(kmean) j(time)
(j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations                5   ->   145         
Number of variables                  59   ->   4           
j variable (29 values)                    ->   time
xij variables:
  cases_cum1 cases_cum2 ... cases_cum29   ->   cases_cum
deaths_cum1 deaths_cum2 ... deaths_cum29  ->   deaths_cum
-----------------------------------------------------------------------------

. xtset kmean time 

Panel variable: kmean (strongly balanced)
 Time variable: time, 1 to 29
         Delta: 1 unit

. xtline cases_cum 

. graph export "${results}sdid/fig_kmeans.jpg", as(jpg) name("Graph") quality(100) replace            
>     
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/fig_kmeans.jpg written in JPEG 
> format

. clear  

. 
. ** Restore      
. restore 

. 
. ** Define and standardize covariates
. ** Note: prop_tax_rate added for non-IRS full sample specifications
. local all_covariates "population per_capita_income prop_tax_rate"

. foreach v of local all_covariates {
  2.         egen tmp_v = std(`v')
  3.         replace `v' = tmp_v
  4.         drop tmp_v
  5. } // END COVAR LOOP 
(21,178 real changes made)
(21,178 real changes made)
(17,815 missing values generated)
(3,363 real changes made)

. 
. ** Define outcome variables (IRS)
. foreach x in "n1" "n2" "agi" {
  2.         
.         if "`x'" == "n1" local xtxt "returns"
  3.         else if "`x'" == "n2" local xtxt "exemptions"
  4.         else if "`x'" == "agi" local xtxt "AGI"
  5.         
.         ** Loop over migration type 
.         foreach y in "net" "in" "out" {
  6.                 
.                         if "`y'" == "net" local ytxt "Net domestic migration"
  7.                         else if "`y'" == "in" local ytxt "Domestic in-migration"
  8.                         else if "`y'" == "out" local ytxt "Domestic out-migration"
  9.                 
.                         ** Generate
.                         gen `x'_`y'_rate_irs = 100 * (`x'_`y'_3 / (`x'_out_1 + `x'_out_2))
 10. 
.                         ** Label var 
.                         label var `x'_`y'_rate_irs      "`ytxt' rate, `xtxt' (%)"
 11.                         
.         } // END MIGRATION TYPE LOOP 
 12.         
. } // END OUTCOME TYPE LOOP 
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)

. 
. ** Define outcome variables (ACS)
. 
. ** Rename for loop 
. rename acs*_households_* acs*_n1_*

. rename acs*_persons_* acs*_n2_*

. rename acs*_dollars_* acs*_agi_*

. 
. ** Loop over sample 
. ** (18+ = 1, college degree == 2, no college degree == 3)
. forvalues i = 1/2{
  2.         
.         if `i' == 1 local itxt ""
  3.         else if `i' == 2 local itxt " (College)"
  4.         else if `i' == 3 local itxt " (No College)"
  5.         
. 
.         ** Define outcome variables (IRS)
.         foreach x in "n1" "n2" "agi" {
  6.                 
.                 if "`x'" == "n1" local xtxt "HHs"
  7.                 else if "`x'" == "n2" local xtxt "persons"
  8.                 else if "`x'" == "agi" local xtxt "total income"
  9.         
.                 
.                 ** Loop over migration type 
.                 foreach y in "net" "in" "out" {
 10.                         
.                                 if "`y'" == "net" local ytxt "Net domestic migration"
 11.                                 else if "`y'" == "in" local ytxt "Domestic in-migration"
 12.                                 else if "`y'" == "out" local ytxt "Domestic out-migration"
 13.                         
.                                 ** Generate
.                                 gen `x'_`y'_rate_acs`i' = 100 * (acs`i'_`x'_`y'_3 / (acs`i'_`x'_out_
> 1 + acs`i'_`x'_out_2))
 14. 
.                                 ** Label var 
.                                 label var `x'_`y'_rate_acs`i' "`ytxt' rate, `xtxt'`itxt' (%)"
 15.                                 
.                 } // END MIGRATION TYPE LOOP 
 16.                 
.         } // END OUTCOME TYPE LOOP 
 17.         
. } // END SAMPLE LOOP 
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)

. 
. ** Declare panel
. xtset fips year 

Panel variable: fips (unbalanced)
 Time variable: year, 2016 to 2024
         Delta: 1 unit

. 
. ** Tag unique fips 
. egen unique = tag(fips)

. tab year unique

  Tax year |
     (year |
    before |       tag(fips)
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |         0      2,916 |     2,916 
      2017 |     2,916          0 |     2,916 
      2018 |     2,916          0 |     2,916 
      2019 |     2,916          0 |     2,916 
      2020 |     2,916          0 |     2,916 
      2021 |     2,916          0 |     2,916 
      2022 |     2,916          0 |     2,916 
      2023 |       383          0 |       383 
      2024 |       383          0 |       383 
-----------+----------------------+----------
     Total |    18,262      2,916 |    21,178 

. 
. ** Label var 
. label var year "Year (destination)"

. 
. ** Before your loops, set up weights dataset
. preserve

. clear

. set obs 0
Number of observations (_N) was 0, now 0.

. gen fips = .

. gen weight = .

. gen sample_data = ""

. gen out = ""

. gen sample = ""

. gen controls = .

. gen exclusion = .

. save "${results}sdid/sdid_weights.dta", replace
(dataset contains 0 observations)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_weights.dta saved

. clear

. restore

. 
. ** Set up treatment effects dataset
. preserve

. clear

. set obs 0
Number of observations (_N) was 0, now 0.

. gen sample_data = ""

. gen sample = ""

. gen outcome = ""

. gen controls = .

. gen exclusion = .

. gen tau = .

. gen se = .

. gen pval = .

. gen ci_lower = .

. gen ci_upper = .

. gen n_counties = .

. gen pre_mean = .

. save "${results}sdid/sdid_results.dta", replace
(dataset contains 0 observations)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_results.dta saved

. clear

. restore 

. 
. ** Loop over IRS and ACS Samples
. foreach data of varlist irs_sample_1 irs_sample_2 acs_period_1 acs_period_2  {
  2. 
.         ** Define covariates based on data type
.         ** irs_sample_1 uses basic covariates; all others add property tax rate
.         if "`data'" == "irs_sample_1" local covariates "population per_capita_income"
  3.         else local covariates "population per_capita_income prop_tax_rate"
  4. 
.         ** Different sets of outcome variables
.         if "`data'" == "irs_sample_1" local out_type "irs"
  5.         else if "`data'" == "irs_sample_2" local out_type "irs"
  6.         else local out_type "acs1 acs2"
  7. 
.         ** Loop over Outcome var type 
.         foreach type of local out_type {
  8.                 
.                 ** Labels 
.                 if "`data'" == "irs_sample_1" local out_txt "irs_full_16_22"
  9.                 if "`data'" == "irs_sample_2" local out_txt "irs_389_16_22"
 10.                 else if "`data'" == "acs_period_1" & "`type'" == "acs1" local out_txt "acs_16_22_
> all"
 11.                 else if "`data'" == "acs_period_1" & "`type'" == "acs2" local out_txt "acs_16_22_
> col"
 12.                 else if "`data'" == "acs_period_1" & "`type'" == "acs3" local out_txt "acs_16_22_
> noc"
 13.                 else if "`data'" == "acs_period_1" & "`type'" == "acs4" local out_txt "acs_16_22_
> 3D"
 14.                 else if "`data'" == "acs_period_2" & "`type'" == "acs1" local out_txt "acs_16_24_
> all"
 15.                 else if "`data'" == "acs_period_2" & "`type'" == "acs2" local out_txt "acs_16_24_
> col"
 16.                 else if "`data'" == "acs_period_2" & "`type'" == "acs3" local out_txt "acs_16_24_
> noc"
 17.                 else if "`data'" == "acs_period_2" & "`type'" == "acs4" local out_txt "acs_16_24_
> 3D"
 18. 
.                 ** Check if subfolder exists, create if not
.                 capture mkdir "${results}sdid/`out_txt'"
 19. 
.                 ** Loop over samples
.                 foreach samp of varlist sample_all sample_urban95 sample_urban95_covid {        
 20.                         
.                         ** Loop over exclusion of 2019-2020 period 
.                         forvalues exl = 1(-1)0 {
 21.                                 
.                                 ** Define sample        
.                                 gen sample = `samp' == 1 & `data' == 1 
 22.                                 if `exl' == 1 replace sample = 0 if year == 2020 
 23.                                 
.                                 ** Clear stored values 
.                                 eststo clear 
 24.                                 
.                                 ** Loop over migration type 
.                                 foreach migr in "net" "in" "out" {
 25.                                         
.                                         ** Loop over outcomes 
.                                         foreach out of varlist  n1_`migr'_rate_`type'   ///
>                                                                                         n2_`migr'_ra
> te_`type'   ///
>                                                                                         agi_`migr'_r
> ate_`type' {
 26.                                         
.                                                 ** Store label 
.                                                 local label : variable label `out'
 27.                                                 
.                                                 ** Loop over inclusion of covariates
.                                                 forvalues c = 0/1 {
 28.                                                 
.                                                         ** Covariates
.                                                         if `c' == 0 local covars ""
 29.                                                         else if `c' == 1 local covars "covariates
> (`covariates', projected)"
 30. 
.                                                         ** Covariates for sdid_event (doesn't suppor
> t 'projected' option)
.                                                         if `c' == 0 local covars_event ""
 31.                                                         else if `c' == 1 local covars_event "cova
> riates(`covariates')"
 32.                                                         
.                                                         ** File Name 
.                                                         if `exl' == 0 local path "${results}sdid/`ou
> t_txt'/fig_`out_txt'_`out'_`c'_`samp'_"
 33.                                                         if `exl' == 1 local path "${results}sdid/
> `out_txt'/fig_`out_txt'_`out'_`c'_`samp'_excl2020_"
 34.                 
.                                                         
.                                                         ** Run SDID
.                                                         eststo sdid_`out'_`c': sdid `out' fips year 
> Treated     ///
>                                                                 if sample == 1,                     
>     ///
>                                                                 vce(placebo)                        
>     ///
>                                                                 `covars'                            
>             ///
>                                                                 reps(`reps')                        
>     ///
>                                                                 graph graph_export("`path'", .pdf)
 35. 
.                                                         ** Store model output 
.                                                         local tmp_tau = e(ATT)
 36.                                                         local tmp_se = e(se)
 37.                                                         matrix omega = e(omega)
 38.                                                         
.                                                         ** Store pre-treatment means and county coun
> ts 
.                                                         qui summ `out' if multnomah == 1 & Treated =
> = 0
 39.                                                         local tmp_premean = r(mean)
 40.                                                         estadd scalar mean = r(mean)
 41.                                                         
.                                                         qui summ `out' if year == 2021 & sample == 1
 42.                                                         local tmp_ncounties = r(N)
 43.                                                         estadd scalar count = r(N)      
 44.                                                         
.                                                         ** Preserve ATE / SE 
.                                                         preserve
 45.                                                         clear
 46.                                                         qui set obs 1
 47.                                                         gen sample_data = "`out_txt'"
 48.                                                         gen sample = "`samp'"
 49.                                                         gen outcome = "`out'"
 50.                                                         gen controls = `c'
 51.                                                         gen exclusion = `exl'
 52.                                                         gen tau = `tmp_tau'
 53.                                                         gen se = `tmp_se'
 54.                                                         gen pval = 2 * (1 - normal(abs(tau/se)))
 55.                                                         gen ci_lower = tau - 1.96 * se
 56.                                                         gen ci_upper = tau + 1.96 * se
 57.                                                         gen n_counties = `tmp_ncounties'
 58.                                                         gen pre_mean = `tmp_premean'
 59.                                                         order sample_data sample outcome controls
>  exclusion     ///
>                                                                 tau se pval ci_lower ci_upper n_coun
> ties pre_mean
 60.                                                         append using "${results}sdid/sdid_results
> .dta"
 61.                                                         compress
 62.                                                         save "${results}sdid/sdid_results.dta", r
> eplace
 63.                                                         clear
 64.                                                         restore
 65.                                                         
.                                                         ** Store weights
.                                                         preserve
 66.                                                         clear
 67.                                                         svmat double omega, names(col)
 68.                                                         rename c2 fips
 69.                                                         rename c1 weight
 70.                                                         gen sample_data = "`out_txt'"
 71.                                                         gen out = "`out'"
 72.                                                         gen sample = "`samp'"
 73.                                                         gen controls = `c'
 74.                                                         gen exclusion = `exl'
 75.                                                         drop if weight == 0
 76.                                                         drop if missing(fips )
 77.                                                         order sample_data sample out controls exc
> lusion fips weight
 78.                                                         sort weight
 79.                                                         append using "${results}sdid/sdid_weights
> .dta"
 80.                                                         compress
 81.                                                         save "${results}sdid/sdid_weights.dta", r
> eplace
 82.                                                         clear 
 83.                                                         restore 
 84.                                                         
.                                                         ** Run event-study
.                                                         sdid_event `out' fips year Treated          
>             ///
>                                                                 if sample == 1,                     
>                     ///
>                                                                 `covars_event'                      
>                     ///
>                                                                 vce(placebo)                        
>                     ///
>                                                                 brep(`reps')                        
>                     ///
>                                                                 placebo(all)
 85. 
.                                                         ** Clean up sdid_event internal variables
.                                                         capture drop ever_treated*
 86.                                                         
.                                                         ** Create Figure
. 
.                                                         ** Store max year
.                                                         qui summ year if multnomah == 1 & sample == 
> 1
 87.                                                         local max_yr = r(max)
 88.                                                         dis "`max_yr'"
 89. 
.                                                         ** Move results from matrix to data
.                                                         qui count if multnomah == 1 & sample == 1
 90.                                                         local ct = r(N)
 91.                                                         local ct = `ct' + 1
 92.                                                         matrix list e(H)
 93.                                                         mat res = e(H)[2..`ct',1..5]
 94. 
.                                                         ** Preserve data before plotting (expand cre
> ates duplicate obs)
.                                                         preserve
 95. 
.                                                         ** Move Matrix results to data
.                                                         svmat res
 96. 
.                                                         ** Generate ID variable
.                                                         gen id = `max_yr' - _n + 1 if !missing(res1)
 97. 
.                                                         ** Update labeling for exclusion of 2020
.                                                         if `exl' == 1 {
 98.                                                                 replace id = id - 1 if id <= 2020
 99.                                                                 expand 2 if id == 2019, gen(tag)
100.                                                                 replace id = 2020 if tag == 1
101.                                                                 replace res1 = . if tag == 1
102.                                                                 replace res3 = . if tag == 1
103.                                                                 replace res4 = . if tag == 1
104.                                                         }
105.                                                         label var id "Year (destination)"
106. 
.                                                         ** Sort
.                                                         sort id
107. 
.                                                         ** Plot
.                                                         twoway  (rcap res3 res4 id, lc(gs10) fc(gs11
> %50))       ///
>                                                                         (scatter res1 id, mc(black))
> ,                           ///
>                                                                 legend(off) ytitle("`label'")       
>                             ///
>                                                                 yline(0, lc(red) lp(-))             
>                                     ///
>                                                                 xline(2020.5, lc(black) lp(solid))  
>                             ///
>                                                                 ylabel(-10(2.5)10, format(%9.1f))
108. 
.                                                         if `exl' == 0 local path "${results}sdid/`ou
> t_txt'/fig_`out_txt'_`out'_`c'_`samp'_eventstudy.jpg"
109.                                                         if `exl' == 1 local path "${results}sdid/
> `out_txt'/fig_`out_txt'_`out'_`c'_`samp'_excl2020_eventstudy.jpg"
110. 
.                                                         graph export "`path'",  ///
>                                                                 as(jpg) name("Graph") quality(100) r
> eplace
111. 
.                                                         ** Restore data (removes expanded rows and t
> emp variables)
.                                                         restore 
112.                                                                                         
.                                                 } // END COVAR LOOP 
113.                                         
.                                         } // END OUTCOME LOOP 
114.                                         
.                                         ** Determine name
.                                         if `exl' == 0 local path "${results}sdid/`out_txt'/tab_sdid_
> `out_txt'_`migr'_`samp'.tex"
115.                                         if `exl' == 1 local path "${results}sdid/`out_txt'/tab_sd
> id_`out_txt'_`migr'_`samp'_excl2020.tex"
116.                                         
. 
.                                         ** Table of results 
.                                         if "`data'" == "irs_sample1" |  "`data'" == "irs_sample2" | 
>  {
117.                                         
.                                         esttab  sdid_n1_`migr'_rate_`type'_0 sdid_n1_`migr'_rate_`ty
> pe'_1       ///
>                                                         sdid_n2_`migr'_rate_`type'_0 sdid_n2_`migr'_
> rate_`type'_1       ///
>                                                         sdid_agi_`migr'_rate_`type'_0 sdid_agi_`migr
> '_rate_`type'_1 ///
>                                                 using "`path'",                                     
>                     ///
>                                         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                ///
>                                         b(%-9.3f) se(%-9.3f) replace                                
>     ///
>                                         mgroups("Returns" "Exemptions" "AGI",                   ///
>                                                 pattern(1 0 1 0 1 0) )                              
>             ///
>                                         mtitle( "No Covariates" "Covariates"                    ///
>                                                         "No Covariates" "Covariates"                
>     ///
>                                                         "No Covariates" "Covariates")               
>     ///
>                                         stats(count mean,                                           
>                     ///
>                                                 fmt(%9.0fc %9.3fc)                                  
>                     ///
>                                                 labels("Number of Counties" "Pre-treatment mean"))
118.                                         }
119.                                         else {
120.                                         esttab  sdid_n1_`migr'_rate_`type'_0 sdid_n1_`migr'_rate_
> `type'_1       ///
>                                                         sdid_n2_`migr'_rate_`type'_0 sdid_n2_`migr'_
> rate_`type'_1       ///
>                                                         sdid_agi_`migr'_rate_`type'_0 sdid_agi_`migr
> '_rate_`type'_1 ///
>                                                 using "`path'",                                     
>                     ///
>                                         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                ///
>                                         b(%-9.3f) se(%-9.3f) replace                                
>     ///
>                                         mgroups("Households" "Adults" "Household Income",       ///
>                                                 pattern(1 0 1 0 1 0) )                              
>             ///
>                                         mtitle( "No Covariates" "Covariates"                    ///
>                                                         "No Covariates" "Covariates"                
>     ///
>                                                         "No Covariates" "Covariates")               
>     ///
>                                         stats(count mean,                                           
>                     ///
>                                                 fmt(%9.0fc %9.3fc)                                  
>                     ///
>                                                 labels("Number of Counties" "Pre-treatment mean"))
121.                                                 
.                                         }
122. 
.                                 
.                                 } // END MIGRATION TYPE LOOP 
123.                                 
.                                 ** Drop sample var 
.                                 drop sample 
124.                                 
.                         } // END EXCLUSION LOOP 
125.                         
.                 } // END SAMPLE LOOP 
126.         
.         } // END OUT TYPE 
127.         
. } // END DATA LOOP 
(2,916 real changes made)
Placebo replications (100). This may take some time.
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5
..................................................     50
..................................................     100


Synthetic Difference-in-Differences Estimator

-----------------------------------------------------------------------------
n1_net_rat~s |     ATT     Std. Err.     t      P>|t|    [95% Conf. Interval]
-------------+---------------------------------------------------------------
     Treated |  -1.92529    1.10901    -1.74    0.083    -4.09890     0.24833
-----------------------------------------------------------------------------
95% CIs and p-values are based on large-sample approximations.
Refer to Arkhangelsky et al., (2021) for theoretical derivations.
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_full_16
    > _22_n1_net_rate_irs_0_sample_all_excl2020_trends2021.pdf saved as PDF format

added scalar:
               e(mean) =  .1434552

added scalar:
              e(count) =  2916
  variable controls was float now byte
  variable exclusion was float now byte
  variable n_counties was float now int
  (8 bytes saved)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_results.dta saved
number of observations will be reset to 2916
Press any key to continue, or Break to abort
Number of observations (_N) was 0, now 2,916.
(1,160 observations deleted)
(1 observation deleted)
  variable controls was float now byte
  variable exclusion was float now byte
  variable fips was double now long
  (17,550 bytes saved)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_weights.dta saved
Synthetic Difference-in-differences

Boostrap replications (100), placebo mode.
|0% ----------------------------------------- 100%|
|.................................................|


             |  Estimate         SE      LB CI      UB CI  Switchers 
-------------+------------------------------------------------------
         ATT | -1.925286   1.346564  -4.564551   .7139788          1 
    Effect_1 | -2.430048   1.635941  -5.636493   .7763971          1 
    Effect_2 | -1.420525   1.479684  -4.320706   1.479656          1 
   Placebo_1 |  .0018158   .1439491  -.2803243    .283956          1 
   Placebo_2 | -.0017198   .0811338   -.160742   .1573024          1 
   Placebo_3 | -.0060693   .1413559  -.2831268   .2709882          1 
   Placebo_4 |  .0088023   .0576835  -.1042574    .121862          1 
2022

e(H)[7,5]
             Estimate          SE       LB CI       UB CI   Switchers
      ATT  -1.9252863   1.3465638  -4.5645514   .71397881           1
 Effect_1  -2.4300477   1.6359412  -5.6364926   .77639711           1
 Effect_2  -1.4205248   1.4796842  -4.3207059   1.4796563           1
Placebo_1   .00181583   .14394906  -.28032433     .283956           1
Placebo_2  -.00171981   .08113378  -.16074202   .15730241           1
Placebo_3  -.00606931   .14135587  -.28312681   .27098818           1
Placebo_4   .00880226   .05768352  -.10425743   .12186196           1
(21,172 missing values generated)
(4 real changes made)
(1 observation created)
(1 real change made)
(1 real change made, 1 to missing)
(1 real change made, 1 to missing)
(1 real change made, 1 to missing)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_full_16_
> 22_n1_net_rate_irs_0_sample_all_excl2020_eventstudy.jpg written in JPEG format
Placebo replications (100). This may take some time.
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5
..................................................     50
..................................................     100


Synthetic Difference-in-Differences Estimator

-----------------------------------------------------------------------------
n1_net_rat~s |     ATT     Std. Err.     t      P>|t|    [95% Conf. Interval]
-------------+---------------------------------------------------------------
     Treated |  -1.89125    0.79158    -2.39    0.017    -3.44272    -0.33979
-----------------------------------------------------------------------------
95% CIs and p-values are based on large-sample approximations.
Refer to Arkhangelsky et al., (2021) for theoretical derivations.
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_full_16
    > _22_n1_net_rate_irs_1_sample_all_excl2020_trends2021.pdf saved as PDF format

added scalar:
               e(mean) =  .1434552

added scalar:
              e(count) =  2916
  variable controls was float now byte
  variable exclusion was float now byte
  variable n_counties was float now int
  (16 bytes saved)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_results.dta saved
number of observations will be reset to 2916
Press any key to continue, or Break to abort
Number of observations (_N) was 0, now 2,916.
(1,122 observations deleted)
(1 observation deleted)
  variable controls was float now byte
  variable exclusion was float now byte
  variable fips was double now long
  (35,480 bytes saved)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_weights.dta saved
Synthetic Difference-in-differences

Boostrap replications (100), placebo mode.
|0% ----------------------------------------- 100%|
|.................................................|


             |  Estimate         SE      LB CI      UB CI  Switchers 
-------------+------------------------------------------------------
         ATT | -1.900694   1.010178  -3.880643   .0792554          1 
    Effect_1 |  -2.39265   1.537533  -5.406214   .6209146          1 
    Effect_2 | -1.408738   .9919246  -3.352911   .5354338          1 
   Placebo_1 |  .0020645   .0443337  -.0848296   .0889586          1 
   Placebo_2 | -.0018603    .063325  -.1259773   .1222566          1 
   Placebo_3 | -.0061974   .0573417  -.1185871   .1061923          1 
   Placebo_4 |   .008127   .0483552  -.0866492   .1029033          1 
2022

e(H)[7,5]
             Estimate          SE       LB CI       UB CI   Switchers
      ATT  -1.9006941   1.0101783  -3.8806435   .07925537           1
 Effect_1  -2.3926497   1.5375328   -5.406214   .62091456           1
 Effect_2  -1.4087384   .99192458  -3.3529106   .53543379           1
Placebo_1   .00206448   .04433373  -.08482962   .08895859           1
Placebo_2  -.00186031   .06332498  -.12597726   .12225664           1
Placebo_3  -.00619741    .0573417  -.11858714   .10619233           1
Placebo_4   .00812705   .04835522  -.08664919   .10290329           1
(21,172 missing values generated)
(4 real changes made)
(1 observation created)
(1 real change made)
(1 real change made, 1 to missing)
(1 real change made, 1 to missing)
(1 real change made, 1 to missing)
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_full_16
> _22_n1_net_rate_irs_1_sample_all_excl2020_eventstudy.jpg not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_full_16_
> 22_n1_net_rate_irs_1_sample_all_excl2020_eventstudy.jpg written in JPEG format
Placebo replications (100). This may take some time.
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5
..................................................     50
..................................................     100


Synthetic Difference-in-Differences Estimator

-----------------------------------------------------------------------------
n2_net_rat~s |     ATT     Std. Err.     t      P>|t|    [95% Conf. Interval]
-------------+---------------------------------------------------------------
     Treated |  -1.82184    1.17671    -1.55    0.122    -4.12814     0.48447
-----------------------------------------------------------------------------
95% CIs and p-values are based on large-sample approximations.
Refer to Arkhangelsky et al., (2021) for theoretical derivations.
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_full_16
    > _22_n2_net_rate_irs_0_sample_all_excl2020_trends2021.pdf saved as PDF format

added scalar:
               e(mean) =  -.73591077

added scalar:
              e(count) =  2916
  variable controls was float now byte
  variable exclusion was float now byte
  variable n_counties was float now int
  (24 bytes saved)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_results.dta saved
number of observations will be reset to 2916
Press any key to continue, or Break to abort
Number of observations (_N) was 0, now 2,916.
(1,204 observations deleted)
(1 observation deleted)
  variable controls was float now byte
  variable exclusion was float now byte
  variable fips was double now long
  (52,590 bytes saved)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_weights.dta saved
Synthetic Difference-in-differences

Boostrap replications (100), placebo mode.
|0% ----------------------------------------- 100%|
|.................................................|


             |  Estimate         SE      LB CI      UB CI  Switchers 
-------------+------------------------------------------------------
         ATT | -1.821837   .8822703  -3.551087  -.0925869          1 
    Effect_1 | -2.268932   1.161435  -4.545344   .0074796          1 
    Effect_2 | -1.374741   1.119617   -3.56919    .819708          1 
   Placebo_1 |  .0027779   .0867441  -.1672405   .1727963          1 
   Placebo_2 | -.0013103   .3239968  -.6363441   .6337234          1 
   Placebo_3 | -.0077218   .0428733  -.0917535   .0763099          1 
   Placebo_4 |  .0067843   .1616331  -.3100166   .3235852          1 
2022

e(H)[7,5]
             Estimate          SE       LB CI       UB CI   Switchers
      ATT  -1.8218368   .88227035  -3.5510867   -.0925869           1
 Effect_1  -2.2689324   1.1614347  -4.5453444   .00747959           1
 Effect_2  -1.3747411   1.1196169  -3.5691903   .81970801           1
Placebo_1    .0027779   .08674407  -.16724047   .17279627           1
Placebo_2  -.00131033   .32399683  -.63634411   .63372345           1
Placebo_3  -.00772184   .04287332  -.09175354   .07630986           1
Placebo_4   .00678431   .16163311  -.31001658    .3235852           1
(21,172 missing values generated)
(4 real changes made)
(1 observation created)
(1 real change made)
(1 real change made, 1 to missing)
(1 real change made, 1 to missing)
(1 real change made, 1 to missing)
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_full_16
> _22_n2_net_rate_irs_0_sample_all_excl2020_eventstudy.jpg not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_full_16_
> 22_n2_net_rate_irs_0_sample_all_excl2020_eventstudy.jpg written in JPEG format
Placebo replications (100). This may take some time.
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5
..................................................     50
..................................................     100


Synthetic Difference-in-Differences Estimator

-----------------------------------------------------------------------------
n2_net_rat~s |     ATT     Std. Err.     t      P>|t|    [95% Conf. Interval]
-------------+---------------------------------------------------------------
     Treated |  -1.77898    1.04670    -1.70    0.089    -3.83048     0.27253
-----------------------------------------------------------------------------
95% CIs and p-values are based on large-sample approximations.
Refer to Arkhangelsky et al., (2021) for theoretical derivations.
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_full_16
    > _22_n2_net_rate_irs_1_sample_all_excl2020_trends2021.pdf saved as PDF format

added scalar:
               e(mean) =  -.73591077

added scalar:
              e(count) =  2916
  variable controls was float now byte
  variable exclusion was float now byte
  variable n_counties was float now int
  (32 bytes saved)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_results.dta saved
number of observations will be reset to 2916
Press any key to continue, or Break to abort
Number of observations (_N) was 0, now 2,916.
(1,199 observations deleted)
(1 observation deleted)
  variable controls was float now byte
  variable exclusion was float now byte
  variable fips was double now long
  (69,750 bytes saved)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_weights.dta saved
Synthetic Difference-in-differences

Boostrap replications (100), placebo mode.
|0% ----------------------------------------- 100%|
|.................................................|


             |  Estimate         SE      LB CI      UB CI  Switchers 
-------------+------------------------------------------------------
         ATT | -1.787821   .8942864  -3.540623  -.0350198          1 
    Effect_1 | -2.221646   1.132949  -4.442226  -.0010663          1 
    Effect_2 | -1.353997   1.212513  -3.730522   1.022529          1 
   Placebo_1 |  .0029415   .0166287  -.0296507   .0355337          1 
   Placebo_2 | -.0012815   .0490297  -.0973797   .0948167          1 
   Placebo_3 |  -.007775   .1364167  -.2751517   .2596017          1 
   Placebo_4 |  .0062534   .0803695  -.1512709   .1637777          1 
2022

e(H)[7,5]
             Estimate          SE       LB CI       UB CI   Switchers
      ATT  -1.7878213   .89428643  -3.5406227  -.03501984           1
 Effect_1  -2.2216459   1.1329488  -4.4422255  -.00106628           1
 Effect_2  -1.3539966   1.2125128  -3.7305218   1.0225286           1
Placebo_1   .00294151   .01662866  -.02965068   .03553369           1
Placebo_2  -.00128151   .04902971  -.09737975   .09481673           1
Placebo_3  -.00777497   .13641668  -.27515167   .25960172           1
Placebo_4   .00625338   .08036954  -.15127092   .16377769           1
(21,172 missing values generated)
(4 real changes made)
(1 observation created)
(1 real change made)
(1 real change made, 1 to missing)
(1 real change made, 1 to missing)
(1 real change made, 1 to missing)
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_full_16
> _22_n2_net_rate_irs_1_sample_all_excl2020_eventstudy.jpg not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_full_16_
> 22_n2_net_rate_irs_1_sample_all_excl2020_eventstudy.jpg written in JPEG format
Placebo replications (100). This may take some time.
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5
..................................................     50
..................................................     100


Synthetic Difference-in-Differences Estimator

-----------------------------------------------------------------------------
agi_net_ra~s |     ATT     Std. Err.     t      P>|t|    [95% Conf. Interval]
-------------+---------------------------------------------------------------
     Treated |  -3.74944    0.98584    -3.80    0.000    -5.68164    -1.81724
-----------------------------------------------------------------------------
95% CIs and p-values are based on large-sample approximations.
Refer to Arkhangelsky et al., (2021) for theoretical derivations.
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_full_16
    > _22_agi_net_rate_irs_0_sample_all_excl2020_trends2021.pdf saved as PDF format

added scalar:
               e(mean) =  -.29483641

added scalar:
              e(count) =  2916
  variable controls was float now byte
  variable exclusion was float now byte
  variable n_counties was float now int
  (40 bytes saved)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_results.dta saved
number of observations will be reset to 2916
Press any key to continue, or Break to abort
Number of observations (_N) was 0, now 2,916.
(83 observations deleted)
(1 observation deleted)
  variable controls was float now byte
  variable exclusion was float now byte
  variable fips was double now long
  (98,070 bytes saved)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_weights.dta saved
Synthetic Difference-in-differences

Boostrap replications (100), placebo mode.
|0% ----------------------------------------- 100%|
|.................................................|


             |  Estimate         SE      LB CI      UB CI  Switchers 
-------------+------------------------------------------------------
         ATT | -3.749438   1.192108   -6.08597  -1.412906          1 
    Effect_1 | -3.942519   1.614332  -7.106609   -.778429          1 
    Effect_2 | -3.556357   1.337483  -6.177823  -.9348898          1 
   Placebo_1 |  .0037643   .1408932  -.2723864   .2799149          1 
   Placebo_2 | -.0011156   .1549289  -.3047761    .302545          1 
   Placebo_3 | -.0030111   .2071753  -.4090747   .4030526          1 
   Placebo_4 |  .0023952   .0651454  -.1252898   .1300802          1 
2022

e(H)[7,5]
             Estimate          SE       LB CI       UB CI   Switchers
      ATT  -3.7494376   1.1921081  -6.0859696  -1.4129057           1
 Effect_1  -3.9425187   1.6143315  -7.1066085  -.77842898           1
 Effect_2  -3.5563565    1.337483  -6.1778233  -.93488983           1
Placebo_1   .00376427    .1408932   -.2723864   .27991495           1
Placebo_2  -.00111556   .15492886  -.30477612   .30254501           1
Placebo_3  -.00301105   .20717534  -.40907473   .40305262           1
Placebo_4   .00239518   .06514541  -.12528984   .13008019           1
(21,172 missing values generated)
(4 real changes made)
(1 observation created)
(1 real change made)
(1 real change made, 1 to missing)
(1 real change made, 1 to missing)
(1 real change made, 1 to missing)
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_full_16
> _22_agi_net_rate_irs_0_sample_all_excl2020_eventstudy.jpg not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_full_16_
> 22_agi_net_rate_irs_0_sample_all_excl2020_eventstudy.jpg written in JPEG format
Placebo replications (100). This may take some time.
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5
............--Break--
r(1);

end of do-file
--Break--
r(1);

end of do-file

--Break--
r(1);

. do "C:\Users\ji252\AppData\Local\Temp\STD4058_00000a.tmp"

. ** Flow-based models (IRS)
. do ${code}02_flow_analysis.do

. /*******************************************************************************
> File Name:              02_flow_analysis.do
> Creator:                John Iselin
> Date Update:    January 15, 2026
> 
> Called by: 00_multnomah.do
> 
> Purpose: Perform flow-based analysis on IRS data.
> 
> Outputs:
> - county_did_coefficients.dta/csv: DiD coefficients for all counties
>   (b_out, b_in, se_out, se_in, t-stats, p-values, percentile ranks)
> - fig_multnomah_post_*.png: DiD coefficient plots for Multnomah
> - fig_hist_out_coef.png: Histogram of out-migration coefficients
> - fig_hist_in_coef.png: Histogram of in-migration coefficients
> - fig_scatter_out_in_coef.png: Scatter plot of out vs in coefficients
> - fig_multnomah_out_*.png: Event study plots for out-migration
> - fig_multnomah_in_*.png: Event study plots for in-migration
> - fig_multnomah_both_*.png: Combined event study plots
> 
> Authors: John Iselin
> 
> For more information, contact john.iselin@yale.edu
> 
> *******************************************************************************/
. 
. 
. ** Start log file
. capture log close log_02

. log using "${logs}02_log_flow_${date}", replace text name(log_02)
------------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_flow_2026-01-15.log
  log type:  text
 opened on:  16 Jan 2026, 08:40:08

. 
. ** Parameters
. local reps = 100

. 
. ** Load IRS Data
. use "${data}working/irs_county_flow.dta", clear

. 
. ** Sample restrictions
. drop if inlist(state_fips_o, 2, 15)     // Alaska and Hawaii
(3,109 observations deleted)

. drop if inlist(state_fips_d, 2, 15)     // Alaska and Hawaii
(2,293 observations deleted)

. 
. ** Clean up variables
. drop fips

. 
. ** Merge with time-varying controls
. 
. ** Keep if in donor pool in both origin and destination
. foreach x in "o" "d" {
  2. 
.         ** Merge with relevent variables
.         gen fips = fips_`x'
  3.         merge m:1 year fips using "${data}working/bls_unemployment",    ///
>                 keep(match) gen(merge_bls_`x')
  4.         merge m:1 year fips using "${data}working/bea_economics",               ///
>                 keep(match) gen(merge_bea_`x')
  5. 
.         ** Rename
.         rename unemp unemp_`x'
  6.         rename population pop_`x'
  7.         rename per_capita_income per_capita_income_`x'
  8.         drop fips
  9. 
. } // END ORIGIN-DESTINATION LOOP
(variable fips was float, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           353,742  (merge_bls_o==3)
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           348,116  (merge_bea_o==3)
    -----------------------------------------
(variable fips was float, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           345,941  (merge_bls_d==3)
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           342,102  (merge_bea_d==3)
    -----------------------------------------

. 
. 
. ** Mover indicators
. gen mover = fips_o != fips_d

. 
. ** Generate flow id
. egen flow_id = group(fips_d fips_o)

. 
. ** Keep balanced panel of flows 
. bysort flow_id: gen ct = _N

. tab ct 

         ct |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     10,447        3.05        3.05
          2 |     11,672        3.41        6.47
          3 |     13,200        3.86       10.32
          4 |     15,228        4.45       14.78
          5 |     18,945        5.54       20.31
          6 |     29,766        8.70       29.01
          7 |    242,844       70.99      100.00
------------+-----------------------------------
      Total |    342,102      100.00

. keep if ct >= 7
(99,258 observations deleted)

. 
. ** Multnomah indicators
. gen out_multnomah = (state_fips_o == 41 & county_fips_o == 51)

. gen in_multnomah = (state_fips_d == 41 & county_fips_d == 51)

. 
. ** Post-indicators
. gen post = year > 2020

. 
. ** Interactions
. gen in_multnomah_post = in_multnomah * post

. gen out_multnomah_post = out_multnomah * post

. 
. ** Create interactions manually (base year = 2020)
. forvalues y = 2016/2022 {
  2.         gen x_out_`y' = out_multnomah * (year == `y')
  3.         gen x_in_`y' = in_multnomah * (year == `y')
  4. }

. 
. ** Drop base year (2020)
. drop x_out_2020 x_in_2020  

. 
. ********************************************************************************
. ** REGRESSION 1: Multnomah X Post (DiD)
. ********************************************************************************
. 
. ** Data cleaning 
. replace agi = 0 if agi < 0 
(52 real changes made)

. 
. ** Loop over outcome variables
. foreach outcome in n1 n2 agi {
  2. 
.         ** Set outcome label for graphs
.         if "`outcome'" == "n1" local outcome_label "Number of Returns"
  3.         if "`outcome'" == "n2" local outcome_label "Number of Exemptions"
  4.         if "`outcome'" == "agi" local outcome_label "Adjusted Gross Income"
  5. 
.         ** Regression 1a: With covariates
.         ppmlhdfe `outcome' i.out_multnomah_post i.in_multnomah_post     ///
>                 unemp_* pop_* per_capita_income_*                                                   
>     ///
>                 if mover == 1,                                                                      
>                     ///
>                 absorb(year flow_id) vce(cluster flow_id)
  6.         estimates store `outcome'_with_covars
  7. 
.         ** Regression 1b: Without covariates
.         ppmlhdfe `outcome' i.out_multnomah_post i.in_multnomah_post     ///
>                 if mover == 1,                                                                      
>                     ///
>                 absorb(year flow_id) vce(cluster flow_id)
  8.         estimates store `outcome'_no_covars
  9.         
.         ** Plot both regressions
.         coefplot        (`outcome'_with_covars, label("With Covariates")        ///
>                                         mc(navy) ciopts(lc(navy)))                                  
>             ///
>                                 (`outcome'_no_covars, label("Without Covariates")       ///
>                                         mc(maroon) ciopts(lc(maroon))),                             
>     ///
>                 keep(1.out_multnomah_post 1.in_multnomah_post)                          ///
>                 ciopts(recast(rcap))                                                                
>             ///
>                 yline(0, lc(gs10) lp(dash))                                                         
>     ///
>                 xline(0, lc(gs10) lp(dash))                                                         
>     ///
>                 coeflabels(     1.out_multnomah_post = "Out-migration"                  ///
>                                         1.in_multnomah_post = "In-migration")                   ///
>                 ytitle("Coefficient")                                                               
>             ///
>                 xtitle("")                                                                          
>                             ///
>                 legend(pos(6) rows(1))                                                              
>             ///
>                 title("Migration Flows: Multnomah County x Post")                       ///
>                 subtitle("`outcome_label'")                                                         
>             ///
>                 graphregion(color(white))
 10. 
.         graph export "${results}flows/fig_multnomah_post_`outcome'.png", replace
 11. 
. 
. } // END OUTCOME LOOP
Iteration 1:   deviance = 2.5745e+06  eps = .         iters = 3    tol = 1.0e-04  min(eta) =  -2.73  P
>    
Iteration 2:   deviance = 5.6235e+05  eps = 3.58e+00  iters = 2    tol = 1.0e-04  min(eta) =  -3.26   
>    
Iteration 3:   deviance = 5.2328e+05  eps = 7.47e-02  iters = 2    tol = 1.0e-04  min(eta) =  -3.45   
>    
Iteration 4:   deviance = 5.2323e+05  eps = 1.11e-04  iters = 2    tol = 1.0e-04  min(eta) =  -3.47   
>    
Iteration 5:   deviance = 5.2323e+05  eps = 1.69e-09  iters = 1    tol = 1.0e-04  min(eta) =  -3.47   
>    
Iteration 6:   deviance = 5.2323e+05  eps = 2.52e-16  iters = 1    tol = 1.0e-05  min(eta) =  -3.47   
> S  
Iteration 7:   deviance = 5.2323e+05  eps = 1.26e-16  iters = 1    tol = 1.0e-09  min(eta) =  -3.47   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 7 iterations and 12 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    242,844
Absorbing 2 HDFE groups                           Residual df     =     34,691
Statistics robust to heteroskedasticity           Wald chi2(8)    =    1039.96
Deviance             =  523226.0213               Prob > chi2     =     0.0000
Log pseudolikelihood = -1008038.515               Pseudo R2       =     0.9799

Number of clusters (flow_id)=     34,692
                                   (Std. err. adjusted for 34,692 clusters in flow_id)
--------------------------------------------------------------------------------------
                     |               Robust
                  n1 | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
---------------------+----------------------------------------------------------------
1.out_multnomah_post |   .0088172   .0227387     0.39   0.698    -.0357498    .0533841
 1.in_multnomah_post |  -.0757481   .0164515    -4.60   0.000    -.1079924   -.0435039
             unemp_o |   .0240935   .0010083    23.90   0.000     .0221173    .0260697
             unemp_d |  -.0219545    .001033   -21.25   0.000    -.0239792   -.0199298
               pop_o |   6.31e-08   3.21e-08     1.97   0.049     2.11e-10    1.26e-07
               pop_d |   3.60e-07   3.33e-08    10.79   0.000     2.94e-07    4.25e-07
 per_capita_income_o |   2.18e-06   3.81e-07     5.72   0.000     1.43e-06    2.92e-06
 per_capita_income_d |  -1.62e-06   2.97e-07    -5.44   0.000    -2.20e-06   -1.03e-06
               _cons |   5.802999   .0561722   103.31   0.000     5.692903    5.913094
--------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     34692       34692           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
Iteration 1:   deviance = 2.5987e+06  eps = .         iters = 3    tol = 1.0e-04  min(eta) =  -2.69  P
>    
Iteration 2:   deviance = 5.8515e+05  eps = 3.44e+00  iters = 2    tol = 1.0e-04  min(eta) =  -3.23   
>    
Iteration 3:   deviance = 5.4608e+05  eps = 7.15e-02  iters = 2    tol = 1.0e-04  min(eta) =  -3.42   
>    
Iteration 4:   deviance = 5.4602e+05  eps = 1.06e-04  iters = 2    tol = 1.0e-04  min(eta) =  -3.44   
>    
Iteration 5:   deviance = 5.4602e+05  eps = 1.62e-09  iters = 1    tol = 1.0e-04  min(eta) =  -3.44   
>    
Iteration 6:   deviance = 5.4602e+05  eps = 2.41e-16  iters = 1    tol = 1.0e-05  min(eta) =  -3.44   
> S  
Iteration 7:   deviance = 5.4602e+05  eps = 1.21e-16  iters = 1    tol = 1.0e-09  min(eta) =  -3.44   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 7 iterations and 12 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    242,844
Absorbing 2 HDFE groups                           Residual df     =     34,691
Statistics robust to heteroskedasticity           Wald chi2(2)    =      30.36
Deviance             =  546024.8437               Prob > chi2     =     0.0000
Log pseudolikelihood = -1019437.927               Pseudo R2       =     0.9797

Number of clusters (flow_id)=     34,692
                                   (Std. err. adjusted for 34,692 clusters in flow_id)
--------------------------------------------------------------------------------------
                     |               Robust
                  n1 | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
---------------------+----------------------------------------------------------------
1.out_multnomah_post |   .0154431   .0233843     0.66   0.509    -.0303893    .0612755
 1.in_multnomah_post |  -.0855705   .0156644    -5.46   0.000    -.1162723   -.0548688
               _cons |   6.332383   .0000377  1.7e+05   0.000     6.332309    6.332457
--------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     34692       34692           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_multnomah_post_n1.png
    saved as PNG format
Iteration 1:   deviance = 4.8771e+06  eps = .         iters = 3    tol = 1.0e-04  min(eta) =  -2.81  P
>    
Iteration 2:   deviance = 1.2303e+06  eps = 2.96e+00  iters = 2    tol = 1.0e-04  min(eta) =  -3.37   
>    
Iteration 3:   deviance = 1.1553e+06  eps = 6.50e-02  iters = 2    tol = 1.0e-04  min(eta) =  -3.65   
>    
Iteration 4:   deviance = 1.1551e+06  eps = 1.41e-04  iters = 2    tol = 1.0e-04  min(eta) =  -3.69   
>    
Iteration 5:   deviance = 1.1551e+06  eps = 8.37e-09  iters = 1    tol = 1.0e-04  min(eta) =  -3.69   
>    
Iteration 6:   deviance = 1.1551e+06  eps = 4.13e-16  iters = 1    tol = 1.0e-05  min(eta) =  -3.69   
> S  
Iteration 7:   deviance = 1.1551e+06  eps = 2.06e-16  iters = 1    tol = 1.0e-09  min(eta) =  -3.69   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 7 iterations and 12 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    242,844
Absorbing 2 HDFE groups                           Residual df     =     34,691
Statistics robust to heteroskedasticity           Wald chi2(8)    =    1017.21
Deviance             =  1155101.236               Prob > chi2     =     0.0000
Log pseudolikelihood = -1394106.164               Pseudo R2       =     0.9845

Number of clusters (flow_id)=     34,692
                                   (Std. err. adjusted for 34,692 clusters in flow_id)
--------------------------------------------------------------------------------------
                     |               Robust
                  n2 | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
---------------------+----------------------------------------------------------------
1.out_multnomah_post |   .0113317   .0200657     0.56   0.572    -.0279963    .0506596
 1.in_multnomah_post |  -.0737369   .0155564    -4.74   0.000     -.104227   -.0432469
             unemp_o |   .0227199   .0010565    21.51   0.000     .0206492    .0247906
             unemp_d |  -.0240049   .0011102   -21.62   0.000    -.0261809   -.0218289
               pop_o |   5.08e-08   3.25e-08     1.56   0.118    -1.28e-08    1.15e-07
               pop_d |   3.56e-07   3.08e-08    11.59   0.000     2.96e-07    4.17e-07
 per_capita_income_o |   2.55e-06   3.93e-07     6.49   0.000     1.78e-06    3.32e-06
 per_capita_income_d |  -2.08e-06   3.19e-07    -6.53   0.000    -2.71e-06   -1.46e-06
               _cons |    6.45028   .0564924   114.18   0.000     6.339557    6.561003
--------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     34692       34692           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
Iteration 1:   deviance = 4.9204e+06  eps = .         iters = 3    tol = 1.0e-04  min(eta) =  -2.75  P
>    
Iteration 2:   deviance = 1.2717e+06  eps = 2.87e+00  iters = 2    tol = 1.0e-04  min(eta) =  -3.36   
>    
Iteration 3:   deviance = 1.1967e+06  eps = 6.27e-02  iters = 2    tol = 1.0e-04  min(eta) =  -3.63   
>    
Iteration 4:   deviance = 1.1965e+06  eps = 1.36e-04  iters = 2    tol = 1.0e-04  min(eta) =  -3.68   
>    
Iteration 5:   deviance = 1.1965e+06  eps = 8.02e-09  iters = 1    tol = 1.0e-04  min(eta) =  -3.68   
>    
Iteration 6:   deviance = 1.1965e+06  eps = 5.98e-16  iters = 1    tol = 1.0e-05  min(eta) =  -3.68   
> S  
Iteration 7:   deviance = 1.1965e+06  eps = 0.00e+00  iters = 1    tol = 1.0e-09  min(eta) =  -3.68   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 7 iterations and 12 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    242,844
Absorbing 2 HDFE groups                           Residual df     =     34,691
Statistics robust to heteroskedasticity           Wald chi2(2)    =      33.81
Deviance             =  1196511.489               Prob > chi2     =     0.0000
Log pseudolikelihood = -1414811.291               Pseudo R2       =     0.9842

Number of clusters (flow_id)=     34,692
                                   (Std. err. adjusted for 34,692 clusters in flow_id)
--------------------------------------------------------------------------------------
                     |               Robust
                  n2 | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
---------------------+----------------------------------------------------------------
1.out_multnomah_post |   .0173025   .0198624     0.87   0.384    -.0216271    .0562321
 1.in_multnomah_post |  -.0861147   .0150124    -5.74   0.000    -.1155384    -.056691
               _cons |   6.917879   .0000275  2.5e+05   0.000     6.917825    6.917933
--------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     34692       34692           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_multnomah_post_n2.png
    saved as PNG format
Iteration 1:   deviance = 3.6390e+08  eps = .         iters = 4    tol = 1.0e-04  min(eta) =  -3.61  P
>    
Iteration 2:   deviance = 1.5381e+08  eps = 1.37e+00  iters = 3    tol = 1.0e-04  min(eta) =  -4.10   
>    
Iteration 3:   deviance = 1.4573e+08  eps = 5.55e-02  iters = 2    tol = 1.0e-04  min(eta) =  -4.67   
>    
Iteration 4:   deviance = 1.4561e+08  eps = 7.98e-04  iters = 2    tol = 1.0e-04  min(eta) =  -4.92   
>    
Iteration 5:   deviance = 1.4561e+08  eps = 1.85e-06  iters = 2    tol = 1.0e-04  min(eta) =  -4.96   
>    
Iteration 6:   deviance = 1.4561e+08  eps = 4.56e-11  iters = 2    tol = 1.0e-05  min(eta) =  -4.96   
> S  
Iteration 7:   deviance = 1.4561e+08  eps = 0.00e+00  iters = 1    tol = 1.0e-07  min(eta) =  -4.96   
> S  
Iteration 8:   deviance = 1.4561e+08  eps = 1.53e-16  iters = 1    tol = 1.0e-09  min(eta) =  -4.96   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 8 iterations and 17 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    242,844
Absorbing 2 HDFE groups                           Residual df     =     34,691
Statistics robust to heteroskedasticity           Wald chi2(8)    =     349.65
Deviance             =  145610883.4               Prob > chi2     =     0.0000
Log pseudolikelihood =  -74045181.7               Pseudo R2       =     0.9824

Number of clusters (flow_id)=     34,692
                                   (Std. err. adjusted for 34,692 clusters in flow_id)
--------------------------------------------------------------------------------------
                     |               Robust
                 agi | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
---------------------+----------------------------------------------------------------
1.out_multnomah_post |   .1637083   .0574195     2.85   0.004     .0511681    .2762484
 1.in_multnomah_post |  -.1842754   .0216594    -8.51   0.000    -.2267272   -.1418237
             unemp_o |   .0432255   .0057777     7.48   0.000     .0319015    .0545496
             unemp_d |   -.045658   .0040973   -11.14   0.000    -.0536885   -.0376275
               pop_o |  -2.81e-07   6.48e-08    -4.34   0.000    -4.08e-07   -1.54e-07
               pop_d |   4.59e-07   7.88e-08     5.82   0.000     3.04e-07    6.13e-07
 per_capita_income_o |   8.31e-06   9.61e-07     8.65   0.000     6.43e-06    .0000102
 per_capita_income_d |   1.20e-06   8.87e-07     1.35   0.177    -5.42e-07    2.94e-06
               _cons |   9.996335   .1489622    67.11   0.000     9.704374     10.2883
--------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     34692       34692           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
Iteration 1:   deviance = 3.7707e+08  eps = .         iters = 3    tol = 1.0e-04  min(eta) =  -3.19  P
>    
Iteration 2:   deviance = 1.6332e+08  eps = 1.31e+00  iters = 2    tol = 1.0e-04  min(eta) =  -4.05   
>    
Iteration 3:   deviance = 1.5498e+08  eps = 5.38e-02  iters = 2    tol = 1.0e-04  min(eta) =  -4.65   
>    
Iteration 4:   deviance = 1.5486e+08  eps = 7.58e-04  iters = 2    tol = 1.0e-04  min(eta) =  -4.89   
>    
Iteration 5:   deviance = 1.5486e+08  eps = 1.66e-06  iters = 2    tol = 1.0e-04  min(eta) =  -4.93   
>    
Iteration 6:   deviance = 1.5486e+08  eps = 3.90e-11  iters = 1    tol = 1.0e-05  min(eta) =  -4.93   
> S  
Iteration 7:   deviance = 1.5486e+08  eps = 0.00e+00  iters = 1    tol = 1.0e-07  min(eta) =  -4.93   
> S  
Iteration 8:   deviance = 1.5486e+08  eps = 0.00e+00  iters = 1    tol = 1.0e-09  min(eta) =  -4.93   
> S O
------------------------------------------------------------------------------------------------------
> ------
(legend: p: exact partial-out   s: exact solver   h: step-halving   o: epsilon below tolerance)
Converged in 8 iterations and 14 HDFE sub-iterations (tol = 1.0e-08)

HDFE PPML regression                              No. of obs      =    242,844
Absorbing 2 HDFE groups                           Residual df     =     34,691
Statistics robust to heteroskedasticity           Wald chi2(2)    =      80.57
Deviance             =  154863730.3               Prob > chi2     =     0.0000
Log pseudolikelihood = -78671605.12               Pseudo R2       =     0.9813

Number of clusters (flow_id)=     34,692
                                   (Std. err. adjusted for 34,692 clusters in flow_id)
--------------------------------------------------------------------------------------
                     |               Robust
                 agi | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
---------------------+----------------------------------------------------------------
1.out_multnomah_post |   .1702923   .0611878     2.78   0.005     .0503664    .2902181
 1.in_multnomah_post |   -.184156   .0217875    -8.45   0.000    -.2268587   -.1414533
               _cons |    10.8117   .0001194  9.1e+04   0.000     10.81147    10.81193
--------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         7           1           6     |
     flow_id |     34692       34692           0    *|
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/flows/fig_multnomah_post_agi.png
    saved as PNG format

. 
. ********************************************************************************
. ** REGRESSION 1b: Loop over all counties (Permutation-style analysis)
. ** Purpose: Run same DiD regression for each county to create distribution
. **          of treatment effects for comparison with Multnomah
. ********************************************************************************
. 
. ** Preserve data for later use in REGRESSION 2
. preserve

. 
. ** Get list of unique origin fips codes
. levelsof fips_o, local(fips_list)
1001 1003 1005 1007 1009 1011 1013 1015 1017 1019 1021 1025 1027 1029 1031 1033 1035 1037 1039 1041 10
> 43 1045 1047 1049 1051 1053 1055 1057 1059 1061 1063 1065 1067 1069 1071 1073 1075 1077 1079 1081 10
> 83 1085 1087 1089 1091 1093 1095 1097 1099 1101 1103 1105 1107 1109 1111 1113 1115 1117 1119 1121 11
> 23 1125 1127 1129 1131 1133 4001 4003 4005 4007 4009 4011 4012 4013 4015 4017 4019 4021 4023 4025 40
> 27 5001 5003 5005 5007 5009 5011 5015 5017 5019 5021 5023 5025 5027 5029 5031 5033 5035 5037 5041 50
> 43 5045 5047 5049 5051 5053 5055 5057 5059 5061 5063 5065 5067 5069 5071 5073 5075 5077 5079 5081 50
> 83 5085 5087 5089 5091 5093 5095 5097 5099 5101 5103 5105 5107 5109 5111 5115 5117 5119 5121 5123 51
> 25 5127 5131 5133 5135 5139 5141 5143 5145 5147 5149 6001 6005 6007 6009 6011 6013 6015 6017 6019 60
> 21 6023 6025 6027 6029 6031 6033 6035 6037 6039 6041 6043 6045 6047 6051 6053 6055 6057 6059 6061 60
> 63 6065 6067 6069 6071 6073 6075 6077 6079 6081 6083 6085 6087 6089 6093 6095 6097 6099 6101 6103 61
> 05 6107 6109 6111 6113 6115 8001 8003 8005 8007 8013 8014 8015 8019 8021 8027 8029 8031 8035 8037 80
> 39 8041 8043 8045 8047 8049 8051 8055 8059 8067 8069 8071 8075 8077 8081 8083 8085 8087 8089 8091 80
> 93 8097 8101 8103 8105 8107 8109 8113 8117 8119 8123 10001 10003 10005 11001 12001 12003 12005 12007
>  12009 12011 12013 12015 12017 12019 12021 12023 12027 12029 12031 12033 12035 12037 12039 12041 120
> 43 12045 12047 12049 12051 12053 12055 12057 12059 12061 12063 12065 12067 12069 12071 12073 12075 1
> 2077 12079 12081 12083 12085 12086 12087 12089 12091 12093 12095 12097 12099 12101 12103 12105 12107
>  12109 12111 12113 12115 12117 12119 12121 12123 12125 12127 12129 12131 12133 13001 13003 13005 130
> 09 13011 13013 13015 13017 13019 13021 13023 13025 13027 13029 13031 13033 13035 13039 13043 13045 1
> 3047 13049 13051 13053 13055 13057 13059 13063 13067 13069 13071 13073 13075 13077 13079 13081 13083
>  13085 13087 13089 13091 13093 13095 13097 13099 13101 13103 13105 13107 13109 13111 13113 13115 131
> 17 13119 13121 13123 13127 13129 13131 13133 13135 13137 13139 13141 13143 13145 13147 13149 13151 1
> 3153 13155 13157 13159 13161 13163 13165 13167 13169 13171 13173 13175 13177 13179 13181 13183 13185
>  13187 13189 13191 13193 13195 13197 13199 13201 13205 13207 13209 13211 13213 13215 13217 13219 132
> 21 13223 13225 13227 13229 13231 13233 13235 13237 13241 13245 13247 13249 13251 13253 13255 13257 1
> 3259 13261 13263 13267 13271 13273 13275 13277 13279 13281 13283 13285 13287 13289 13291 13293 13295
>  13297 13299 13301 13303 13305 13311 13313 13319 13321 16001 16005 16009 16011 16013 16015 16017 160
> 19 16021 16027 16029 16031 16035 16039 16041 16043 16045 16047 16049 16051 16053 16055 16057 16061 1
> 6063 16065 16067 16069 16073 16075 16077 16079 16081 16083 16085 16087 17001 17003 17005 17007 17011
>  17015 17017 17019 17021 17023 17025 17027 17029 17031 17033 17035 17037 17039 17041 17043 17045 170
> 49 17051 17053 17055 17057 17059 17061 17063 17065 17067 17071 17073 17075 17077 17079 17081 17083 1
> 7085 17087 17089 17091 17093 17095 17097 17099 17101 17103 17105 17107 17109 17111 17113 17115 17117
>  17119 17121 17123 17125 17127 17129 17131 17133 17135 17137 17139 17141 17143 17145 17147 17149 171
> 55 17157 17159 17161 17163 17165 17167 17169 17171 17173 17175 17177 17179 17181 17183 17185 17187 1
> 7189 17191 17195 17197 17199 17201 17203 18001 18003 18005 18007 18009 18011 18013 18015 18017 18019
>  18021 18023 18025 18027 18029 18031 18033 18035 18037 18039 18041 18043 18045 18047 18049 18051 180
> 53 18055 18057 18059 18061 18063 18065 18067 18069 18071 18073 18075 18077 18079 18081 18083 18085 1
> 8087 18089 18091 18093 18095 18097 18099 18101 18103 18105 18107 18109 18111 18113 18115 18117 18119
>  18121 18123 18125 18127 18129 18131 18133 18135 18137 18139 18141 18143 18145 18147 18149 18151 181
> 53 18155 18157 18159 18161 18163 18165 18167 18169 18171 18173 18175 18177 18179 18181 18183 19001 1
> 9005 19007 19011 19013 19015 19017 19019 19021 19023 19025 19027 19029 19031 19033 19037 19039 19041
>  19043 19045 19047 19049 19051 19053 19055 19057 19059 19061 19063 19065 19067 19069 19071 19073 190
> 75 19077 19079 19081 19083 19085 19087 19089 19091 19095 19097 19099 19101 19103 19105 19107 19109 1
> 9111 19113 19115 19117 19119 19121 19123 19125 19127 19129 19133 19139 19141 19143 19145 19147 19149
>  19153 19155 19157 19161 19163 19165 19167 19169 19171 19173 19175 19179 19181 19183 19187 19189 191
> 91 19193 19195 19197 20001 20005 20009 20011 20015 20021 20027 20029 20031 20035 20037 20041 20043 2
> 0045 20051 20055 20057 20059 20061 20069 20077 20079 20085 20087 20091 20093 20095 20099 20103 20107
>  20111 20113 20115 20121 20125 20131 20133 20139 20143 20145 20149 20151 20155 20159 20161 20163 201
> 67 20169 20173 20175 20177 20191 20197 20205 20209 21001 21003 21005 21007 21009 21011 21013 21015 2
> 1017 21019 21021 21023 21025 21027 21029 21031 21033 21035 21037 21041 21043 21045 21047 21049 21051
>  21053 21059 21061 21065 21067 21069 21071 21073 21075 21077 21079 21081 21083 21085 21087 21089 210
> 91 21093 21095 21097 21099 21101 21103 21107 21109 21111 21113 21115 21117 21119 21121 21123 21125 2
> 1127 21131 21133 21135 21137 21139 21141 21143 21145 21147 21149 21151 21153 21155 21157 21159 21161
>  21163 21165 21167 21169 21171 21173 21175 21177 21179 21181 21183 21185 21187 21191 21193 21195 211
> 97 21199 21203 21205 21207 21209 21211 21213 21215 21217 21219 21221 21223 21225 21227 21229 21231 2
> 1233 21235 21239 22001 22003 22005 22007 22009 22011 22013 22015 22017 22019 22021 22023 22025 22027
>  22029 22031 22033 22035 22037 22039 22041 22043 22045 22047 22049 22051 22053 22055 22057 22059 220
> 61 22063 22065 22067 22069 22071 22073 22075 22077 22079 22081 22083 22085 22087 22089 22091 22093 2
> 2095 22097 22099 22101 22103 22105 22109 22111 22113 22115 22117 22119 22121 22123 22125 22127 23001
>  23003 23005 23007 23009 23011 23013 23015 23017 23019 23021 23023 23025 23027 23029 23031 24001 240
> 03 24005 24009 24011 24013 24015 24017 24019 24021 24023 24025 24027 24029 24031 24033 24035 24037 2
> 4039 24041 24043 24045 24047 24510 25001 25003 25005 25007 25009 25011 25013 25015 25017 25019 25021
>  25023 25025 25027 26001 26003 26005 26007 26009 26011 26013 26015 26017 26019 26021 26023 26025 260
> 27 26029 26031 26033 26035 26037 26039 26041 26043 26045 26047 26049 26051 26053 26055 26057 26059 2
> 6061 26063 26065 26067 26069 26071 26073 26075 26077 26079 26081 26083 26085 26087 26089 26091 26093
>  26097 26099 26101 26103 26105 26107 26109 26111 26113 26115 26117 26119 26121 26123 26125 26127 261
> 29 26133 26137 26139 26141 26143 26145 26147 26149 26151 26153 26155 26157 26159 26161 26163 26165 2
> 7001 27003 27005 27007 27009 27013 27015 27017 27019 27021 27023 27025 27027 27029 27033 27035 27037
>  27039 27041 27043 27045 27047 27049 27051 27053 27055 27057 27059 27061 27063 27065 27067 27071 270
> 75 27079 27081 27083 27085 27089 27091 27093 27095 27097 27099 27103 27105 27107 27109 27111 27113 2
> 7115 27117 27119 27121 27123 27127 27129 27131 27133 27137 27139 27141 27143 27145 27147 27151 27153
>  27157 27159 27161 27163 27165 27167 27169 27171 27173 28001 28003 28005 28007 28009 28011 28013 280
> 15 28017 28019 28021 28023 28025 28027 28029 28031 28033 28035 28039 28041 28043 28045 28047 28049 2
> 8051 28057 28059 28061 28063 28065 28067 28069 28071 28073 28075 28077 28079 28081 28083 28085 28087
>  28089 28091 28093 28095 28097 28099 28101 28103 28105 28107 28109 28111 28113 28115 28117 28119 281
> 21 28123 28127 28129 28131 28133 28135 28137 28139 28141 28143 28145 28147 28149 28151 28153 28155 2
> 8157 28159 28161 28163 29001 29003 29007 29009 29011 29013 29015 29017 29019 29021 29023 29025 29027
>  29029 29031 29035 29037 29039 29041 29043 29045 29047 29049 29051 29053 29055 29057 29059 29063 290
> 65 29067 29069 29071 29073 29077 29079 29083 29085 29089 29091 29093 29095 29097 29099 29101 29105 2
> 9107 29109 29111 29113 29115 29119 29121 29123 29125 29127 29131 29133 29135 29137 29139 29141 29143
>  29145 29147 29149 29151 29153 29155 29157 29159 29161 29163 29165 29167 29169 29173 29175 29177 291
> 81 29183 29185 29186 29187 29189 29195 29197 29201 29203 29207 29209 29211 29213 29215 29217 29219 2
> 9221 29223 29225 29229 29510 30003 30005 30007 30009 30013 30015 30017 30023 30027 30029 30031 30035
>  30041 30043 30047 30049 30053 30057 30061 30063 30065 30067 30081 30083 30087 30089 30093 30095 300
> 99 30111 31001 31003 31013 31019 31023 31025 31035 31037 31041 31043 31047 31051 31053 31055 31067 3
> 1079 31081 31093 31095 31097 31099 31101 31109 31111 31119 31121 31123 31127 31131 31137 31139 31141
>  31143 31151 31153 31155 31157 31159 31167 31177 31179 31185 32001 32003 32005 32007 32013 32015 320
> 17 32019 32023 32027 32029 32031 32033 32510 33001 33003 33005 33007 33009 33011 33013 33015 33017 3
> 3019 34001 34003 34005 34007 34009 34011 34013 34015 34017 34019 34021 34023 34025 34027 34029 34031
>  34033 34035 34037 34039 34041 35001 35005 35006 35007 35009 35013 35015 35017 35025 35027 35028 350
> 29 35031 35035 35039 35041 35043 35045 35047 35049 35051 35053 35055 35057 35061 36001 36003 36005 3
> 6007 36009 36011 36013 36015 36017 36019 36021 36023 36025 36027 36029 36031 36033 36035 36037 36039
>  36043 36045 36047 36049 36051 36053 36055 36057 36059 36061 36063 36065 36067 36069 36071 36073 360
> 75 36077 36079 36081 36083 36085 36087 36089 36091 36093 36095 36097 36099 36101 36103 36105 36107 3
> 6109 36111 36113 36115 36117 36119 36121 36123 37001 37003 37007 37009 37011 37013 37015 37017 37019
>  37021 37023 37025 37027 37029 37031 37033 37035 37037 37039 37041 37043 37045 37047 37049 37051 370
> 53 37055 37057 37059 37061 37063 37065 37067 37069 37071 37073 37077 37079 37081 37083 37085 37087 3
> 7089 37091 37093 37097 37099 37101 37103 37105 37107 37109 37111 37113 37115 37117 37119 37121 37123
>  37125 37127 37129 37131 37133 37135 37137 37139 37141 37143 37145 37147 37149 37151 37153 37155 371
> 57 37159 37161 37163 37165 37167 37169 37171 37173 37175 37179 37181 37183 37185 37187 37189 37191 3
> 7193 37195 37197 37199 38003 38005 38009 38015 38017 38025 38035 38049 38053 38055 38057 38059 38061
>  38067 38071 38073 38075 38077 38089 38093 38097 38099 38101 38105 39001 39003 39005 39007 39009 390
> 11 39013 39015 39017 39019 39021 39023 39025 39027 39029 39031 39033 39035 39037 39039 39041 39043 3
> 9045 39047 39049 39051 39053 39055 39057 39059 39061 39063 39065 39067 39069 39071 39073 39075 39077
>  39079 39081 39083 39085 39087 39089 39091 39093 39095 39097 39099 39101 39103 39105 39107 39109 391
> 11 39113 39115 39117 39119 39121 39123 39125 39127 39129 39131 39133 39135 39137 39139 39141 39143 3
> 9145 39147 39149 39151 39153 39155 39157 39159 39161 39163 39165 39167 39169 39171 39173 39175 40001
>  40005 40009 40011 40013 40015 40017 40019 40021 40023 40027 40029 40031 40033 40035 40037 40039 400
> 41 40045 40047 40049 40051 40053 40055 40061 40063 40065 40067 40069 40071 40073 40077 40079 40081 4
> 0083 40085 40087 40089 40091 40093 40095 40097 40099 40101 40103 40105 40107 40109 40111 40113 40115
>  40117 40119 40121 40123 40125 40127 40131 40133 40135 40137 40139 40141 40143 40145 40147 40149 401
> 53 41001 41003 41005 41007 41009 41011 41013 41015 41017 41019 41027 41029 41031 41033 41035 41039 4
> 1041 41043 41045 41047 41049 41051 41053 41057 41059 41061 41065 41067 41071 42001 42003 42005 42007
>  42009 42011 42013 42015 42017 42019 42021 42025 42027 42029 42031 42033 42035 42037 42039 42041 420
> 43 42045 42047 42049 42051 42055 42057 42059 42061 42063 42065 42067 42069 42071 42073 42075 42077 4
> 2079 42081 42083 42085 42087 42089 42091 42093 42095 42097 42099 42101 42103 42105 42107 42109 42111
>  42113 42115 42117 42119 42121 42123 42125 42127 42129 42131 42133 44001 44003 44005 44007 44009 450
> 01 45003 45005 45007 45009 45011 45013 45015 45017 45019 45021 45023 45025 45027 45029 45031 45033 4
> 5035 45037 45039 45041 45043 45045 45047 45049 45051 45053 45055 45057 45059 45061 45063 45065 45067
>  45069 45071 45073 45075 45077 45079 45081 45083 45085 45087 45089 45091 46005 46009 46011 46013 460
> 19 46027 46029 46033 46035 46045 46047 46057 46061 46065 46077 46079 46081 46083 46087 46093 46099 4
> 6101 46102 46103 46115 46117 46125 46127 46135 47001 47003 47005 47007 47009 47011 47013 47015 47017
>  47019 47021 47023 47025 47029 47031 47033 47035 47037 47039 47041 47043 47045 47047 47049 47051 470
> 53 47055 47057 47059 47061 47063 47065 47069 47071 47073 47075 47077 47079 47081 47083 47085 47087 4
> 7089 47091 47093 47095 47097 47099 47101 47103 47105 47107 47109 47111 47113 47115 47117 47119 47121
>  47123 47125 47127 47129 47131 47133 47137 47139 47141 47143 47145 47147 47149 47151 47153 47155 471
> 57 47159 47161 47163 47165 47167 47169 47171 47173 47175 47177 47179 47181 47183 47185 47187 47189 4
> 8001 48003 48005 48007 48009 48013 48015 48019 48021 48025 48027 48029 48031 48035 48037 48039 48041
>  48047 48049 48051 48053 48055 48057 48059 48061 48063 48065 48067 48071 48073 48077 48081 48083 480
> 85 48089 48091 48093 48097 48099 48103 48107 48111 48113 48115 48117 48119 48121 48123 48127 48131 4
> 8133 48135 48139 48141 48143 48145 48147 48149 48153 48157 48159 48161 48163 48165 48167 48169 48171
>  48175 48177 48179 48181 48183 48185 48187 48189 48193 48199 48201 48203 48205 48209 48213 48215 482
> 17 48219 48221 48223 48225 48227 48229 48231 48233 48239 48241 48245 48249 48251 48253 48255 48257 4
> 8259 48265 48273 48277 48279 48281 48283 48285 48287 48289 48291 48293 48297 48299 48303 48305 48309
>  48313 48315 48317 48321 48323 48325 48329 48331 48337 48339 48341 48343 48347 48349 48351 48353 483
> 55 48357 48361 48363 48365 48367 48369 48371 48373 48375 48377 48379 48381 48387 48389 48395 48397 4
> 8399 48401 48403 48405 48407 48409 48413 48415 48419 48423 48425 48427 48437 48439 48441 48445 48449
>  48451 48453 48455 48457 48459 48463 48465 48467 48469 48471 48473 48475 48477 48479 48481 48485 484
> 87 48489 48491 48493 48495 48497 48499 48501 48503 48505 48507 49001 49003 49005 49007 49011 49013 4
> 9015 49019 49021 49023 49025 49027 49029 49035 49037 49039 49041 49043 49045 49047 49049 49051 49053
>  49057 50001 50003 50005 50007 50009 50011 50013 50015 50017 50019 50021 50023 50025 50027 51001 510
> 07 51009 51013 51019 51023 51025 51027 51029 51033 51036 51037 51041 51043 51047 51049 51057 51061 5
> 1065 51067 51071 51073 51075 51079 51083 51085 51087 51093 51097 51099 51101 51103 51107 51109 51111
>  51113 51115 51117 51119 51125 51127 51131 51133 51135 51137 51139 51141 51145 51147 51155 51157 511
> 59 51167 51169 51171 51173 51179 51185 51187 51193 51197 51510 51550 51650 51700 51710 51740 51760 5
> 1770 51800 51810 53001 53003 53005 53007 53009 53011 53013 53015 53017 53019 53021 53025 53027 53029
>  53031 53033 53035 53037 53039 53041 53043 53045 53047 53049 53051 53053 53055 53057 53059 53061 530
> 63 53065 53067 53069 53071 53073 53075 53077 54001 54003 54005 54009 54011 54015 54017 54019 54023 5
> 4025 54027 54029 54031 54033 54035 54037 54039 54041 54043 54045 54047 54049 54051 54053 54055 54057
>  54059 54061 54063 54065 54067 54069 54073 54077 54079 54081 54083 54085 54087 54089 54091 54093 540
> 95 54097 54099 54103 54105 54107 54109 55001 55003 55005 55007 55009 55011 55013 55015 55017 55019 5
> 5021 55023 55025 55027 55029 55031 55033 55035 55037 55039 55043 55045 55047 55049 55051 55053 55055
>  55057 55059 55061 55063 55065 55067 55069 55071 55073 55075 55077 55078 55079 55081 55083 55085 550
> 87 55089 55091 55093 55095 55097 55101 55103 55105 55107 55109 55111 55113 55115 55117 55119 55121 5
> 5123 55125 55127 55129 55131 55133 55135 55137 55139 55141 56001 56003 56005 56007 56009 56011 56013
>  56015 56019 56021 56023 56025 56029 56031 56033 56037 56039 56041 56045

. local n_fips : word count `fips_list'

. dis "Running regressions for `n_fips' counties..."
Running regressions for 2621 counties...

. 
. ** Initialize tempfile to store results
. tempfile county_results

. postfile county_coefs fips b_out se_out b_in se_in using `county_results', replace
(file C:\Users\ji252\AppData\Local\Temp\ST_4058_000002.tmp not found)

. 
. ** Counter for display
. local ct = 1

. 
. foreach f of local fips_list {
  2. 
.         ** Display status every 100 counties
.         if mod(`ct', 100) == 0 {
  3.                 dis "Processing county `ct' of `n_fips' (fips = `f')..."
  4.         }
  5. 
.         ** Generate treatment vars
.         gen out_tmp = fips_o == `f'
  6.         gen in_tmp = fips_d == `f'
  7. 
.         ** Interactions
.         gen out_post_tmp = out_tmp * post
  8.         gen in_post_tmp = in_tmp * post
  9. 
.         ** Run regression with capture to handle potential errors
.         capture {
 10.                 ** Regression: With covariates
.                  ppmlhdfe agi i.out_post_tmp i.in_post_tmp      ///
>                         unemp_* pop_* per_capita_income_*                               ///
>                         if mover == 1,                                                              
>     ///
>                         absorb(year flow_id) vce(cluster flow_id)
 11. 
.                 ** Store coefficients and SEs
.                 local tmp_b_out = _b[1.out_post_tmp]
 12.                 local tmp_se_out = _se[1.out_post_tmp]
 13.                 local tmp_b_in = _b[1.in_post_tmp]
 14.                 local tmp_se_in = _se[1.in_post_tmp]
 15. 
.                 ** Post results
.                 post county_coefs (`f') (`tmp_b_out') (`tmp_se_out') (`tmp_b_in') (`tmp_se_in')
 16.         }
 17. 
.         ** If regression failed, post missing values
.         if _rc != 0 {
 18.                 post county_coefs (`f') (.) (.) (.) (.)
 19.                 dis "Warning: Regression failed for fips `f'"
 20.         }
 21. 
.         ** Drop temporary vars
.         drop out_tmp in_tmp out_post_tmp in_post_tmp
 22. 
.         ** Update count
.         local ct = `ct' + 1
 23. 
. } // END FIPS LOOP
Warning: Regression failed for fips 1105
Warning: Regression failed for fips 1131
Processing county 100 of 2621 (fips = 5041)...
Warning: Regression failed for fips 5073
Warning: Regression failed for fips 5095
Processing county 200 of 2621 (fips = 6103)...
Warning: Regression failed for fips 8113
Processing county 300 of 2621 (fips = 12089)...
Warning: Regression failed for fips 13099
Processing county 400 of 2621 (fips = 13167)...
Warning: Regression failed for fips 13201
Warning: Regression failed for fips 13259
Warning: Regression failed for fips 13283
Warning: Regression failed for fips 13303
Warning: Regression failed for fips 16063
Processing county 500 of 2621 (fips = 16079)...
Warning: Regression failed for fips 17059
Warning: Regression failed for fips 17065
Processing county 600 of 2621 (fips = 18001)...
Warning: Regression failed for fips 18183
Warning: Regression failed for fips 19001
Warning: Regression failed for fips 19005
Warning: Regression failed for fips 19007
Warning: Regression failed for fips 19011
Warning: Regression failed for fips 19013
Warning: Regression failed for fips 19015
Warning: Regression failed for fips 19017
Warning: Regression failed for fips 19019
Processing county 700 of 2621 (fips = 19021)...
Warning: Regression failed for fips 19021
Warning: Regression failed for fips 19023
Warning: Regression failed for fips 19025
Warning: Regression failed for fips 19027
Warning: Regression failed for fips 19029
Warning: Regression failed for fips 19031
Warning: Regression failed for fips 19033
Warning: Regression failed for fips 19037
Warning: Regression failed for fips 19039
Warning: Regression failed for fips 19041
Warning: Regression failed for fips 19043
Warning: Regression failed for fips 19045
Warning: Regression failed for fips 19047
Warning: Regression failed for fips 19049
Warning: Regression failed for fips 19051
Warning: Regression failed for fips 19053
Warning: Regression failed for fips 19055
Warning: Regression failed for fips 19057
Warning: Regression failed for fips 19059
Warning: Regression failed for fips 19061
Warning: Regression failed for fips 19063
Warning: Regression failed for fips 19065
Warning: Regression failed for fips 19067
Warning: Regression failed for fips 19069
Warning: Regression failed for fips 19071
Warning: Regression failed for fips 19073
Warning: Regression failed for fips 19075
Warning: Regression failed for fips 19077
Warning: Regression failed for fips 19079
Warning: Regression failed for fips 19081
Warning: Regression failed for fips 19083
Warning: Regression failed for fips 19085
Warning: Regression failed for fips 19087
Warning: Regression failed for fips 19089
Warning: Regression failed for fips 19091
Warning: Regression failed for fips 19095
Warning: Regression failed for fips 19129
