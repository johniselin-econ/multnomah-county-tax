--------------------------------------------------------------------------------------------------
      name:  log_01
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/01_log_data_clean_mult
> nomah_2026-01-14.log
  log type:  text
 opened on:  14 Jan 2026, 20:22:09

. 
. //--------------------------------------------------
. // STEP 0: Preliminary Set-Up 
. //--------------------------------------------------
. 
. ** Define labels 
. label define lb_move_type       0 "ERROR"                               ///
>                                                         1 "Non-movers"                  ///
>                                                         2 "All movers"                  ///
>                                                         3 "Domestic movers"             ///
>                                                         4 "Within-state movers" ///
>                                                         5 "Inter-state movers"  ///
>                                                         6 "Foreign movers", modify

.                                                         
. label define lb_agi             1 "Under $1"                    ///
>                                                         2 "$1 under $10K"               ///
>                                                         3 "$10K under $25K"             ///
>                                                         4 "$25K under $50K"             ///
>                                                         5 "$50K under $75K"             ///
>                                                         6 "$75K under $100K"    ///
>                                                         7 "$100K under $200K"   ///
>                                                         8 "$200K or more", modify               
>                                         

. 
. 
. ** Define Programs
. 
. ** Make FIPS code from state and county fips codes 
. capture program drop make_fips

. program define make_fips
  1.     syntax varlist(min=2 max=2 numeric), GEN(name)
  2. 
.     quietly {
  3.         tempvar s c
  4. 
.         local v1 : word 1 of `varlist'
  5.         local v2 : word 2 of `varlist'
  6. 
.         gen `s' = string(`v1', "%02.0f")
  7.         gen `c' = string(`v2', "%03.0f")
  8. 
.         gen `gen' = real(`s' + `c')
  9.     }
 10. end

. 
. ** Reclassify suppressed values as 0 
. 
. capture program drop unsuppress

. program define unsuppress
  1.     syntax varlist
  2. 
.     foreach v of varlist `varlist' {
  3.         replace `v' = 0 if `v' == -1
  4.     }
  5. end

. 
. 
. ** Create a gross-migration file via ACS 
. capture program drop acs_make_gross_migration

. program define acs_make_gross_migration
  1.     version 16.0
  2.     /*
>       Build county-year gross migration totals from ACS microdata with origin/destination counti
> es.
> 
>       Outputs (wide):
>         persons_in_*, persons_out_*, persons_net_*
>         households_in_*, households_out_*, households_net_*
>         dollars_in_*, dollars_out_*, dollars_net_*
> 
>       Move-type indices (mirrors your IRS convention as closely as possible):
>         1 = Non-movers (same county)
>         2 = All movers (different county) = 4 + 5
>         3 = Domestic movers (same as 2 here; foreign already dropped upstream)
>         4 = Within-state movers (different county, same state)
>         5 = Inter-state movers (different state)
>     */
. 
.     syntax using/ [if] [in], SAVING(string) [REPLACE] ///
>         [ IDSFILE(string) ///
>           YEARVAR(name) ORIGFIPS(name) DESTFIPS(name) ///
>           PERSONWT(name) HHWT(name) HHPERWT(name) HEADVAR(name) INCOME(name) SAMPLE(string)]
  3. 
.     // Defaults consistent with your 01_clean_data.do
.     if "`idsfile'"  == "" local idsfile  "${data}working/ids"
  4.     if "`yearvar'"  == "" local yearvar  year
  5.     if "`origfips'" == "" local origfips fips_o
  6.     if "`destfips'" == "" local destfips fips_d
  7.         if "`personwt'" == "" local personwt perwt
  8.     if "`hhperwt'"  == "" local hhperwt  hh_perwt
  9.     if "`hhwt'"     == "" local hhwt     hhwt
 10.     if "`headvar'"  == "" local headvar  hh_head
 11.     if "`income'"   == "" local income   inctot
 12. 
.     // Load microdata (optionally subset via if/in)
.     use "`using'" `if' `in', clear
 13.         
.         if "`sample'" != "" keep if `sample'
 14. 
.     // Basic checks
.     foreach v in `yearvar' `origfips' `destfips' `personwt' `hhwt' `headvar' `income' {
 15.         capture confirm variable `v'
 16.         if _rc {
 17.             di as err "Required variable `v' not found in `using'."
 18.             exit 198
 19.         }
 20.     }
 21. 
.     // Keep only valid year/origin/destination
.     drop if missing(`yearvar') | missing(`origfips') | missing(`destfips')
 22. 
.     // Income: treat missing as 0 (keep negatives as reported)
.     replace `income' = 0 if missing(`income')
 23. 
.     // Build weighted components at the person level
.     gen double persons_wt = `hhperwt' if `headvar' == 1
 24.     gen double dollars_wt = `income' * `personwt'
 25.     gen double households_wt = `hhwt' if `headvar' == 1
 26.     replace households_wt = 0 if missing(households_wt)
 27. 
.     // Collapse to origin-destination-year flow first
.     keep `yearvar' `origfips' `destfips' persons_wt dollars_wt households_wt
 28.     collapse (sum) persons=persons_wt dollars=dollars_wt households=households_wt, ///
>         by(`yearvar' `origfips' `destfips')
 29. 
.     // Derive state/county components for mover-type logic
.     gen int state_o  = floor(`origfips'/1000)
 30.     gen int state_d  = floor(`destfips'/1000)
 31. 
.     gen byte same_county = (`origfips' == `destfips')
 32.     gen byte same_state  = (state_o == state_d)
 33.     gen byte within_state_mover = same_state & !same_county
 34.     gen byte inter_state_mover  = !same_state
 35. 
.     // -----------------------
.     // IN-MIGRATION (by destination county)
.     // -----------------------
.     preserve
 36.         gen long fips = `destfips'
 37.         gen int state_fips  = floor(fips/1000)
 38.         gen int county_fips = mod(fips, 1000)
 39. 
.         // type 1/4/5 components
.         foreach m in persons households dollars {
 40.             gen double `m'_1 = `m' if same_county
 41.             gen double `m'_4 = `m' if within_state_mover
 42.             gen double `m'_5 = `m' if inter_state_mover
 43.         }
 44. 
.         collapse (sum) persons_1 persons_4 persons_5 ///
>                        households_1 households_4 households_5 ///
>                        dollars_1 dollars_4 dollars_5, ///
>                 by(`yearvar' fips state_fips county_fips)
 45. 
.         // build 2 and 3
.         gen double persons_2    = persons_4 + persons_5
 46.         gen double persons_3    = persons_2
 47.         gen double households_2 = households_4 + households_5
 48.         gen double households_3 = households_2
 49.         gen double dollars_2    = dollars_4 + dollars_5
 50.         gen double dollars_3    = dollars_2
 51. 
.         // rename to *_in_*
.         foreach t in 1 2 3 4 5 {
 52.             rename persons_`t'    persons_in_`t'
 53.             rename households_`t' households_in_`t'
 54.             rename dollars_`t'    dollars_in_`t'
 55.         }
 56. 
.         tempfile __in
 57.         save `__in', replace
 58.     restore
 59. 
.     // -----------------------
.     // OUT-MIGRATION (by origin county)
.     // -----------------------
.     preserve
 60.         gen long fips = `origfips'
 61.         gen int state_fips  = floor(fips/1000)
 62.         gen int county_fips = mod(fips, 1000)
 63. 
.         foreach m in persons households dollars {
 64.             gen double `m'_1 = `m' if same_county
 65.             gen double `m'_4 = `m' if within_state_mover
 66.             gen double `m'_5 = `m' if inter_state_mover
 67.         }
 68. 
.         collapse (sum) persons_1 persons_4 persons_5 ///
>                        households_1 households_4 households_5 ///
>                        dollars_1 dollars_4 dollars_5, ///
>                 by(`yearvar' fips state_fips county_fips)
 69. 
.         gen double persons_2    = persons_4 + persons_5
 70.         gen double persons_3    = persons_2
 71.         gen double households_2 = households_4 + households_5
 72.         gen double households_3 = households_2
 73.         gen double dollars_2    = dollars_4 + dollars_5
 74.         gen double dollars_3    = dollars_2
 75. 
.         foreach t in 1 2 3 4 5 {
 76.             rename persons_`t'    persons_out_`t'
 77.             rename households_`t' households_out_`t'
 78.             rename dollars_`t'    dollars_out_`t'
 79.         }
 80. 
.         tempfile __out
 81.         save `__out', replace
 82.     restore
 83. 
.     // -----------------------
.     // Merge in/out; compute net
.     // -----------------------
.     use `__in', clear
 84.     merge 1:1 `yearvar' fips state_fips county_fips using `__out', nogen
 85. 
.     // Replace missings with 0 prior to net calcs (counties can be only in or only out)
.     foreach m in persons households dollars {
 86.         foreach t in 1 2 3 4 5 {
 87.             replace `m'_in_`t'  = 0 if missing(`m'_in_`t')
 88.             replace `m'_out_`t' = 0 if missing(`m'_out_`t')
 89.         }
 90.     }
 91. 
.     // Net = in - out (types 2/3/4/5 are the meaningful migration nets; 1 will be ~0 by construc
> tion)
.     foreach m in persons households dollars {
 92.         foreach t in 2 3 4 5 {
 93.             gen double `m'_net_`t' = `m'_in_`t' - `m'_out_`t'
 94.         }
 95.     }
 96. 
.     // Merge names
.     merge m:1 state_fips county_fips using "`idsfile'", keep(master match) nogen
 97. 
.     // Labels
.     label var fips "County FIPS (state*1000 + county)"
 98.     label var state_fips "State FIPS"
 99.     label var county_fips "County FIPS"
100. 
.     label var persons_in_2  "Persons, in-migration, all movers"
101.     label var persons_out_2 "Persons, out-migration, all movers"
102.     label var persons_net_2 "Persons, net migration, all movers"
103. 
.     label var households_in_2  "Households, in-migration, all movers (HH heads)"
104.     label var households_out_2 "Households, out-migration, all movers (HH heads)"
105.     label var households_net_2 "Households, net migration, all movers (HH heads)"
106. 
.     label var dollars_in_2  "Dollars, in-migration, all movers (INCTOT*PERWT)"
107.     label var dollars_out_2 "Dollars, out-migration, all movers (INCTOT*PERWT)"
108.     label var dollars_net_2 "Dollars, net migration, all movers (INCTOT*PERWT)"
109. 
.     order `yearvar' fips state_fips county_fips state_name county_name, first
110.     sort `yearvar' state_fips county_fips
111.     compress
112. 
.     // Save
.     save "`saving'", `replace'
113.         clear
114.         
. end

. 
. ********************************************************************************
. ** STEP 1: Download and check non-IPUMS data 
. ********************************************************************************
. 
. ** Ensure expected directory structure exists
. capture mkdir "${data}"

. capture mkdir "${data}working"

. capture mkdir "${data}demographic"

. capture mkdir "${data}demographic/CAINC1"

. capture mkdir "${data}demographic/nhgis0031_csv"

. capture mkdir "${data}demographic/dol"

. capture mkdir "${data}demographic/bls"

. capture mkdir "${data}irs"

. capture mkdir "${data}covid"

. 
. ** This block downloads public-use source data directly from official URLs if 
. ** not present locally.
. /*
> Automated downloads included:
>   - IRS SOI county-to-county migration: countyinflowYYZZ.csv / countyoutflowYYZZ.csv
>   - IRS SOI county data: YYincyallagi.csv
>   - BEA Regional Economic Accounts (CAINC1): CAINC1.zip (unzips to CAINC1__ALL_AREAS_*.csv and r
> elated files)
> */
. 
. * ----------------------------
. * IRS SOI: migration files
. * ----------------------------
. local irs_base "https://www.irs.gov/pub/irs-soi"

. 
. forvalues yy = 15/21 {
  2.     local zz = `yy' + 1
  3.     local fn_out "countyoutflow`yy'`zz'.csv"
  4.     local fn_in  "countyinflow`yy'`zz'.csv"
  5. 
.     capture confirm file "${data}irs/`fn_out'"
  6.     if _rc {
  7.         di as txt "Downloading (IRS SOI) `fn_out' ..."
  8.         copy "`irs_base'/`fn_out'" "${data}irs/`fn_out'", replace
  9.     }
 10. 
.     capture confirm file "${data}irs/`fn_in'"
 11.     if _rc {
 12.         di as txt "Downloading (IRS SOI) `fn_in' ..."
 13.         copy "`irs_base'/`fn_in'" "${data}irs/`fn_in'", replace
 14.     }
 15. }

. 
. * ----------------------------
. * IRS SOI: county income (AGI) files
. * ----------------------------
. forvalues yy = 15/22 {
  2.     local fn_inc "`yy'incyallagi.csv"
  3. 
.     capture confirm file "${data}irs/`fn_inc'"
  4.     if _rc {
  5.         di as txt "Downloading (IRS SOI) `fn_inc' ..."
  6.         copy "`irs_base'/`fn_inc'" "${data}irs/`fn_inc'", replace
  7.     }
  8. }

. 
. * ----------------------------
. * BEA Regional: CAINC1.zip
. * ----------------------------
. local bea_dir "${data}demographic/CAINC1"

. local bea_url "https://apps.bea.gov/regional/zip/CAINC1.zip"

. local bea_zip "`bea_dir'/CAINC1.zip"

. 
. * If we don't already have a CAINC1 "_ALL_AREAS" file, download + unzip the ZIP.
. local bea_files : dir "`bea_dir'" files "CAINC1__ALL_AREAS_*.csv"

. if "`bea_files'"=="" {
.     local bea_files : dir "`bea_dir'" files "CAINC1__ALL_STATES_*.csv"
. }

. 
. if "`bea_files'"=="" {
.     di as txt "Downloading (BEA) CAINC1.zip ..."
Downloading (BEA) CAINC1.zip ...
.     copy "`bea_url'" "`bea_zip'", replace
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/demographic/CAINC1/CAINC1.zip
    not found)
. 
.     local curdir "`c(pwd)'"
.     cd "`bea_dir'"
C:\Users\ji252\Documents\GitHub\multnomah-county-tax\data\demographic\CAINC1
.     unzipfile "CAINC1.zip", replace
    inflating: CAINC1__ALL_AREAS_1969_2023.csv
    inflating: CAINC1__definition.xml
    inflating: CAINC1__Footnotes.html
    inflating: CAINC1_AK_1969_2023.csv
    inflating: CAINC1_AL_1969_2023.csv
    inflating: CAINC1_AR_1969_2023.csv
    inflating: CAINC1_AZ_1969_2023.csv
    inflating: CAINC1_CA_1969_2023.csv
    inflating: CAINC1_CO_1969_2023.csv
    inflating: CAINC1_CSA_1969_2023.csv
    inflating: CAINC1_CT_1969_2023.csv
    inflating: CAINC1_DC_1969_2023.csv
    inflating: CAINC1_DE_1969_2023.csv
    inflating: CAINC1_FL_1969_2023.csv
    inflating: CAINC1_GA_1969_2023.csv
    inflating: CAINC1_HI_1969_2023.csv
    inflating: CAINC1_IA_1969_2023.csv
    inflating: CAINC1_ID_1969_2023.csv
    inflating: CAINC1_IL_1969_2023.csv
    inflating: CAINC1_IN_1969_2023.csv
    inflating: CAINC1_KS_1969_2023.csv
    inflating: CAINC1_KY_1969_2023.csv
    inflating: CAINC1_LA_1969_2023.csv
    inflating: CAINC1_MA_1969_2023.csv
    inflating: CAINC1_MD_1969_2023.csv
    inflating: CAINC1_MDIV_1969_2023.csv
    inflating: CAINC1_ME_1969_2023.csv
    inflating: CAINC1_MI_1969_2023.csv
    inflating: CAINC1_MIC_1969_2023.csv
    inflating: CAINC1_MN_1969_2023.csv
    inflating: CAINC1_MO_1969_2023.csv
    inflating: CAINC1_MS_1969_2023.csv
    inflating: CAINC1_MSA_1969_2023.csv
    inflating: CAINC1_MT_1969_2023.csv
    inflating: CAINC1_NC_1969_2023.csv
    inflating: CAINC1_ND_1969_2023.csv
    inflating: CAINC1_NE_1969_2023.csv
    inflating: CAINC1_NH_1969_2023.csv
    inflating: CAINC1_NJ_1969_2023.csv
    inflating: CAINC1_NM_1969_2023.csv
    inflating: CAINC1_NV_1969_2023.csv
    inflating: CAINC1_NY_1969_2023.csv
    inflating: CAINC1_OH_1969_2023.csv
    inflating: CAINC1_OK_1969_2023.csv
    inflating: CAINC1_OR_1969_2023.csv
    inflating: CAINC1_PA_1969_2023.csv
    inflating: CAINC1_PORT_1969_2023.csv
    inflating: CAINC1_RI_1969_2023.csv
    inflating: CAINC1_SC_1969_2023.csv
    inflating: CAINC1_SD_1969_2023.csv
    inflating: CAINC1_TN_1969_2023.csv
    inflating: CAINC1_TX_1969_2023.csv
    inflating: CAINC1_US_1969_2023.csv
    inflating: CAINC1_UT_1969_2023.csv
    inflating: CAINC1_VA_1969_2023.csv
    inflating: CAINC1_VT_1969_2023.csv
    inflating: CAINC1_WA_1969_2023.csv
    inflating: CAINC1_WI_1969_2023.csv
    inflating: CAINC1_WV_1969_2023.csv
    inflating: CAINC1_WY_1969_2023.csv

successfully unzipped CAINC1.zip to current directory
total processed:  60
        skipped:  0
      extracted:  60
.     cd "`curdir'"
C:\Users\ji252\Documents\GitHub\multnomah-county-tax
. 
.     capture erase "`bea_zip'"
. }

. 
. * ----------------------------
. * NYTimes COVID Data 
. * ----------------------------
. local covid_dir "${data}covid"

. local covid_url "https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv"

. 
. * If we don't already have a COVID file, download.
. local covid_file : dir "`covid_dir'" files "covid_nyt.csv"

. if "`covid_file'"=="" {
.     local covid_file : dir "`covid_dir'" files "covid_nyt.csv"
. }

. 
. if "`covid_file'"=="" {
.     di as txt "Downloading (COVID)  ..."
Downloading (COVID)  ...
.     copy "`covid_url'" "`covid_dir'/covid_nyt.csv", replace
. }

. 
. ** This block checks that non-automatically downloaded data are present: 
. /*
> Non-automtated downloads included:
>   - DOL childcare data (through 2022)
>   - BLS unemployment data 
> */
. 
. ** Define paths 
. local dol_dir "${data}demographic/dol/NDCP2022.xlsx"

. local bls_dir "${data}demographic/bls/la.data.64.County" 

. 
. capture confirm file `dol_dir' // Check if the file exists

. 
. if _rc != 0 {
.     display "Error: The file `dol_dir' was not found."
.     display "Execution of the do-file is stopping."
.     exit // Stops the do-file/program
. }

. 
. capture confirm file `bls_dir' // Check if the file exists

. 
. if _rc != 0 {
.     display "Error: The file `bls_dir' was not found."
.     display "Execution of the do-file is stopping."
.     exit // Stops the do-file/program
. }

. 
. 
. 
. ********************************************************************************
. ** STEP 2: Clean demographic + economic data via IPUMS, BLS, and BEA 
. ********************************************************************************
. 
. ** Import data 
. import delimited        ///
>         "${data}demographic/nhgis0031_csv/nhgis0031_ts_nominal_county.csv", clear 
(encoding automatically selected: ISO-8859-1)
(15 vars, 54,673 obs)

. 
. ** Describe data 
. des 

Contains data
 Observations:        54,673                  
    Variables:            15                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
gisjoin         str8    %9s                   GISJOIN
year            str9    %9s                   YEAR
state           str20   %20s                  STATE
statefp         byte    %8.0g                 STATEFP
statenh         int     %8.0g                 STATENH
county          str46   %46s                  COUNTY
countyfp        int     %8.0g                 COUNTYFP
countynh        int     %8.0g                 COUNTYNH
name            str59   %59s                  NAME
av0aa           long    %12.0g                AV0AA
d15aa           long    %12.0g                D15AA
d15ab           long    %12.0g                D15AB
b79aa           long    %12.0g                B79AA
av0aam          long    %12.0g                AV0AAM
b79aam          long    %8.0g                 B79AAM
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.

. 
. ** Drop unnecc variables 
. drop gisjoin statenh countynh name 

. 
. ** Rename 
. rename state state_name 

. rename statefp state_fips 

. rename county county_name 

. rename countyfp county_fips 

. rename av0aa population 

. rename d15aa pop_urban 

. rename d15ab pop_rural 

. rename b79aa median_income 

. rename av0aam population_margin

. rename b79aam median_income_margin 

. 
. ** Create urban percent 
. gen percent_urban = pop_urban / population
(45,090 missing values generated)

. 
. ** Label variables 
. label var state_name "State name"

. label var state_fips "State FIPS code"

. label var county_name "County name"

. label var county_fips "County FIPS code"

. label var population "Population count"

. label var pop_rural "Rural population count"

. label var pop_urban "Urban population count"

. label var percent_urban "Percent of population in urban areas"

. label var median_income "Median household income (prior year)"

. label var population_margin "ACS margin for error: population"

. label var median_income_margin "ACS margin for error: median income"

. 
. ** Save as temporary file 
. tempfile demo

. save `demo'
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_000001.tmp saved as .dta format

. 
. ** Create three datasets 
. 
. ** (1) Basic state and county IDs 
. keep if year == "2020" 
(51,452 observations deleted)

. keep state* county* 

. 
. ** Make FIPS 
. make_fips state_fips county_fips, gen(fips)

. 
. ** Save as state and county Ids 
. save "${data}working/ids", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/ids.dta saved

. 
. ** Save state IDS 
. keep state_fips state_name 

. duplicates drop 

Duplicates in terms of all variables

(3,169 observations deleted)

. 
. ** Save as state and county Ids 
. save "${data}working/state_ids", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/state_ids.dta saved

. 
. clear  

. 
. ** (2) Population data 
. use `demo'

. keep if !missing(pop_urban) 
(45,090 observations deleted)

. tab year 

       YEAR |      Freq.     Percent        Cum.
------------+-----------------------------------
       2000 |      3,141       32.78       32.78
       2010 |      3,221       33.61       66.39
       2020 |      3,221       33.61      100.00
------------+-----------------------------------
      Total |      9,583      100.00

. 
. ** Keep 2020 
. keep if year == "2020"
(6,362 observations deleted)

. drop year median_income* population_margin

. 
. ** Make FIPS 
. make_fips state_fips county_fips, gen(fips)

. 
. ** Save data
. save "${data}working/population_2020", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/population_2020.dta saved

. clear  

. 
. ** (3) 2015-2019 ACS data 
. use `demo'

. keep if !missing(median_income) 
(6,447 observations deleted)

. tab year 

       YEAR |      Freq.     Percent        Cum.
------------+-----------------------------------
       2000 |      3,141        6.51        6.51
  2006-2010 |      3,221        6.68       13.19
  2007-2011 |      3,221        6.68       19.87
  2008-2012 |      3,221        6.68       26.55
  2009-2013 |      3,221        6.68       33.23
  2010-2014 |      3,220        6.68       39.91
  2011-2015 |      3,219        6.67       46.58
  2012-2016 |      3,220        6.68       53.26
  2013-2017 |      3,220        6.68       59.93
  2014-2018 |      3,219        6.67       66.61
  2015-2019 |      3,220        6.68       73.29
  2016-2020 |      3,220        6.68       79.96
  2017-2021 |      3,220        6.68       86.64
  2018-2022 |      3,221        6.68       93.32
  2019-2023 |      3,222        6.68      100.00
------------+-----------------------------------
      Total |     48,226      100.00

. 
. ** Keep 2020 
. keep if year == "2015-2019"
(45,006 observations deleted)

. drop year pop_rural pop_urban percent_urban

. 
. ** Make FIPS 
. make_fips state_fips county_fips, gen(fips)

. 
. ** Save data
. save "${data}working/acs_2015_2019_data", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/acs_2015_2019_data.dta
    saved

. 
. ** Rename for merge 
. rename population population_acs

. 
. ** Merge with other data 
. merge 1:1 state_fips county_fips using "${data}working/population_2020",                ///
>         keep(match) nogen 

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             3,219  
    -----------------------------------------

. 
. ** Save data
. save "${data}working/demographics_2020", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/demographics_2020.dta
    saved

. 
. ** Load BEA Data 
. import delimited "${data}demographic/CAINC1/CAINC1__ALL_AREAS_1969_2023.csv",   ///
>         clear 
(encoding automatically selected: ISO-8859-1)
(63 vars, 9,604 obs)

. 
. ** Drop unnecc variables 
. drop region tablename industryclassification unit geoname 

. 
. ** Drop empty cells 
. drop if missing(linecode)
(4 observations deleted)

. 
. ** Update names 
. rename geofips fips 

. replace fips = subinstr(fips, `"""', "", .)
(9,600 real changes made)

. destring fips, replace 
fips: all characters numeric; replaced as long

. 
. ** Keep population and per-capita income, dropping personal income (total)
. tab description linecode

                      |             LineCode
          Description |         1          2          3 |     Total
----------------------+---------------------------------+----------
Per capita personal.. |         0          0      3,200 |     3,200 
Personal income (th.. |     3,200          0          0 |     3,200 
Population (persons.. |         0      3,200          0 |     3,200 
----------------------+---------------------------------+----------
                Total |     3,200      3,200      3,200 |     9,600 

. drop if linecode == 1   
(3,200 observations deleted)

. drop description

.         
. ** Get V* to be in terms of years 
. ** V9 == 1969 
. forvalues i = 9/63 {
  2.         
.         local j = 1960 + `i'
  3.         rename v`i' value`j'
  4.         
. } // END I LOOP 

. 
. ** Reshape 
. reshape long value, i(fips linecode) j(year)
(j = 1969 1970 1971 1972 1973 1974 1975 1976 1977 1978 1979 1980 1981 1982 1983 1984 1985 1986 198
> 7 1988 1989 1990 1991 1992 1993 1994 1995 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006
>  2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021 2022 2023)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations            6,400   ->   352,000     
Number of variables                  57   ->   4           
j variable (55 values)                    ->   year
xij variables:
      value1969 value1970 ... value2023   ->   value
-----------------------------------------------------------------------------

. reshape wide value, i(fips year ) j(linecode)
(j = 2 3)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations          352,000   ->   176,000     
Number of variables                   4   ->   4           
j variable (2 values)          linecode   ->   (dropped)
xij variables:
                                  value   ->   value2 value3
-----------------------------------------------------------------------------

. 
. ** Keep years 
. keep if inrange(year, 2015, ${end_year_acs})
(147,200 observations deleted)

. 
. ** Rename values 
. rename value2 population 

. rename value3 per_capita_income

. 
. ** Drop if missing values 
. drop if population == "(NA)"
(239 observations deleted)

. 
. ** Keep only counties with all observations 
. bysort fips: gen ct = _N 

. tab ct

         ct |      Freq.     Percent        Cum.
------------+-----------------------------------
          4 |          8        0.03        0.03
          5 |          5        0.02        0.05
          9 |     28,548       99.95      100.00
------------+-----------------------------------
      Total |     28,561      100.00

. keep if ct == 9
(13 observations deleted)

. drop ct

. 
. ** Destring 
. destring population, replace 
population: all characters numeric; replaced as long

. destring per_capita_income, replace 
per_capita_income: all characters numeric; replaced as long

. 
. ** Extrapolate through 2024 
. expand 2 if year == 2023, gen(tag)
(3,172 observations created)

. replace year = 2024 if tag == 1 
(3,172 real changes made)

. replace population = . if tag == 1 
(3,172 real changes made, 3,172 to missing)

. replace per_capita_income = . if tag == 1 
(3,172 real changes made, 3,172 to missing)

. 
. ** Get list of all counties 
. qui levelsof fips, local(fips)

. 
. ** Loop over variables
. foreach v of varlist population per_capita_income {
  2.         
.         ** Loop over all FIPS 
.     foreach c of local fips {
  3.                 
.                 quietly{
  4.                         
.                         regress `v' year if fips == `c' & tag != 1 
  5.                         predict `v'_hat
  6.                         replace `v' = `v'_hat if fips == `c' & year == 2024
  7.                         drop `v'_hat
  8.                         
.                 } // END QUIET
  9.     } // END FIPS LOOP 
 10. } // END VAR LOOP 

. 
. ** Drop tag 
. drop tag

. 
. ** Save data
. save "${data}working/bea_economics", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/bea_economics.dta saved

. 
. ** Load BLS Unemployment data 
. import delimited "${data}demographic\bls\la.data.64.County", clear 
(encoding automatically selected: ISO-8859-1)
(5 vars, 5,974,328 obs)

. 
. ** Keep annual average 
. keep if period == "M13"
(5,523,684 observations deleted)

. drop period 

. 
. ** Keep only Unemployment Rate 
. gen measure = substr(series_id, 20,1)

. keep if measure == "3"
(337,983 observations deleted)

. drop measure 

. 
. ** Keep years 
. keep if inrange(year, 2015, ${end_year_acs})
(80,456 observations deleted)

. tab year 

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       2015 |      3,220       10.00       10.00
       2016 |      3,220       10.00       20.00
       2017 |      3,220       10.00       30.00
       2018 |      3,220       10.00       39.99
       2019 |      3,220       10.00       49.99
       2020 |      3,221       10.00       59.99
       2021 |      3,221       10.00       70.00
       2022 |      3,221       10.00       80.00
       2023 |      3,221       10.00       90.00
       2024 |      3,221       10.00      100.00
------------+-----------------------------------
      Total |     32,205      100.00

. 
. ** Define counties 
. gen fips = substr(series_id, 6,5)

. destring fips, replace 
fips: all characters numeric; replaced as long

. drop series_id 

. isid fips year 

. 
. ** Drop PR 
. drop if fips > 60000
(780 observations deleted)

. drop footnote_codes 

. 
. ** Update names 
. rename value unemp 

. order year fips unemp 

. 
. destring unemp, replace 
unemp: all characters numeric; replaced as double

. 
. ** Save data
. save "${data}working/bls_unemployment", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/bls_unemployment.dta
    saved

. 
. ** Load County Centroids 
. import delimited "${data}demographic\PopCenterCounty_US.csv", clear 
(encoding automatically selected: UTF-8)
(18 vars, 9,673 obs)

. 
. ** Keep required years (2010)
. keep if year == 2010 
(6,452 observations deleted)

. 
. ** Keep required variables 
. keep geographicindentifier latitude longitude 

. 
. ** Rename 
. rename geographicindentifier fips 

. rename latitude lat 

. rename longitude lon 

. 
. ** Drop PR 
. drop if fips > 60000
(78 observations deleted)

. 
. ** Save data
. save "${data}working/pop_centers", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/pop_centers.dta saved

. 
. 
. 
. 
. ********************************************************************************
. ** STEP 3: Import and Clean NYTimes COVID-19 Data 
. ********************************************************************************
. 
. ** Import data 
. import delimited using "${data}covid/covid_nyt.csv", varnames(1) clear case(lower) 
(encoding automatically selected: ISO-8859-1)
(6 vars, 2,502,832 obs)

. 
. ** Describe data 
. des 

Contains data
 Observations:     2,502,832                  
    Variables:             6                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
date            str10   %10s                  
county          str35   %35s                  
state           str24   %24s                  
fips            long    %12.0g                
cases           long    %12.0g                
deaths          long    %8.0g                 
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.

. 
. ** Set up date information 
. generate num_date = date(date, "YMD")

. format num_date %td

. drop date 

. 
. ** Rename 
. rename state state_name 

. rename county county_name 

. rename num_date date 

. 
. ** keep only counties 
. keep if !missing(fips)
(23,678 observations deleted)

. 
. ** Keep in 50 states 
. drop if state_name == "Puerto Rico"
(57,605 observations deleted)

. drop if state_name == "Virgin Islands"
(2,304 observations deleted)

. drop if state_name == "Northern Mariana Islands"
(1,452 observations deleted)

. 
. ** Sort 
. sort date fips 

. 
. ** Create panel 
. xtset fips date

Panel variable: fips (unbalanced)
 Time variable: date, 21jan2020 to 13may2022, but with gaps
         Delta: 1 day

. 
. ** Fill in panel 
. tsfill, full 

. 
. ** Fill in missing values 
. replace cases = 0 if missing(cases)
(228,991 real changes made)

. replace deaths = 0 if missing(deaths)
(228,991 real changes made)

. 
. ** Preserve data 
. preserve 

. 
. ** Preserve fips codes and names 
. keep if !missing(state_name)
(228,991 observations deleted)

. keep if !missing(county_name)
(0 observations deleted)

. duplicates drop fips state_name county_name, force 

Duplicates in terms of fips state_name county_name

(2,414,657 observations deleted)

. 
. ** Save as temporary data 
. tempfile state_county_names 

. save `state_county_names'
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_000003.tmp saved as .dta format

. clear 

. 
. ** Restore 
. restore 

. 
. ** Drop and merge in names 
. drop state_name county_name

. merge m:1 fips using `state_county_names', keep(master match) nogen 

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                         2,646,784  
    -----------------------------------------

. 
. ** Get year, month, day 
. gen year = year(date)

. gen month = month(date)

. gen day = day(date)

. 
. ** Order data 
. order date year month day fips state county cases deaths 

. 
. ** Calculate cumulative cases and deaths 
. bysort fips (date): gen cases_cum = sum(cases)

. bysort fips (date): gen deaths_cum = sum(deaths)

. 
. ** Merge population data (2020)
. merge m:1 fips using "${data}working/population_2020", keep(match) nogen  
(variable county_name was str35, now str46 to accommodate using data's values)
(variable fips was long, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                         2,643,408  
    -----------------------------------------

. 
. ** Save file 
. save ${data}working/covid_cleaned.dta, replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/covid_cleaned.dta saved

. 
. ** Keep one observation per month 
. keep year month fips state_name county_name cases deaths population

. collapse (sum) cases deaths (mean) population, by(year month fips state_name county_name) 

. sort year month fips 

. egen date = group(year month)

. drop year month 

. 
. ** Calculate cumulative cases and deaths 
. bysort fips (date): gen cases_cum = sum(cases)

. bysort fips (date): gen deaths_cum = sum(deaths)

. 
. ** Generate per capita figures
. replace cases_cum = 1000 * cases_cum / population
(82,955 real changes made)

. replace cases_cum = 1000 * cases_cum / population
(82,955 real changes made)

. drop population cases deaths

. 
. ** Reshape wide 
. reshape wide cases_cum deaths_cum, i(fips state_name county_name) j(date)
(j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations           90,828   ->   3,132       
Number of variables                   6   ->   61          
j variable (29 values)             date   ->   (dropped)
xij variables:
                              cases_cum   ->   cases_cum1 cases_cum2 ... cases_cum29
                             deaths_cum   ->   deaths_cum1 deaths_cum2 ... deaths_cum29
-----------------------------------------------------------------------------

. 
. ** Save file 
. save ${data}working/covid_cleaned_wide.dta, replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/covid_cleaned_wide.dta
    saved

. clear

. 
. 
. ********************************************************************************
. ** STEP 4: Import and Clean IPUMS ACS Data via IPUMS 
. ********************************************************************************
. 
. ** Load data 
. forvalues y = 2015(1)$end_year_acs {
  2.         
.         ** Import CSV
.         import delimited using "${data}acs/acs_`y'", varnames(1) clear case(lower)
  3.         
.         ** Save as temporary data 
.         tempfile acs_`y'
  4.         save `acs_`y''
  5.         clear 
  6.         
. } // END YEAR LOOP 
(encoding automatically selected: ISO-8859-1)
(68 vars, 2,997,503 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_000004.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(68 vars, 3,007,847 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_000005.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(68 vars, 3,038,696 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_000006.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(68 vars, 3,060,442 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_000007.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(68 vars, 3,087,291 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_000008.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(68 vars, 2,454,160 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_000009.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(68 vars, 3,092,079 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000a.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(68 vars, 3,190,848 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000b.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(68 vars, 3,228,659 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000c.tmp saved as .dta format
(encoding automatically selected: ISO-8859-1)
(67 vars, 3,238,311 obs)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000d.tmp saved as .dta format

. 
. ** Append data 
. forvalues y = 2015(1)$end_year_acs {
  2.         
.         append using `acs_`y''  
  3.         
. } // END YEAR LOOP 
(variable cbserial was long, now double to accommodate using data's values)
(variable proptx99 was byte, now int to accommodate using data's values)

. 
. ** Des 
. tab year 

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       2015 |  2,997,503        9.86        9.86
       2016 |  3,007,847        9.90       19.76
       2017 |  3,038,696       10.00       29.75
       2018 |  3,060,442       10.07       39.82
       2019 |  3,087,291       10.16       49.98
       2020 |  2,454,160        8.07       58.05
       2021 |  3,092,079       10.17       68.23
       2022 |  3,190,848       10.50       78.72
       2023 |  3,228,659       10.62       89.35
       2024 |  3,238,311       10.65      100.00
------------+-----------------------------------
      Total | 30,395,836      100.00

. 
. ** Define # of adults and kids in HHs 
. gen adult = age >= 18 

. gen child = age < 18 

. bysort year serial: gen hh_size = _N 

. bysort year serial: egen hh_adult_ct = total(adult)

. bysort year serial: egen hh_child_ct = total(child)

. 
. ** Define HH-wide indicators for creation of gross migration files 
. gen college = educd >= 0 

. gen hh_any_child = hh_child_ct > 0

. bysort year serial: egen hh_any_college = max(college)

. 
. ** Define weighted # of people 
. bysort year serial: egen hh_perwt = total(perwt)

. 
. ** Sample 18+
. drop if child == 1 
(6,257,228 observations deleted)

. drop child adult 

. 
. ** Sample not living abroad last year 
. drop if migplac1 > 56 
(123,571 observations deleted)

. drop if migrate1 == 4 
(0 observations deleted)

. 
. ** Rename variables 
. rename statefip state_fips_d

. rename countyfip county_fips_d 

. 
. ** Set up origin data 
. fre migrate1

migrate1
-----------------------------------------------------------
              |      Freq.    Percent      Valid       Cum.
--------------+--------------------------------------------
Valid   1     |   2.15e+07      89.70      89.70      89.70
        2     |    1990266       8.29       8.29      97.99
        3     |     483752       2.01       2.01     100.00
        Total |   2.40e+07     100.00     100.00           
-----------------------------------------------------------

. drop migrate1d

. tab migplac1

   migplac1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 21,541,019       89.70       89.70
          1 |     34,638        0.14       89.84
          2 |      6,437        0.03       89.87
          4 |     60,713        0.25       90.12
          5 |     23,837        0.10       90.22
          6 |    286,432        1.19       91.41
          8 |     58,203        0.24       91.66
          9 |     23,742        0.10       91.76
         10 |      5,887        0.02       91.78
         11 |      9,506        0.04       91.82
         12 |    169,310        0.71       92.52
         13 |     78,921        0.33       92.85
         15 |     10,884        0.05       92.90
         16 |     15,101        0.06       92.96
         17 |     94,301        0.39       93.35
         18 |     52,715        0.22       93.57
         19 |     23,702        0.10       93.67
         20 |     24,542        0.10       93.77
         21 |     35,053        0.15       93.92
         22 |     31,495        0.13       94.05
         23 |      8,677        0.04       94.09
         24 |     43,943        0.18       94.27
         25 |     53,708        0.22       94.49
         26 |     71,355        0.30       94.79
         27 |     38,594        0.16       94.95
         28 |     18,617        0.08       95.03
         29 |     49,703        0.21       95.24
         30 |      8,315        0.03       95.27
         31 |     14,930        0.06       95.33
         32 |     27,276        0.11       95.45
         33 |      9,634        0.04       95.49
         34 |     55,622        0.23       95.72
         35 |     13,589        0.06       95.77
         36 |    130,573        0.54       96.32
         37 |     78,068        0.33       96.64
         38 |      6,435        0.03       96.67
         39 |     89,408        0.37       97.04
         40 |     31,763        0.13       97.18
         41 |     39,836        0.17       97.34
         42 |     83,639        0.35       97.69
         44 |      7,189        0.03       97.72
         45 |     37,090        0.15       97.87
         46 |      6,736        0.03       97.90
         47 |     53,208        0.22       98.12
         48 |    219,556        0.91       99.04
         49 |     28,598        0.12       99.16
         50 |      4,493        0.02       99.18
         51 |     70,723        0.29       99.47
         53 |     71,202        0.30       99.77
         54 |     11,625        0.05       99.81
         55 |     39,001        0.16       99.98
         56 |      5,493        0.02      100.00
------------+-----------------------------------
      Total | 24,015,037      100.00

. rename migplac1 state_fips_o

. tab migcounty1

 migcounty1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 22,397,212       93.26       93.26
          1 |     38,852        0.16       93.43
          3 |     63,981        0.27       93.69
          5 |     23,554        0.10       93.79
          7 |     14,942        0.06       93.85
          9 |     13,176        0.05       93.91
         11 |     25,896        0.11       94.01
         13 |     59,788        0.25       94.26
         15 |      8,049        0.03       94.30
         17 |     24,998        0.10       94.40
         19 |     25,974        0.11       94.51
         20 |      2,285        0.01       94.52
         21 |     14,712        0.06       94.58
         23 |      8,687        0.04       94.62
         25 |     23,269        0.10       94.71
         27 |     16,916        0.07       94.78
         29 |     35,798        0.15       94.93
         31 |     63,004        0.26       95.19
         33 |     37,066        0.15       95.35
         35 |     27,440        0.11       95.46
         37 |     79,114        0.33       95.79
         39 |     11,614        0.05       95.84
         41 |      9,685        0.04       95.88
         43 |      9,722        0.04       95.92
         45 |      6,865        0.03       95.95
         47 |     25,074        0.10       96.06
         49 |     23,558        0.10       96.15
         51 |     19,026        0.08       96.23
         53 |     19,452        0.08       96.31
         55 |     13,919        0.06       96.37
         57 |     20,272        0.08       96.46
         59 |     33,983        0.14       96.60
         61 |     34,892        0.15       96.74
         63 |     13,833        0.06       96.80
         65 |     20,464        0.09       96.89
         67 |     32,851        0.14       97.02
         69 |      4,704        0.02       97.04
         71 |     30,322        0.13       97.17
         73 |     40,463        0.17       97.34
         75 |     13,169        0.05       97.39
         77 |      9,062        0.04       97.43
         79 |      8,380        0.03       97.46
         81 |     33,279        0.14       97.60
         83 |     10,073        0.04       97.64
         85 |     32,160        0.13       97.78
         87 |      7,300        0.03       97.81
         89 |     11,560        0.05       97.86
         91 |     16,976        0.07       97.93
         93 |      5,920        0.02       97.95
         95 |     21,990        0.09       98.04
         97 |     21,423        0.09       98.13
         99 |     21,309        0.09       98.22
        101 |     15,847        0.07       98.29
        103 |     20,195        0.08       98.37
        105 |      8,157        0.03       98.41
        107 |      6,225        0.03       98.43
        109 |     11,773        0.05       98.48
        111 |     16,340        0.07       98.55
        113 |     33,983        0.14       98.69
        115 |      5,301        0.02       98.71
        117 |      8,478        0.04       98.75
        119 |     16,875        0.07       98.82
        121 |     12,017        0.05       98.87
        123 |      4,198        0.02       98.89
        125 |     10,142        0.04       98.93
        127 |      2,922        0.01       98.94
        129 |      1,975        0.01       98.95
        133 |      5,837        0.02       98.97
        135 |      8,815        0.04       99.01
        139 |      6,638        0.03       99.04
        141 |      7,621        0.03       99.07
        143 |      5,187        0.02       99.09
        145 |      2,074        0.01       99.10
        147 |      2,570        0.01       99.11
        149 |      2,427        0.01       99.12
        151 |      2,091        0.01       99.13
        153 |      5,916        0.02       99.15
        157 |     12,742        0.05       99.21
        159 |        807        0.00       99.21
        160 |        234        0.00       99.21
        161 |      5,166        0.02       99.23
        163 |     14,992        0.06       99.29
        165 |      2,647        0.01       99.31
        167 |      5,589        0.02       99.33
        169 |        921        0.00       99.33
        171 |        529        0.00       99.33
        173 |        362        0.00       99.34
        179 |      1,984        0.01       99.34
        183 |     12,753        0.05       99.40
        185 |        956        0.00       99.40
        187 |      2,572        0.01       99.41
        189 |      7,260        0.03       99.44
        191 |        855        0.00       99.45
        197 |      3,714        0.02       99.46
        201 |     32,347        0.13       99.60
        209 |      2,962        0.01       99.61
        215 |      3,501        0.01       99.62
        223 |        849        0.00       99.63
        227 |      1,037        0.00       99.63
        245 |      3,376        0.01       99.64
        251 |      1,136        0.00       99.65
        257 |        957        0.00       99.65
        303 |      3,683        0.02       99.67
        309 |      2,562        0.01       99.68
        313 |        525        0.00       99.68
        329 |      1,285        0.01       99.69
        339 |      3,566        0.01       99.70
        355 |      2,895        0.01       99.71
        367 |      1,109        0.00       99.72
        375 |      1,077        0.00       99.72
        381 |      1,335        0.01       99.73
        423 |      1,679        0.01       99.74
        439 |     16,294        0.07       99.80
        441 |      1,584        0.01       99.81
        451 |      1,056        0.00       99.81
        453 |     13,967        0.06       99.87
        479 |      1,416        0.01       99.88
        485 |      1,431        0.01       99.88
        491 |      4,607        0.02       99.90
        510 |     11,147        0.05       99.95
        550 |      1,187        0.00       99.96
        650 |      1,161        0.00       99.96
        700 |      1,586        0.01       99.97
        710 |        689        0.00       99.97
        760 |      3,068        0.01       99.98
        810 |      4,263        0.02      100.00
------------+-----------------------------------
      Total | 24,015,037      100.00

. rename migcounty1 county_fips_o

. 
. ** Use migrate1 to update values 
. 
. ** Within same house 
. replace state_fips_o = state_fips_d if migrate1 == 1
(21,541,019 real changes made)

. replace county_fips_o = county_fips_d if migrate1 == 1 
(13,111,570 real changes made)

. 
. ** Within same state 
. replace state_fips_o = state_fips_d if migrate1 == 2
(0 real changes made)

. 
. ** Generate county IDS 
. foreach x in "o" "d" {
  2.         
.         make_fips state_fips_`x' county_fips_`x', gen(fips_`x')
  3. 
. }

. 
. ** Check for within-state migration 
. gen same_county = fips_o == fips_d 

. tab year same_county

           |      same_county
      year |         0          1 |     Total
-----------+----------------------+----------
      2015 |    89,492  2,245,481 | 2,334,973 
      2016 |    91,109  2,255,901 | 2,347,010 
      2017 |    93,553  2,278,348 | 2,371,901 
      2018 |    96,080  2,306,022 | 2,402,102 
      2019 |    96,088  2,344,171 | 2,440,259 
      2020 |    71,827  1,877,155 | 1,948,982 
      2021 |    97,600  2,361,518 | 2,459,118 
      2022 |   106,231  2,430,426 | 2,536,657 
      2023 |    98,226  2,479,566 | 2,577,792 
      2024 |    93,040  2,503,203 | 2,596,243 
-----------+----------------------+----------
     Total |   933,246 23,081,791 |24,015,037 

. tab year same_county if migrate1 == 2

           |      same_county
      year |         0          1 |     Total
-----------+----------------------+----------
      2015 |    42,597    172,956 |   215,553 
      2016 |    43,823    172,091 |   215,914 
      2017 |    45,058    174,386 |   219,444 
      2018 |    46,477    173,182 |   219,659 
      2019 |    46,329    168,101 |   214,430 
      2020 |    34,625    119,307 |   153,932 
      2021 |    46,470    148,925 |   195,395 
      2022 |    50,584    141,717 |   192,301 
      2023 |    47,498    135,794 |   183,292 
      2024 |    46,033    134,313 |   180,346 
-----------+----------------------+----------
     Total |   449,494  1,540,772 | 1,990,266 

. 
. ** Tag HH head 
. gen byte hh_head = (relate == 1)

. 
. ** Compress file 
. compress 
  variable incwelfr was long now int
  variable incsupp was long now int
  variable state_fips_o was int now byte
  variable hh_size was float now byte
  variable hh_adult_ct was float now byte
  variable hh_child_ct was float now byte
  variable college was float now byte
  variable hh_any_child was float now byte
  variable hh_any_college was float now byte
  variable hh_perwt was float now int
  variable same_county was float now byte
  (672,421,036 bytes saved)

. 
. ** Save 
. save "${data}working/acs_migration_file", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/acs_migration_file.dta
    saved

. 
. ** Keep only observations with valid origin/destination counties and YEAR
. drop if missing(year) | missing(fips_o) | missing(fips_d)
(0 observations deleted)

. 
. ** Clean income (treat missing as 0; keep negative values as reported)
. replace inctot = 0 if missing(inctot)
(0 real changes made)

. gen double income_wt = inctot * perwt

. label var income_wt "Person income (INCTOT) weighted by PERWT"

. 
. ** Persons + income totals by origin/destination/year
. 
. preserve

. keep year fips_o fips_d perwt income_wt

. collapse (sum) persons=perwt income_total=income_wt, by(year fips_o fips_d)

. tempfile acs_pi

. save `acs_pi'
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000f.tmp saved as .dta format

. restore

. 
. ** Households by origin/destination/year
. ** Use HHWT among household heads (RELATE==1)
. 
. preserve

. keep if hh_head == 1 
(11,523,232 observations deleted)

. keep year fips_o fips_d hhwt

. collapse (sum) households=hhwt, by(year fips_o fips_d)

. tempfile acs_hh

. save `acs_hh'
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000h.tmp saved as .dta format

. restore

. 
. ** Merge persons/income with households
. use `acs_pi', clear

. merge 1:1 year fips_o fips_d using `acs_hh', nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                        50,330
        from master                    50,330  
        from using                          0  

    Matched                           181,401  
    -----------------------------------------

. 
. label var persons "Estimated number of persons (sum PERWT)"

. label var households "Estimated number of households (sum HHWT among heads)"

. label var income_total "Estimated total personal income (sum INCTOT*PERWT)"

. 
. ** Derive state/county components for merges with name crosswalk
. gen int state_fips_o  = floor(fips_o/1000)

. gen int county_fips_o = mod(fips_o,1000)

. gen int state_fips_d  = floor(fips_d/1000)

. gen int county_fips_d = mod(fips_d,1000)

. 
. label var state_fips_o "State FIPS (origin)"

. label var county_fips_o "County FIPS (origin)"

. label var state_fips_d "State FIPS (destination)"

. label var county_fips_d "County FIPS (destination)"

. 
. ** Merge in names (from NHGIS IDs snapshot)
. 
. 
. ** Loop over orgin and destination states
. foreach x in "d" "o" {
  2.         
.         preserve
  3.         
.         ** Load County IDs 
.         use "${data}working/ids", clear
  4.         
.         ** Rename 
.         rename  (state_fips county_fips state_name county_name) ///
>                         (state_fips_`x' county_fips_`x' state_name_`x' county_name_`x')
  5.                 
.         ** Save as temporary file       
.         tempfile ids_`x'
  6.         save `ids_`x''
  7.         
.         ** Restore and merge data 
.         restore
  8.         merge m:1 state_fips_`x' county_fips_`x' using `ids_`x'', keep(master match) nogen
  9. 
. } // END ORIGIN - DESTINATION LOOP 
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000j.tmp saved as .dta format

    Result                      Number of obs
    -----------------------------------------
    Not matched                        55,890
        from master                    55,890  
        from using                          0  

    Matched                           175,841  
    -----------------------------------------
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000l.tmp saved as .dta format

    Result                      Number of obs
    -----------------------------------------
    Not matched                        52,146
        from master                    52,146  
        from using                          0  

    Matched                           179,585  
    -----------------------------------------

. 
. ** Organize data 
. order year ///
>     state_fips_o county_fips_o state_name_o county_name_o fips_o ///
>     state_fips_d county_fips_d state_name_d county_name_d fips_d ///
>     persons households income_total

. 
. ** Sort data 
. sort year state_fips_o county_fips_o state_fips_d county_fips_d

. 
. ** Identify other counties (suppression)
. replace county_name_o = "Other" if county_fips_o == 0 
(52,066 real changes made)

. replace county_name_d = "Other" if county_fips_d == 0 
(55,163 real changes made)

. 
. ** Save data
. save "${data}working/acs_county_flow", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/acs_county_flow.dta saved

. clear 

. 
. ** Create gross-migration files for ACS 
. 
. ** All (18+)
. acs_make_gross_migration using "${data}working/acs_migration_file", ///
>     saving("${data}working/acs_county_gross_18plus") replace 
(0 observations deleted)
(0 real changes made)
(11,523,232 missing values generated)
(11,523,232 missing values generated)
(11,523,232 real changes made)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000n.tmp not found)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000n.tmp saved as .dta format
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000p.tmp not found)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000p.tmp saved as .dta format

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             4,825  
    -----------------------------------------
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(variable fips was long, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           504
        from master                       504  
        from using                          0  

    Matched                             4,321  
    -----------------------------------------
  variable state_fips was int now byte
  variable fips was double now long
  variable persons_in_1 was double now long
  variable persons_in_4 was double now long
  variable persons_in_5 was double now long
  variable households_in_1 was double now long
  variable households_in_4 was double now long
  variable households_in_5 was double now long
  variable persons_in_2 was double now long
  variable persons_in_3 was double now long
  variable households_in_2 was double now long
  variable households_in_3 was double now long
  variable persons_out_1 was double now long
  variable persons_out_4 was double now long
  variable persons_out_5 was double now long
  variable households_out_1 was double now long
  variable households_out_4 was double now long
  variable households_out_5 was double now long
  variable persons_out_2 was double now long
  variable persons_out_3 was double now long
  variable households_out_2 was double now long
  variable households_out_3 was double now long
  variable persons_net_2 was double now long
  variable persons_net_3 was double now long
  variable persons_net_4 was double now long
  variable persons_net_5 was double now long
  variable households_net_2 was double now long
  variable households_net_3 was double now long
  variable households_net_4 was double now long
  variable households_net_5 was double now long
  variable county_name was str46 now str23
  (675,500 bytes saved)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/acs_county_gross_18plus.dt
    > a saved

.         
. ** College-degrees 
. acs_make_gross_migration  using "${data}working/acs_migration_file", ///
>     saving("${data}working/acs_county_gross_college") replace sample("hh_any_college == 1")
(0 observations deleted)
(0 observations deleted)
(0 real changes made)
(11,523,232 missing values generated)
(11,523,232 missing values generated)
(11,523,232 real changes made)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000n.tmp not found)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000n.tmp saved as .dta format
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(226,906 missing values generated)
(187,776 missing values generated)
(48,780 missing values generated)
(file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000p.tmp not found)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000p.tmp saved as .dta format

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             4,825  
    -----------------------------------------
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(variable fips was long, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           504
        from master                       504  
        from using                          0  

    Matched                             4,321  
    -----------------------------------------
  variable state_fips was int now byte
  variable fips was double now long
  variable persons_in_1 was double now long
  variable persons_in_4 was double now long
  variable persons_in_5 was double now long
  variable households_in_1 was double now long
  variable households_in_4 was double now long
  variable households_in_5 was double now long
  variable persons_in_2 was double now long
  variable persons_in_3 was double now long
  variable households_in_2 was double now long
  variable households_in_3 was double now long
  variable persons_out_1 was double now long
  variable persons_out_4 was double now long
  variable persons_out_5 was double now long
  variable households_out_1 was double now long
  variable households_out_4 was double now long
  variable households_out_5 was double now long
  variable persons_out_2 was double now long
  variable persons_out_3 was double now long
  variable households_out_2 was double now long
  variable households_out_3 was double now long
  variable persons_net_2 was double now long
  variable persons_net_3 was double now long
  variable persons_net_4 was double now long
  variable persons_net_5 was double now long
  variable households_net_2 was double now long
  variable households_net_3 was double now long
  variable households_net_4 was double now long
  variable households_net_5 was double now long
  variable county_name was str46 now str23
  (675,500 bytes saved)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/acs_county_gross_college.d
    > ta saved

.         
. ** No Kids
. acs_make_gross_migration using "${data}working/acs_migration_file", ///
>     saving("${data}working/acs_county_gross_nokids") replace sample("hh_any_child == 0")
(7,412,793 observations deleted)
(0 observations deleted)
(0 real changes made)
(7,460,825 missing values generated)
(7,460,825 missing values generated)
(7,460,825 real changes made)
(192,951 missing values generated)
(157,429 missing values generated)
(45,172 missing values generated)
(192,951 missing values generated)
(157,429 missing values generated)
(45,172 missing values generated)
(192,951 missing values generated)
(157,429 missing values generated)
(45,172 missing values generated)
(file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000n.tmp not found)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000n.tmp saved as .dta format
(192,951 missing values generated)
(157,429 missing values generated)
(45,172 missing values generated)
(192,951 missing values generated)
(157,429 missing values generated)
(45,172 missing values generated)
(192,951 missing values generated)
(157,429 missing values generated)
(45,172 missing values generated)
(file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000p.tmp not found)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000p.tmp saved as .dta format

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             4,825  
    -----------------------------------------
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(variable fips was long, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           504
        from master                       504  
        from using                          0  

    Matched                             4,321  
    -----------------------------------------
  variable state_fips was int now byte
  variable fips was double now long
  variable persons_in_1 was double now long
  variable persons_in_4 was double now long
  variable persons_in_5 was double now long
  variable households_in_1 was double now long
  variable households_in_4 was double now long
  variable households_in_5 was double now long
  variable persons_in_2 was double now long
  variable persons_in_3 was double now long
  variable households_in_2 was double now long
  variable households_in_3 was double now long
  variable persons_out_1 was double now long
  variable persons_out_4 was double now long
  variable persons_out_5 was double now long
  variable households_out_1 was double now long
  variable households_out_4 was double now long
  variable households_out_5 was double now long
  variable persons_out_2 was double now long
  variable persons_out_3 was double now long
  variable households_out_2 was double now long
  variable households_out_3 was double now long
  variable persons_net_2 was double now long
  variable persons_net_3 was double now long
  variable persons_net_4 was double now long
  variable persons_net_5 was double now long
  variable households_net_2 was double now long
  variable households_net_3 was double now long
  variable households_net_4 was double now long
  variable households_net_5 was double now int
  variable county_name was str46 now str23
  (685,150 bytes saved)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/acs_county_gross_nokids.dt
    > a saved

.         
. ********************************************************************************
. ** STEP 5: Import and Clean IRS Migration Data 
. ********************************************************************************
.         
. ** Loop over years 
. forvalues y = 16(1)22 {
  2.         
.         local start = `y' - 1
  3.         local end = `y'  
  4.         
.         ** Import data (out)
.         import delimited "${data}irs/countyoutflow`start'`end'.csv", clear 
  5.         
.         ** Describe data 
.         des 
  6.         
.         ** Generate year (end year)
.         gen year = 2000 + `y'
  7.         
.         ** Drop Regional Values 
.         drop if y2_state == "DS"
  8.         
.         ** Drop Foreign Migration 
.         drop if y2_state == "FR"
  9.         
.         ** Drop observations without a county
.         drop if y1_countyfips == 0 
 10.         
.         ** Deal with suppressed values 
.         unsuppress n1 n2 agi
 11.         
.         ** Drop unnecc variables 
.         drop y2_state y2_countyname
 12.                 
.         ** Create two versions: gross and net 
.         tempfile tmp
 13.         save `tmp'
 14.         
.         ** Gross first 
.         
.         ** Keep gross categories 
.         keep if ///
>                 (y1_statefips == y2_statefips & y1_countyfips == y2_countyfips) |       ///
>                 inlist(y2_statefips, 96, 97, 98)
 15. 
.         ** Clean up 
.         gen move_type = 0 
 16.         
.         ** Stayers 
.         replace move_type = 1 if        (y1_statefips == y2_statefips) &        ///
>                                                                 (y1_countyfips == y2_countyfips)
>  
 17.         
.         ** Movers
.         replace move_type = 2 if        y2_statefips == 96              // ALL 
 18.         replace move_type = 3 if        y2_statefips == 97 &    ///
>                                                                 y2_countyfips == 0              
> // Domestic Total
 19.         replace move_type = 4 if        y2_statefips == 97 &    ///
>                                                                 y2_countyfips == 1              
> // Within-state
 20.         replace move_type = 5 if        y2_statefips == 97 &    ///
>                                                                 y2_countyfips == 3              
> // Between-states 
 21.         replace move_type = 6 if        y2_statefips == 98              // Foreign 
 22.         
.         ** Label movers 
.         label values move_type lb_move_type 
 23.         
.         ** Generate total category 
.         foreach var of varlist n1 n2 agi {
 24.                 
.                 gen tmp = `var' if inlist(move_type, 1, 2)
 25.                 bysort y1_statefips y1_countyfips: egen `var'_total = total(tmp)
 26.                 drop tmp 
 27.                 
.         } // END VAR LOOP 
 28.         
.         ** Drop unnecc variables 
.         drop y2_* 
 29.         
.         ** Sort 
.         sort year y1_statefips y1_countyfips move_type 
 30. 
.         ** Order 
.         order year y1_statefips y1_countyfips move_type 
 31.         
.         ** Rename 
.         rename y1_countyfips county_fips 
 32.         rename y1_statefips state_fips 
 33.         
.         ** Label variables 
.         label var year "Tax year (year before move)"
 34.         label var state_fips "State FIPS code (origin state)"
 35.         label var county_fips "County FIPS code (origin county)"
 36.         label var move_type "Mover category"
 37.         label var n1 "Number of returns"
 38.         label var n2 "Number of exemptions"
 39.         label var agi "Adjusted Gross Income"
 40.         label var n1_total "Number of returns, county total (origin)"
 41.         label var n2_total "Number of exemptions, county total (origin)"
 42.         label var agi_total "Adjusted Gross Income, county total (origin)"
 43.         
.         ** Save 
.         save "${data}working/irs_county_gross_out_`y'", replace 
 44.         
.         ** Create version for merge with net 
.         keep if move_type == 3 
 45.         
.         ** Rename variables 
.         rename n1 n1_mover
 46.         rename n2 n2_mover 
 47.         rename agi agi_mover 
 48.         
.         label var n1_mover "Number of domestic mover returns"
 49.         label var n2_mover "Number of domestic mover exemptions"
 50.         label var agi_mover "Adjusted Gross Income, domestic movers"
 51.         
.         ** Save as temp file 
.         tempfile merge 
 52.         save `merge'
 53.         clear 
 54.         
.         ** Next, create flow file 
.         use `tmp', clear 
 55.         
.         ** Drop aggregate values 
.         drop if inlist(y2_statefips, 96, 97, 98)
 56.         drop if (y1_statefips == y2_statefips & y1_countyfips == y2_countyfips) 
 57.         
.         ** Sort 
.         sort year y1_statefips y1_countyfips y2_statefips y2_countyfips 
 58. 
.         ** Order 
.         order year y1_statefips y1_countyfips y2_statefips y2_countyfips
 59. 
.         
.         ** Rename 
.         rename y1_countyfips county_fips 
 60.         rename y1_statefips state_fips 
 61.         rename y2_countyfips y2_county_fips 
 62.         rename y2_statefips y2_state_fips       
 63.         
.         ** Label variables 
.         label var year "Tax year (year before move)"
 64.         label var state_fips "State FIPS code (origin state)"
 65.         label var county_fips "County FIPS code (origin county)"
 66.         label var y2_state_fips "State FIPS code (dest. state)"
 67.         label var y2_county_fips "County FIPS code (dest. county)"      
 68.         label var n1 "Number of returns"
 69.         label var n2 "Number of exemptions"
 70.         label var agi "Adjusted Gross Income"
 71.         
.         ** Merge with county of origin data 
.         merge m:1 state_fips county_fips using `merge', nogen keep(master match)
 72.         
.         ** Rename 
.         rename state_fips state_fips_o
 73.         rename county_fips county_fips_o
 74.         rename y2_* *_d 
 75.         
.         ** Dropo unnecc variable 
.         drop move_type 
 76.         
.         ** Save 
.         save "${data}working/irs_county_flow_`y'", replace 
 77.         clear
 78.         
.         ** Import data (in)
.         import delimited "${data}irs/countyinflow`start'`end'.csv", clear 
 79.         
.         ** Describe data 
.         des 
 80. 
.         ** Generate year 
.         gen year = 2000 + `y' 
 81.         
.         ** Drop Regional Values 
.         drop if y1_state == "DS"
 82.         
.         ** Drop Foreign Migration 
.         drop if y1_state == "FR"
 83.         
.         ** Drop observations with no county ID 
.         drop if y2_countyfips == 0 
 84.         
.         ** Keep gross categories 
.         keep if ///
>                 (y1_statefips == y2_statefips & y1_countyfips == y2_countyfips) |       ///
>                 inlist(y1_statefips, 96, 97, 98)
 85. 
.         ** Clean up 
.         gen move_type = 0 
 86.         
.         ** Deal with suppressed values 
.         unsuppress n1 n2 agi
 87.         
.         ** Stayers 
.         replace move_type = 1 if        (y1_statefips == y2_statefips) &        ///
>                                                                 (y1_countyfips == y2_countyfips)
>  
 88.         
.         ** Movers
.         replace move_type = 2 if        y1_statefips == 96              // ALL 
 89.         replace move_type = 3 if        y1_statefips == 97 &    ///
>                                                                 y1_countyfips == 0              
> // Domestic Total
 90.         replace move_type = 4 if        y1_statefips == 97 &    ///
>                                                                 y1_countyfips == 1              
> // Within-state
 91.         replace move_type = 5 if        y1_statefips == 97 &    ///
>                                                                 y1_countyfips == 3              
> // Between-states 
 92.         replace move_type = 6 if        y1_statefips == 98              // Foreign 
 93.         
.         ** Label move variable  
.         label values move_type lb_move_type 
 94.         
.         ** Generate total category 
.         foreach var of varlist n1 n2 agi {
 95.                 
.                 gen tmp = `var' if inlist(move_type, 1, 2)
 96.                 bysort y2_statefips y2_countyfips: egen `var'_total = total(tmp)
 97.                 drop tmp 
 98.                 
.         } // END VAR LOOP 
 99.         
.         ** Drop unnecc variables 
.         drop y1_*
100.         
.         ** Sort 
.         sort year y2_statefips y2_countyfips move_type 
101. 
.         ** Order 
.         order year y2_statefips y2_countyfips move_type 
102.         
.         ** Rename 
.         rename y2_countyfips county_fips 
103.         rename y2_statefips state_fips 
104.         
.         ** Label variables 
.         label var year "Tax year (year before move)"
105.         label var state_fips "State FIPS code (dest. state)"
106.         label var county_fips "County FIPS code (dest. county)"
107.         label var move_type "Mover category"
108.         label var n1 "Number of returns"
109.         label var n2 "Number of exemptions"
110.         label var agi "Adjusted Gross Income"
111.         label var n1_total "Number of returns, county total (dest.)"
112.         label var n2_total "Number of exemptions, county total (dest.)"
113.         label var agi_total "Adjusted Gross Income, county total (dest.)"
114.         
.         ** Save 
.         save "${data}working/irs_county_gross_in_`y'", replace 
115.         clear 
116.         
. } // END YEAR LOOP 
(encoding automatically selected: ISO-8859-1)
(9 vars, 86,481 obs)

Contains data
 Observations:        86,481                  
    Variables:             9                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y2_state        str2    %9s                   
y2_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,289 observations deleted)
(2,937 observations deleted)
(254 observations deleted)
(2,056 real changes made)
(2,056 real changes made)
(2,056 real changes made)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000m.tmp saved as .dta format
(50,007 observations deleted)
(3,141 real changes made)
(3,141 real changes made)
(3,141 real changes made)
(3,140 real changes made)
(3,140 real changes made)
(2,291 real changes made)
(11,712 missing values generated)
(11,712 missing values generated)
(11,712 missing values generated)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_out_16.dt
    > a saved
(14,853 observations deleted)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000n.tmp saved as .dta format
(14,853 observations deleted)
(3,141 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                            50,007  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_flow_16.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 86,330 obs)

Contains data
 Observations:        86,330                  
    Variables:             9                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y1_state        str2    %9s                   
y1_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,315 observations deleted)
(2,814 observations deleted)
(254 observations deleted)
(50,005 observations deleted)
(2,041 real changes made)
(2,041 real changes made)
(2,041 real changes made)
(3,141 real changes made)
(3,141 real changes made)
(3,141 real changes made)
(3,140 real changes made)
(3,140 real changes made)
(2,239 real changes made)
(11,660 missing values generated)
(11,660 missing values generated)
(11,660 missing values generated)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_in_16.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 98,948 obs)

Contains data
 Observations:        98,948                  
    Variables:             9                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y2_state        str2    %9s                   
y2_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,372 observations deleted)
(2,360 observations deleted)
(254 observations deleted)
(1,877 real changes made)
(1,877 real changes made)
(1,877 real changes made)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000o.tmp saved as .dta format
(63,249 observations deleted)
(3,140 real changes made)
(3,141 real changes made)
(3,141 real changes made)
(3,140 real changes made)
(3,141 real changes made)
(2,010 real changes made)
(11,432 missing values generated)
(11,432 missing values generated)
(11,432 missing values generated)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_out_17.dt
    > a saved
(14,572 observations deleted)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000p.tmp saved as .dta format
(14,573 observations deleted)
(3,140 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                            63,249  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_flow_17.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 98,874 obs)

Contains data
 Observations:        98,874                  
    Variables:             9                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y1_state        str2    %9s                   
y1_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,432 observations deleted)
(2,282 observations deleted)
(254 observations deleted)
(63,249 observations deleted)
(1,788 real changes made)
(1,788 real changes made)
(1,788 real changes made)
(3,140 real changes made)
(3,141 real changes made)
(3,141 real changes made)
(3,140 real changes made)
(3,140 real changes made)
(1,955 real changes made)
(11,376 missing values generated)
(11,376 missing values generated)
(11,376 missing values generated)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_in_17.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 87,820 obs)

Contains data
 Observations:        87,820                  
    Variables:             9                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y2_state        str2    %9s                   
y2_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,300 observations deleted)
(2,364 observations deleted)
(254 observations deleted)
(1,942 real changes made)
(1,942 real changes made)
(1,942 real changes made)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000q.tmp saved as .dta format
(52,173 observations deleted)
(3,141 real changes made)
(3,141 real changes made)
(3,141 real changes made)
(3,140 real changes made)
(3,140 real changes made)
(2,026 real changes made)
(11,447 missing values generated)
(11,447 missing values generated)
(11,447 missing values generated)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_out_18.dt
    > a saved
(14,588 observations deleted)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000r.tmp saved as .dta format
(14,588 observations deleted)
(3,141 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                            52,173  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_flow_18.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 87,932 obs)

Contains data
 Observations:        87,932                  
    Variables:             9                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y1_state        str2    %9s                   
y1_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,368 observations deleted)
(2,403 observations deleted)
(254 observations deleted)
(52,174 observations deleted)
(1,919 real changes made)
(1,919 real changes made)
(1,919 real changes made)
(3,141 real changes made)
(3,141 real changes made)
(3,141 real changes made)
(3,140 real changes made)
(3,140 real changes made)
(2,030 real changes made)
(11,451 missing values generated)
(11,451 missing values generated)
(11,451 missing values generated)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_in_18.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 83,878 obs)

Contains data
 Observations:        83,878                  
    Variables:             9                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y2_state        str2    %9s                   
y2_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(14,919 observations deleted)
(2,298 observations deleted)
(0 observations deleted)
(53 real changes made)
(53 real changes made)
(53 real changes made)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000s.tmp saved as .dta format
(51,090 observations deleted)
(3,141 real changes made)
(3,107 real changes made)
(3,107 real changes made)
(3,103 real changes made)
(2,778 real changes made)
(335 real changes made)
(9,323 missing values generated)
(9,323 missing values generated)
(9,323 missing values generated)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_out_19.dt
    > a saved
(12,464 observations deleted)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000t.tmp saved as .dta format
(12,430 observations deleted)
(3,141 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            34
        from master                        34  
        from using                          0  

    Matched                            51,056  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_flow_19.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 83,762 obs)

Contains data
 Observations:        83,762                  
    Variables:             9                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y1_state        str2    %9s                   
y1_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(14,890 observations deleted)
(2,290 observations deleted)
(0 observations deleted)
(51,090 observations deleted)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(3,141 real changes made)
(3,086 real changes made)
(3,086 real changes made)
(3,082 real changes made)
(2,729 real changes made)
(368 real changes made)
(9,265 missing values generated)
(9,265 missing values generated)
(9,265 missing values generated)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_in_19.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 87,325 obs)

Contains data
 Observations:        87,325                  
    Variables:             9                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y2_state        str2    %9s                   
y2_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(14,937 observations deleted)
(2,272 observations deleted)
(0 observations deleted)
(62 real changes made)
(62 real changes made)
(62 real changes made)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000u.tmp saved as .dta format
(54,560 observations deleted)
(3,142 real changes made)
(3,104 real changes made)
(3,104 real changes made)
(3,101 real changes made)
(2,773 real changes made)
(332 real changes made)
(9,310 missing values generated)
(9,310 missing values generated)
(9,310 missing values generated)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_out_20.dt
    > a saved
(12,452 observations deleted)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000v.tmp saved as .dta format
(12,414 observations deleted)
(3,142 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            38
        from master                        38  
        from using                          0  

    Matched                            54,522  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_flow_20.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 87,552 obs)

Contains data
 Observations:        87,552                  
    Variables:             9                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y1_state        str2    %9s                   
y1_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,060 observations deleted)
(2,323 observations deleted)
(0 observations deleted)
(54,560 observations deleted)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(3,142 real changes made)
(3,102 real changes made)
(3,102 real changes made)
(3,097 real changes made)
(2,805 real changes made)
(361 real changes made)
(9,365 missing values generated)
(9,365 missing values generated)
(9,365 missing values generated)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_in_20.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 89,511 obs)

Contains data
 Observations:        89,511                  
    Variables:             9                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y2_state        str2    %9s                   
y2_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(14,963 observations deleted)
(2,175 observations deleted)
(0 observations deleted)
(79 real changes made)
(79 real changes made)
(79 real changes made)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000w.tmp saved as .dta format
(56,831 observations deleted)
(3,143 real changes made)
(3,097 real changes made)
(3,097 real changes made)
(3,094 real changes made)
(2,787 real changes made)
(324 real changes made)
(9,302 missing values generated)
(9,302 missing values generated)
(9,302 missing values generated)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_out_21.dt
    > a saved
(12,445 observations deleted)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000x.tmp saved as .dta format
(12,399 observations deleted)
(3,143 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            46
        from master                        46  
        from using                          0  

    Matched                            56,785  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_flow_21.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 89,850 obs)

Contains data
 Observations:        89,850                  
    Variables:             9                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y1_state        str2    %9s                   
y1_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,132 observations deleted)
(2,263 observations deleted)
(0 observations deleted)
(56,835 observations deleted)
(1 real change made)
(1 real change made)
(1 real change made)
(3,143 real changes made)
(3,101 real changes made)
(3,101 real changes made)
(3,098 real changes made)
(2,838 real changes made)
(339 real changes made)
(9,376 missing values generated)
(9,376 missing values generated)
(9,376 missing values generated)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_in_21.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 90,409 obs)

Contains data
 Observations:        90,409                  
    Variables:             9                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y2_state        str2    %9s                   
y2_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(14,962 observations deleted)
(2,223 observations deleted)
(0 observations deleted)
(64 real changes made)
(64 real changes made)
(64 real changes made)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_000010.tmp saved as .dta format
(57,644 observations deleted)
(3,144 real changes made)
(3,107 real changes made)
(3,107 real changes made)
(3,103 real changes made)
(2,790 real changes made)
(329 real changes made)
(9,329 missing values generated)
(9,329 missing values generated)
(9,329 missing values generated)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_out_22.dt
    > a saved
(12,473 observations deleted)
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_000011.tmp saved as .dta format
(12,436 observations deleted)
(3,144 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            37
        from master                        37  
        from using                          0  

    Matched                            57,607  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_flow_22.dta
    saved
(encoding automatically selected: ISO-8859-1)
(9 vars, 90,498 obs)

Contains data
 Observations:        90,498                  
    Variables:             9                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
y2_statefips    byte    %8.0g                 
y2_countyfips   int     %8.0g                 
y1_statefips    byte    %8.0g                 
y1_countyfips   int     %8.0g                 
y1_state        str2    %9s                   
y1_countyname   str60   %60s                  
n1              long    %12.0g                
n2              long    %12.0g                
agi             long    %12.0g                
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
(15,093 observations deleted)
(2,179 observations deleted)
(0 observations deleted)
(57,640 observations deleted)
(1 real change made)
(1 real change made)
(1 real change made)
(3,144 real changes made)
(3,098 real changes made)
(3,098 real changes made)
(3,094 real changes made)
(2,822 real changes made)
(330 real changes made)
(9,344 missing values generated)
(9,344 missing values generated)
(9,344 missing values generated)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_in_22.dta
    saved

. 
. ** Append data 
. 
. ** Loop over datasets 
. foreach file in "irs_county_gross_in" "irs_county_gross_out" "irs_county_flow"{
  2.         
.                 
.         ** Loop over years 
.         forvalues y = 16(1)22 {
  3. 
.                 ** Append 
.                 append using "${data}working/`file'_`y'"
  4.                 
.         } // END YEAR LOOP 
  5.         
.         
.         ** Order and sort flow file 
.         if "`file'" == "irs_county_flow" {
  6.                 
.                 ** Loop over orgin and destination state 
.                 foreach x in "o" "d" {
  7.                         
.                         ** Rename 
.                         rename *_fips_`x' *_fips 
  8.                         
.                         ** Merge with county and state names 
.                         merge m:1 state_fips county_fips using "${data}working/ids",    ///
>                                 keep(match) nogen 
  9.                                 
.                         ** Rename 
.                         rename *_fips *_fips_`x' 
 10.                         rename *_name *_name_`x' 
 11.                         
.                         ** Generate county IDS 
.                         make_fips state_fips_`x' county_fips_`x', gen(fips_`x')
 12.                         
.                 } // END ORIGIN / DESTINATION LOOP 
 13.                 
.                 ** Order file 
.                 order year state_*_o county_*_o state_*_d county_*_d  
 14.                 sort year state_*_o county_*_o state_*_d county_*_d  
 15. 
.         } // END MIGRATION FLOW IF-STATEMENT 
 16.         
.         else {
 17.                 
.                 ** Merge with county and state names 
.                 merge m:1 state_fips county_fips using "${data}working/ids",    ///
>                                 keep(match) nogen 
 18.                                 
.                 ** Order 
.                 order year state_* county* move_type
 19.                 
.         } 
 20.         
.         ** Save file 
.         save "${data}working/`file'", replace 
 21.         clear 
 22.         
. } // END FILE LOOP 

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           115,567  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_in.dta
    saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           115,611  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross_out.dta
    saved

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           384,896  
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           362,678  
    -----------------------------------------
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_flow.dta saved

. 
. ** Create gross file with in and out migration 
. use "${data}working/irs_county_gross_in", clear 

. 
. ** Rename 
. rename n1 n1_in_

. rename n2 n2_in_

. rename agi agi_in_

. rename *_total *_total_in

. 
. ** Reshape 
. reshape wide n1_in_ n2_in_ agi_in_, i(year state_fips county_fips) j(move_type)
(j = 1 2 3 4 5 6)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations          115,567   ->   21,980      
Number of variables                  13   ->   27          
j variable (6 values)         move_type   ->   (dropped)
xij variables:
                                 n1_in_   ->   n1_in_1 n1_in_2 ... n1_in_6
                                 n2_in_   ->   n2_in_1 n2_in_2 ... n2_in_6
                                agi_in_   ->   agi_in_1 agi_in_2 ... agi_in_6
-----------------------------------------------------------------------------

. 
. ** Define locals 
. local txt1 "Non-movers"

. local txt2 "All movers"                 

. local txt3 "Domestic movers"            

. local txt4 "Within-state movers"        

. local txt5 "Inter-state movers" 

. local txt6 "Foreign movers"

. 
. ** Label variables, in loop 
. foreach n of numlist 1(1)6 {
  2.         
.         label var n1_in_`n' "Returns, in-migration, `txt`n''"
  3.         label var n2_in_`n' "Exemptions, in-migration, `txt`n''"
  4.         label var agi_in_`n' "AGI, in-migration, `txt`n''"
  5. 
. } // END NUMLIST LOOP 

. 
. ** Preserve 
. tempfile gross_in

. save `gross_in'
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_000012.tmp saved as .dta format

. clear

. 
. ** Create gross file with in and out migration 
. use "${data}working/irs_county_gross_out", clear 

. 
. ** Rename 
. rename n1 n1_out_

. rename n2 n2_out_

. rename agi agi_out_

. rename *_total *_total_out

. 
. ** Reshape 
. reshape wide n1_out_ n2_out_ agi_out_, i(year state_fips county_fips) j(move_type)
(j = 1 2 3 4 5 6)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations          115,611   ->   21,980      
Number of variables                  13   ->   27          
j variable (6 values)         move_type   ->   (dropped)
xij variables:
                                n1_out_   ->   n1_out_1 n1_out_2 ... n1_out_6
                                n2_out_   ->   n2_out_1 n2_out_2 ... n2_out_6
                               agi_out_   ->   agi_out_1 agi_out_2 ... agi_out_6
-----------------------------------------------------------------------------

. 
. ** Define locals 
. local txt1 "Non-movers"

. local txt2 "All movers"                 

. local txt3 "Domestic movers"            

. local txt4 "Within-state movers"        

. local txt5 "Inter-state movers" 

. local txt6 "Foreign movers"

. 
. ** Label variables, in loop 
. foreach n of numlist 1(1)6 {
  2.         
.         label var n1_out_`n' "Returns, out-migration, `txt`n''"
  3.         label var n2_out_`n' "Exemptions, out-migration, `txt`n''"
  4.         label var agi_out_`n' "AGI, out-migration, `txt`n''"
  5. 
. } // END NUMLIST LOOP 

. 
. ** Merge data 
. merge 1:1 year state_fips county_fips using `gross_in', keep(match) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                            21,980  
    -----------------------------------------

. 
. ** Text for correct matching (non-movers should match perfectly)
. summ n*_*_1 agi_*_1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    n1_out_1 |     21,979    37461.71    123155.4          0    3944880
    n2_out_1 |     21,979    78000.79    252081.2          0    7841705
     n1_in_1 |     21,979    37461.71    123155.4          0    3944880
     n2_in_1 |     21,979    78000.79    252081.2          0    7841705
   agi_out_1 |     21,979     3214755    1.23e+07      -8051   4.30e+08
-------------+---------------------------------------------------------
    agi_in_1 |     21,979     3214755    1.23e+07      -8051   4.30e+08

. 
. ** Define net migration variables 
. 
. ** Loop over variable
. foreach a in "n1" "n2" "agi" {
  2. 
.         if "`a'" == "n1" local txt "Returns"
  3.         else if "`a'" == "n2" local txt "Exemptions"
  4.         else if "`a'" == "agi" local txt "AGI"
  5. 
.         ** Loop over type of movers 
.         forvalues n = 2/6 {
  6.                 
.                 ** Clean up missing values 
.                 replace `a'_in_`n' = 0 if missing(`a'_in_`n')
  7.                 replace `a'_out_`n' = 0 if missing(`a'_out_`n')
  8. 
.                 ** Generate net 
.                 gen `a'_net_`n' = `a'_in_`n' - `a'_out_`n'
  9.                 label var `a'_net_`n' "`txt', net-migration, `txt`n''"
 10. 
.         } // END MOVER TYPE LOOP 
 11. 
. } // END VARIABLE LOOP 
(183 real changes made)
(155 real changes made)
(183 real changes made)
(155 real changes made)
(202 real changes made)
(172 real changes made)
(1,379 real changes made)
(1,444 real changes made)
(14,365 real changes made)
(14,342 real changes made)
(183 real changes made)
(155 real changes made)
(183 real changes made)
(155 real changes made)
(202 real changes made)
(172 real changes made)
(1,379 real changes made)
(1,444 real changes made)
(14,365 real changes made)
(14,342 real changes made)
(183 real changes made)
(155 real changes made)
(183 real changes made)
(155 real changes made)
(202 real changes made)
(172 real changes made)
(1,379 real changes made)
(1,444 real changes made)
(14,365 real changes made)
(14,342 real changes made)

. 
. ** Generate fips variable
. *make_fips state_fips county_fips, gen(fips)
. 
. ** Save file 
. save "${data}working/irs_county_gross", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_gross.dta
    saved

. clear

. 
. ********************************************************************************
. ** STEP 6: Import and Clean IRS County-Level Aggr. Data 
. ********************************************************************************
. 
. ** Loop over years 
. forvalues y = 15(1)22 {
  2.         
.         
.         ** Import data (out)
.         import delimited "${data}irs/`y'incyallagi.csv", clear 
  3. 
.         ** Describe data 
.         des 
  4.         
.         ** Generate year 
.         gen year = 2000 + `y' 
  5.         
.         ** Define AGI groups 
.         label var agi_stub "AGI Brackets"
  6.         label values agi_stub lb_agi 
  7.         
.         ** Define set of variables to keep 
.         keep state* county* agi_stub year n1 mars1 mars2 mars4 n2 elderly       ///
>                 a00100 n02650 a02650 n00200 a00200 
  8.                 
.         ** Rename variables 
.         rename a00100 agi 
  9.         rename n02650 n_total_inc
 10.         rename a02650 a_total_inc
 11.         rename n00200 n_wage
 12.         rename a00200 a_wage 
 13.         rename statefips state_fips
 14.         rename state state_abb 
 15.         rename countyfips county_fips 
 16.         rename countyname county_name 
 17.         
.         ** Rescale 
.         replace agi = 1000 * agi 
 18.         replace a_total_inc = 1000 * a_total_inc
 19.         replace a_wage = 1000 * a_wage 
 20.         
.         ** Label 
.         label var n1 "Number of returns"
 21.         label var mars1 "Number of single returns"
 22.         label var mars1 "Number of MFJ returns"
 23.         label var mars1 "Number of HoH returns"
 24.         label var n2 "Number of individuals"
 25.         label var elderly "Number of returns with one individual over 60"
 26.         label var agi "Adjusted Gross Income (AGI)"
 27.         label var n_total_inc "Number of returns with total income"
 28.         label var a_total_inc "Total income amount"
 29.         label var n_wage "Number of returns with wage income"
 30.         label var a_wage "Wage income amount"
 31.         
.         ** Sort 
.         sort year state_fips county_fips agi_stub 
 32.         
.         ** Order 
.         order year state* county* agi_stub 
 33.         
.         ** Save 
.         save "${data}working/irs_county_all_`y'", replace 
 34.         
.         clear 
 35.         
. } // END YEAR LOOP 
(encoding automatically selected: ISO-8859-1)
(132 vars, 25,536 obs)

Contains data
 Observations:        25,536                  
    Variables:           132                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
statefips       byte    %8.0g                 STATEFIPS
state           str2    %9s                   STATE
countyfips      int     %8.0g                 COUNTYFIPS
countyname      str20   %20s                  COUNTYNAME
agi_stub        byte    %8.0g                 
n1              long    %12.0g                N1
mars1           long    %12.0g                
mars2           long    %12.0g                MARS2
mars4           long    %12.0g                MARS4
prep            long    %12.0g                PREP
n2              long    %12.0g                N2
numdep          long    %12.0g                NUMDEP
total_vita      long    %8.0g                 TOTAL_VITA
vita            long    %8.0g                 VITA
tce             long    %8.0g                 TCE
vita_eic        int     %8.0g                 VITA_EIC
ral             long    %8.0g                 RAL
rac             long    %12.0g                RAC
elderly         long    %12.0g                ELDERLY
a00100          long    %12.0g                A00100
n02650          long    %12.0g                N02650
a02650          long    %12.0g                A02650
n00200          long    %12.0g                N00200
a00200          long    %12.0g                A00200
n00300          long    %12.0g                N00300
a00300          long    %12.0g                A00300
n00600          long    %12.0g                N00600
a00600          long    %12.0g                A00600
n00650          long    %12.0g                N00650
a00650          long    %12.0g                A00650
n00700          long    %12.0g                N00700
a00700          long    %12.0g                A00700
n00900          long    %12.0g                N00900
a00900          long    %12.0g                A00900
n01000          long    %12.0g                N01000
a01000          long    %12.0g                A01000
n01400          long    %12.0g                N01400
a01400          long    %12.0g                A01400
n01700          long    %12.0g                N01700
a01700          long    %12.0g                A01700
schf            long    %8.0g                 SCHF
n02300          long    %8.0g                 N02300
a02300          long    %12.0g                A02300
n02500          long    %12.0g                N02500
a02500          long    %12.0g                A02500
n26270          long    %12.0g                N26270
a26270          long    %12.0g                A26270
n02900          long    %12.0g                N02900
a02900          long    %12.0g                A02900
n03220          long    %8.0g                 N03220
a03220          long    %8.0g                 A03220
n03300          long    %8.0g                 N03300
a03300          long    %12.0g                A03300
n03270          long    %8.0g                 N03270
a03270          long    %12.0g                A03270
n03150          long    %8.0g                 N03150
a03150          long    %12.0g                A03150
n03210          long    %12.0g                N03210
a03210          long    %12.0g                A03210
n03230          long    %8.0g                 N03230
a03230          long    %8.0g                 A03230
n03240          int     %8.0g                 N03240
a03240          long    %12.0g                A03240
n04470          long    %12.0g                N04470
a04470          long    %12.0g                A04470
a00101          long    %12.0g                A00101
n18425          long    %12.0g                N18425
a18425          long    %12.0g                A18425
n18450          long    %8.0g                 N18450
a18450          long    %8.0g                 A18450
n18500          long    %12.0g                N18500
a18500          long    %12.0g                A18500
n18300          long    %12.0g                N18300
a18300          long    %12.0g                A18300
n19300          long    %12.0g                N19300
a19300          long    %12.0g                A19300
n19700          long    %12.0g                N19700
a19700          long    %12.0g                A19700
n04800          long    %12.0g                N04800
a04800          long    %12.0g                A04800
n05800          long    %12.0g                N05800
a05800          long    %12.0g                A05800
n09600          long    %12.0g                N09600
a09600          long    %12.0g                A09600
n05780          long    %8.0g                 N05780
a05780          long    %8.0g                 A05780
n07100          long    %12.0g                N07100
a07100          long    %12.0g                A07100
n07300          long    %12.0g                N07300
a07300          long    %12.0g                A07300
n07180          long    %8.0g                 N07180
a07180          long    %8.0g                 A07180
n07230          long    %12.0g                N07230
a07230          long    %12.0g                A07230
n07240          long    %12.0g                N07240
a07240          long    %8.0g                 A07240
n07220          long    %12.0g                N07220
a07220          long    %12.0g                A07220
n07260          long    %8.0g                 N07260
a07260          long    %8.0g                 A07260
n09400          long    %12.0g                N09400
a09400          long    %12.0g                A09400
n85770          long    %12.0g                N85770
a85770          long    %12.0g                A85770
n85775          long    %12.0g                N85775
a85775          long    %12.0g                A85775
n09750          long    %8.0g                 N09750
a09750          long    %8.0g                 A09750
n10600          long    %12.0g                N10600
a10600          long    %12.0g                A10600
n59660          long    %12.0g                N59660
a59660          long    %12.0g                A59660
n59720          long    %12.0g                N59720
a59720          long    %12.0g                A59720
n11070          long    %12.0g                N11070
a11070          long    %12.0g                A11070
n10960          long    %12.0g                N10960
a10960          long    %12.0g                A10960
n11560          long    %8.0g                 N11560
a11560          long    %8.0g                 A11560
n06500          long    %12.0g                N06500
a06500          long    %12.0g                A06500
n10300          long    %12.0g                N10300
a10300          long    %12.0g                A10300
n85530          long    %12.0g                N85530
a85530          long    %12.0g                A85530
n85300          long    %12.0g                N85300
a85300          long    %12.0g                A85300
n11901          long    %12.0g                N11901
a11901          long    %12.0g                A11901
n11902          long    %12.0g                N11902
a11902          long    %12.0g                A11902
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
variable agi was long now double
(25,283 real changes made)
variable a_total_inc was long now double
(25,283 real changes made)
variable a_wage was long now double
(24,576 real changes made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all_15.dta
    saved
(encoding automatically selected: ISO-8859-1)
(148 vars, 25,536 obs)

Contains data
 Observations:        25,536                  
    Variables:           148                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
statefips       byte    %8.0g                 STATEFIPS
state           str2    %9s                   STATE
countyfips      int     %8.0g                 COUNTYFIPS
countyname      str20   %20s                  COUNTYNAME
agi_stub        byte    %8.0g                 
n1              long    %12.0g                N1
mars1           long    %12.0g                
mars2           long    %12.0g                MARS2
mars4           long    %12.0g                MARS4
prep            long    %12.0g                PREP
n2              long    %12.0g                N2
numdep          long    %12.0g                NUMDEP
total_vita      long    %8.0g                 TOTAL_VITA
vita            long    %8.0g                 VITA
tce             long    %8.0g                 TCE
vita_eic        int     %8.0g                 VITA_EIC
ral             long    %8.0g                 RAL
rac             long    %12.0g                RAC
elderly         long    %12.0g                ELDERLY
a00100          long    %12.0g                A00100
n02650          long    %12.0g                N02650
a02650          long    %12.0g                A02650
n00200          long    %12.0g                N00200
a00200          long    %12.0g                A00200
n00300          long    %12.0g                N00300
a00300          long    %12.0g                A00300
n00600          long    %12.0g                N00600
a00600          long    %12.0g                A00600
n00650          long    %12.0g                N00650
a00650          long    %12.0g                A00650
n00700          long    %12.0g                N00700
a00700          long    %12.0g                A00700
n00900          long    %12.0g                N00900
a00900          long    %12.0g                A00900
n01000          long    %12.0g                N01000
a01000          long    %12.0g                A01000
n01400          long    %12.0g                N01400
a01400          long    %12.0g                A01400
n01700          long    %12.0g                N01700
a01700          long    %12.0g                A01700
schf            long    %8.0g                 SCHF
n02300          long    %8.0g                 N02300
a02300          long    %12.0g                A02300
n02500          long    %12.0g                N02500
a02500          long    %12.0g                A02500
n26270          long    %12.0g                N26270
a26270          long    %12.0g                A26270
n02900          long    %12.0g                N02900
a02900          long    %12.0g                A02900
n03220          long    %8.0g                 N03220
a03220          long    %8.0g                 A03220
n03300          long    %8.0g                 N03300
a03300          long    %12.0g                A03300
n03270          long    %8.0g                 N03270
a03270          long    %12.0g                A03270
n03150          long    %8.0g                 N03150
a03150          long    %12.0g                A03150
n03210          long    %12.0g                N03210
a03210          long    %12.0g                A03210
n03230          long    %8.0g                 N03230
a03230          long    %8.0g                 A03230
n03240          int     %8.0g                 N03240
a03240          long    %12.0g                A03240
n04470          long    %12.0g                N04470
a04470          long    %12.0g                A04470
a00101          long    %12.0g                A00101
n17000          long    %12.0g                N17000
a17000          long    %12.0g                A17000
n18425          long    %12.0g                N18425
a18425          long    %12.0g                A18425
n18450          long    %8.0g                 N18450
a18450          long    %8.0g                 A18450
n18500          long    %12.0g                N18500
a18500          long    %12.0g                A18500
n18800          long    %12.0g                N18800
a18800          long    %12.0g                A18800
n18300          long    %12.0g                N18300
a18300          long    %12.0g                A18300
n19300          long    %12.0g                N19300
a19300          long    %12.0g                A19300
n19500          long    %8.0g                 N19500
a19500          long    %8.0g                 A19500
n19530          long    %8.0g                 N19530
a19530          long    %8.0g                 A19530
n19550          long    %8.0g                 N19550
a19550          long    %8.0g                 A19550
n19570          long    %8.0g                 N19570
a19570          long    %12.0g                A19570
n19700          long    %12.0g                N19700
a19700          long    %12.0g                A19700
n20800          long    %12.0g                N20800
a20800          long    %12.0g                A20800
n21020          long    %8.0g                 N21020
a21020          long    %12.0g                A21020
n04800          long    %12.0g                N04800
a04800          long    %12.0g                A04800
n05800          long    %12.0g                N05800
a05800          long    %12.0g                A05800
n09600          long    %12.0g                N09600
a09600          long    %12.0g                A09600
n05780          long    %8.0g                 N05780
a05780          long    %8.0g                 A05780
n07100          long    %12.0g                N07100
a07100          long    %12.0g                A07100
n07300          long    %12.0g                N07300
a07300          long    %12.0g                A07300
n07180          long    %8.0g                 N07180
a07180          long    %8.0g                 A07180
n07230          long    %12.0g                N07230
a07230          long    %12.0g                A07230
n07240          long    %12.0g                N07240
a07240          long    %8.0g                 A07240
n07220          long    %12.0g                N07220
a07220          long    %12.0g                A07220
n07260          long    %8.0g                 N07260
a07260          long    %8.0g                 A07260
n09400          long    %12.0g                N09400
a09400          long    %12.0g                A09400
n85770          long    %12.0g                N85770
a85770          long    %12.0g                A85770
n85775          long    %12.0g                N85775
a85775          long    %12.0g                A85775
n09750          long    %8.0g                 N09750
a09750          long    %8.0g                 A09750
n10600          long    %12.0g                N10600
a10600          long    %12.0g                A10600
n59660          long    %12.0g                N59660
a59660          long    %12.0g                A59660
n59720          long    %12.0g                N59720
a59720          long    %12.0g                A59720
n11070          long    %12.0g                N11070
a11070          long    %12.0g                A11070
n10960          long    %12.0g                N10960
a10960          long    %12.0g                A10960
n11560          long    %8.0g                 N11560
a11560          long    %8.0g                 A11560
n06500          long    %12.0g                N06500
a06500          long    %12.0g                A06500
n10300          long    %12.0g                N10300
a10300          long    %12.0g                A10300
n85530          long    %12.0g                N85530
a85530          long    %12.0g                A85530
n85300          long    %12.0g                N85300
a85300          long    %12.0g                A85300
n11901          long    %12.0g                N11901
a11901          long    %12.0g                A11901
n11902          long    %12.0g                N11902
a11902          long    %12.0g                A11902
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
variable agi was long now double
(25,267 real changes made)
variable a_total_inc was long now double
(25,267 real changes made)
variable a_wage was long now double
(24,662 real changes made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all_16.dta
    saved
(encoding automatically selected: ISO-8859-1)
(154 vars, 25,536 obs)

Contains data
 Observations:        25,536                  
    Variables:           154                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
statefips       byte    %8.0g                 STATEFIPS
state           str2    %9s                   STATE
countyfips      int     %8.0g                 COUNTYFIPS
countyname      str20   %20s                  COUNTYNAME
agi_stub        byte    %8.0g                 
n1              long    %12.0g                N1
mars1           long    %12.0g                
mars2           long    %12.0g                MARS2
mars4           long    %12.0g                MARS4
elf             long    %12.0g                ELF
cprep           long    %12.0g                CPREP
prep            long    %12.0g                PREP
dir_dep         long    %12.0g                DIR_DEP
n2              long    %12.0g                N2
numdep          long    %12.0g                NUMDEP
total_vita      long    %12.0g                TOTAL_VITA
vita            long    %8.0g                 VITA
tce             long    %8.0g                 TCE
vita_eic        int     %8.0g                 VITA_EIC
rac             long    %12.0g                RAC
elderly         long    %12.0g                ELDERLY
a00100          long    %12.0g                A00100
n02650          long    %12.0g                N02650
a02650          long    %12.0g                A02650
n00200          long    %12.0g                N00200
a00200          long    %12.0g                A00200
n00300          long    %12.0g                N00300
a00300          long    %12.0g                A00300
n00600          long    %12.0g                N00600
a00600          long    %12.0g                A00600
n00650          long    %12.0g                N00650
a00650          long    %12.0g                A00650
n00700          long    %12.0g                N00700
a00700          long    %12.0g                A00700
n00900          long    %12.0g                N00900
a00900          long    %12.0g                A00900
n01000          long    %12.0g                N01000
a01000          long    %12.0g                A01000
n01400          long    %12.0g                N01400
a01400          long    %12.0g                A01400
n01700          long    %12.0g                N01700
a01700          long    %12.0g                A01700
schf            long    %8.0g                 SCHF
n02300          long    %12.0g                N02300
a02300          long    %12.0g                A02300
n02500          long    %12.0g                N02500
a02500          long    %12.0g                A02500
n26270          long    %12.0g                N26270
a26270          long    %12.0g                A26270
n02900          long    %12.0g                N02900
a02900          long    %12.0g                A02900
n03220          long    %12.0g                N03220
a03220          long    %8.0g                 A03220
n03300          long    %8.0g                 N03300
a03300          long    %12.0g                A03300
n03270          long    %8.0g                 N03270
a03270          long    %12.0g                A03270
n03150          long    %8.0g                 N03150
a03150          long    %12.0g                A03150
n03210          long    %12.0g                N03210
a03210          long    %12.0g                A03210
n03230          long    %8.0g                 N03230
a03230          long    %8.0g                 A03230
n03240          long    %8.0g                 N03240
a03240          long    %12.0g                A03240
n04470          long    %12.0g                N04470
a04470          long    %12.0g                A04470
a00101          long    %12.0g                A00101
n17000          long    %12.0g                N17000
a17000          long    %12.0g                A17000
n18425          long    %12.0g                N18425
a18425          long    %12.0g                A18425
n18450          long    %12.0g                N18450
a18450          long    %12.0g                A18450
n18500          long    %12.0g                N18500
a18500          long    %12.0g                A18500
n18800          long    %12.0g                N18800
a18800          long    %12.0g                A18800
n18300          long    %12.0g                N18300
a18300          long    %12.0g                A18300
n19300          long    %12.0g                N19300
a19300          long    %12.0g                A19300
n19500          long    %8.0g                 N19500
a19500          long    %8.0g                 A19500
n19530          long    %8.0g                 N19530
a19530          long    %8.0g                 A19530
n19550          long    %8.0g                 N19550
a19550          long    %8.0g                 A19550
n19570          long    %8.0g                 N19570
a19570          long    %12.0g                A19570
n19700          long    %12.0g                N19700
a19700          long    %12.0g                A19700
n20800          long    %12.0g                N20800
a20800          long    %12.0g                A20800
n20950          long    %8.0g                 N20950
a20950          long    %12.0g                A20950
n04800          long    %12.0g                N04800
a04800          long    %12.0g                A04800
n05800          long    %12.0g                N05800
a05800          long    %12.0g                A05800
n09600          long    %12.0g                N09600
a09600          long    %12.0g                A09600
n05780          long    %8.0g                 N05780
a05780          long    %8.0g                 A05780
n07100          long    %12.0g                N07100
a07100          long    %12.0g                A07100
n07300          long    %12.0g                N07300
a07300          long    %12.0g                A07300
n07180          long    %12.0g                N07180
a07180          long    %8.0g                 A07180
n07230          long    %12.0g                N07230
a07230          long    %12.0g                A07230
n07240          long    %12.0g                N07240
a07240          long    %12.0g                A07240
n07220          long    %12.0g                N07220
a07220          long    %12.0g                A07220
n07260          long    %8.0g                 N07260
a07260          long    %8.0g                 A07260
n09400          long    %12.0g                N09400
a09400          long    %12.0g                A09400
n85770          long    %12.0g                N85770
a85770          long    %12.0g                A85770
n85775          long    %12.0g                N85775
a85775          long    %12.0g                A85775
n09750          long    %12.0g                N09750
a09750          long    %12.0g                A09750
n10600          long    %12.0g                N10600
a10600          long    %12.0g                A10600
n59660          long    %12.0g                N59660
a59660          long    %12.0g                A59660
n59720          long    %12.0g                N59720
a59720          long    %12.0g                A59720
n11070          long    %12.0g                N11070
a11070          long    %12.0g                A11070
n10960          long    %12.0g                N10960
a10960          long    %12.0g                A10960
n11560          long    %8.0g                 N11560
a11560          long    %8.0g                 A11560
n06500          long    %12.0g                N06500
a06500          long    %12.0g                A06500
n10300          long    %12.0g                N10300
a10300          long    %12.0g                A10300
n85530          long    %12.0g                N85530
a85530          long    %12.0g                A85530
n85300          long    %12.0g                N85300
a85300          long    %12.0g                A85300
n11901          long    %12.0g                N11901
a11901          long    %12.0g                A11901
n11900          long    %12.0g                N11900
a11900          long    %12.0g                A11900
n11902          long    %12.0g                N11902
a11902          long    %12.0g                A11902
n12000          long    %12.0g                N12000
a12000          long    %12.0g                A12000
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
variable agi was long now double
(25,280 real changes made)
variable a_total_inc was long now double
(25,280 real changes made)
variable a_wage was long now double
(24,634 real changes made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all_17.dta
    saved
(encoding automatically selected: ISO-8859-1)
(154 vars, 25,536 obs)

Contains data
 Observations:        25,536                  
    Variables:           154                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
statefips       byte    %8.0g                 STATEFIPS
state           str2    %9s                   STATE
countyfips      int     %8.0g                 COUNTYFIPS
countyname      str20   %20s                  COUNTYNAME
agi_stub        byte    %8.0g                 
n1              long    %12.0g                N1
mars1           long    %12.0g                
mars2           long    %12.0g                MARS2
mars4           long    %12.0g                MARS4
elf             long    %12.0g                ELF
cprep           long    %12.0g                CPREP
prep            long    %12.0g                PREP
dir_dep         long    %12.0g                DIR_DEP
n2              long    %12.0g                N2
numdep          long    %12.0g                NUMDEP
total_vita      long    %12.0g                TOTAL_VITA
vita            long    %8.0g                 VITA
tce             long    %8.0g                 TCE
vita_eic        int     %8.0g                 VITA_EIC
rac             long    %12.0g                RAC
elderly         long    %12.0g                ELDERLY
a00100          long    %12.0g                A00100
n02650          long    %12.0g                N02650
a02650          long    %12.0g                A02650
n00200          long    %12.0g                N00200
a00200          long    %12.0g                A00200
n00300          long    %12.0g                N00300
a00300          long    %12.0g                A00300
n00600          long    %12.0g                N00600
a00600          long    %12.0g                A00600
n00650          long    %12.0g                N00650
a00650          long    %12.0g                A00650
n00700          long    %12.0g                N00700
a00700          long    %12.0g                A00700
n00900          long    %12.0g                N00900
a00900          long    %12.0g                A00900
n01000          long    %12.0g                N01000
a01000          long    %12.0g                A01000
n01750          long    %12.0g                N01750
a01750          long    %12.0g                A01750
schf            long    %8.0g                 SCHF
n02300          long    %12.0g                N02300
a02300          long    %12.0g                A02300
n02500          long    %12.0g                N02500
a02500          long    %12.0g                A02500
n26270          long    %12.0g                N26270
a26270          long    %12.0g                A26270
n02900          long    %12.0g                N02900
a02900          long    %12.0g                A02900
n03220          long    %12.0g                N03220
a03220          long    %8.0g                 A03220
n03300          long    %8.0g                 N03300
a03300          long    %12.0g                A03300
n03270          long    %8.0g                 N03270
a03270          long    %12.0g                A03270
n03150          long    %8.0g                 N03150
a03150          long    %12.0g                A03150
n03210          long    %12.0g                N03210
a03210          long    %12.0g                A03210
n04450          long    %12.0g                N04450
a04450          long    %12.0g                A04450
n04100          long    %12.0g                N04100
a04100          long    %12.0g                A04100
n04200          long    %12.0g                N04200
a04200          long    %12.0g                A04200
n04470          long    %12.0g                N04470
a04470          long    %12.0g                A04470
a00101          long    %12.0g                A00101
n17000          long    %8.0g                 N17000
a17000          long    %12.0g                A17000
n18425          long    %12.0g                N18425
a18425          long    %12.0g                A18425
n18450          long    %8.0g                 N18450
a18450          long    %8.0g                 A18450
n18500          long    %12.0g                N18500
a18500          long    %12.0g                A18500
n18800          long    %12.0g                N18800
a18800          long    %8.0g                 A18800
n18460          long    %12.0g                N18460
a18460          long    %12.0g                A18460
n18300          long    %12.0g                N18300
a18300          long    %12.0g                A18300
n19300          long    %12.0g                N19300
a19300          long    %12.0g                A19300
n19500          long    %8.0g                 N19500
a19500          long    %8.0g                 A19500
n19530          long    %8.0g                 N19530
a19530          long    %8.0g                 A19530
n19570          long    %8.0g                 N19570
a19570          long    %12.0g                A19570
n19700          long    %12.0g                N19700
a19700          long    %12.0g                A19700
n20950          long    %8.0g                 N20950
a20950          long    %12.0g                A20950
n04475          long    %12.0g                N04475
a04475          long    %12.0g                A04475
n04800          long    %12.0g                N04800
a04800          long    %12.0g                A04800
n05800          long    %12.0g                N05800
a05800          long    %12.0g                A05800
n09600          long    %8.0g                 N09600
a09600          long    %12.0g                A09600
n05780          long    %8.0g                 N05780
a05780          long    %8.0g                 A05780
n07100          long    %12.0g                N07100
a07100          long    %12.0g                A07100
n07300          long    %12.0g                N07300
a07300          long    %12.0g                A07300
n07180          long    %12.0g                N07180
a07180          long    %12.0g                A07180
n07230          long    %12.0g                N07230
a07230          long    %12.0g                A07230
n07240          long    %12.0g                N07240
a07240          long    %12.0g                A07240
n07225          long    %12.0g                N07225
a07225          long    %12.0g                A07225
n07260          long    %8.0g                 N07260
a07260          long    %8.0g                 A07260
n09400          long    %12.0g                N09400
a09400          long    %12.0g                A09400
n85770          long    %12.0g                N85770
a85770          long    %12.0g                A85770
n85775          long    %12.0g                N85775
a85775          long    %12.0g                A85775
n09750          long    %12.0g                N09750
a09750          long    %8.0g                 A09750
n10600          long    %12.0g                N10600
a10600          long    %12.0g                A10600
n59660          long    %12.0g                N59660
a59660          long    %12.0g                A59660
n59720          long    %12.0g                N59720
a59720          long    %12.0g                A59720
n11070          long    %12.0g                N11070
a11070          long    %12.0g                A11070
n10960          long    %12.0g                N10960
a10960          long    %12.0g                A10960
n11560          long    %8.0g                 N11560
a11560          long    %8.0g                 A11560
n06500          long    %12.0g                N06500
a06500          long    %12.0g                A06500
n10300          long    %12.0g                N10300
a10300          long    %12.0g                A10300
n85530          long    %12.0g                N85530
a85530          long    %12.0g                A85530
n85300          long    %12.0g                N85300
a85300          long    %12.0g                A85300
n11901          long    %12.0g                N11901
a11901          long    %12.0g                A11901
n11900          long    %12.0g                N11900
a11900          long    %12.0g                A11900
n11902          long    %12.0g                N11902
a11902          long    %12.0g                A11902
n12000          long    %12.0g                N12000
a12000          long    %12.0g                A12000
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
variable agi was long now double
(25,325 real changes made)
variable a_total_inc was long now double
(25,325 real changes made)
variable a_wage was long now double
(24,672 real changes made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all_18.dta
    saved
(encoding automatically selected: ISO-8859-1)
(153 vars, 25,544 obs)

Contains data
 Observations:        25,544                  
    Variables:           153                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
statefips       byte    %8.0g                 STATEFIPS
state           str2    %9s                   STATE
countyfips      int     %8.0g                 COUNTYFIPS
countyname      str24   %24s                  COUNTYNAME
agi_stub        byte    %8.0g                 
n1              long    %12.0g                N1
mars1           long    %12.0g                
mars2           long    %12.0g                MARS2
mars4           long    %12.0g                MARS4
elf             long    %12.0g                ELF
cprep           long    %12.0g                CPREP
prep            long    %12.0g                PREP
dir_dep         long    %12.0g                DIR_DEP
n2              long    %12.0g                N2
total_vita      long    %12.0g                TOTAL_VITA
vita            long    %12.0g                VITA
tce             int     %8.0g                 TCE
vita_eic        int     %8.0g                 VITA_EIC
rac             long    %12.0g                RAC
elderly         long    %12.0g                ELDERLY
a00100          long    %12.0g                A00100
n02650          long    %12.0g                N02650
a02650          float   %9.0g                 A02650
n00200          long    %12.0g                N00200
a00200          long    %12.0g                A00200
n00300          long    %12.0g                N00300
a00300          long    %12.0g                A00300
n00600          long    %12.0g                N00600
a00600          long    %12.0g                A00600
n00650          long    %12.0g                N00650
a00650          long    %12.0g                A00650
n00700          long    %12.0g                N00700
a00700          long    %12.0g                A00700
n00900          long    %12.0g                N00900
a00900          long    %12.0g                A00900
n01000          long    %12.0g                N01000
a01000          long    %12.0g                A01000
n01400          long    %12.0g                N01400
a01400          long    %12.0g                A01400
n01700          long    %12.0g                N01700
a01700          long    %12.0g                A01700
schf            long    %8.0g                 SCHF
n02300          long    %12.0g                N02300
a02300          long    %12.0g                A02300
n02500          long    %12.0g                N02500
a02500          long    %12.0g                A02500
n26270          long    %12.0g                N26270
a26270          long    %12.0g                A26270
n02900          long    %12.0g                N02900
a02900          long    %12.0g                A02900
n03220          long    %12.0g                N03220
a03220          long    %12.0g                A03220
n03300          long    %12.0g                N03300
a03300          long    %12.0g                A03300
n03270          long    %12.0g                N03270
a03270          long    %12.0g                A03270
n03150          long    %12.0g                N03150
a03150          long    %12.0g                A03150
n03210          long    %12.0g                N03210
a03210          long    %12.0g                A03210
n04450          long    %12.0g                N04450
a04450          long    %12.0g                A04450
n04100          long    %12.0g                N04100
a04100          long    %12.0g                A04100
n04200          long    %12.0g                N04200
a04200          long    %12.0g                A04200
n04470          long    %12.0g                N04470
a04470          long    %12.0g                A04470
a00101          long    %12.0g                A00101
n17000          long    %12.0g                N17000
a17000          long    %12.0g                A17000
n18425          long    %12.0g                N18425
a18425          long    %12.0g                A18425
n18450          long    %12.0g                N18450
a18450          long    %12.0g                A18450
n18500          long    %12.0g                N18500
a18500          long    %12.0g                A18500
n18800          long    %12.0g                N18800
a18800          long    %12.0g                A18800
n18460          long    %12.0g                N18460
a18460          long    %12.0g                A18460
n18300          long    %12.0g                N18300
a18300          long    %12.0g                A18300
n19300          long    %12.0g                N19300
a19300          long    %12.0g                A19300
n19500          long    %12.0g                N19500
a19500          long    %12.0g                A19500
n19530          long    %12.0g                N19530
a19530          long    %12.0g                A19530
n19570          long    %12.0g                N19570
a19570          long    %12.0g                A19570
n19700          long    %12.0g                N19700
a19700          long    %12.0g                A19700
n20950          long    %12.0g                N20950
a20950          long    %12.0g                A20950
n04475          long    %12.0g                N04475
a04475          long    %12.0g                A04475
n04800          long    %12.0g                N04800
a04800          long    %12.0g                A04800
n05800          long    %12.0g                N05800
a05800          long    %12.0g                A05800
n09600          int     %8.0g                 N09600
a09600          long    %12.0g                A09600
n05780          long    %12.0g                N05780
a05780          long    %12.0g                A05780
n07100          long    %12.0g                N07100
a07100          long    %12.0g                A07100
n07300          long    %12.0g                N07300
a07300          long    %12.0g                A07300
n07180          long    %12.0g                N07180
a07180          long    %12.0g                A07180
n07230          long    %12.0g                N07230
a07230          long    %12.0g                A07230
n07240          long    %12.0g                N07240
a07240          long    %12.0g                A07240
n07225          long    %12.0g                N07225
a07225          long    %12.0g                A07225
n07260          long    %12.0g                N07260
a07260          long    %12.0g                A07260
n09400          long    %12.0g                N09400
a09400          long    %12.0g                A09400
n85770          long    %12.0g                N85770
a85770          long    %12.0g                A85770
n85775          long    %12.0g                N85775
a85775          long    %12.0g                A85775
n10600          long    %12.0g                N10600
a10600          long    %12.0g                A10600
n59660          long    %12.0g                N59660
a59660          long    %12.0g                A59660
n59720          long    %12.0g                N59720
a59720          long    %12.0g                A59720
n11070          long    %12.0g                N11070
a11070          long    %12.0g                A11070
n10960          long    %12.0g                N10960
a10960          long    %12.0g                A10960
n11560          long    %12.0g                N11560
a11560          long    %12.0g                A11560
n06500          long    %12.0g                N06500
a06500          long    %12.0g                A06500
n10300          long    %12.0g                N10300
a10300          long    %12.0g                A10300
n85530          long    %12.0g                N85530
a85530          long    %12.0g                A85530
n85300          long    %12.0g                N85300
a85300          long    %12.0g                A85300
n11901          long    %12.0g                N11901
a11901          long    %12.0g                A11901
n11900          long    %12.0g                N11900
a11900          long    %12.0g                A11900
n11902          long    %12.0g                N11902
a11902          long    %12.0g                A11902
n12000          long    %12.0g                N12000
a12000          long    %12.0g                A12000
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
variable agi was long now double
(25,363 real changes made)
(25,363 real changes made)
variable a_wage was long now double
(24,724 real changes made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all_19.dta
    saved
(encoding automatically selected: ISO-8859-1)
(166 vars, 25,545 obs)

Contains data
 Observations:        25,545                  
    Variables:           166                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
statefips       byte    %8.0g                 STATEFIPS
state           str2    %9s                   STATE
countyfips      int     %8.0g                 COUNTYFIPS
countyname      str20   %20s                  COUNTYNAME
agi_stub        byte    %8.0g                 
n1              long    %12.0g                N1
mars1           long    %12.0g                
mars2           long    %12.0g                MARS2
mars4           long    %12.0g                MARS4
elf             long    %12.0g                ELF
cprep           long    %8.0g                 CPREP
prep            long    %12.0g                PREP
dir_dep         long    %12.0g                DIR_DEP
vrtcrind        long    %8.0g                 VRTCRIND
n2              long    %12.0g                N2
total_vita      long    %8.0g                 TOTAL_VITA
vita            long    %8.0g                 VITA
tce             int     %8.0g                 TCE
vita_eic        int     %8.0g                 VITA_EIC
rac             long    %12.0g                RAC
elderly         long    %12.0g                ELDERLY
a00100          long    %12.0g                A00100
n02650          long    %12.0g                N02650
a02650          float   %9.0g                 A02650
n00200          long    %12.0g                N00200
a00200          long    %12.0g                A00200
n00300          long    %12.0g                N00300
a00300          long    %12.0g                A00300
n00600          long    %12.0g                N00600
a00600          long    %12.0g                A00600
n00650          long    %12.0g                N00650
a00650          long    %12.0g                A00650
n00700          long    %12.0g                N00700
a00700          long    %12.0g                A00700
n00900          long    %12.0g                N00900
a00900          long    %12.0g                A00900
n01000          long    %12.0g                N01000
a01000          long    %12.0g                A01000
n01400          long    %12.0g                N01400
a01400          long    %12.0g                A01400
n01700          long    %12.0g                N01700
a01700          long    %12.0g                A01700
schf            float   %9.0g                 SCHF
n02300          long    %12.0g                N02300
a02300          long    %12.0g                A02300
n02500          long    %12.0g                N02500
a02500          long    %12.0g                A02500
n26270          long    %12.0g                N26270
a26270          long    %12.0g                A26270
n02900          long    %12.0g                N02900
a02900          long    %12.0g                A02900
n03220          long    %12.0g                N03220
a03220          long    %8.0g                 A03220
n03300          long    %8.0g                 N03300
a03300          long    %12.0g                A03300
n03270          long    %8.0g                 N03270
a03270          long    %12.0g                A03270
n03150          long    %8.0g                 N03150
a03150          long    %12.0g                A03150
n03210          long    %12.0g                N03210
a03210          long    %12.0g                A03210
n02910          long    %12.0g                N02910
a02910          long    %12.0g                A02910
n04450          long    %12.0g                N04450
a04450          long    %12.0g                A04450
n04100          long    %12.0g                N04100
a04100          long    %12.0g                A04100
n04200          long    %12.0g                N04200
a04200          long    %12.0g                A04200
n04470          long    %12.0g                N04470
a04470          long    %12.0g                A04470
a00101          long    %12.0g                A00101
n17000          long    %8.0g                 N17000
a17000          long    %12.0g                A17000
n18425          long    %12.0g                N18425
a18425          long    %12.0g                A18425
n18450          long    %8.0g                 N18450
a18450          long    %8.0g                 A18450
n18500          long    %12.0g                N18500
a18500          long    %12.0g                A18500
n18800          long    %12.0g                N18800
a18800          long    %8.0g                 A18800
n18460          long    %12.0g                N18460
a18460          long    %12.0g                A18460
n18300          long    %12.0g                N18300
a18300          long    %12.0g                A18300
n19300          long    %12.0g                N19300
a19300          long    %12.0g                A19300
n19500          int     %8.0g                 N19500
a19500          long    %8.0g                 A19500
n19530          long    %8.0g                 N19530
a19530          long    %8.0g                 A19530
n19550          long    %8.0g                 N19550
a19550          long    %8.0g                 A19550
n19570          long    %8.0g                 N19570
a19570          long    %12.0g                A19570
n19700          long    %12.0g                N19700
a19700          long    %12.0g                A19700
n20950          long    %8.0g                 N20950
a20950          long    %12.0g                A20950
n04475          long    %12.0g                N04475
a04475          long    %12.0g                A04475
n04800          long    %12.0g                N04800
a04800          long    %12.0g                A04800
n05800          long    %12.0g                N05800
a05800          long    %12.0g                A05800
n09600          int     %8.0g                 N09600
a09600          long    %8.0g                 A09600
n05780          long    %8.0g                 N05780
a05780          long    %8.0g                 A05780
n07100          long    %12.0g                N07100
a07100          long    %12.0g                A07100
n07300          long    %12.0g                N07300
a07300          long    %12.0g                A07300
n07180          long    %12.0g                N07180
a07180          long    %8.0g                 A07180
n07230          long    %12.0g                N07230
a07230          long    %12.0g                A07230
n07240          long    %12.0g                N07240
a07240          long    %12.0g                A07240
n07225          long    %12.0g                N07225
a07225          long    %12.0g                A07225
n07260          long    %8.0g                 N07260
a07260          long    %8.0g                 A07260
n09400          long    %12.0g                N09400
a09400          long    %12.0g                A09400
n85770          long    %8.0g                 N85770
a85770          long    %12.0g                A85770
n85775          long    %8.0g                 N85775
a85775          long    %12.0g                A85775
n10600          long    %12.0g                N10600
a10600          long    %12.0g                A10600
n59660          long    %12.0g                N59660
a59660          long    %12.0g                A59660
n59720          long    %12.0g                N59720
a59720          long    %12.0g                A59720
n11070          long    %12.0g                N11070
a11070          long    %12.0g                A11070
n10960          long    %12.0g                N10960
a10960          long    %12.0g                A10960
n11560          long    %8.0g                 N11560
a11560          long    %8.0g                 A11560
n11450          long    %8.0g                 N11450
a11450          long    %8.0g                 A11450
n10970          long    %12.0g                N10970
a10970          long    %12.0g                A10970
n10971          long    %12.0g                N10971
a10971          long    %12.0g                A10971
n10973          long    %12.0g                N10973
a10973          long    %12.0g                A10973
n06500          long    %12.0g                N06500
a06500          long    %12.0g                A06500
n10300          long    %12.0g                N10300
a10300          long    %12.0g                A10300
n85530          long    %12.0g                N85530
a85530          long    %12.0g                A85530
n85300          long    %12.0g                N85300
a85300          long    %12.0g                A85300
n11901          long    %12.0g                N11901
a11901          long    %12.0g                A11901
n11900          long    %12.0g                N11900
a11900          long    %12.0g                A11900
n11902          long    %12.0g                N11902
a11902          long    %12.0g                A11902
n12000          long    %12.0g                N12000
a12000          long    %12.0g                A12000
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
variable agi was long now double
(25,410 real changes made)
(25,410 real changes made)
variable a_wage was long now double
(24,896 real changes made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all_20.dta
    saved
(encoding automatically selected: ISO-8859-1)
(168 vars, 25,552 obs)

Contains data
 Observations:        25,552                  
    Variables:           168                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
statefips       byte    %8.0g                 STATEFIPS
state           str2    %9s                   STATE
countyfips      int     %8.0g                 COUNTYFIPS
countyname      str20   %20s                  COUNTYNAME
agi_stub        byte    %8.0g                 
n1              long    %12.0g                N1
mars1           long    %12.0g                
mars2           long    %12.0g                MARS2
mars4           long    %12.0g                MARS4
elf             long    %12.0g                ELF
cprep           long    %8.0g                 CPREP
prep            long    %12.0g                PREP
dir_dep         long    %12.0g                DIR_DEP
vrtcrind        long    %8.0g                 VRTCRIND
n2              long    %12.0g                N2
total_vita      long    %8.0g                 TOTAL_VITA
vita            long    %8.0g                 VITA
tce             int     %8.0g                 TCE
vita_eic        int     %8.0g                 VITA_EIC
rac             long    %12.0g                RAC
elderly         long    %12.0g                ELDERLY
a00100          long    %12.0g                A00100
n02650          long    %12.0g                N02650
a02650          float   %9.0g                 A02650
n00200          long    %12.0g                N00200
a00200          long    %12.0g                A00200
n00300          long    %12.0g                N00300
a00300          long    %12.0g                A00300
n00600          long    %12.0g                N00600
a00600          long    %12.0g                A00600
n00650          long    %12.0g                N00650
a00650          long    %12.0g                A00650
n00700          long    %8.0g                 N00700
a00700          long    %12.0g                A00700
n00900          long    %12.0g                N00900
a00900          long    %12.0g                A00900
n01000          long    %12.0g                N01000
a01000          long    %12.0g                A01000
n01400          long    %12.0g                N01400
a01400          long    %12.0g                A01400
n01700          long    %12.0g                N01700
a01700          long    %12.0g                A01700
schf            float   %9.0g                 SCHF
n02300          long    %12.0g                N02300
a02300          long    %12.0g                A02300
n02500          long    %12.0g                N02500
a02500          long    %12.0g                A02500
n26270          long    %12.0g                N26270
a26270          long    %12.0g                A26270
n02900          long    %12.0g                N02900
a02900          long    %12.0g                A02900
n03220          long    %8.0g                 N03220
a03220          long    %8.0g                 A03220
n03300          long    %8.0g                 N03300
a03300          long    %12.0g                A03300
n03270          long    %8.0g                 N03270
a03270          long    %12.0g                A03270
n03150          long    %8.0g                 N03150
a03150          long    %12.0g                A03150
n03210          long    %8.0g                 N03210
a03210          long    %8.0g                 A03210
n02910          long    %12.0g                N02910
a02910          long    %12.0g                A02910
n04450          long    %12.0g                N04450
a04450          long    %12.0g                A04450
n04100          long    %12.0g                N04100
a04100          long    %12.0g                A04100
n04200          long    %12.0g                N04200
a04200          long    %12.0g                A04200
n04470          long    %12.0g                N04470
a04470          long    %12.0g                A04470
a00101          long    %12.0g                A00101
n17000          long    %8.0g                 N17000
a17000          long    %12.0g                A17000
n18425          long    %12.0g                N18425
a18425          long    %12.0g                A18425
n18450          long    %8.0g                 N18450
a18450          long    %8.0g                 A18450
n18500          long    %12.0g                N18500
a18500          long    %12.0g                A18500
n18800          long    %8.0g                 N18800
a18800          long    %8.0g                 A18800
n18460          long    %12.0g                N18460
a18460          long    %12.0g                A18460
n18300          long    %12.0g                N18300
a18300          long    %12.0g                A18300
n19300          long    %12.0g                N19300
a19300          long    %12.0g                A19300
n19500          int     %8.0g                 N19500
a19500          long    %8.0g                 A19500
n19530          long    %8.0g                 N19530
a19530          long    %8.0g                 A19530
n19550          long    %8.0g                 N19550
a19550          long    %8.0g                 A19550
n19570          long    %8.0g                 N19570
a19570          long    %12.0g                A19570
n19700          long    %12.0g                N19700
a19700          long    %12.0g                A19700
n20950          long    %8.0g                 N20950
a20950          long    %12.0g                A20950
n04475          long    %12.0g                N04475
a04475          long    %12.0g                A04475
n04800          long    %12.0g                N04800
a04800          long    %12.0g                A04800
n05800          long    %12.0g                N05800
a05800          long    %12.0g                A05800
n09600          long    %8.0g                 N09600
a09600          long    %8.0g                 A09600
n05780          long    %8.0g                 N05780
a05780          long    %8.0g                 A05780
n07100          long    %12.0g                N07100
a07100          long    %12.0g                A07100
n07300          long    %8.0g                 N07300
a07300          long    %12.0g                A07300
n07180          int     %8.0g                 N07180
a07180          long    %8.0g                 A07180
n07230          long    %12.0g                N07230
a07230          long    %12.0g                A07230
n07240          long    %12.0g                N07240
a07240          long    %8.0g                 A07240
n07225          long    %12.0g                N07225
a07225          long    %8.0g                 A07225
n07260          long    %8.0g                 N07260
a07260          long    %8.0g                 A07260
n09400          long    %12.0g                N09400
a09400          long    %12.0g                A09400
n85770          long    %12.0g                N85770
a85770          long    %12.0g                A85770
n85775          long    %12.0g                N85775
a85775          long    %12.0g                A85775
n10600          long    %12.0g                N10600
a10600          long    %12.0g                A10600
n59660          long    %12.0g                N59660
a59660          long    %12.0g                A59660
n59720          long    %12.0g                N59720
a59720          long    %12.0g                A59720
n11070          long    %12.0g                N11070
a11070          long    %12.0g                A11070
n10960          long    %8.0g                 N10960
a10960          long    %8.0g                 A10960
n11560          long    %8.0g                 N11560
a11560          long    %8.0g                 A11560
n11450          long    %8.0g                 N11450
a11450          long    %12.0g                A11450
n11520          long    %8.0g                 N11520
a11520          long    %12.0g                A11520
n11530          long    %8.0g                 N11530
a11530          long    %12.0g                A11530
n10970          long    %12.0g                N10970
a10970          long    %12.0g                A10970
n10971          long    %12.0g                N10971
a10971          long    %12.0g                A10971
n06500          long    %12.0g                N06500
a06500          long    %12.0g                A06500
n10300          long    %12.0g                N10300
a10300          long    %12.0g                A10300
n85530          long    %12.0g                N85530
a85530          long    %12.0g                A85530
n85300          long    %12.0g                N85300
a85300          long    %12.0g                A85300
n11901          long    %12.0g                N11901
a11901          long    %12.0g                A11901
n11900          long    %12.0g                N11900
a11900          long    %12.0g                A11900
n11902          long    %12.0g                N11902
a11902          long    %12.0g                A11902
n12000          long    %8.0g                 N12000
a12000          long    %12.0g                A12000
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
variable agi was long now double
(25,456 real changes made)
(25,456 real changes made)
variable a_wage was long now double
(24,659 real changes made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all_21.dta
    saved
(encoding automatically selected: ISO-8859-1)
(166 vars, 25,552 obs)

Contains data
 Observations:        25,552                  
    Variables:           166                  
--------------------------------------------------------------------------------------------------
Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
statefips       byte    %8.0g                 STATEFIPS
state           str2    %9s                   STATE
countyfips      int     %8.0g                 COUNTYFIPS
countyname      str20   %20s                  COUNTYNAME
agi_stub        byte    %8.0g                 
n1              long    %12.0g                N1
mars1           long    %12.0g                
mars2           long    %12.0g                MARS2
mars4           long    %12.0g                MARS4
elf             long    %12.0g                ELF
cprep           long    %8.0g                 CPREP
prep            long    %12.0g                PREP
dir_dep         long    %12.0g                DIR_DEP
vrtcrind        long    %8.0g                 VRTCRIND
n2              long    %12.0g                N2
total_vita      long    %8.0g                 TOTAL_VITA
vita            long    %8.0g                 VITA
tce             int     %8.0g                 TCE
vita_eic        int     %8.0g                 VITA_EIC
rac             long    %12.0g                RAC
elderly         long    %12.0g                ELDERLY
a00100          long    %12.0g                A00100
n02650          long    %12.0g                N02650
a02650          long    %12.0g                A02650
n00200          long    %12.0g                N00200
a00200          long    %12.0g                A00200
n00300          long    %12.0g                N00300
a00300          long    %12.0g                A00300
n00400          long    %12.0g                N00400
a00400          long    %12.0g                A00400
n00600          long    %12.0g                N00600
a00600          long    %12.0g                A00600
n00650          long    %12.0g                N00650
a00650          long    %12.0g                A00650
n00700          long    %8.0g                 N00700
a00700          long    %8.0g                 A00700
n00900          long    %12.0g                N00900
a00900          long    %12.0g                A00900
n01000          long    %12.0g                N01000
a01000          long    %12.0g                A01000
n01400          long    %12.0g                N01400
a01400          long    %12.0g                A01400
n01700          long    %12.0g                N01700
a01700          long    %12.0g                A01700
schf            long    %8.0g                 SCHF
n02300          long    %12.0g                N02300
a02300          long    %12.0g                A02300
n02500          long    %12.0g                N02500
a02500          long    %12.0g                A02500
n26270          long    %12.0g                N26270
a26270          long    %12.0g                A26270
n25870          long    %12.0g                N25870
a25870          long    %12.0g                A25870
n02900          long    %12.0g                N02900
a02900          long    %12.0g                A02900
n03220          long    %12.0g                N03220
a03220          long    %8.0g                 A03220
n03300          long    %8.0g                 N03300
a03300          long    %12.0g                A03300
n03270          long    %8.0g                 N03270
a03270          long    %12.0g                A03270
n03150          long    %8.0g                 N03150
a03150          long    %12.0g                A03150
n03210          long    %12.0g                N03210
a03210          long    %12.0g                A03210
n04450          long    %12.0g                N04450
a04450          long    %12.0g                A04450
n04100          long    %12.0g                N04100
a04100          long    %12.0g                A04100
n04200          long    %12.0g                N04200
a04200          long    %12.0g                A04200
n04470          long    %12.0g                N04470
a04470          long    %12.0g                A04470
a00101          long    %12.0g                A00101
n17000          long    %8.0g                 N17000
a17000          long    %12.0g                A17000
n18425          long    %12.0g                N18425
a18425          long    %12.0g                A18425
n18450          long    %8.0g                 N18450
a18450          long    %8.0g                 A18450
n18500          long    %12.0g                N18500
a18500          long    %12.0g                A18500
n18800          long    %12.0g                N18800
a18800          long    %8.0g                 A18800
n18460          long    %12.0g                N18460
a18460          long    %12.0g                A18460
n18300          long    %12.0g                N18300
a18300          long    %12.0g                A18300
n19300          long    %12.0g                N19300
a19300          long    %12.0g                A19300
n19500          int     %8.0g                 N19500
a19500          long    %8.0g                 A19500
n19530          long    %8.0g                 N19530
a19530          long    %8.0g                 A19530
n19570          long    %8.0g                 N19570
a19570          long    %12.0g                A19570
n19700          long    %12.0g                N19700
a19700          long    %12.0g                A19700
n20950          long    %8.0g                 N20950
a20950          long    %12.0g                A20950
n04475          long    %12.0g                N04475
a04475          long    %12.0g                A04475
n04800          long    %12.0g                N04800
a04800          long    %12.0g                A04800
n05800          long    %12.0g                N05800
a05800          long    %12.0g                A05800
n09600          int     %8.0g                 N09600
a09600          long    %12.0g                A09600
n05780          long    %12.0g                N05780
a05780          long    %12.0g                A05780
n07100          long    %12.0g                N07100
a07100          long    %12.0g                A07100
n07300          long    %12.0g                N07300
a07300          long    %12.0g                A07300
n07180          long    %12.0g                N07180
a07180          long    %12.0g                A07180
n07230          long    %12.0g                N07230
a07230          long    %12.0g                A07230
n07240          long    %12.0g                N07240
a07240          long    %12.0g                A07240
n07225          long    %12.0g                N07225
a07225          long    %12.0g                A07225
n07260          long    %8.0g                 N07260
a07260          long    %12.0g                A07260
n09400          long    %12.0g                N09400
a09400          long    %12.0g                A09400
n85770          long    %12.0g                N85770
a85770          long    %12.0g                A85770
n85775          long    %12.0g                N85775
a85775          long    %12.0g                A85775
n10600          long    %12.0g                N10600
a10600          long    %12.0g                A10600
n59660          long    %12.0g                N59660
a59660          long    %12.0g                A59660
n59661          long    %12.0g                N59661
a59661          long    %12.0g                A59661
n59662          long    %12.0g                N59662
a59662          long    %12.0g                A59662
n59663          long    %12.0g                N59663
a59663          long    %12.0g                A59663
n59664          long    %12.0g                N59664
a59664          long    %12.0g                A59664
n59720          long    %12.0g                N59720
a59720          long    %12.0g                A59720
n11070          long    %12.0g                N11070
a11070          long    %12.0g                A11070
n10960          long    %12.0g                N10960
a10960          long    %12.0g                A10960
n11560          long    %8.0g                 N11560
a11560          long    %8.0g                 A11560
n06500          long    %12.0g                N06500
a06500          long    %12.0g                A06500
n10300          long    %12.0g                N10300
a10300          long    %12.0g                A10300
n85530          long    %12.0g                N85530
a85530          long    %12.0g                A85530
n85300          long    %12.0g                N85300
a85300          long    %12.0g                A85300
n11901          long    %12.0g                N11901
a11901          long    %12.0g                A11901
n11900          long    %12.0g                N11900
a11900          long    %12.0g                A11900
n11902          long    %12.0g                N11902
a11902          long    %12.0g                A11902
n12000          long    %12.0g                N12000
a12000          long    %12.0g                A12000
--------------------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.
variable agi was long now double
(25,400 real changes made)
variable a_total_inc was long now double
(25,400 real changes made)
variable a_wage was long now double
(24,693 real changes made)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all_22.dta
    saved

. 
. ** Append data 
. 
. ** Loop over years 
. forvalues y = 15(1)22 {
  2. 
.         ** Append 
.         append using "${data}working/irs_county_all_`y'"
  3.                 
.         } // END YEAR LOOP 
(variable county_name was str20, now str24 to accommodate using data's values)

.         
. ** Save file 
. save "${data}working/irs_county_all", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all.dta saved

.         
. ** Generate fips variable
. make_fips state_fips county_fips, gen(fips)

. 
. ** Save file 
. save "${data}working/irs_county_all", replace 
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/irs_county_all.dta saved

. 
. ********************************************************************************
. ** STEP 7: Import and Clean DOL Childcare Cost Data 
. ********************************************************************************
. 
. ** Import data 
. import excel using "${data}demographic/dol/NDCP2022.xlsx", firstrow case(lower) clear
(370 vars, 48,308 obs)

. 
. ** Drop if not in 50 states + DC 
. drop if state_fips == 72
(1,170 observations deleted)

. 
. ** Keep in year range 
. keep if inrange(studyyear, 2015, 2022)
(21,999 observations deleted)

. 
. ** Keep required variables 
. keep county_fips_code studyyear me      ///
>         mcinfant mctoddler mcpreschool  ///
>         mfccinfant mfcctoddler mfccpreschool

.         
. rename county_fips fips 

. rename studyyear year 

. 
. ** Fill-in missing variables 
. xtset fips year 

Panel variable: fips (unbalanced)
 Time variable: year, 2015 to 2022
         Delta: 1 unit

. tsfill, full

. 
. ** Interpotate
. foreach var of varlist me mc* mf* {
  2.         bys fips: ipolate `var' year, g(tmp1)
  3.         replace `var' = tmp1 if missing(`var')
  4.         drop tmp1
  5. } // END VAR LOOP 
(13 missing values generated)
(0 real changes made)
(2857 missing values generated)
(752 real changes made)
(2840 missing values generated)
(748 real changes made)
(2823 missing values generated)
(749 real changes made)
(3280 missing values generated)
(743 real changes made)
(3287 missing values generated)
(743 real changes made)
(3275 missing values generated)
(743 real changes made)

. 
. ** Generate value as a percent of median income 
. gen mc_infant_med = mcinfant / me 
(2,857 missing values generated)

. gen mc_toddler_med = mctoddler / me 
(2,840 missing values generated)

. gen mc_preschool_med = mcpreschool / me 
(2,823 missing values generated)

. gen mf_infant_med = mfccinfant / me 
(3,280 missing values generated)

. gen mf_toddler_med = mfcctoddler / me 
(3,287 missing values generated)

. gen mf_preschool_med = mfccpreschool / me 
(3,275 missing values generated)

. 
. ** Drop unnecc. variables 
. drop me mcinfant mctoddler mcpreschool mfcc* 

. 
. ** Inflate forwards by two years, by county and variable 
. local ct = ${end_year_acs} - 2022 + 1 

. expand `ct' if year == 2022
(6,288 observations created)

. by fips year, sort: replace year = year + _n - 1 if year == 2022 & _n > 1
(6,288 real changes made)

. 
. ** Get list of all counties 
. qui levelsof fips, local(fips)

. 
. ** Loop over variables
. foreach v of varlist mc_* mf_* {
  2.         
.         ** Replace 2023 + 2024 values with missings 
.     replace `v' = . if year > 2022
  3.         
.         ** Loop over all FIPS 
.     foreach c of local fips {
  4.                 
.                 quietly{
  5.                         
.                         ** Run if not missing too many observations 
.                         count if !missing(`v') & fips == `c' 
  6.                         if `r(N)' > 3 {
  7.                                 regress `v' year if fips == `c'
  8.                                 predict `v'_hat
  9.                                 replace `v' = `v'_hat if fips == `c' & year > 2022
 10.                                 drop `v'_hat
 11.                         } // END IF-STATEMENT
 12.                         else drop if fips == `c'
 13.                 } // END QUIET
 14.     } // END FIPS LOOP 
 15. } // END VAR LOOP 
(5,322 real changes made, 5,322 to missing)
(5,310 real changes made, 5,310 to missing)
(5,324 real changes made, 5,324 to missing)
(5,152 real changes made, 5,152 to missing)
(5,140 real changes made, 5,140 to missing)
(5,152 real changes made, 5,152 to missing)

. 
. ** Save file
. save "${data}working/dol_childcare", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/dol_childcare.dta saved

. 
. 
. ********************************************************************************
. ** STEP 8: Calculate County-Level Property Tax Rates from ACS Data
. ********************************************************************************
. 
. ** Load ACS migration file (contains proptx99, valueh, qproptx99, qvalueh)
. use "${data}working/acs_migration_file", clear

. 
. ** Keep household heads only (relate == 1 for household reference person)
. keep if relate == 1
(11,523,232 observations deleted)

. 
. ** Generate FIPS code for destination county
. gen fips = fips_d

. 
. ** Drop if missing FIPS
. drop if missing(fips)
(0 observations deleted)

. 
. ** Drop observations where PROPTX99 == 0 (N/A - not applicable)
. drop if proptx99 == 0
(3,538,913 observations deleted)

. 
. ** Convert PROPTX99 codes to dollar midpoint values
. ** Based on IPUMS coding scheme: https://usa.ipums.org/usa-action/variables/PROPTX99#codes_secti
> on
. gen proptx_dollars = .
(8,952,892 missing values generated)

. 
. ** Code 1: None (0)
. replace proptx_dollars = 0 if proptx99 == 1
(419,640 real changes made)

. 
. ** Code 2: $1-49 -> midpoint $25
. replace proptx_dollars = 25 if proptx99 == 2
(66,151 real changes made)

. 
. ** Codes 3-12: $50-99, $100-149, ... $500-549 (increments of 50, midpoints)
. forvalues i = 3/12 {
  2.     local lower = (`i' - 3) * 50 + 50
  3.     local upper = `lower' + 49
  4.     local midpoint = (`lower' + `upper') / 2
  5.     replace proptx_dollars = `midpoint' if proptx99 == `i'
  6. }
(61,747 real changes made)
(68,476 real changes made)
(59,441 real changes made)
(77,852 real changes made)
(62,086 real changes made)
(95,651 real changes made)
(71,811 real changes made)
(99,356 real changes made)
(67,217 real changes made)
(125,470 real changes made)

. 
. ** Codes 13-22: $550-599, $600-699, ... $1000-1099 (transitioning to $100 increments)
. replace proptx_dollars = 575 if proptx99 == 13
(58,866 real changes made)

. replace proptx_dollars = 650 if proptx99 == 14
(133,020 real changes made)

. replace proptx_dollars = 750 if proptx99 == 15
(66,547 real changes made)

. replace proptx_dollars = 850 if proptx99 == 16
(110,304 real changes made)

. replace proptx_dollars = 950 if proptx99 == 17
(65,921 real changes made)

. replace proptx_dollars = 1050 if proptx99 == 18
(144,998 real changes made)

. replace proptx_dollars = 1150 if proptx99 == 19
(61,433 real changes made)

. replace proptx_dollars = 1250 if proptx99 == 20
(116,654 real changes made)

. replace proptx_dollars = 1350 if proptx99 == 21
(59,011 real changes made)

. replace proptx_dollars = 1450 if proptx99 == 22
(226,521 real changes made)

. 
. ** Codes 23+: Higher ranges with $100 increments then $500/$1000 at top
. ** $1500-1599, $1600-1699, ... up to high values
. forvalues i = 23/62 {
  2.     local lower = (`i' - 23) * 100 + 1500
  3.     local upper = `lower' + 99
  4.     local midpoint = (`lower' + `upper') / 2
  5.     replace proptx_dollars = `midpoint' if proptx99 == `i'
  6. }
(131,332 real changes made)
(336,659 real changes made)
(165,059 real changes made)
(163,982 real changes made)
(243,773 real changes made)
(153,651 real changes made)
(127,376 real changes made)
(187,760 real changes made)
(101,576 real changes made)
(318,173 real changes made)
(89,835 real changes made)
(125,362 real changes made)
(101,814 real changes made)
(139,349 real changes made)
(222,116 real changes made)
(94,845 real changes made)
(77,048 real changes made)
(106,250 real changes made)
(54,428 real changes made)
(300,072 real changes made)
(46,524 real changes made)
(98,363 real changes made)
(57,043 real changes made)
(61,714 real changes made)
(164,160 real changes made)
(88,141 real changes made)
(48,743 real changes made)
(73,708 real changes made)
(37,840 real changes made)
(242,752 real changes made)
(30,279 real changes made)
(59,165 real changes made)
(37,313 real changes made)
(36,840 real changes made)
(0 real changes made)
(114,171 real changes made)
(35,379 real changes made)
(27,958 real changes made)
(54,035 real changes made)
(23,313 real changes made)

. 
. ** Codes 63+: Higher brackets ($5500+)
. replace proptx_dollars = 5750 if proptx99 == 63
(326,858 real changes made)

. replace proptx_dollars = 6250 if proptx99 == 64
(157,452 real changes made)

. replace proptx_dollars = 6750 if proptx99 == 65
(386,770 real changes made)

. replace proptx_dollars = 7250 if proptx99 == 66
(248,309 real changes made)

. replace proptx_dollars = 7750 if proptx99 == 67
(209,153 real changes made)

. replace proptx_dollars = 8500 if proptx99 == 68
(133,804 real changes made)

. replace proptx_dollars = 9500 if proptx99 == 69
(221,304 real changes made)

. 
. ** For codes 70+: Use approximate midpoints for higher brackets
. ** These are $10000+ ranges
. forvalues i = 70/100 {
  2.     if proptx_dollars == . & proptx99 == `i' {
  3.         local midpoint = 10000 + (`i' - 70) * 1000
  4.         replace proptx_dollars = `midpoint' if proptx99 == `i'
  5.     }
  6. }

. 
. ** Top codes (very high property taxes)
. replace proptx_dollars = 75000 if proptx99 >= 140 & proptx99 < 159
(0 real changes made)

. replace proptx_dollars = 100000 if proptx99 == 159
(0 real changes made)

. 
. ** Label variable
. label var proptx_dollars "Property tax ($ midpoint from PROPTX99 codes)"

. 
. ** Drop if property tax could not be assigned or home value is missing/zero
. drop if missing(proptx_dollars)
(373,168 observations deleted)

. drop if missing(valueh) | valueh == 0 | valueh == 9999999
(0 observations deleted)

. 
. ** Calculate property tax rate (as percentage of home value)
. gen prop_rate = 100 * proptx_dollars / valueh

. label var prop_rate "Property tax rate (% of home value)"

. 
. ** ============================================================================
. ** VERSION 1: Overall (all observations)
. ** ============================================================================
. preserve

. 
. ** Collapse to county X year, weighted by household weight
. collapse (mean) prop_rate_mean = prop_rate ///
>          (semean) prop_rate_se = prop_rate ///
>          (count) prop_rate_n = prop_rate ///
>          [pw = hhwt], by(year fips)
semean not allowed with pweights
r(135);

end of do-file
r(135);

end of do-file

r(135);

. do "C:\Users\ji252\AppData\Local\Temp\STD72bc_00000a.tmp"

. 
. ** ============================================================================
. ** VERSION 1: Overall (all observations)
. ** ============================================================================
. preserve

. 
. ** Collapse to county X year, weighted by household weight
. collapse (mean) prop_rate_mean = prop_rate ///
>          (semean) prop_rate_se = prop_rate ///
>          (count) prop_rate_n = prop_rate ///
>          [fw = hhwt], by(year fips)

. 
. ** Label variables
. label var prop_rate_mean "Mean property tax rate (% of home value)"

. label var prop_rate_se "SE of property tax rate"

. label var prop_rate_n "Number of observations"

. 
. ** Generate state and county FIPS
. gen state_fips = floor(fips / 1000)

. gen county_fips = mod(fips, 1000)

. 
. ** Merge with county names
. merge m:1 state_fips county_fips using "${data}working/ids", keep(master match) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                           504
        from master                       504  
        from using                          0  

    Matched                             4,321  
    -----------------------------------------

. 
. ** Order variables
. order year fips state_fips county_fips state_name county_name prop_rate_mean prop_rate_se prop_r
> ate_n

. 
. ** Sort
. sort fips year

. 
. ** Save overall version
. save "${data}working/property_tax_rates_overall", replace
(file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/property_tax_rates_overall
    > .dta not found)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/property_tax_rates_overall
    > .dta saved

. 
. ** Export to CSV
. export delimited using "${data}working/property_tax_rates_overall.csv", replace
(file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/property_tax_rates_overall
    > .csv not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/property_tax_rates_overall.
> csv saved

. 
. restore

. 
. ** ============================================================================
. ** VERSION 2: Excluding allocated values (qproptx99 != 4, qvalueh != 4)
. ** ============================================================================
. 
. ** Drop observations where values are allocated (quality flag == 4)
. drop if qproptx99 == 4
qproptx99 not found
r(111);

end of do-file

r(111);

. do "C:\Users\ji252\AppData\Local\Temp\STD72bc_00000b.tmp"

. 
. ** Drop observations where values are allocated (quality flag == 4)
. drop if qprotx99 == 4
(1,223,562 observations deleted)

. drop if qvalueh == 4
(319,989 observations deleted)

. 
end of do-file

.  count
  7,036,173

. do "C:\Users\ji252\AppData\Local\Temp\STD72bc_00000c.tmp"

. 
. ** Collapse to county X year, weighted by household weight
. collapse (mean) prop_rate_mean = prop_rate ///
>          (semean) prop_rate_se = prop_rate ///
>          (count) prop_rate_n = prop_rate ///
>          [fw = hhwt], by(year fips)

. 
. ** Label variables
. label var prop_rate_mean "Mean property tax rate (% of home value, excl. allocated)"

. label var prop_rate_se "SE of property tax rate (excl. allocated)"

. label var prop_rate_n "Number of observations (excl. allocated)"

. 
. ** Generate state and county FIPS
. gen state_fips = floor(fips / 1000)

. gen county_fips = mod(fips, 1000)

. 
. ** Merge with county names
. merge m:1 state_fips county_fips using "${data}working/ids", keep(master match) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                           504
        from master                       504  
        from using                          0  

    Matched                             4,321  
    -----------------------------------------

. 
. ** Order variables
. order year fips state_fips county_fips state_name county_name prop_rate_mean prop_rate_se prop_r
> ate_n

. 
. ** Sort
. sort fips year

. 
end of do-file

. tab state_name , de
option de not allowed
r(198);

. tab state_name , d
option d not allowed
r(198);

. tab state_name , m

          State name |      Freq.     Percent        Cum.
---------------------+-----------------------------------
                     |        504       10.45       10.45
             Alabama |         64        1.33       11.77
              Alaska |         10        0.21       11.98
             Arizona |         47        0.97       12.95
            Arkansas |         37        0.77       13.72
          California |        340        7.05       20.77
            Colorado |         13        0.27       21.04
         Connecticut |         56        1.16       22.20
            Delaware |         30        0.62       22.82
District of Columbia |         10        0.21       23.03
             Florida |        295        6.11       29.14
             Georgia |        206        4.27       33.41
              Hawaii |         20        0.41       33.82
               Idaho |         10        0.21       34.03
            Illinois |        165        3.42       37.45
             Indiana |        160        3.32       40.77
                Iowa |         43        0.89       41.66
              Kansas |         30        0.62       42.28
            Kentucky |         56        1.16       43.44
           Louisiana |         77        1.60       45.04
               Maine |         27        0.56       45.60
            Maryland |        117        2.42       48.02
       Massachusetts |         41        0.85       48.87
            Michigan |        160        3.32       52.19
           Minnesota |         80        1.66       53.84
         Mississippi |         30        0.62       54.47
            Missouri |         70        1.45       55.92
             Montana |          3        0.06       55.98
            Nebraska |         30        0.62       56.60
              Nevada |         20        0.41       57.02
          New Jersey |        170        3.52       60.54
          New Mexico |         27        0.56       61.10
            New York |        210        4.35       65.45
      North Carolina |        194        4.02       69.47
        North Dakota |         10        0.21       69.68
                Ohio |        210        4.35       74.03
            Oklahoma |         33        0.68       74.72
              Oregon |         80        1.66       76.37
        Pennsylvania |        200        4.15       80.52
        Rhode Island |         30        0.62       81.14
      South Carolina |         52        1.08       82.22
           Tennessee |         96        1.99       84.21
               Texas |        380        7.88       92.08
                Utah |         50        1.04       93.12
             Vermont |          3        0.06       93.18
            Virginia |        100        2.07       95.25
          Washington |         93        1.93       97.18
       West Virginia |          3        0.06       97.24
           Wisconsin |        130        2.69       99.94
             Wyoming |          3        0.06      100.00
---------------------+-----------------------------------
               Total |      4,825      100.00

. tab fips if state_name == .
type mismatch
r(109);

. tab fips if state_name == ""

       fips |      Freq.     Percent        Cum.
------------+-----------------------------------
       1000 |         10        1.98        1.98
       2000 |         10        1.98        3.97
       4000 |         10        1.98        5.95
       5000 |         10        1.98        7.94
       6000 |         10        1.98        9.92
       8000 |         10        1.98       11.90
       9000 |          3        0.60       12.50
       9120 |          3        0.60       13.10
       9130 |          3        0.60       13.69
       9140 |          3        0.60       14.29
       9160 |          3        0.60       14.88
       9170 |          3        0.60       15.48
       9180 |          3        0.60       16.07
       9190 |          3        0.60       16.67
      12000 |         10        1.98       18.65
      13000 |         10        1.98       20.63
      15000 |         10        1.98       22.62
      16000 |         10        1.98       24.60
      17000 |         10        1.98       26.59
      18000 |         10        1.98       28.57
      19000 |         10        1.98       30.56
      20000 |         10        1.98       32.54
      21000 |         10        1.98       34.52
      22000 |         10        1.98       36.51
      23000 |         10        1.98       38.49
      24000 |         10        1.98       40.48
      25000 |         10        1.98       42.46
      26000 |         10        1.98       44.44
      27000 |         10        1.98       46.43
      28000 |         10        1.98       48.41
      29000 |         10        1.98       50.40
      30000 |         10        1.98       52.38
      31000 |         10        1.98       54.37
      32000 |         10        1.98       56.35
      33000 |         10        1.98       58.33
      34000 |         10        1.98       60.32
      35000 |         10        1.98       62.30
      36000 |         10        1.98       64.29
      37000 |         10        1.98       66.27
      38000 |         10        1.98       68.25
      39000 |         10        1.98       70.24
      40000 |         10        1.98       72.22
      41000 |         10        1.98       74.21
      42000 |         10        1.98       76.19
      44000 |         10        1.98       78.17
      45000 |         10        1.98       80.16
      46000 |         10        1.98       82.14
      47000 |         10        1.98       84.13
      48000 |         10        1.98       86.11
      49000 |         10        1.98       88.10
      50000 |         10        1.98       90.08
      51000 |         10        1.98       92.06
      53000 |         10        1.98       94.05
      54000 |         10        1.98       96.03
      55000 |         10        1.98       98.02
      56000 |         10        1.98      100.00
------------+-----------------------------------
      Total |        504      100.00

. do "C:\Users\ji252\AppData\Local\Temp\STD72bc_00000d.tmp"

. ** Descriptives 
. do ${code}02_descriptives.do 

. /*******************************************************************************
> File Name:              02_descriptives.do
> Creator:                John Iselin
> Date Update:    December 17, 2025
> 
> Called by: 00_multnomah.do
> 
> Purpose: Preform descriptive analysis
> 
> Authors: John Iselin 
> 
> For more information, contact john.iselin@yale.edu
> 
> *******************************************************************************/
. 
. ** Start log file 
. capture log close log_02

. log using "${logs}02_log_descriptives_${date}", replace text name(log_02)
--------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_descriptives_20
> 26-01-14.log
  log type:  text
 opened on:  14 Jan 2026, 20:39:07

. 
. ** Determine set of common in- and out-migration counties for Multnomah
. use ${data}working/irs_county_flow.dta, clear 

. 
. ** Tag Multnomah
. gen multnomah_o = (state_fips_o == 41 & county_fips_o == 51)

. gen multnomah_d = (state_fips_d == 41 & county_fips_d == 51)

. 
. ** Loop over samples 
. foreach x in "o" "d" {
  2.         
.         ** Preserve 
.         preserve 
  3.         
.         ** Keep Multnomah
.         keep if multnomah_`x' == 1 
  4.         
.         ** Export data 
.         export excel using "${data}multnomah.xlsx",     ///
>                 sheet(irs_`x', replace ) firstrow(variables) 
  5.                 
.         ** Clear and restore 
.         clear 
  6.         restore
  7.                 
. } // END ORIGIN-DESTINATION LOOP 
(361,546 observations deleted)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/multnomah.xlsx saved
(361,434 observations deleted)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/multnomah.xlsx saved

. 
. ** Determine set of common in- and out-migration counties for Multnomah
. use ${data}working/acs_county_flow.dta, clear 

. 
. ** Tag Multnomah
. gen multnomah_o = (state_fips_o == 41 & county_fips_o == 51)

. gen multnomah_d = (state_fips_d == 41 & county_fips_d == 51)

. 
. ** Loop over samples 
. foreach x in "o" "d" {
  2.         
.         ** Preserve 
.         preserve 
  3.         
.         ** Keep Multnomah
.         keep if multnomah_`x' == 1 
  4.         
.         ** Export data 
.         export excel using "${data}multnomah.xlsx",     ///
>                 sheet(acs_`x', replace ) firstrow(variables) 
  5.                 
.         ** Clear and restore 
.         clear 
  6.         restore
  7.                 
. } // END ORIGIN-DESTINATION LOOP 
(230,904 observations deleted)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/multnomah.xlsx saved
(230,847 observations deleted)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/multnomah.xlsx saved

. 
. /*******************************************************************************
> SECTION 2: PRE-POST FLOW COMPARISON (2018-2019 vs 2021-2022)
> Purpose: Compare IRS migration flows to/from Multnomah County before and after
>          the 2020 tax change. Creates datasets and exports CSVs for mapping.
> *******************************************************************************/
. 
. ** Load IRS flow data
. use ${data}working/irs_county_flow.dta, clear

. 
. ** Define Multnomah County FIPS
. local multnomah_fips = 41051

. 
. ** Define pre and post periods
. local pre_years "2018 2019"

. local post_years "2021 2022"

. 
. ** Create period indicator
. gen period = ""
(362,678 missing values generated)

. replace period = "pre" if inlist(year, 2018, 2019)
variable period was str1 now str3
(97,023 real changes made)

. replace period = "post" if inlist(year, 2021, 2022)
variable period was str3 now str4
(107,196 real changes made)

. 
. ** Keep only pre and post periods
. keep if period != ""
(158,459 observations deleted)

. 
. ** Loop over each measure to create separate datasets
. foreach measure in "n1" "n2" "agi" {
  2. 
.         ** Display status
.         dis "Creating flow comparison dataset for `measure'..."
  3. 
.         ** Preserve original data
.         preserve
  4. 
.         ** ----------------------------------------------------------------
.         ** OUT-MIGRATION: Flows FROM Multnomah TO other counties
.         ** ----------------------------------------------------------------
. 
.         ** Keep flows where Multnomah is the origin
.         keep if fips_o == `multnomah_fips'
  5. 
.         ** Collapse to sum flows by destination county and period
.         collapse (sum) `measure', by(fips_d period)
  6. 
.         ** Reshape to wide format (pre and post as columns)
.         reshape wide `measure', i(fips_d) j(period) string
  7. 
.         ** Rename for clarity
.         rename fips_d fips
  8.         rename `measure'pre out_pre
  9.         rename `measure'post out_post
 10. 
.         ** Save temp file for out-migration
.         tempfile out_flows
 11.         save `out_flows'
 12. 
.         ** ----------------------------------------------------------------
.         ** IN-MIGRATION: Flows TO Multnomah FROM other counties
.         ** ----------------------------------------------------------------
. 
.         ** Restore and start fresh
.         restore
 13.         preserve
 14. 
.         ** Keep flows where Multnomah is the destination
.         keep if fips_d == `multnomah_fips'
 15. 
.         ** Collapse to sum flows by origin county and period
.         collapse (sum) `measure', by(fips_o period)
 16. 
.         ** Reshape to wide format
.         reshape wide `measure', i(fips_o) j(period) string
 17. 
.         ** Rename for clarity
.         rename fips_o fips
 18.         rename `measure'pre in_pre
 19.         rename `measure'post in_post
 20. 
.         ** ----------------------------------------------------------------
.         ** MERGE: Combine in and out flows
.         ** ----------------------------------------------------------------
. 
.         ** Merge with out-migration flows
.         merge 1:1 fips using `out_flows', nogen
 21. 
.         ** Replace missing with 0 (counties with flows in only one direction)
.         foreach var of varlist out_pre out_post in_pre in_post {
 22.                 replace `var' = 0 if missing(`var')
 23.         }
 24. 
.         ** Order columns: fips, out_pre, out_post, in_pre, in_post
.         order fips out_pre out_post in_pre in_post
 25. 
.         ** Sort by fips
.         sort fips
 26. 
.         ** Label variables
.         label var fips "County FIPS code"
 27.         label var out_pre "Out-migration from Multnomah (2018-2019)"
 28.         label var out_post "Out-migration from Multnomah (2021-2022)"
 29.         label var in_pre "In-migration to Multnomah (2018-2019)"
 30.         label var in_post "In-migration to Multnomah (2021-2022)"
 31. 
.         ** Save Stata dataset to working directory (for R mapping)
.         save "${data}working/multnomah_flow_comparison_`measure'.dta", replace
 32. 
.         ** Export to CSV for R mapping
.         export delimited using "${data}working/multnomah_flow_comparison_`measure'.csv", replace
 33. 
.         ** Display summary statistics
.         dis "Summary for `measure':"
 34.         summ out_pre out_post in_pre in_post
 35. 
.         ** Restore original data for next measure
.         restore
 36. 
. } // END MEASURE LOOP
Creating flow comparison dataset for n1...
(203,572 observations deleted)
(j = post pre)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations              355   ->   202         
Number of variables                   3   ->   3           
j variable (2 values)            period   ->   (dropped)
xij variables:
                                     n1   ->   n1post n1pre
-----------------------------------------------------------------------------
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_000006.tmp saved as .dta format
(203,528 observations deleted)
(j = post pre)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations              379   ->   202         
Number of variables                   3   ->   3           
j variable (2 values)            period   ->   (dropped)
xij variables:
                                     n1   ->   n1post n1pre
-----------------------------------------------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                            58
        from master                        29  
        from using                         29  

    Matched                               173  
    -----------------------------------------
(75 real changes made)
(32 real changes made)
(36 real changes made)
(47 real changes made)
(file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_
    > n1.dta not found)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_
    > n1.dta saved
(file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_
    > n1.csv not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_n
> 1.csv saved
Summary for n1:

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     out_pre |        231     217.658     999.888          0      10579
    out_post |        231    258.5541    1107.284          0      11770
      in_pre |        231    223.6537    835.9653          0       8773
     in_post |        231    225.6753    816.5126          0       8572
Creating flow comparison dataset for n2...
(203,572 observations deleted)
(j = post pre)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations              355   ->   202         
Number of variables                   3   ->   3           
j variable (2 values)            period   ->   (dropped)
xij variables:
                                     n2   ->   n2post n2pre
-----------------------------------------------------------------------------
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_000009.tmp saved as .dta format
(203,528 observations deleted)
(j = post pre)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations              379   ->   202         
Number of variables                   3   ->   3           
j variable (2 values)            period   ->   (dropped)
xij variables:
                                     n2   ->   n2post n2pre
-----------------------------------------------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                            58
        from master                        29  
        from using                         29  

    Matched                               173  
    -----------------------------------------
(75 real changes made)
(32 real changes made)
(36 real changes made)
(47 real changes made)
(file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_
    > n2.dta not found)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_
    > n2.dta saved
(file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_
    > n2.csv not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_n
> 2.csv saved
Summary for n2:

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     out_pre |        231    345.1342    1677.485          0      18690
    out_post |        231    398.8095    1806.828          0      20381
      in_pre |        231    322.4978    1252.515          0      12631
     in_post |        231    310.0649    1160.729          0      11789
Creating flow comparison dataset for agi...
(203,572 observations deleted)
(j = post pre)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations              355   ->   202         
Number of variables                   3   ->   3           
j variable (2 values)            period   ->   (dropped)
xij variables:
                                    agi   ->   agipost agipre
-----------------------------------------------------------------------------
file C:\Users\ji252\AppData\Local\Temp\ST_72bc_00000c.tmp saved as .dta format
(203,528 observations deleted)
(j = post pre)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations              379   ->   202         
Number of variables                   3   ->   3           
j variable (2 values)            period   ->   (dropped)
xij variables:
                                    agi   ->   agipost agipre
-----------------------------------------------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                            58
        from master                        29  
        from using                         29  

    Matched                               173  
    -----------------------------------------
(75 real changes made)
(32 real changes made)
(36 real changes made)
(47 real changes made)
(file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_
    > agi.dta not found)
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_
    > agi.dta saved
(file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_
    > agi.csv not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/multnomah_flow_comparison_a
> gi.csv saved
Summary for agi:

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     out_pre |        231     15245.4    71845.05          0     727846
    out_post |        231    24860.27    109864.8          0    1170383
      in_pre |        231    14641.75     53537.6          0     592707
     in_post |        231    16286.22    58385.22          0     662028

. 
. dis "Flow comparison datasets created and exported to ${results}flows/"
Flow comparison datasets created and exported to C:/Users/ji252/Documents/GitHub/multnomah-county-
> tax/results/flows/

. 
. ** Close log
. clear

. log close log_02
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_descriptives_20
> 26-01-14.log
  log type:  text
 closed on:  14 Jan 2026, 20:39:09
--------------------------------------------------------------------------------------------------

. 
end of do-file

. 
. ** Create maps 
. rcall script "${code}R/map_code.R", vanilla
Reading layer `Metro_District_Boundary' from data source 
  `C:\Users\ji252\Documents\GitHub\multnomah-county-tax\data\mapping\Metro_District_Boundary\Metro
> _District_Boundary.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 1 feature and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 7522267 ymin: 596871.4 xmax: 7732958 ymax: 733890
Projected CRS: NAD83(HARN) / Oregon North (ft)
Warning message:
 In  :  

. 
end of do-file

. use "C:\Users\ji252\Documents\GitHub\multnomah-county-tax\data\working\property_tax_rates_overal
> l.dta"

. tab year

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       2015 |        478        9.91        9.91
       2016 |        478        9.91       19.81
       2017 |        478        9.91       29.72
       2018 |        478        9.91       39.63
       2019 |        478        9.91       49.53
       2020 |        478        9.91       59.44
       2021 |        478        9.91       69.35
       2022 |        493       10.22       79.56
       2023 |        493       10.22       89.78
       2024 |        493       10.22      100.00
------------+-----------------------------------
      Total |      4,825      100.00

. do "C:\Users\ji252\AppData\Local\Temp\STD72bc_00000e.tmp"

. 
. ** Start log file
. capture log close log_02

. log using "${logs}02_log_sdid_parallel_${date}", replace text name(log_02)
--------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_sdid_parallel_2
> 026-01-14.log
  log type:  text
 opened on:  14 Jan 2026, 20:43:05

. 
. /*******************************************************************************
> SECTION 1: SETUP AND CONFIGURATION
> *******************************************************************************/
. 
. ** Set number of parallel clusters (adjust based on your machine)
. ** Use fewer than total cores to leave resources for system
. local n_clusters = 6

. 
. ** Parameters
. local reps = 100

. 
. ** Initialize parallel processing
. parallel initialize `n_clusters', force
N Child processes: 6
Stata dir:  C:\Program Files\StataNow19/StataMP-64.exe

. 
. /*******************************************************************************
> SECTION 2: DATA PREPARATION
> (Same as original - prepares main analysis dataset)
> *******************************************************************************/
. 
. ** Load data
. use "${data}working/irs_county_gross", replace

. 
. ** Keep required variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3

. order year fips state* county*

. 
. ** Merge with ACS Data
. merge 1:1 year fips using "${data}working/acs_county_gross_18plus", gen(merge_acs_1)
(variable fips was float, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        20,771
        from master                    18,963  (merge_acs_1==1)
        from using                      1,808  (merge_acs_1==2)

    Matched                             3,017  (merge_acs_1==3)
    -----------------------------------------

. 
. ** Keep require variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3 merge_acs_*

. 
. ** Label acs samples
. rename persons_* acs1_persons_*

. rename households_* acs1_households_*

. rename dollars_* acs1_dollars_*

. 
. ** Merge with ACS Data
. merge 1:1 year fips using "${data}working/acs_county_gross_college", gen(merge_acs_2)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,963
        from master                    18,963  (merge_acs_2==1)
        from using                          0  (merge_acs_2==2)

    Matched                             4,825  (merge_acs_2==3)
    -----------------------------------------

. 
. ** Keep require variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3  merge_acs_*

. 
. ** Label acs samples
. rename persons_* acs2_persons_*

. rename households_* acs2_households_*

. rename dollars_* acs2_dollars_*

. 
. ** Drop "other counties"
. drop if county_fips == 0
(483 observations deleted)

. drop if year == 2015
(430 observations deleted)

. 
. ** Merge with Demographic data
. merge m:1 fips using "${data}working/demographics_2020",        ///
>         gen(demo_merge) keep(master match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            27
        from master                        27  (demo_merge==1)
        from using                          0  (demo_merge==2)

    Matched                            22,848  (demo_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name demo_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
                     |        21          0 |        21 
             Alabama |         0        479 |       479 
              Alaska |         6        198 |       204 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         0         34 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |         0        951 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |        27     22,848 |    22,875 

. tab year demo_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         0      3,140 |     3,140 
      2017 |         0      3,140 |     3,140 
      2018 |         0      3,140 |     3,140 
      2019 |         0      3,140 |     3,140 
      2020 |         2      3,140 |     3,142 
      2021 |         2      3,141 |     3,143 
      2022 |         9      3,133 |     3,142 
      2023 |         7        437 |       444 
      2024 |         7        437 |       444 
-----------+----------------------+----------
     Total |        27     22,848 |    22,875 

. 
. ** Keep if matched
. keep if demo_merge == 3
(27 observations deleted)

. drop demo_merge

. 
. ** Rename
. rename population pop_census

. 
. ** Merge with Demographic data
. merge m:1 year fips using "${data}working/bea_economics",       ///
>         gen(econ_merge) keep(master match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           366
        from master                       366  (econ_merge==1)
        from using                          0  (econ_merge==2)

    Matched                            22,482  (econ_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name econ_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
             Alabama |         0        479 |       479 
              Alaska |         0        198 |       198 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         9         25 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |       357        594 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |       366     22,482 |    22,848 

. tab year econ_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |        52      3,088 |     3,140 
      2017 |        52      3,088 |     3,140 
      2018 |        52      3,088 |     3,140 
      2019 |        52      3,088 |     3,140 
      2020 |        52      3,088 |     3,140 
      2021 |        53      3,088 |     3,141 
      2022 |        53      3,080 |     3,133 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |       366     22,482 |    22,848 

. 
. ** Keep if matched
. keep if econ_merge == 3
(366 observations deleted)

. drop econ_merge

. 
. ** Merge with COVID-19 Data
. merge m:1 fips using ${data}working/covid_cleaned_wide.dta,     ///
>         gen(covid_merge) keep(master match )
(variable state_name was str20, now str24 to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            73
        from master                        73  (covid_merge==1)
        from using                          0  (covid_merge==2)

    Matched                            22,409  (covid_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name covid_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |         0        479 |       479 
               Alaska |        28        170 |       198 
              Arizona |         0        113 |       113 
             Arkansas |         0        531 |       531 
           California |         0        474 |       474 
             Colorado |         0        452 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |         0        535 |       535 
              Georgia |         0      1,157 |     1,157 
               Hawaii |         0         25 |        25 
                Idaho |         0        310 |       310 
             Illinois |         0        740 |       740 
              Indiana |         0        676 |       676 
                 Iowa |         0        703 |       703 
               Kansas |         0        741 |       741 
             Kentucky |         0        854 |       854 
            Louisiana |         0        462 |       462 
                Maine |         0        116 |       116 
             Maryland |         0        190 |       190 
        Massachusetts |         0        116 |       116 
             Michigan |         0        613 |       613 
            Minnesota |         0        625 |       625 
          Mississippi |         0        580 |       580 
             Missouri |         0        819 |       819 
              Montana |         0        394 |       394 
             Nebraska |         0        657 |       657 
               Nevada |         0        123 |       123 
        New Hampshire |         0         70 |        70 
           New Jersey |         0        181 |       181 
           New Mexico |         0        235 |       235 
             New York |        45        431 |       476 
       North Carolina |         0        736 |       736 
         North Dakota |         0        373 |       373 
                 Ohio |         0        658 |       658 
             Oklahoma |         0        547 |       547 
               Oregon |         0        268 |       268 
         Pennsylvania |         0        509 |       509 
         Rhode Island |         0         41 |        41 
       South Carolina |         0        338 |       338 
         South Dakota |         0        462 |       462 
            Tennessee |         0        687 |       687 
                Texas |         0      1,854 |     1,854 
                 Utah |         0        213 |       213 
              Vermont |         0        100 |       100 
             Virginia |         0        594 |       594 
           Washington |         0        293 |       293 
        West Virginia |         0        387 |       387 
            Wisconsin |         0        530 |       530 
              Wyoming |         0        163 |       163 
----------------------+----------------------+----------
                Total |        73     22,409 |    22,482 

. tab year covid_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         9      3,079 |     3,088 
      2017 |         9      3,079 |     3,088 
      2018 |         9      3,079 |     3,088 
      2019 |         9      3,079 |     3,088 
      2020 |         9      3,079 |     3,088 
      2021 |         9      3,079 |     3,088 
      2022 |         9      3,071 |     3,080 
      2023 |         5        432 |       437 
      2024 |         5        432 |       437 
-----------+----------------------+----------
     Total |        73     22,409 |    22,482 

. 
. ** Merge with Property Tax Rates (time-varying)
. merge m:1 year fips using "${data}working/property_tax_rates_overall", ///
>         gen(proptx_merge) keep(master match) keepusing(prop_rate_mean prop_rate_se)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,591
        from master                    18,591  (proptx_merge==1)
        from using                          0  (proptx_merge==2)

    Matched                             3,891  (proptx_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name proptx_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |       422         57 |       479 
               Alaska |       189          9 |       198 
              Arizona |        71         42 |       113 
             Arkansas |       498         33 |       531 
           California |       168        306 |       474 
             Colorado |       440         12 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |       268        267 |       535 
              Georgia |       971        186 |     1,157 
               Hawaii |         7         18 |        25 
                Idaho |       301          9 |       310 
             Illinois |       593        147 |       740 
              Indiana |       532        144 |       676 
                 Iowa |       664         39 |       703 
               Kansas |       714         27 |       741 
             Kentucky |       803         51 |       854 
            Louisiana |       393         69 |       462 
                Maine |        92         24 |       116 
             Maryland |        85        105 |       190 
        Massachusetts |        77         39 |       116 
             Michigan |       469        144 |       613 
            Minnesota |       553         72 |       625 
          Mississippi |       553         27 |       580 
             Missouri |       756         63 |       819 
              Montana |       391          3 |       394 
             Nebraska |       630         27 |       657 
               Nevada |       105         18 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        28        153 |       181 
           New Mexico |       211         24 |       235 
             New York |       287        189 |       476 
       North Carolina |       562        174 |       736 
         North Dakota |       364          9 |       373 
                 Ohio |       469        189 |       658 
             Oklahoma |       517         30 |       547 
               Oregon |       196         72 |       268 
         Pennsylvania |       329        180 |       509 
         Rhode Island |        14         27 |        41 
       South Carolina |       290         48 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       600         87 |       687 
                Texas |     1,512        342 |     1,854 
                 Utah |       168         45 |       213 
              Vermont |        97          3 |       100 
             Virginia |       504         90 |       594 
           Washington |       209         84 |       293 
        West Virginia |       384          3 |       387 
            Wisconsin |       413        117 |       530 
              Wyoming |       160          3 |       163 
----------------------+----------------------+----------
                Total |    18,591      3,891 |    22,482 

. tab year proptx_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |     2,658        430 |     3,088 
      2017 |     2,658        430 |     3,088 
      2018 |     2,658        430 |     3,088 
      2019 |     2,658        430 |     3,088 
      2020 |     2,658        430 |     3,088 
      2021 |     2,658        430 |     3,088 
      2022 |     2,643        437 |     3,080 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |    18,591      3,891 |    22,482 

. 
end of do-file

. do "C:\Users\ji252\AppData\Local\Temp\STD72bc_00000f.tmp"

. 
. ** Rename for clarity
. rename prop_rate_mean prop_tax_rate

. rename prop_rate_se prop_tax_rate_se

. label var prop_tax_rate "Mean property tax rate (% of home value)"

. label var prop_tax_rate_se "SE of property tax rate"

. 
. ** Organize data
. order year fips state_* county_*

. sort fips year

. isid fips year

. 
. ** Keep only sample with non-missing base populations
. tab county_name year if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022

                      |  Tax year
                      |   (year
                      |   before
                      |   move)
          County name |      2017 |     Total
----------------------+-----------+----------
        Loving County |         1 |         1 
----------------------+-----------+----------
                Total |         1 |         1 

. drop if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022
(1 observation deleted)

. 
end of do-file

. do "C:\Users\ji252\AppData\Local\Temp\STD72bc_00000g.tmp"

. 
. ** Keep only sample with observations in each year
. bysort fips: gen ct = _N

. tab county_name state_name if ct < 7

                      |      State name
          County name | Connect..      Texas |     Total
----------------------+----------------------+----------
     Fairfield County |         6          0 |         6 
      Hartford County |         6          0 |         6 
    Litchfield County |         6          0 |         6 
        Loving County |         0          6 |         6 
     Middlesex County |         6          0 |         6 
     New Haven County |         6          0 |         6 
    New London County |         6          0 |         6 
       Tolland County |         6          0 |         6 
       Windham County |         6          0 |         6 
----------------------+----------------------+----------
                Total |        48          6 |        54 

. drop if ct < 7
(54 observations deleted)

. drop ct

. 
end of do-file

. do "C:\Users\ji252\AppData\Local\Temp\STD72bc_00000h.tmp"

. 
. ** Generate IRS sample
. gen irs_sample_1 = inrange(year, 2016, 2022)

. gen irs_sample_2 = inrange(year, 2016, 2022) & merge_acs_1 != 1

. 
. ** Generate ACS Period Indicators
. gen acs_period_1 = merge_acs_1 != 1 & inrange(year, 2016, 2022)

. gen acs_period_2 = merge_acs_1 != 1

. 
. ** Make sure we have a balanced panel of ACS counties
. gen tmp = merge_acs_1 != 1

. bysort fips: egen ct_tmp = total(tmp)

. replace acs_period_1 = 0 if ct_tmp != 9
(246 real changes made)

. replace acs_period_2 = 0 if ct_tmp != 9
(342 real changes made)

. replace irs_sample_2 = 0 if ct_tmp != 9
(246 real changes made)

. drop tmp ct_tmp

. 
. tab year irs_sample_1

  Tax year |
     (year |
    before |     irs_sample_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |         0      3,079 |     3,079 
      2017 |         0      3,079 |     3,079 
      2018 |         0      3,079 |     3,079 
      2019 |         0      3,079 |     3,079 
      2020 |         0      3,079 |     3,079 
      2021 |         0      3,079 |     3,079 
      2022 |         0      3,079 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |       874     21,553 |    22,427 

. tab year irs_sample_2

  Tax year |
     (year |
    before |     irs_sample_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_1

  Tax year |
     (year |
    before |     acs_period_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_2

  Tax year |
     (year |
    before |     acs_period_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |        48        389 |       437 
      2024 |        48        389 |       437 
-----------+----------------------+----------
     Total |    18,926      3,501 |    22,427 

. tab state_name acs_period_1

                      |     acs_period_1
           State name |         0          1 |     Total
----------------------+----------------------+----------
              Alabama |       458         21 |       479 
               Alaska |       191          7 |       198 
              Arizona |        92         21 |       113 
             Arkansas |       510         21 |       531 
           California |       236        238 |       474 
             Colorado |       445          7 |       452 
             Delaware |         6         21 |        27 
 District of Columbia |         2          7 |         9 
              Florida |       339        196 |       535 
              Georgia |     1,017        140 |     1,157 
               Hawaii |        11         14 |        25 
                Idaho |       303          7 |       310 
             Illinois |       656         84 |       740 
              Indiana |       564        112 |       676 
                 Iowa |       675         28 |       703 
               Kansas |       720         21 |       741 
             Kentucky |       819         35 |       854 
            Louisiana |       413         49 |       462 
                Maine |       102         14 |       116 
             Maryland |       113         77 |       190 
        Massachusetts |       102         14 |       116 
             Michigan |       501        112 |       613 
            Minnesota |       583         42 |       625 
          Mississippi |       559         21 |       580 
             Missouri |       784         35 |       819 
              Montana |       394          0 |       394 
             Nebraska |       636         21 |       657 
               Nevada |       109         14 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        62        119 |       181 
           New Mexico |       221         14 |       235 
             New York |       336        140 |       476 
       North Carolina |       610        126 |       736 
         North Dakota |       366          7 |       373 
                 Ohio |       525        133 |       658 
             Oklahoma |       526         21 |       547 
               Oregon |       219         49 |       268 
         Pennsylvania |       369        140 |       509 
         Rhode Island |        20         21 |        41 
       South Carolina |       331          7 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       638         49 |       687 
                Texas |     1,581        266 |     1,847 
                 Utah |       178         35 |       213 
              Vermont |       100          0 |       100 
             Virginia |       531         63 |       594 
           Washington |       230         63 |       293 
        West Virginia |       387          0 |       387 
            Wisconsin |       439         91 |       530 
              Wyoming |       163          0 |       163 
----------------------+----------------------+----------
                Total |    19,704      2,723 |    22,427 

. 
end of do-file

. tab year acs_period_1

  Tax year |
     (year |
    before |     acs_period_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year proptx_merge

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |     2,657        422 |     3,079 
      2017 |     2,657        422 |     3,079 
      2018 |     2,657        422 |     3,079 
      2019 |     2,657        422 |     3,079 
      2020 |     2,657        422 |     3,079 
      2021 |     2,657        422 |     3,079 
      2022 |     2,642        437 |     3,079 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |    18,584      3,843 |    22,427 

. tab county_name if proptx_merge == 1

                            County name |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                       Abbeville County |          7        0.04        0.04
                          Acadia Parish |          7        0.04        0.08
                        Accomack County |          7        0.04        0.11
                             Ada County |          7        0.04        0.15
                           Adair County |         28        0.15        0.30
                           Adams County |         84        0.45        0.75
                         Addison County |          7        0.04        0.79
                           Aiken County |          6        0.03        0.82
                          Aitkin County |          7        0.04        0.86
                         Alamosa County |          7        0.04        0.90
                          Albany County |          7        0.04        0.94
                          Alcona County |          7        0.04        0.97
                          Alcorn County |          7        0.04        1.01
                 Aleutians East Borough |          7        0.04        1.05
             Aleutians West Census Area |          7        0.04        1.09
                       Alexander County |         14        0.08        1.16
                         Alfalfa County |          7        0.04        1.20
                           Alger County |          7        0.04        1.24
                       Allamakee County |          7        0.04        1.28
                        Allegany County |         14        0.08        1.35
                       Alleghany County |          7        0.04        1.39
                           Allen County |         14        0.08        1.46
                           Allen Parish |          7        0.04        1.50
                       Allendale County |          7        0.04        1.54
                          Alpena County |          7        0.04        1.58
                          Alpine County |          7        0.04        1.61
                          Amador County |          7        0.04        1.65
                          Amelia County |          7        0.04        1.69
                         Amherst County |          7        0.04        1.73
                           Amite County |          7        0.04        1.76
                        Anderson County |         29        0.16        1.92
                          Andrew County |          7        0.04        1.96
                         Andrews County |          7        0.04        2.00
                        Angelina County |          7        0.04        2.03
                           Anson County |          7        0.04        2.07
                        Antelope County |          7        0.04        2.11
                          Antrim County |          7        0.04        2.15
                          Apache County |          7        0.04        2.18
                       Appanoose County |          7        0.04        2.22
                         Appling County |          7        0.04        2.26
                      Appomattox County |          7        0.04        2.30
                         Aransas County |          7        0.04        2.34
                        Arapahoe County |          7        0.04        2.37
                          Archer County |          7        0.04        2.41
                       Archuleta County |          7        0.04        2.45
                          Arenac County |          7        0.04        2.49
                        Arkansas County |          7        0.04        2.52
                       Armstrong County |         14        0.08        2.60
                       Aroostook County |          7        0.04        2.64
                          Arthur County |          7        0.04        2.67
                            Ashe County |          7        0.04        2.71
                         Ashland County |         14        0.08        2.79
                          Ashley County |          7        0.04        2.83
                       Ashtabula County |          1        0.01        2.83
                          Asotin County |          7        0.04        2.87
                      Assumption Parish |          7        0.04        2.91
                        Atascosa County |          7        0.04        2.94
                        Atchison County |         14        0.08        3.02
                          Athens County |          7        0.04        3.06
                        Atkinson County |          7        0.04        3.09
                        Atlantic County |          7        0.04        3.13
                           Atoka County |          7        0.04        3.17
                          Attala County |          7        0.04        3.21
                         Audrain County |          7        0.04        3.24
                         Audubon County |          7        0.04        3.28
                        Auglaize County |          7        0.04        3.32
                          Aurora County |          7        0.04        3.36
                          Austin County |          7        0.04        3.40
                         Autauga County |          7        0.04        3.43
                           Avery County |          7        0.04        3.47
                       Avoyelles Parish |          7        0.04        3.51
                            Baca County |          7        0.04        3.55
                           Bacon County |          7        0.04        3.58
                          Bailey County |          7        0.04        3.62
                           Baker County |         21        0.11        3.73
                         Baldwin County |          7        0.04        3.77
                         Ballard County |          7        0.04        3.81
                         Bamberg County |          7        0.04        3.85
                         Bandera County |          7        0.04        3.89
                           Banks County |          7        0.04        3.92
                          Banner County |          7        0.04        3.96
                         Bannock County |          7        0.04        4.00
                          Baraga County |          7        0.04        4.04
                          Barber County |          7        0.04        4.07
                         Barbour County |         14        0.08        4.15
                          Barnes County |          7        0.04        4.19
                      Barnstable County |          7        0.04        4.22
                        Barnwell County |          7        0.04        4.26
                          Barren County |          7        0.04        4.30
                          Barron County |          7        0.04        4.34
                          Barrow County |          7        0.04        4.37
                           Barry County |         14        0.08        4.45
                     Bartholomew County |          7        0.04        4.49
                          Barton County |         14        0.08        4.56
                         Bastrop County |          7        0.04        4.60
                           Bates County |          7        0.04        4.64
                            Bath County |         14        0.08        4.71
                          Baxter County |          7        0.04        4.75
                             Bay County |         13        0.07        4.82
                        Bayfield County |          7        0.04        4.86
                          Baylor County |          7        0.04        4.90
                          Beadle County |          7        0.04        4.93
                       Bear Lake County |          7        0.04        4.97
                        Beaufort County |         14        0.08        5.05
                      Beauregard Parish |          7        0.04        5.09
                          Beaver County |         21        0.11        5.20
                      Beaverhead County |          7        0.04        5.24
                          Becker County |          7        0.04        5.27
                         Beckham County |          7        0.04        5.31
                         Bedford County |         21        0.11        5.42
                             Bee County |          7        0.04        5.46
                         Belknap County |          7        0.04        5.50
                            Bell County |          7        0.04        5.54
                         Belmont County |          7        0.04        5.57
                        Beltrami County |          7        0.04        5.61
                        Ben Hill County |          7        0.04        5.65
                         Benewah County |          7        0.04        5.69
                         Bennett County |          7        0.04        5.73
                      Bennington County |          7        0.04        5.76
                          Benson County |          7        0.04        5.80
                            Bent County |          7        0.04        5.84
                          Benton County |         56        0.30        6.14
                          Benzie County |          7        0.04        6.18
                        Berkeley County |         13        0.07        6.25
                      Bernalillo County |          7        0.04        6.28
                         Berrien County |          7        0.04        6.32
                          Bertie County |          7        0.04        6.36
                     Bethel Census Area |          7        0.04        6.40
                            Bibb County |          7        0.04        6.44
                       Bienville Parish |          7        0.04        6.47
                        Big Horn County |         14        0.08        6.55
                       Big Stone County |          7        0.04        6.59
                        Billings County |          7        0.04        6.62
                         Bingham County |          7        0.04        6.66
                       Blackford County |          7        0.04        6.70
                          Bladen County |          7        0.04        6.74
                          Blaine County |         28        0.15        6.89
                           Blair County |          7        0.04        6.93
                          Blanco County |          7        0.04        6.96
                           Bland County |          7        0.04        7.00
                        Bleckley County |          7        0.04        7.04
                         Bledsoe County |          7        0.04        7.08
                          Blount County |          7        0.04        7.11
                      Blue Earth County |          7        0.04        7.15
                           Boise County |          7        0.04        7.19
                         Bolivar County |          7        0.04        7.23
                       Bollinger County |          7        0.04        7.26
                       Bon Homme County |          7        0.04        7.30
                            Bond County |          7        0.04        7.34
                          Bonner County |          7        0.04        7.38
                           Boone County |         43        0.23        7.61
                          Borden County |          7        0.04        7.65
                          Bosque County |          7        0.04        7.68
                         Bossier Parish |          7        0.04        7.72
                       Botetourt County |          7        0.04        7.76
                       Bottineau County |          7        0.04        7.80
                         Boulder County |          7        0.04        7.83
                        Boundary County |          7        0.04        7.87
                         Bourbon County |         14        0.08        7.95
                           Bowie County |          7        0.04        7.99
                          Bowman County |          7        0.04        8.02
                       Box Butte County |          7        0.04        8.06
                       Box Elder County |          7        0.04        8.10
                            Boyd County |         14        0.08        8.17
                           Boyle County |          7        0.04        8.21
                         Bracken County |          7        0.04        8.25
                        Bradford County |         14        0.08        8.32
                         Bradley County |         14        0.08        8.40
                          Branch County |          7        0.04        8.44
                        Brantley County |          7        0.04        8.48
                         Braxton County |          7        0.04        8.51
                       Breathitt County |          7        0.04        8.55
                    Breckinridge County |          7        0.04        8.59
                          Bremer County |          7        0.04        8.63
                        Brewster County |          7        0.04        8.66
                         Briscoe County |          7        0.04        8.70
                    Bristol Bay Borough |          7        0.04        8.74
                         Bristol County |         13        0.07        8.81
                      Broadwater County |          7        0.04        8.85
                          Brooke County |          7        0.04        8.88
                       Brookings County |          7        0.04        8.92
                          Brooks County |         14        0.08        9.00
                          Broome County |          7        0.04        9.03
                      Broomfield County |          7        0.04        9.07
                           Brown County |         56        0.30        9.37
                           Brule County |          7        0.04        9.41
                       Brunswick County |          7        0.04        9.45
                           Bryan County |         14        0.08        9.52
                        Buchanan County |         21        0.11        9.64
                      Buckingham County |          7        0.04        9.67
                     Buena Vista County |          7        0.04        9.71
                         Buffalo County |         21        0.11        9.83
                         Bullitt County |          7        0.04        9.86
                         Bulloch County |          7        0.04        9.90
                         Bullock County |          7        0.04        9.94
                          Bureau County |          7        0.04        9.98
                           Burke County |         21        0.11       10.09
                        Burleigh County |          7        0.04       10.13
                        Burleson County |          7        0.04       10.16
                          Burnet County |          7        0.04       10.20
                         Burnett County |          7        0.04       10.24
                            Burt County |          7        0.04       10.28
                          Butler County |         42        0.23       10.50
                           Butte County |         14        0.08       10.58
                           Butts County |          7        0.04       10.62
                        Cabarrus County |          7        0.04       10.65
                          Cabell County |          7        0.04       10.69
                           Cache County |          7        0.04       10.73
                           Caddo County |          7        0.04       10.77
                       Calaveras County |          7        0.04       10.80
                       Calcasieu Parish |          7        0.04       10.84
                        Caldwell County |         28        0.15       10.99
                        Caldwell Parish |          7        0.04       11.03
                       Caledonia County |          7        0.04       11.07
                         Calhoun County |         70        0.38       11.45
                        Callahan County |          7        0.04       11.48
                        Callaway County |          7        0.04       11.52
                        Calloway County |          7        0.04       11.56
                         Calumet County |          7        0.04       11.60
                         Calvert County |          7        0.04       11.63
                           Camas County |          7        0.04       11.67
                          Camden County |         21        0.11       11.78
                         Cameron County |          7        0.04       11.82
                         Cameron Parish |          7        0.04       11.86
                            Camp County |          7        0.04       11.90
                        Campbell County |         28        0.15       12.05
                         Candler County |          7        0.04       12.09
                          Cannon County |          7        0.04       12.12
                          Canyon County |          7        0.04       12.16
                  Cape Girardeau County |          7        0.04       12.20
                        Cape May County |          7        0.04       12.24
                          Carbon County |         28        0.15       12.39
                         Caribou County |          7        0.04       12.42
                        Carlisle County |          7        0.04       12.46
                         Carlton County |          7        0.04       12.50
                        Caroline County |         14        0.08       12.58
                         Carroll County |         70        0.38       12.95
                            Carson City |          7        0.04       12.99
                          Carson County |          7        0.04       13.03
                          Carter County |         35        0.19       13.22
                        Carteret County |          7        0.04       13.25
                          Carver County |          6        0.03       13.29
                         Cascade County |          7        0.04       13.32
                           Casey County |          7        0.04       13.36
                            Cass County |         56        0.30       13.66
                          Cassia County |          7        0.04       13.70
                          Castro County |          7        0.04       13.74
                         Caswell County |          7        0.04       13.78
                       Catahoula Parish |          7        0.04       13.81
                         Catoosa County |          7        0.04       13.85
                          Catron County |          7        0.04       13.89
                     Cattaraugus County |          7        0.04       13.93
                        Cavalier County |          7        0.04       13.96
                          Cayuga County |          7        0.04       14.00
                           Cedar County |         21        0.11       14.11
                     Cerro Gordo County |          7        0.04       14.15
                         Chaffee County |          7        0.04       14.19
                        Chambers County |         14        0.08       14.26
                       Champaign County |          8        0.04       14.31
                        Chariton County |          7        0.04       14.35
                    Charles City County |          7        0.04       14.38
                     Charles Mix County |          7        0.04       14.42
                      Charleston County |          6        0.03       14.45
                      Charlevoix County |          7        0.04       14.49
                       Charlotte County |          7        0.04       14.53
                        Charlton County |          7        0.04       14.57
                           Chase County |         14        0.08       14.64
                         Chatham County |          7        0.04       14.68
                   Chattahoochee County |          7        0.04       14.72
                       Chattooga County |          7        0.04       14.75
                      Chautauqua County |          7        0.04       14.79
                          Chaves County |          7        0.04       14.83
                        Cheatham County |          7        0.04       14.87
                       Cheboygan County |          7        0.04       14.91
                          Chelan County |          7        0.04       14.94
                         Chemung County |          7        0.04       14.98
                        Chenango County |          7        0.04       15.02
                        Cherokee County |         49        0.26       15.28
                          Cherry County |          7        0.04       15.32
                        Chesapeake city |          1        0.01       15.33
                        Cheshire County |          7        0.04       15.36
                         Chester County |         14        0.08       15.44
                    Chesterfield County |          7        0.04       15.48
                        Cheyenne County |         21        0.11       15.59
                       Chickasaw County |         14        0.08       15.66
                          Chicot County |          7        0.04       15.70
                       Childress County |          7        0.04       15.74
                         Chilton County |          7        0.04       15.78
                        Chippewa County |         21        0.11       15.89
                         Chisago County |          7        0.04       15.93
                      Chittenden County |          6        0.03       15.96
                         Choctaw County |         21        0.11       16.07
                        Chouteau County |          7        0.04       16.11
                          Chowan County |          7        0.04       16.15
                       Christian County |         21        0.11       16.26
                       Churchill County |          7        0.04       16.30
                          Cibola County |          7        0.04       16.34
                        Cimarron County |          7        0.04       16.37
                       Claiborne County |         14        0.08       16.45
                       Claiborne Parish |          7        0.04       16.49
                         Clallam County |          7        0.04       16.52
                           Clare County |          7        0.04       16.56
                       Clarendon County |          7        0.04       16.60
                         Clarion County |          7        0.04       16.64
                           Clark County |         56        0.30       16.94
                          Clarke County |         28        0.15       17.09
                         Clatsop County |          7        0.04       17.13
                            Clay County |        118        0.63       17.76
                         Clayton County |          7        0.04       17.80
                     Clear Creek County |          7        0.04       17.84
                      Clearfield County |          7        0.04       17.88
                      Clearwater County |         14        0.08       17.95
                        Cleburne County |         14        0.08       18.03
                        Clermont County |          7        0.04       18.06
                       Cleveland County |         14        0.08       18.14
                          Clinch County |          7        0.04       18.18
                         Clinton County |         63        0.34       18.52
                           Cloud County |          7        0.04       18.55
                         Coahoma County |          7        0.04       18.59
                            Coal County |          7        0.04       18.63
                         Cochise County |          7        0.04       18.67
                         Cochran County |          7        0.04       18.70
                           Cocke County |          7        0.04       18.74
                       Codington County |          7        0.04       18.78
                          Coffee County |         21        0.11       18.89
                          Coffey County |          7        0.04       18.93
                            Coke County |          7        0.04       18.97
                         Colbert County |          7        0.04       19.01
                            Cole County |          7        0.04       19.04
                         Coleman County |          7        0.04       19.08
                           Coles County |          7        0.04       19.12
                          Colfax County |         14        0.08       19.19
                        Colleton County |          7        0.04       19.23
                   Collingsworth County |          7        0.04       19.27
                        Colorado County |          7        0.04       19.31
                        Colquitt County |          7        0.04       19.34
                        Columbia County |         49        0.26       19.61
                      Columbiana County |          1        0.01       19.61
                        Columbus County |          7        0.04       19.65
                          Colusa County |          7        0.04       19.69
                        Comanche County |         21        0.11       19.80
                          Concho County |          7        0.04       19.84
                       Concordia Parish |          7        0.04       19.88
                         Conecuh County |          7        0.04       19.91
                         Conejos County |          7        0.04       19.95
                        Converse County |          7        0.04       19.99
                          Conway County |          7        0.04       20.03
                            Cook County |         14        0.08       20.10
                           Cooke County |          7        0.04       20.14
                          Cooper County |          7        0.04       20.18
                            Coos County |         14        0.08       20.25
                           Coosa County |          7        0.04       20.29
                          Copiah County |          7        0.04       20.33
                          Corson County |          7        0.04       20.37
                        Cortland County |          7        0.04       20.40
                         Coryell County |          7        0.04       20.44
                       Coshocton County |          7        0.04       20.48
                        Costilla County |          7        0.04       20.52
                          Cottle County |          7        0.04       20.56
                          Cotton County |          7        0.04       20.59
                      Cottonwood County |          7        0.04       20.63
                       Covington County |         14        0.08       20.71
                          Cowley County |          7        0.04       20.74
                         Cowlitz County |          7        0.04       20.78
                           Craig County |         14        0.08       20.86
                       Craighead County |          7        0.04       20.89
                           Crane County |          7        0.04       20.93
                          Craven County |          1        0.01       20.94
                        Crawford County |         77        0.41       21.35
                           Creek County |          7        0.04       21.39
                        Crenshaw County |          7        0.04       21.43
                           Crisp County |          7        0.04       21.46
                      Crittenden County |         14        0.08       21.54
                        Crockett County |         14        0.08       21.62
                           Crook County |         14        0.08       21.69
                          Crosby County |          7        0.04       21.73
                           Cross County |          7        0.04       21.77
                       Crow Wing County |          7        0.04       21.80
                         Crowley County |          7        0.04       21.84
                       Culberson County |          7        0.04       21.88
                         Cullman County |          7        0.04       21.92
                        Culpeper County |          7        0.04       21.95
                      Cumberland County |         49        0.26       22.22
                          Cuming County |          7        0.04       22.26
                       Currituck County |          7        0.04       22.29
                           Curry County |         14        0.08       22.37
                          Custer County |         42        0.23       22.59
                            Dade County |         14        0.08       22.67
                         Daggett County |          7        0.04       22.71
                          Dakota County |          7        0.04       22.75
                            Dale County |          7        0.04       22.78
                          Dallam County |          7        0.04       22.82
                          Dallas County |         28        0.15       22.97
                         Daniels County |          7        0.04       23.01
                            Dare County |          7        0.04       23.05
                           Darke County |          7        0.04       23.08
                      Darlington County |          7        0.04       23.12
                           Davie County |          7        0.04       23.16
                         Daviess County |         20        0.11       23.27
                           Davis County |          7        0.04       23.30
                         Davison County |          7        0.04       23.34
                           Dawes County |          7        0.04       23.38
                          Dawson County |         28        0.15       23.53
                             Day County |          7        0.04       23.57
                         De Baca County |          7        0.04       23.61
                         De Soto Parish |          7        0.04       23.64
                         De Witt County |          7        0.04       23.68
                          DeKalb County |         35        0.19       23.87
                          DeSoto County |          7        0.04       23.91
                          DeWitt County |          7        0.04       23.95
                      Deaf Smith County |          7        0.04       23.98
                        Dearborn County |          7        0.04       24.02
                         Decatur County |         35        0.19       24.21
                      Deer Lodge County |          7        0.04       24.25
                        Defiance County |          7        0.04       24.28
                       Del Norte County |          7        0.04       24.32
                        Delaware County |         21        0.11       24.43
                           Delta County |         21        0.11       24.55
                         Denali Borough |          7        0.04       24.59
                            Dent County |          7        0.04       24.62
                          Denver County |          7        0.04       24.66
                      Des Moines County |          7        0.04       24.70
                       Deschutes County |          1        0.01       24.70
                           Desha County |          7        0.04       24.74
                           Deuel County |         14        0.08       24.82
                           Dewey County |         14        0.08       24.89
                         Dickens County |          7        0.04       24.93
                       Dickenson County |          7        0.04       24.97
                          Dickey County |          7        0.04       25.01
                       Dickinson County |         21        0.11       25.12
                         Dickson County |          7        0.04       25.16
                 Dillingham Census Area |          7        0.04       25.19
                          Dillon County |          7        0.04       25.23
                          Dimmit County |          7        0.04       25.27
                          Divide County |          7        0.04       25.31
                           Dixie County |          7        0.04       25.34
                           Dixon County |          7        0.04       25.38
                       Doddridge County |          7        0.04       25.42
                           Dodge County |         28        0.15       25.57
                         Dolores County |          7        0.04       25.61
                        Doniphan County |          7        0.04       25.65
                          Donley County |          7        0.04       25.68
                           Dooly County |          7        0.04       25.72
                            Door County |          7        0.04       25.76
                      Dorchester County |         13        0.07       25.83
                       Dougherty County |          7        0.04       25.87
                         Douglas County |         56        0.30       26.17
                            Drew County |          7        0.04       26.21
                          Dubois County |          7        0.04       26.24
                         Dubuque County |          7        0.04       26.28
                        Duchesne County |          7        0.04       26.32
                           Dukes County |          7        0.04       26.36
                           Dundy County |          7        0.04       26.39
                         Dunklin County |          7        0.04       26.43
                            Dunn County |         14        0.08       26.51
                          Duplin County |          7        0.04       26.54
                        Dutchess County |          1        0.01       26.55
                           Duval County |          7        0.04       26.59
                            Dyer County |          7        0.04       26.63
                           Eagle County |          7        0.04       26.66
                           Early County |          7        0.04       26.70
                    East Carroll Parish |          7        0.04       26.74
                  East Feliciana Parish |          7        0.04       26.78
                        Eastland County |          7        0.04       26.81
                           Eaton County |          7        0.04       26.85
                      Eau Claire County |          7        0.04       26.89
                          Echols County |          7        0.04       26.93
                            Eddy County |         14        0.08       27.00
                           Edgar County |          7        0.04       27.04
                       Edgecombe County |          7        0.04       27.08
                       Edgefield County |          7        0.04       27.11
                        Edmonson County |          7        0.04       27.15
                         Edmunds County |          7        0.04       27.19
                         Edwards County |         21        0.11       27.30
                       Effingham County |         14        0.08       27.38
                         El Paso County |          7        0.04       27.42
                          Elbert County |         14        0.08       27.49
                             Elk County |         14        0.08       27.57
                            Elko County |          7        0.04       27.60
                         Elliott County |          7        0.04       27.64
                           Ellis County |         14        0.08       27.72
                       Ellsworth County |          7        0.04       27.76
                          Elmore County |         14        0.08       27.83
                         Emanuel County |          7        0.04       27.87
                           Emery County |          7        0.04       27.91
                           Emmet County |         14        0.08       27.98
                          Emmons County |          7        0.04       28.02
                           Erath County |          7        0.04       28.06
                            Erie County |          7        0.04       28.09
                        Escambia County |          7        0.04       28.13
                       Esmeralda County |          7        0.04       28.17
                           Essex County |         27        0.15       28.31
                          Estill County |          7        0.04       28.35
                          Etowah County |          1        0.01       28.36
                          Eureka County |          7        0.04       28.40
                      Evangeline Parish |          7        0.04       28.43
                           Evans County |          7        0.04       28.47
           Fairbanks North Star Borough |          7        0.04       28.51
                       Fairfield County |          7        0.04       28.55
                      Fall River County |          7        0.04       28.58
                          Fallon County |          7        0.04       28.62
                           Falls County |          7        0.04       28.66
                          Fannin County |         14        0.08       28.73
                       Faribault County |          7        0.04       28.77
                           Faulk County |          7        0.04       28.81
                        Faulkner County |          7        0.04       28.85
                        Fauquier County |          7        0.04       28.89
                         Fayette County |         56        0.30       29.19
                        Fentress County |          7        0.04       29.22
                          Fergus County |          7        0.04       29.26
                           Ferry County |          7        0.04       29.30
                        Fillmore County |         14        0.08       29.37
                          Finney County |          7        0.04       29.41
                          Fisher County |          7        0.04       29.45
                         Flagler County |          6        0.03       29.48
                        Flathead County |          7        0.04       29.52
                         Fleming County |          7        0.04       29.56
                        Florence County |         13        0.07       29.63
                           Floyd County |         42        0.23       29.85
                        Fluvanna County |          7        0.04       29.89
                           Foard County |          7        0.04       29.93
                     Fond du Lac County |          7        0.04       29.97
                            Ford County |         14        0.08       30.04
                          Forest County |         14        0.08       30.12
                         Forrest County |          7        0.04       30.15
                          Foster County |          7        0.04       30.19
                        Fountain County |          7        0.04       30.23
                        Franklin County |        155        0.83       31.06
                        Franklin Parish |          7        0.04       31.10
                        Freeborn County |          7        0.04       31.14
                       Freestone County |          7        0.04       31.18
                         Fremont County |         28        0.15       31.33
                            Frio County |          7        0.04       31.37
                        Frontier County |          7        0.04       31.40
                          Fulton County |         55        0.30       31.70
                          Furnas County |          7        0.04       31.74
                         Gadsden County |          7        0.04       31.77
                            Gage County |          7        0.04       31.81
                          Gaines County |          7        0.04       31.85
                        Gallatin County |         20        0.11       31.96
                          Gallia County |          7        0.04       32.00
                          Garden County |          7        0.04       32.03
                        Garfield County |         42        0.23       32.26
                         Garland County |          7        0.04       32.30
                         Garrard County |          7        0.04       32.33
                         Garrett County |          7        0.04       32.37
                          Garvin County |          7        0.04       32.41
                           Garza County |          7        0.04       32.45
                       Gasconade County |          7        0.04       32.48
                           Gates County |          7        0.04       32.52
                           Geary County |          7        0.04       32.56
                          Geauga County |          7        0.04       32.60
                             Gem County |          7        0.04       32.64
                         Genesee County |         14        0.08       32.71
                          Geneva County |          7        0.04       32.75
                          Gentry County |          7        0.04       32.79
                          George County |          7        0.04       32.82
                      Georgetown County |          7        0.04       32.86
                          Gibson County |         14        0.08       32.94
                            Gila County |          7        0.04       32.97
                       Gilchrist County |          7        0.04       33.01
                           Giles County |         14        0.08       33.09
                       Gillespie County |          7        0.04       33.13
                         Gilliam County |          7        0.04       33.16
                          Gilmer County |         14        0.08       33.24
                          Gilpin County |          7        0.04       33.28
                         Glacier County |          7        0.04       33.31
                          Glades County |          7        0.04       33.35
                         Gladwin County |          7        0.04       33.39
                        Glascock County |          7        0.04       33.43
                       Glasscock County |          7        0.04       33.46
                           Glenn County |          7        0.04       33.50
                      Gloucester County |          7        0.04       33.54
                           Glynn County |          7        0.04       33.58
                         Gogebic County |          7        0.04       33.61
                   Golden Valley County |         14        0.08       33.69
                          Goliad County |          7        0.04       33.73
                        Gonzales County |          7        0.04       33.77
                       Goochland County |          7        0.04       33.80
                         Goodhue County |          7        0.04       33.84
                         Gooding County |          7        0.04       33.88
                          Gordon County |          7        0.04       33.92
                          Goshen County |          7        0.04       33.95
                          Gosper County |          7        0.04       33.99
                            Gove County |          7        0.04       34.03
                           Grady County |         14        0.08       34.10
                         Grafton County |          7        0.04       34.14
                          Graham County |         21        0.11       34.26
                        Grainger County |          7        0.04       34.29
                           Grand County |         14        0.08       34.37
                     Grand Forks County |          7        0.04       34.41
                      Grand Isle County |          7        0.04       34.44
                  Grand Traverse County |          7        0.04       34.48
                         Granite County |          7        0.04       34.52
                           Grant County |         98        0.53       35.05
                           Grant Parish |          7        0.04       35.08
                       Granville County |          7        0.04       35.12
                         Gratiot County |          7        0.04       35.16
                          Graves County |          7        0.04       35.20
                            Gray County |         14        0.08       35.27
                    Grays Harbor County |          7        0.04       35.31
                         Grayson County |         21        0.11       35.42
                         Greeley County |         14        0.08       35.50
                           Green County |         14        0.08       35.57
                      Green Lake County |          7        0.04       35.61
                      Greenbrier County |          7        0.04       35.65
                          Greene County |         91        0.49       36.14
                        Greenlee County |          7        0.04       36.18
                         Greenup County |          7        0.04       36.21
                      Greenville County |          6        0.03       36.25
                       Greenwood County |         14        0.08       36.32
                           Greer County |          7        0.04       36.36
                         Gregory County |          7        0.04       36.40
                         Grenada County |          7        0.04       36.43
                          Griggs County |          7        0.04       36.47
                          Grimes County |          7        0.04       36.51
                          Grundy County |         28        0.15       36.66
                       Guadalupe County |          7        0.04       36.70
                        Guernsey County |          7        0.04       36.74
                            Gulf County |          7        0.04       36.77
                        Gunnison County |          7        0.04       36.81
                         Guthrie County |          7        0.04       36.85
                          Haakon County |          7        0.04       36.89
                       Habersham County |          7        0.04       36.92
                         Haines Borough |          7        0.04       36.96
                            Hale County |         14        0.08       37.04
                         Halifax County |         14        0.08       37.11
                            Hall County |         14        0.08       37.19
                         Hamblen County |          7        0.04       37.23
                        Hamilton County |         56        0.30       37.53
                          Hamlin County |          7        0.04       37.56
                         Hampden County |          6        0.03       37.60
                       Hampshire County |         14        0.08       37.67
                         Hampton County |          7        0.04       37.71
                         Hancock County |         70        0.38       38.09
                            Hand County |          7        0.04       38.12
                         Hanover County |          7        0.04       38.16
                        Hansford County |          7        0.04       38.20
                          Hanson County |          7        0.04       38.24
                        Haralson County |          7        0.04       38.27
                          Hardee County |          7        0.04       38.31
                        Hardeman County |         14        0.08       38.39
                          Hardin County |         41        0.22       38.61
                         Harding County |         14        0.08       38.68
                           Hardy County |          7        0.04       38.72
                          Harlan County |         14        0.08       38.80
                          Harmon County |          7        0.04       38.83
                          Harney County |          7        0.04       38.87
                          Harper County |         14        0.08       38.95
                          Harris County |          7        0.04       38.99
                        Harrison County |         49        0.26       39.25
                            Hart County |         14        0.08       39.32
                         Hartley County |          7        0.04       39.36
                          Harvey County |          7        0.04       39.40
                         Haskell County |         21        0.11       39.51
                         Hawkins County |          7        0.04       39.55
                           Hayes County |          7        0.04       39.59
                         Haywood County |         14        0.08       39.66
                           Heard County |          7        0.04       39.70
                        Hemphill County |          7        0.04       39.74
                       Hempstead County |          7        0.04       39.78
                       Henderson County |         35        0.19       39.96
                          Hendry County |          7        0.04       40.00
                           Henry County |         56        0.30       40.30
                        Herkimer County |          7        0.04       40.34
                        Hertford County |          7        0.04       40.38
                       Hettinger County |          7        0.04       40.42
                         Hickman County |         14        0.08       40.49
                         Hickory County |          7        0.04       40.53
                         Hidalgo County |          7        0.04       40.57
                        Highland County |         14        0.08       40.64
                       Highlands County |          7        0.04       40.68
                            Hill County |         14        0.08       40.76
                    Hillsborough County |          7        0.04       40.79
                       Hillsdale County |          7        0.04       40.83
                           Hinds County |          7        0.04       40.87
                        Hinsdale County |          7        0.04       40.91
                       Hitchcock County |          7        0.04       40.94
                         Hocking County |          7        0.04       40.98
                         Hockley County |          7        0.04       41.02
                        Hodgeman County |          7        0.04       41.06
                            Hoke County |          7        0.04       41.09
                          Holmes County |         21        0.11       41.21
                            Holt County |         14        0.08       41.28
                            Hood County |          7        0.04       41.32
                      Hood River County |          7        0.04       41.36
                          Hooker County |          7        0.04       41.40
              Hoonah-Angoon Census Area |          7        0.04       41.43
                         Hopkins County |         14        0.08       41.51
                           Horry County |          1        0.01       41.51
                      Hot Spring County |          7        0.04       41.55
                     Hot Springs County |          7        0.04       41.59
                        Houghton County |          7        0.04       41.63
                         Houston County |         35        0.19       41.82
                          Howard County |         42        0.23       42.04
                          Howell County |          7        0.04       42.08
                         Hubbard County |          7        0.04       42.12
                        Hudspeth County |          7        0.04       42.15
                        Huerfano County |          7        0.04       42.19
                          Hughes County |         14        0.08       42.27
                        Humboldt County |         14        0.08       42.34
                       Humphreys County |         14        0.08       42.42
                            Hunt County |          7        0.04       42.46
                      Huntingdon County |          7        0.04       42.49
                      Huntington County |          7        0.04       42.53
                           Huron County |         14        0.08       42.61
                      Hutchinson County |         14        0.08       42.68
                            Hyde County |         14        0.08       42.76
                          Iberia Parish |          7        0.04       42.79
                       Iberville Parish |          7        0.04       42.83
                             Ida County |          7        0.04       42.87
                           Idaho County |          7        0.04       42.91
                    Independence County |          7        0.04       42.95
                         Indiana County |          7        0.04       42.98
                            Inyo County |          7        0.04       43.02
                           Ionia County |          7        0.04       43.06
                           Iosco County |          7        0.04       43.10
                            Iowa County |         14        0.08       43.17
                         Iredell County |          7        0.04       43.21
                           Irion County |          7        0.04       43.25
                            Iron County |         28        0.15       43.40
                        Iroquois County |          7        0.04       43.44
                           Irwin County |          7        0.04       43.47
                        Isabella County |          7        0.04       43.51
                          Isanti County |          7        0.04       43.55
                          Island County |          7        0.04       43.59
                   Isle of Wight County |          7        0.04       43.62
                       Issaquena County |          7        0.04       43.66
                          Itasca County |          7        0.04       43.70
                        Itawamba County |          7        0.04       43.74
                           Izard County |          7        0.04       43.77
                            Jack County |          7        0.04       43.81
                         Jackson County |        133        0.72       44.53
                         Jackson Parish |          7        0.04       44.57
                          Jasper County |         56        0.30       44.87
                             Jay County |          7        0.04       44.90
                      Jeff Davis County |         14        0.08       44.98
                       Jefferson County |        148        0.80       45.78
                 Jefferson Davis County |          7        0.04       45.81
                 Jefferson Davis Parish |          7        0.04       45.85
                       Jefferson Parish |          7        0.04       45.89
                         Jenkins County |          7        0.04       45.93
                        Jennings County |          7        0.04       45.96
                         Jerauld County |          7        0.04       46.00
                          Jerome County |          7        0.04       46.04
                          Jersey County |          7        0.04       46.08
                       Jessamine County |          7        0.04       46.11
                          Jewell County |          7        0.04       46.15
                        Jim Hogg County |          7        0.04       46.19
                       Jim Wells County |          7        0.04       46.23
                      Jo Daviess County |          7        0.04       46.27
                         Johnson County |         56        0.30       46.57
                        Johnston County |          8        0.04       46.61
                           Jones County |         42        0.23       46.84
                       Josephine County |          7        0.04       46.87
                            Juab County |          7        0.04       46.91
                    Judith Basin County |          7        0.04       46.95
                Juneau City and Borough |          7        0.04       46.99
                          Juneau County |          7        0.04       47.02
                         Juniata County |          7        0.04       47.06
                        Kalkaska County |          7        0.04       47.10
                         Kanabec County |          7        0.04       47.14
                         Kanawha County |          6        0.03       47.17
                       Kandiyohi County |          7        0.04       47.21
                            Kane County |          7        0.04       47.24
                        Kankakee County |          1        0.01       47.25
                          Karnes County |          7        0.04       47.29
                           Kauai County |          7        0.04       47.33
                             Kay County |          7        0.04       47.36
                         Kearney County |          7        0.04       47.40
                          Kearny County |          7        0.04       47.44
                           Keith County |          7        0.04       47.48
                          Kemper County |          7        0.04       47.51
                Kenai Peninsula Borough |          7        0.04       47.55
                         Kendall County |         13        0.07       47.62
                          Kenedy County |          7        0.04       47.66
                            Kent County |         14        0.08       47.73
                          Keokuk County |          7        0.04       47.77
                            Kerr County |          7        0.04       47.81
                         Kershaw County |          7        0.04       47.85
              Ketchikan Gateway Borough |          7        0.04       47.89
                        Kewaunee County |          7        0.04       47.92
                        Keweenaw County |          7        0.04       47.96
                       Keya Paha County |          7        0.04       48.00
                          Kidder County |          7        0.04       48.04
                         Kimball County |          7        0.04       48.07
                          Kimble County |          7        0.04       48.11
                            King County |          7        0.04       48.15
                     King George County |          7        0.04       48.19
                    King William County |          7        0.04       48.22
                  King and Queen County |          7        0.04       48.26
                      Kingfisher County |          7        0.04       48.30
                         Kingman County |          7        0.04       48.34
                       Kingsbury County |          7        0.04       48.37
                          Kinney County |          7        0.04       48.41
                           Kiowa County |         21        0.11       48.53
                      Kit Carson County |          7        0.04       48.56
                        Kittitas County |          7        0.04       48.60
                         Kittson County |          7        0.04       48.64
                         Klamath County |          7        0.04       48.68
                         Kleberg County |          7        0.04       48.71
                       Klickitat County |          7        0.04       48.75
                           Knott County |          7        0.04       48.79
                            Knox County |         62        0.33       49.12
                  Kodiak Island Borough |          7        0.04       49.16
                     Koochiching County |          7        0.04       49.20
                        Kootenai County |          7        0.04       49.24
                       Kosciusko County |          7        0.04       49.27
                         Kossuth County |          7        0.04       49.31
                   Kusilvak Census Area |          7        0.04       49.35
                          La Paz County |          7        0.04       49.39
                        La Plata County |          7        0.04       49.42
                        La Salle County |          7        0.04       49.46
                        LaGrange County |          7        0.04       49.50
                         LaMoure County |          7        0.04       49.54
                         LaSalle County |          1        0.01       49.54
                         LaSalle Parish |          7        0.04       49.58
                         Labette County |          7        0.04       49.62
                   Lac qui Parle County |          7        0.04       49.66
                      Lackawanna County |          7        0.04       49.69
                         Laclede County |          7        0.04       49.73
                       Lafayette County |         35        0.19       49.92
                       Lafourche Parish |          7        0.04       49.96
                            Lake County |         68        0.37       50.32
             Lake and Peninsula Borough |          7        0.04       50.36
               Lake of the Woods County |          7        0.04       50.40
                           Lamar County |         28        0.15       50.55
                            Lamb County |          7        0.04       50.59
                        Lamoille County |          7        0.04       50.62
                        Lampasas County |          7        0.04       50.66
                       Lancaster County |         14        0.08       50.74
                          Lander County |          7        0.04       50.77
                            Lane County |          7        0.04       50.81
                        Langlade County |          7        0.04       50.85
                          Lanier County |          7        0.04       50.89
                          Lapeer County |          7        0.04       50.93
                         Laramie County |          6        0.03       50.96
                           Larue County |          7        0.04       51.00
                      Las Animas County |          7        0.04       51.03
                          Lassen County |          7        0.04       51.07
                           Latah County |          7        0.04       51.11
                         Latimer County |          7        0.04       51.15
                      Lauderdale County |         21        0.11       51.26
                          Laurel County |          7        0.04       51.30
                         Laurens County |         14        0.08       51.37
                          Lavaca County |          7        0.04       51.41
                        Lawrence County |         77        0.41       51.82
                        Le Flore County |          7        0.04       51.86
                        Le Sueur County |          7        0.04       51.90
                             Lea County |          7        0.04       51.94
                           Leake County |          7        0.04       51.97
                     Leavenworth County |          7        0.04       52.01
                             Lee County |         71        0.38       52.39
                        Leelanau County |          7        0.04       52.43
                         Leflore County |          7        0.04       52.47
                          Lehigh County |          7        0.04       52.51
                           Lemhi County |          7        0.04       52.55
                         Lenawee County |          7        0.04       52.58
                          Lenoir County |          7        0.04       52.62
                            Leon County |          7        0.04       52.66
                          Leslie County |          7        0.04       52.70
                         Letcher County |          7        0.04       52.73
                            Levy County |          7        0.04       52.77
                           Lewis County |         49        0.26       53.03
                 Lewis and Clark County |          7        0.04       53.07
                       Lexington County |          6        0.03       53.10
                         Liberty County |         28        0.15       53.26
                       Limestone County |         13        0.07       53.33
                         Lincoln County |        161        0.87       54.19
                         Lincoln Parish |          7        0.04       54.23
                            Linn County |         21        0.11       54.34
                        Lipscomb County |          7        0.04       54.38
                    Little River County |          7        0.04       54.42
                        Live Oak County |          7        0.04       54.46
                      Livingston County |         28        0.15       54.61
                      Livingston Parish |          7        0.04       54.64
                           Llano County |          7        0.04       54.68
                           Logan County |         70        0.38       55.06
                            Long County |          7        0.04       55.10
                          Lonoke County |          7        0.04       55.13
                      Los Alamos County |          7        0.04       55.17
                          Loudon County |          7        0.04       55.21
                          Louisa County |         14        0.08       55.28
                            Loup County |          7        0.04       55.32
                            Love County |          7        0.04       55.36
                         Lowndes County |         14        0.08       55.43
                           Lucas County |         14        0.08       55.51
                            Luce County |          7        0.04       55.55
                         Lumpkin County |          7        0.04       55.59
                            Luna County |          7        0.04       55.62
                       Lunenburg County |          7        0.04       55.66
                         Luzerne County |          7        0.04       55.70
                        Lycoming County |          7        0.04       55.74
                           Lyman County |          7        0.04       55.77
                            Lynn County |          7        0.04       55.81
                            Lyon County |         35        0.19       56.00
                        Mackinac County |          7        0.04       56.04
                           Macon County |         36        0.19       56.23
                        Macoupin County |          7        0.04       56.27
                         Madison County |        119        0.64       56.91
                         Madison Parish |          7        0.04       56.95
                        Magoffin County |          7        0.04       56.98
                         Mahaska County |          7        0.04       57.02
                        Mahnomen County |          7        0.04       57.06
                        Mahoning County |          7        0.04       57.10
                           Major County |          7        0.04       57.14
                         Malheur County |          7        0.04       57.17
                        Manistee County |          7        0.04       57.21
                       Manitowoc County |          7        0.04       57.25
                         Marengo County |          7        0.04       57.29
                          Maries County |          7        0.04       57.32
                       Marinette County |          7        0.04       57.36
                          Marion County |         98        0.53       57.89
                        Mariposa County |          7        0.04       57.93
                        Marlboro County |          7        0.04       57.96
                       Marquette County |         14        0.08       58.04
                        Marshall County |         84        0.45       58.49
                          Martin County |         35        0.19       58.68
                           Mason County |         42        0.23       58.91
                          Massac County |          7        0.04       58.94
                       Matagorda County |          7        0.04       58.98
              Matanuska-Susitna Borough |          7        0.04       59.02
                         Mathews County |          7        0.04       59.06
                           Maury County |          6        0.03       59.09
                        Maverick County |          7        0.04       59.13
                           Mayes County |          7        0.04       59.16
                         McClain County |          7        0.04       59.20
                          McCone County |          7        0.04       59.24
                          McCook County |          7        0.04       59.28
                       McCormick County |          7        0.04       59.31
                       McCracken County |          7        0.04       59.35
                        McCreary County |          7        0.04       59.39
                       McCulloch County |          7        0.04       59.43
                       McCurtain County |          7        0.04       59.47
                        McDonald County |          7        0.04       59.50
                       McDonough County |          7        0.04       59.54
                        McDowell County |         14        0.08       59.62
                        McDuffie County |          7        0.04       59.65
                         McHenry County |          7        0.04       59.69
                        McIntosh County |         21        0.11       59.80
                          McKean County |          7        0.04       59.84
                        McKenzie County |          7        0.04       59.88
                        McKinley County |          7        0.04       59.92
                          McLean County |         14        0.08       59.99
                          McLeod County |          7        0.04       60.03
                          McMinn County |          7        0.04       60.07
                        McMullen County |          7        0.04       60.11
                         McNairy County |          7        0.04       60.14
                       McPherson County |         21        0.11       60.26
                           Meade County |         21        0.11       60.37
                         Meagher County |          7        0.04       60.41
                     Mecklenburg County |          7        0.04       60.44
                         Mecosta County |          7        0.04       60.48
                          Medina County |          7        0.04       60.52
                          Meeker County |          7        0.04       60.56
                           Meigs County |         14        0.08       60.63
                        Mellette County |          7        0.04       60.67
                          Menard County |         14        0.08       60.75
                       Mendocino County |          7        0.04       60.78
                         Menifee County |          7        0.04       60.82
                       Menominee County |         14        0.08       60.90
                          Mercer County |         42        0.23       61.12
                      Meriwether County |          7        0.04       61.16
                         Merrick County |          7        0.04       61.20
                       Merrimack County |          7        0.04       61.24
                            Mesa County |          7        0.04       61.27
                        Metcalfe County |          7        0.04       61.31
                           Miami County |         14        0.08       61.39
                      Miami-Dade County |          7        0.04       61.42
                       Middlesex County |         13        0.07       61.49
                         Midland County |          7        0.04       61.53
                         Mifflin County |          7        0.04       61.57
                           Milam County |          7        0.04       61.61
                         Millard County |          7        0.04       61.64
                      Mille Lacs County |          7        0.04       61.68
                          Miller County |         21        0.11       61.80
                           Mills County |         14        0.08       61.87
                           Miner County |          7        0.04       61.91
                         Mineral County |         28        0.15       62.06
                           Mingo County |          7        0.04       62.10
                        Minidoka County |          7        0.04       62.13
                       Minnehaha County |          7        0.04       62.17
                       Missaukee County |          7        0.04       62.21
                     Mississippi County |         14        0.08       62.28
                        Missoula County |          7        0.04       62.32
                        Mitchell County |         35        0.19       62.51
                           Modoc County |          7        0.04       62.55
                          Moffat County |          7        0.04       62.59
                          Mohave County |          6        0.03       62.62
                        Moniteau County |          7        0.04       62.66
                            Mono County |          7        0.04       62.69
                          Monona County |          7        0.04       62.73
                      Monongalia County |          7        0.04       62.77
                          Monroe County |         91        0.49       63.26
                        Montague County |          7        0.04       63.30
                        Montcalm County |          7        0.04       63.33
                        Monterey County |          7        0.04       63.37
                       Montezuma County |          7        0.04       63.41
                      Montgomery County |         90        0.48       63.89
                     Montmorency County |          7        0.04       63.93
                         Montour County |          7        0.04       63.97
                        Montrose County |          7        0.04       64.01
                           Moody County |          7        0.04       64.04
                           Moore County |         21        0.11       64.16
                            Mora County |          7        0.04       64.20
                       Morehouse Parish |          7        0.04       64.23
                          Morgan County |         77        0.41       64.65
                         Morrill County |          7        0.04       64.68
                          Morris County |         14        0.08       64.76
                        Morrison County |          7        0.04       64.80
                          Morrow County |         14        0.08       64.87
                          Morton County |         14        0.08       64.95
                          Motley County |          7        0.04       64.99
                        Moultrie County |          7        0.04       65.02
                       Mountrail County |          7        0.04       65.06
                           Mower County |          7        0.04       65.10
                      Muhlenberg County |          7        0.04       65.14
                          Murray County |         21        0.11       65.25
                       Muscatine County |          7        0.04       65.29
                        Muscogee County |          7        0.04       65.33
                       Muskingum County |          7        0.04       65.36
                        Muskogee County |          7        0.04       65.40
                     Musselshell County |          7        0.04       65.44
                     Nacogdoches County |          7        0.04       65.48
                           Nance County |          7        0.04       65.51
                       Nantucket County |          7        0.04       65.55
                            Nash County |          7        0.04       65.59
                          Nassau County |          7        0.04       65.63
                    Natchitoches Parish |          7        0.04       65.66
                         Natrona County |          7        0.04       65.70
                          Navajo County |          7        0.04       65.74
                         Navarro County |          7        0.04       65.78
                          Nelson County |         21        0.11       65.89
                          Nemaha County |         14        0.08       65.97
                          Neosho County |          7        0.04       66.00
                         Neshoba County |          7        0.04       66.04
                            Ness County |          7        0.04       66.08
                          Nevada County |         14        0.08       66.15
                     New Hanover County |          7        0.04       66.19
                        New Kent County |          7        0.04       66.23
                      New Madrid County |          7        0.04       66.27
                         Newaygo County |          7        0.04       66.30
                        Newberry County |          7        0.04       66.34
                         Newport County |          7        0.04       66.38
                          Newton County |         42        0.23       66.61
                       Nez Perce County |          7        0.04       66.64
                        Nicholas County |         14        0.08       66.72
                        Nicollet County |          7        0.04       66.76
                        Niobrara County |          7        0.04       66.79
                           Noble County |         21        0.11       66.91
                          Nobles County |          7        0.04       66.94
                         Nodaway County |          7        0.04       66.98
                           Nolan County |          7        0.04       67.02
                       Nome Census Area |          7        0.04       67.06
                         Norfolk County |          6        0.03       67.09
                           Norfolk city |          6        0.03       67.12
                          Norman County |          7        0.04       67.16
                    North Slope Borough |          7        0.04       67.20
                     Northampton County |         21        0.11       67.31
                  Northumberland County |         14        0.08       67.39
               Northwest Arctic Borough |          7        0.04       67.42
                          Norton County |          7        0.04       67.46
                        Nottoway County |          7        0.04       67.50
                          Nowata County |          7        0.04       67.54
                         Noxubee County |          7        0.04       67.57
                        Nuckolls County |          7        0.04       67.61
                             Nye County |          7        0.04       67.65
                         O'Brien County |          7        0.04       67.69
                           Obion County |          7        0.04       67.72
                          Oceana County |          7        0.04       67.76
                       Ochiltree County |          7        0.04       67.80
                          Oconee County |         14        0.08       67.88
                          Oconto County |          7        0.04       67.91
                          Ogemaw County |          7        0.04       67.95
                   Oglala Lakota County |          7        0.04       67.99
                            Ogle County |          7        0.04       68.03
                      Oglethorpe County |          7        0.04       68.06
                            Ohio County |         21        0.11       68.18
                        Okanogan County |          7        0.04       68.21
                      Okeechobee County |          7        0.04       68.25
                        Okfuskee County |          7        0.04       68.29
                        Okmulgee County |          7        0.04       68.33
                       Oktibbeha County |          7        0.04       68.37
                          Oldham County |         14        0.08       68.44
                          Oliver County |          7        0.04       68.48
                          Oneida County |         21        0.11       68.59
                        Onondaga County |          7        0.04       68.63
                          Onslow County |          7        0.04       68.67
                         Ontario County |          7        0.04       68.70
                       Ontonagon County |          7        0.04       68.74
                          Orange County |         28        0.15       68.89
                      Orangeburg County |          7        0.04       68.93
                          Oregon County |          7        0.04       68.97
                         Orleans County |         14        0.08       69.04
                           Osage County |         21        0.11       69.16
                         Osborne County |          7        0.04       69.19
                         Osceola County |         14        0.08       69.27
                          Oscoda County |          7        0.04       69.31
                           Otero County |         14        0.08       69.38
                            Otoe County |          7        0.04       69.42
                          Otsego County |         14        0.08       69.50
                          Ottawa County |         21        0.11       69.61
                      Otter Tail County |          7        0.04       69.65
                        Ouachita County |          7        0.04       69.68
                           Ouray County |          7        0.04       69.72
                         Overton County |          7        0.04       69.76
                            Owen County |         14        0.08       69.83
                          Owsley County |          7        0.04       69.87
                          Owyhee County |          7        0.04       69.91
                          Oxford County |          7        0.04       69.95
                           Ozark County |          7        0.04       69.98
                         Ozaukee County |          7        0.04       70.02
                         Pacific County |          7        0.04       70.06
                            Page County |         14        0.08       70.14
                       Palo Alto County |          7        0.04       70.17
                      Palo Pinto County |          7        0.04       70.21
                         Pamlico County |          7        0.04       70.25
                          Panola County |         14        0.08       70.32
                            Park County |         21        0.11       70.44
                           Parke County |          7        0.04       70.47
                          Parmer County |          7        0.04       70.51
                      Pasquotank County |          7        0.04       70.55
                         Patrick County |          7        0.04       70.59
                        Paulding County |          7        0.04       70.63
                          Pawnee County |         21        0.11       70.74
                         Payette County |          7        0.04       70.78
                           Payne County |          7        0.04       70.81
                           Peach County |          7        0.04       70.85
                     Pearl River County |          7        0.04       70.89
                           Pecos County |          7        0.04       70.93
                         Pembina County |          7        0.04       70.96
                        Pemiscot County |          7        0.04       71.00
                    Pend Oreille County |          7        0.04       71.04
                          Pender County |          7        0.04       71.08
                       Pendleton County |         14        0.08       71.15
                      Pennington County |         14        0.08       71.23
                       Penobscot County |          1        0.01       71.23
                           Pepin County |          7        0.04       71.27
                         Perkins County |         14        0.08       71.35
                      Perquimans County |          7        0.04       71.38
                           Perry County |         70        0.38       71.76
                        Pershing County |          7        0.04       71.80
                          Person County |          7        0.04       71.84
                     Petersburg Borough |          7        0.04       71.87
                       Petroleum County |          7        0.04       71.91
                          Pettis County |          7        0.04       71.95
                          Phelps County |         14        0.08       72.02
                        Phillips County |         28        0.15       72.17
                           Piatt County |          7        0.04       72.21
                        Pickaway County |          7        0.04       72.25
                         Pickens County |         21        0.11       72.36
                         Pickett County |          7        0.04       72.40
                          Pierce County |         28        0.15       72.55
                            Pike County |         70        0.38       72.93
                            Pima County |          1        0.01       72.93
                           Pinal County |          7        0.04       72.97
                            Pine County |          7        0.04       73.01
                       Pipestone County |          7        0.04       73.05
                     Piscataquis County |          7        0.04       73.08
                          Pitkin County |          7        0.04       73.12
                       Pittsburg County |          7        0.04       73.16
                           Piute County |          7        0.04       73.20
                     Plaquemines Parish |          7        0.04       73.24
                          Platte County |         20        0.11       73.34
                       Pleasants County |          7        0.04       73.38
                          Plumas County |          7        0.04       73.42
                        Plymouth County |         13        0.07       73.49
                      Pocahontas County |         14        0.08       73.56
                        Poinsett County |          7        0.04       73.60
                   Pointe Coupee Parish |          7        0.04       73.64
                            Polk County |         76        0.41       74.05
                         Pondera County |          7        0.04       74.09
                        Pontotoc County |         14        0.08       74.16
                            Pope County |         21        0.11       74.27
                         Portage County |          7        0.04       74.31
                        Portsmouth city |          7        0.04       74.35
                           Posey County |          7        0.04       74.39
                    Pottawatomie County |         14        0.08       74.46
                   Pottawattamie County |          7        0.04       74.50
                          Potter County |         14        0.08       74.57
                    Powder River County |          7        0.04       74.61
                          Powell County |         14        0.08       74.69
                           Power County |          7        0.04       74.73
                       Poweshiek County |          7        0.04       74.76
                        Powhatan County |          7        0.04       74.80
                         Prairie County |         14        0.08       74.88
                           Pratt County |          7        0.04       74.91
                          Preble County |          7        0.04       74.95
                        Prentiss County |          7        0.04       74.99
                        Presidio County |          7        0.04       75.03
                    Presque Isle County |          7        0.04       75.06
                         Preston County |          7        0.04       75.10
                           Price County |          7        0.04       75.14
                   Prince Edward County |          7        0.04       75.18
      Prince of Wales-Hyder Census Area |          7        0.04       75.22
                         Prowers County |          7        0.04       75.25
                          Pueblo County |          7        0.04       75.29
                         Pulaski County |         42        0.23       75.52
                      Pushmataha County |          7        0.04       75.55
                          Putnam County |         63        0.34       75.89
                            Quay County |          7        0.04       75.93
                    Queen Anne's County |          7        0.04       75.97
                         Quitman County |         14        0.08       76.04
                           Rabun County |          7        0.04       76.08
                           Rains County |          7        0.04       76.12
                         Raleigh County |          7        0.04       76.16
                           Ralls County |          7        0.04       76.19
                          Ramsey County |          7        0.04       76.23
                        Randolph County |         49        0.26       76.50
                          Rankin County |          7        0.04       76.53
                          Ransom County |          7        0.04       76.57
                         Rapides Parish |          7        0.04       76.61
                    Rappahannock County |          7        0.04       76.65
                         Ravalli County |          7        0.04       76.68
                         Rawlins County |          7        0.04       76.72
                             Ray County |          7        0.04       76.76
                          Reagan County |          7        0.04       76.80
                            Real County |          7        0.04       76.83
                        Red Lake County |          7        0.04       76.87
                       Red River County |          7        0.04       76.91
                       Red River Parish |          7        0.04       76.95
                      Red Willow County |          7        0.04       76.99
                         Redwood County |          7        0.04       77.02
                          Reeves County |          7        0.04       77.06
                         Refugio County |          7        0.04       77.10
                            Reno County |          7        0.04       77.14
                        Renville County |         14        0.08       77.21
                        Republic County |          7        0.04       77.25
                        Reynolds County |          7        0.04       77.29
                            Rhea County |          7        0.04       77.32
                            Rice County |         14        0.08       77.40
                            Rich County |          7        0.04       77.44
                      Richardson County |          7        0.04       77.48
                        Richland County |         35        0.19       77.66
                        Richland Parish |          7        0.04       77.70
                        Richmond County |         14        0.08       77.78
                           Riley County |          7        0.04       77.81
                        Ringgold County |          7        0.04       77.85
                      Rio Arriba County |          7        0.04       77.89
                      Rio Blanco County |          7        0.04       77.93
                      Rio Grande County |          7        0.04       77.96
                          Ripley County |         14        0.08       78.04
                         Ritchie County |          7        0.04       78.08
                           Roane County |         14        0.08       78.15
                           Roanoke city |          7        0.04       78.19
                         Roberts County |         14        0.08       78.27
                       Robertson County |         21        0.11       78.38
                         Robeson County |          7        0.04       78.42
                            Rock County |         14        0.08       78.49
                      Rockcastle County |          7        0.04       78.53
                        Rockdale County |          7        0.04       78.57
                      Rockingham County |         14        0.08       78.64
                        Rockwall County |          7        0.04       78.68
                     Roger Mills County |          7        0.04       78.72
                          Rogers County |          7        0.04       78.76
                         Rolette County |          7        0.04       78.79
                           Rooks County |          7        0.04       78.83
                       Roosevelt County |         14        0.08       78.91
                       Roscommon County |          7        0.04       78.94
                          Roseau County |          7        0.04       78.98
                         Rosebud County |          7        0.04       79.02
                            Ross County |          7        0.04       79.06
                           Routt County |          7        0.04       79.09
                           Rowan County |          7        0.04       79.13
                         Runnels County |          7        0.04       79.17
                            Rush County |         14        0.08       79.25
                            Rusk County |         14        0.08       79.32
                         Russell County |         28        0.15       79.47
                      Rutherford County |          7        0.04       79.51
                         Rutland County |          7        0.04       79.55
                          Sabine County |          7        0.04       79.58
                          Sabine Parish |          7        0.04       79.62
                             Sac County |          7        0.04       79.66
                       Sagadahoc County |          7        0.04       79.70
                        Saguache County |          7        0.04       79.74
                           Salem County |          7        0.04       79.77
                          Saline County |         29        0.16       79.93
                          Saluda County |          7        0.04       79.97
                         Sampson County |          7        0.04       80.00
                   San Augustine County |          7        0.04       80.04
                      San Benito County |          7        0.04       80.08
                     San Jacinto County |          7        0.04       80.12
                        San Juan County |         28        0.15       80.27
                      San Miguel County |         14        0.08       80.34
                    San Patricio County |          7        0.04       80.38
                        San Saba County |          7        0.04       80.42
                         Sanborn County |          7        0.04       80.46
                         Sanders County |          7        0.04       80.49
                        Sandusky County |          7        0.04       80.53
                         Sanilac County |          7        0.04       80.57
                         Sanpete County |          7        0.04       80.61
                      Santa Cruz County |          7        0.04       80.64
                        Santa Fe County |          1        0.01       80.65
                         Sargent County |          7        0.04       80.69
                            Sauk County |          7        0.04       80.73
                        Saunders County |          7        0.04       80.76
                          Sawyer County |          7        0.04       80.80
                      Schleicher County |          7        0.04       80.84
                          Schley County |          7        0.04       80.88
                       Schoharie County |          7        0.04       80.91
                     Schoolcraft County |          7        0.04       80.95
                        Schuyler County |         21        0.11       81.06
                          Scioto County |          7        0.04       81.10
                        Scotland County |         14        0.08       81.18
                           Scott County |         69        0.37       81.55
                    Scotts Bluff County |          7        0.04       81.59
                         Screven County |          7        0.04       81.62
                          Scurry County |          7        0.04       81.66
                          Searcy County |          7        0.04       81.70
                       Sebastian County |          7        0.04       81.74
                        Sedgwick County |         14        0.08       81.81
                        Seminole County |         14        0.08       81.89
                          Seneca County |         14        0.08       81.96
                      Sequatchie County |          7        0.04       82.00
                        Sequoyah County |          7        0.04       82.04
                          Sevier County |         21        0.11       82.15
                          Seward County |         14        0.08       82.23
                     Shackelford County |          7        0.04       82.26
                         Shannon County |          7        0.04       82.30
                         Sharkey County |          7        0.04       82.34
                           Sharp County |          7        0.04       82.38
                         Shawano County |          7        0.04       82.41
                         Shawnee County |          7        0.04       82.45
                          Shelby County |         50        0.27       82.72
                      Shenandoah County |          7        0.04       82.76
                       Sherburne County |          7        0.04       82.80
                        Sheridan County |         35        0.19       82.99
                         Sherman County |         28        0.15       83.14
                      Shiawassee County |          7        0.04       83.17
                        Shoshone County |          7        0.04       83.21
                          Sibley County |          7        0.04       83.25
                          Sierra County |         14        0.08       83.32
                      Silver Bow County |          7        0.04       83.36
                         Simpson County |         14        0.08       83.44
                           Sioux County |         21        0.11       83.55
                        Siskiyou County |          7        0.04       83.59
                 Sitka City and Borough |          7        0.04       83.63
                          Skagit County |          6        0.03       83.66
                   Skagway Municipality |          7        0.04       83.70
                        Skamania County |          7        0.04       83.73
                           Slope County |          7        0.04       83.77
                           Smith County |         21        0.11       83.88
                           Smyth County |          7        0.04       83.92
                          Snyder County |          7        0.04       83.96
                         Socorro County |          7        0.04       84.00
                        Somerset County |         21        0.11       84.11
                       Somervell County |          7        0.04       84.15
        Southeast Fairbanks Census Area |          7        0.04       84.19
                        Spalding County |          7        0.04       84.22
                         Spencer County |         14        0.08       84.30
                           Spink County |          7        0.04       84.34
                     St. Bernard Parish |          7        0.04       84.37
                     St. Charles Parish |          7        0.04       84.41
                       St. Clair County |         15        0.08       84.49
                       St. Croix County |          7        0.04       84.53
                     St. Francis County |          7        0.04       84.57
                    St. Francois County |          7        0.04       84.61
                      St. Helena Parish |          7        0.04       84.64
                       St. James Parish |          7        0.04       84.68
            St. John the Baptist Parish |          7        0.04       84.72
                       St. Johns County |          7        0.04       84.76
                      St. Joseph County |          7        0.04       84.79
                      St. Landry Parish |          7        0.04       84.83
                       St. Louis County |          7        0.04       84.87
                      St. Martin Parish |          7        0.04       84.91
                        St. Mary Parish |          7        0.04       84.94
                      St. Mary's County |          7        0.04       84.98
                        Stafford County |         14        0.08       85.06
                         Stanley County |          7        0.04       85.09
                          Stanly County |          7        0.04       85.13
                         Stanton County |         14        0.08       85.21
                           Stark County |         21        0.11       85.32
                          Starke County |          7        0.04       85.36
                           Starr County |          7        0.04       85.40
                  Ste. Genevieve County |          7        0.04       85.43
                         Stearns County |          1        0.01       85.44
                          Steele County |         14        0.08       85.51
                        Stephens County |         21        0.11       85.63
                      Stephenson County |          7        0.04       85.67
                        Sterling County |          7        0.04       85.70
                         Steuben County |         14        0.08       85.78
                         Stevens County |         21        0.11       85.89
                         Stewart County |         14        0.08       85.97
                      Stillwater County |          7        0.04       86.00
                        Stoddard County |          7        0.04       86.04
                          Stokes County |          7        0.04       86.08
                           Stone County |         21        0.11       86.19
                       Stonewall County |          7        0.04       86.23
                          Storey County |          7        0.04       86.27
                           Story County |          7        0.04       86.31
                       Strafford County |          7        0.04       86.34
                        Stutsman County |          7        0.04       86.38
                        Sublette County |          7        0.04       86.42
                           Suffolk city |          7        0.04       86.46
                        Sullivan County |         41        0.22       86.68
                           Sully County |          7        0.04       86.71
                         Summers County |          7        0.04       86.75
                          Summit County |         14        0.08       86.83
                          Sumner County |          8        0.04       86.87
                          Sumter County |         27        0.15       87.02
                       Sunflower County |          7        0.04       87.05
                           Surry County |         14        0.08       87.13
                     Susquehanna County |          7        0.04       87.17
                          Sussex County |          7        0.04       87.20
                          Sutter County |          7        0.04       87.24
                          Sutton County |          7        0.04       87.28
                        Suwannee County |          7        0.04       87.32
                           Swain County |          7        0.04       87.35
                     Sweet Grass County |          7        0.04       87.39
                      Sweetwater County |          7        0.04       87.43
                           Swift County |          7        0.04       87.47
                         Swisher County |          7        0.04       87.51
                     Switzerland County |          7        0.04       87.54
                          Talbot County |         14        0.08       87.62
                      Taliaferro County |          7        0.04       87.66
                       Talladega County |          7        0.04       87.69
                    Tallahatchie County |          7        0.04       87.73
                      Tallapoosa County |          7        0.04       87.77
                            Tama County |          7        0.04       87.81
                           Taney County |          7        0.04       87.84
                      Tangipahoa Parish |          7        0.04       87.88
                            Taos County |          7        0.04       87.92
                            Tate County |          7        0.04       87.96
                        Tattnall County |          7        0.04       88.00
                          Taylor County |         42        0.23       88.22
                        Tazewell County |          7        0.04       88.26
                          Tehama County |          7        0.04       88.30
                         Telfair County |          7        0.04       88.33
                          Teller County |          7        0.04       88.37
                          Tensas Parish |          7        0.04       88.41
                      Terrebonne Parish |          1        0.01       88.41
                         Terrell County |         14        0.08       88.49
                           Terry County |          7        0.04       88.53
                           Teton County |         21        0.11       88.64
                           Texas County |         14        0.08       88.72
                          Thayer County |          7        0.04       88.75
                          Thomas County |         21        0.11       88.87
                    Throckmorton County |          7        0.04       88.90
                        Thurston County |          7        0.04       88.94
                            Tift County |          7        0.04       88.98
                       Tillamook County |          7        0.04       89.02
                         Tillman County |          7        0.04       89.06
                           Tioga County |         14        0.08       89.13
                          Tippah County |          7        0.04       89.17
                          Tipton County |         14        0.08       89.24
                      Tishomingo County |          7        0.04       89.28
                           Titus County |          7        0.04       89.32
                            Todd County |         21        0.11       89.43
                          Tooele County |          7        0.04       89.47
                           Toole County |          7        0.04       89.51
                          Toombs County |          7        0.04       89.54
                        Torrance County |          7        0.04       89.58
                          Towner County |          7        0.04       89.62
                           Towns County |          7        0.04       89.66
                          Traill County |          7        0.04       89.70
                    Transylvania County |          7        0.04       89.73
                        Traverse County |          7        0.04       89.77
                        Treasure County |          7        0.04       89.81
                           Trego County |          7        0.04       89.85
                     Trempealeau County |          7        0.04       89.88
                        Treutlen County |          7        0.04       89.92
                           Trigg County |          7        0.04       89.96
                         Trimble County |          7        0.04       90.00
                         Trinity County |         14        0.08       90.07
                           Tripp County |          7        0.04       90.11
                           Troup County |          7        0.04       90.15
                       Trousdale County |          7        0.04       90.19
                        Trumbull County |          7        0.04       90.22
                          Tucker County |          7        0.04       90.26
                           Tulsa County |          6        0.03       90.29
                          Tunica County |          7        0.04       90.33
                        Tuolumne County |          7        0.04       90.37
                          Turner County |         14        0.08       90.44
                      Tuscaloosa County |          6        0.03       90.48
                      Tuscarawas County |          7        0.04       90.51
                         Tuscola County |          7        0.04       90.55
                          Twiggs County |          7        0.04       90.59
                      Twin Falls County |          7        0.04       90.63
                           Tyler County |         14        0.08       90.70
                         Tyrrell County |          7        0.04       90.74
                           Uinta County |          7        0.04       90.78
                          Uintah County |          7        0.04       90.81
                          Ulster County |          7        0.04       90.85
                        Umatilla County |          7        0.04       90.89
                          Unicoi County |          7        0.04       90.93
                           Union County |        112        0.60       91.53
                           Union Parish |          7        0.04       91.57
                          Upshur County |         14        0.08       91.64
                           Upson County |          7        0.04       91.68
                           Upton County |          7        0.04       91.72
                          Uvalde County |          7        0.04       91.76
                       Val Verde County |          7        0.04       91.79
                        Valencia County |          7        0.04       91.83
                          Valley County |         21        0.11       91.94
                       Van Buren County |         28        0.15       92.10
                        Van Wert County |          7        0.04       92.13
                       Van Zandt County |          7        0.04       92.17
                           Vance County |          7        0.04       92.21
                         Venango County |          7        0.04       92.25
                       Vermilion County |          7        0.04       92.28
                       Vermilion Parish |          7        0.04       92.32
                      Vermillion County |          7        0.04       92.36
                          Vernon County |         14        0.08       92.43
                          Vernon Parish |          7        0.04       92.47
                        Victoria County |          7        0.04       92.51
                           Vilas County |          7        0.04       92.55
                          Vinton County |          7        0.04       92.59
                         Volusia County |          6        0.03       92.62
                          Wabash County |         14        0.08       92.69
                         Wabasha County |          7        0.04       92.73
                       Wabaunsee County |          7        0.04       92.77
                          Wadena County |          7        0.04       92.81
                         Wagoner County |          7        0.04       92.84
                       Wahkiakum County |          7        0.04       92.88
                         Wakulla County |          7        0.04       92.92
                           Waldo County |          7        0.04       92.96
                          Walker County |         21        0.11       93.07
                     Walla Walla County |          7        0.04       93.11
                         Wallace County |          7        0.04       93.14
                          Waller County |          7        0.04       93.18
                         Wallowa County |          7        0.04       93.22
                           Walsh County |          7        0.04       93.26
                        Walthall County |          7        0.04       93.30
                          Walton County |         14        0.08       93.37
                        Walworth County |          7        0.04       93.41
                         Wapello County |          7        0.04       93.45
                            Ward County |         14        0.08       93.52
                            Ware County |          7        0.04       93.56
                          Warren County |         77        0.41       93.97
                         Warrick County |          7        0.04       94.01
                         Wasatch County |          7        0.04       94.05
                           Wasco County |          7        0.04       94.09
                          Waseca County |          7        0.04       94.12
                        Washakie County |          7        0.04       94.16
                        Washburn County |          7        0.04       94.20
                      Washington County |        156        0.84       95.04
                      Washington Parish |          7        0.04       95.08
                         Washita County |          7        0.04       95.11
                         Watauga County |          7        0.04       95.15
                        Watonwan County |          7        0.04       95.19
                         Waupaca County |          7        0.04       95.23
                        Waushara County |          7        0.04       95.26
                           Wayne County |         91        0.49       95.75
                         Weakley County |          7        0.04       95.79
                         Webster County |         49        0.26       96.06
                         Webster Parish |          7        0.04       96.09
                            Weld County |          6        0.03       96.13
                           Wells County |         14        0.08       96.20
                West Baton Rouge Parish |          7        0.04       96.24
                    West Carroll Parish |          7        0.04       96.28
                  West Feliciana Parish |          7        0.04       96.31
                     Westchester County |          6        0.03       96.35
                    Westmoreland County |          7        0.04       96.38
                          Weston County |          7        0.04       96.42
                          Wetzel County |          7        0.04       96.46
                         Wexford County |          7        0.04       96.50
                         Wharton County |          7        0.04       96.53
                       Wheatland County |          7        0.04       96.57
                         Wheeler County |         28        0.15       96.72
                           White County |         35        0.19       96.91
                      White Pine County |          7        0.04       96.95
                       Whiteside County |          7        0.04       96.99
                         Whitley County |         14        0.08       97.06
                         Whitman County |          7        0.04       97.10
                          Wibaux County |          7        0.04       97.14
                         Wichita County |          7        0.04       97.17
                        Wicomico County |          7        0.04       97.21
                       Wilbarger County |          7        0.04       97.25
                          Wilcox County |         14        0.08       97.33
                          Wilkes County |         14        0.08       97.40
                          Wilkin County |          7        0.04       97.44
                       Wilkinson County |         14        0.08       97.51
                         Willacy County |          7        0.04       97.55
                        Williams County |         14        0.08       97.63
                    Williamsburg County |          7        0.04       97.66
                      Williamson County |          7        0.04       97.70
                          Wilson County |         21        0.11       97.82
                         Windham County |          7        0.04       97.85
                         Windsor County |          7        0.04       97.89
                         Winkler County |          7        0.04       97.93
                            Winn Parish |          7        0.04       97.97
                       Winnebago County |         14        0.08       98.04
                      Winneshiek County |          7        0.04       98.08
                          Winona County |          7        0.04       98.12
                         Winston County |         14        0.08       98.19
                            Wirt County |          7        0.04       98.23
                            Wise County |          7        0.04       98.27
                           Wolfe County |          7        0.04       98.30
                            Wood County |         27        0.15       98.45
                        Woodbury County |          7        0.04       98.49
                        Woodford County |         14        0.08       98.56
                        Woodruff County |          7        0.04       98.60
                           Woods County |          7        0.04       98.64
                         Woodson County |          7        0.04       98.68
                        Woodward County |          7        0.04       98.71
                       Worcester County |         13        0.07       98.78
                           Worth County |         21        0.11       98.90
              Wrangell City and Borough |          7        0.04       98.93
                          Wright County |         15        0.08       99.02
                         Wyandot County |          7        0.04       99.05
                         Wyoming County |         21        0.11       99.17
                           Wythe County |          7        0.04       99.20
                          Yadkin County |          7        0.04       99.24
               Yakutat City and Borough |          7        0.04       99.28
                       Yalobusha County |          7        0.04       99.32
                         Yamhill County |          6        0.03       99.35
                          Yancey County |          7        0.04       99.39
                         Yankton County |          7        0.04       99.42
                           Yates County |          7        0.04       99.46
                           Yazoo County |          7        0.04       99.50
                            Yell County |          7        0.04       99.54
                 Yellow Medicine County |          7        0.04       99.57
                     Yellowstone County |          7        0.04       99.61
                          Yoakum County |          7        0.04       99.65
                            York County |         15        0.08       99.73
                           Young County |          7        0.04       99.77
                            Yuba County |          7        0.04       99.81
              Yukon-Koyukuk Census Area |          7        0.04       99.84
                            Yuma County |          8        0.04       99.89
                          Zapata County |          7        0.04       99.92
                          Zavala County |          7        0.04       99.96
                         Ziebach County |          7        0.04      100.00
----------------------------------------+-----------------------------------
                                  Total |     18,584      100.00

. tab year proptx_merge

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |     2,657        422 |     3,079 
      2017 |     2,657        422 |     3,079 
      2018 |     2,657        422 |     3,079 
      2019 |     2,657        422 |     3,079 
      2020 |     2,657        422 |     3,079 
      2021 |     2,657        422 |     3,079 
      2022 |     2,642        437 |     3,079 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |    18,584      3,843 |    22,427 

. tab year state_name

  Tax year |
     (year |
    before |                            State name
     move) |   Alabama     Alaska    Arizona   Arkansas  Califor..   Colorado |     Total
-----------+------------------------------------------------------------------+----------
      2016 |        67         28         15         75         58         64 |     3,079 
      2017 |        67         28         15         75         58         64 |     3,079 
      2018 |        67         28         15         75         58         64 |     3,079 
      2019 |        67         28         15         75         58         64 |     3,079 
      2020 |        67         28         15         75         58         64 |     3,079 
      2021 |        67         28         15         75         58         64 |     3,079 
      2022 |        67         28         15         75         58         64 |     3,079 
      2023 |         5          1          4          3         34          2 |       437 
      2024 |         5          1          4          3         34          2 |       437 
-----------+------------------------------------------------------------------+----------
     Total |       479        198        113        531        474        452 |    22,427 


  Tax year |
     (year |
    before |                            State name
     move) |  Delaware  Distric..    Florida    Georgia     Hawaii      Idaho |     Total
-----------+------------------------------------------------------------------+----------
      2016 |         3          1         67        159          3         44 |     3,079 
      2017 |         3          1         67        159          3         44 |     3,079 
      2018 |         3          1         67        159          3         44 |     3,079 
      2019 |         3          1         67        159          3         44 |     3,079 
      2020 |         3          1         67        159          3         44 |     3,079 
      2021 |         3          1         67        159          3         44 |     3,079 
      2022 |         3          1         67        159          3         44 |     3,079 
      2023 |         3          1         33         22          2          1 |       437 
      2024 |         3          1         33         22          2          1 |       437 
-----------+------------------------------------------------------------------+----------
     Total |        27          9        535      1,157         25        310 |    22,427 


  Tax year |
     (year |
    before |                            State name
     move) |  Illinois    Indiana       Iowa     Kansas   Kentucky  Louisiana |     Total
-----------+------------------------------------------------------------------+----------
      2016 |       102         92         99        105        120         64 |     3,079 
      2017 |       102         92         99        105        120         64 |     3,079 
      2018 |       102         92         99        105        120         64 |     3,079 
      2019 |       102         92         99        105        120         64 |     3,079 
      2020 |       102         92         99        105        120         64 |     3,079 
      2021 |       102         92         99        105        120         64 |     3,079 
      2022 |       102         92         99        105        120         64 |     3,079 
      2023 |        13         16          5          3          7          7 |       437 
      2024 |        13         16          5          3          7          7 |       437 
-----------+------------------------------------------------------------------+----------
     Total |       740        676        703        741        854        462 |    22,427 


  Tax year |
     (year |
    before |                            State name
     move) |     Maine   Maryland  Massach..   Michigan  Minnesota  Mississ.. |     Total
-----------+------------------------------------------------------------------+----------
      2016 |        16         24         14         83         87         82 |     3,079 
      2017 |        16         24         14         83         87         82 |     3,079 
      2018 |        16         24         14         83         87         82 |     3,079 
      2019 |        16         24         14         83         87         82 |     3,079 
      2020 |        16         24         14         83         87         82 |     3,079 
      2021 |        16         24         14         83         87         82 |     3,079 
      2022 |        16         24         14         83         87         82 |     3,079 
      2023 |         2         11          9         16          8          3 |       437 
      2024 |         2         11          9         16          8          3 |       437 
-----------+------------------------------------------------------------------+----------
     Total |       116        190        116        613        625        580 |    22,427 


  Tax year |
     (year |
    before |                            State name
     move) |  Missouri    Montana   Nebraska     Nevada  New Ham..  New Jer.. |     Total
-----------+------------------------------------------------------------------+----------
      2016 |       115         56         93         17         10         21 |     3,079 
      2017 |       115         56         93         17         10         21 |     3,079 
      2018 |       115         56         93         17         10         21 |     3,079 
      2019 |       115         56         93         17         10         21 |     3,079 
      2020 |       115         56         93         17         10         21 |     3,079 
      2021 |       115         56         93         17         10         21 |     3,079 
      2022 |       115         56         93         17         10         21 |     3,079 
      2023 |         7          1          3          2          0         17 |       437 
      2024 |         7          1          3          2          0         17 |       437 
-----------+------------------------------------------------------------------+----------
     Total |       819        394        657        123         70        181 |    22,427 


  Tax year |
     (year |
    before |                            State name
     move) | New Mex..   New York  North C..  North D..       Ohio   Oklahoma |     Total
-----------+------------------------------------------------------------------+----------
      2016 |        33         62        100         53         88         77 |     3,079 
      2017 |        33         62        100         53         88         77 |     3,079 
      2018 |        33         62        100         53         88         77 |     3,079 
      2019 |        33         62        100         53         88         77 |     3,079 
      2020 |        33         62        100         53         88         77 |     3,079 
      2021 |        33         62        100         53         88         77 |     3,079 
      2022 |        33         62        100         53         88         77 |     3,079 
      2023 |         2         21         18          1         21          4 |       437 
      2024 |         2         21         18          1         21          4 |       437 
-----------+------------------------------------------------------------------+----------
     Total |       235        476        736        373        658        547 |    22,427 


  Tax year |
     (year |
    before |                            State name
     move) |    Oregon  Pennsyl..  Rhode I..  South C..  South D..  Tennessee |     Total
-----------+------------------------------------------------------------------+----------
      2016 |        36         67          5         46         66         95 |     3,079 
      2017 |        36         67          5         46         66         95 |     3,079 
      2018 |        36         67          5         46         66         95 |     3,079 
      2019 |        36         67          5         46         66         95 |     3,079 
      2020 |        36         67          5         46         66         95 |     3,079 
      2021 |        36         67          5         46         66         95 |     3,079 
      2022 |        36         67          5         46         66         95 |     3,079 
      2023 |         8         20          3          8          0         11 |       437 
      2024 |         8         20          3          8          0         11 |       437 
-----------+------------------------------------------------------------------+----------
     Total |       268        509         41        338        462        687 |    22,427 


  Tax year |
     (year |
    before |                            State name
     move) |     Texas       Utah    Vermont   Virginia  Washing..  West Vi.. |     Total
-----------+------------------------------------------------------------------+----------
      2016 |       253         29         14         82         39         55 |     3,079 
      2017 |       253         29         14         82         39         55 |     3,079 
      2018 |       253         29         14         82         39         55 |     3,079 
      2019 |       253         29         14         82         39         55 |     3,079 
      2020 |       253         29         14         82         39         55 |     3,079 
      2021 |       253         29         14         82         39         55 |     3,079 
      2022 |       253         29         14         82         39         55 |     3,079 
      2023 |        38          5          1         10         10          1 |       437 
      2024 |        38          5          1         10         10          1 |       437 
-----------+------------------------------------------------------------------+----------
     Total |     1,847        213        100        594        293        387 |    22,427 


  Tax year |
     (year |
    before |      State name
     move) | Wisconsin    Wyoming |     Total
-----------+----------------------+----------
      2016 |        72         23 |     3,079 
      2017 |        72         23 |     3,079 
      2018 |        72         23 |     3,079 
      2019 |        72         23 |     3,079 
      2020 |        72         23 |     3,079 
      2021 |        72         23 |     3,079 
      2022 |        72         23 |     3,079 
      2023 |        13          1 |       437 
      2024 |        13          1 |       437 
-----------+----------------------+----------
     Total |       530        163 |    22,427 

. tab year state_name if merge_acs_1 != 3 & proptx_merge ==3

  Tax year |
     (year |
    before |                            State name
     move) |   Alabama     Alaska    Arizona   Arkansas  Califor..   Colorado |     Total
-----------+------------------------------------------------------------------+----------
      2023 |         5          1          4          3         34          2 |       437 
      2024 |         5          1          4          3         34          2 |       437 
-----------+------------------------------------------------------------------+----------
     Total |        10          2          8          6         68          4 |       874 


  Tax year |
     (year |
    before |                            State name
     move) |  Delaware  Distric..    Florida    Georgia     Hawaii      Idaho |     Total
-----------+------------------------------------------------------------------+----------
      2023 |         3          1         33         22          2          1 |       437 
      2024 |         3          1         33         22          2          1 |       437 
-----------+------------------------------------------------------------------+----------
     Total |         6          2         66         44          4          2 |       874 


  Tax year |
     (year |
    before |                            State name
     move) |  Illinois    Indiana       Iowa     Kansas   Kentucky  Louisiana |     Total
-----------+------------------------------------------------------------------+----------
      2023 |        13         16          5          3          7          7 |       437 
      2024 |        13         16          5          3          7          7 |       437 
-----------+------------------------------------------------------------------+----------
     Total |        26         32         10          6         14         14 |       874 


  Tax year |
     (year |
    before |                            State name
     move) |     Maine   Maryland  Massach..   Michigan  Minnesota  Mississ.. |     Total
-----------+------------------------------------------------------------------+----------
      2023 |         2         11          9         16          8          3 |       437 
      2024 |         2         11          9         16          8          3 |       437 
-----------+------------------------------------------------------------------+----------
     Total |         4         22         18         32         16          6 |       874 


  Tax year |
     (year |
    before |                            State name
     move) |  Missouri    Montana   Nebraska     Nevada  New Jer..  New Mex.. |     Total
-----------+------------------------------------------------------------------+----------
      2023 |         7          1          3          2         17          2 |       437 
      2024 |         7          1          3          2         17          2 |       437 
-----------+------------------------------------------------------------------+----------
     Total |        14          2          6          4         34          4 |       874 


  Tax year |
     (year |
    before |                            State name
     move) |  New York  North C..  North D..       Ohio   Oklahoma     Oregon |     Total
-----------+------------------------------------------------------------------+----------
      2023 |        21         18          1         21          4          8 |       437 
      2024 |        21         18          1         21          4          8 |       437 
-----------+------------------------------------------------------------------+----------
     Total |        42         36          2         42          8         16 |       874 


  Tax year |
     (year |
    before |                            State name
     move) | Pennsyl..  Rhode I..  South C..  Tennessee      Texas       Utah |     Total
-----------+------------------------------------------------------------------+----------
      2023 |        20          3          8         11         38          5 |       437 
      2024 |        20          3          8         11         38          5 |       437 
-----------+------------------------------------------------------------------+----------
     Total |        40          6         16         22         76         10 |       874 


  Tax year |
     (year |
    before |                            State name
     move) |   Vermont   Virginia  Washing..  West Vi..  Wisconsin    Wyoming |     Total
-----------+------------------------------------------------------------------+----------
      2023 |         1         10         10          1         13          1 |       437 
      2024 |         1         10         10          1         13          1 |       437 
-----------+------------------------------------------------------------------+----------
     Total |         2         20         20          2         26          2 |       874 

. tab acs_period_1

acs_period_ |
          1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     19,704       87.86       87.86
          1 |      2,723       12.14      100.00
------------+-----------------------------------
      Total |     22,427      100.00

. tab year acs_period_1

  Tax year |
     (year |
    before |     acs_period_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year proptx_merge

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |     2,657        422 |     3,079 
      2017 |     2,657        422 |     3,079 
      2018 |     2,657        422 |     3,079 
      2019 |     2,657        422 |     3,079 
      2020 |     2,657        422 |     3,079 
      2021 |     2,657        422 |     3,079 
      2022 |     2,642        437 |     3,079 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |    18,584      3,843 |    22,427 

. tab acs_period_1  proptx_merge

           | Matching result from
acs_period |         merge
        _1 | Master on  Matched ( |     Total
-----------+----------------------+----------
         0 |    18,584      1,120 |    19,704 
         1 |         0      2,723 |     2,723 
-----------+----------------------+----------
     Total |    18,584      3,843 |    22,427 

. tab year if acs_period_1 == 0 &  proptx_merge == 3

   Tax year |
      (year |
     before |
      move) |      Freq.     Percent        Cum.
------------+-----------------------------------
       2016 |         33        2.95        2.95
       2017 |         33        2.95        5.89
       2018 |         33        2.95        8.84
       2019 |         33        2.95       11.79
       2020 |         33        2.95       14.73
       2021 |         33        2.95       17.68
       2022 |         48        4.29       21.96
       2023 |        437       39.02       60.98
       2024 |        437       39.02      100.00
------------+-----------------------------------
      Total |      1,120      100.00

. tab county_name  if acs_period_1 == 0 &  proptx_merge == 3 & year <= 2022

                            County name |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                           Aiken County |          1        0.41        0.41
                        Anderson County |          6        2.44        2.85
                       Ashtabula County |          6        2.44        5.28
                             Bay County |          1        0.41        5.69
                        Berkeley County |          1        0.41        6.10
                           Boone County |          6        2.44        8.54
                         Bristol County |          1        0.41        8.94
                          Carver County |          1        0.41        9.35
                       Champaign County |          6        2.44       11.79
                      Charleston County |          1        0.41       12.20
                        Chesapeake city |          6        2.44       14.63
                      Chittenden County |          1        0.41       15.04
                            Clay County |          1        0.41       15.45
                      Columbiana County |          6        2.44       17.89
                          Craven County |          6        2.44       20.33
                         Daviess County |          1        0.41       20.73
                          DeKalb County |          7        2.85       23.58
                       Deschutes County |          6        2.44       26.02
                      Dorchester County |          1        0.41       26.42
                        Dutchess County |          6        2.44       28.86
                           Essex County |          1        0.41       29.27
                          Etowah County |          6        2.44       31.71
                         Flagler County |          1        0.41       32.11
                        Florence County |          1        0.41       32.52
                        Franklin County |          6        2.44       34.96
                          Fulton County |          1        0.41       35.37
                        Gallatin County |          1        0.41       35.77
                      Greenville County |          1        0.41       36.18
                         Hampden County |          1        0.41       36.59
                          Hardin County |          1        0.41       36.99
                           Horry County |          6        2.44       39.43
                       Jefferson County |          6        2.44       41.87
                        Johnston County |          6        2.44       44.31
                         Kanawha County |          1        0.41       44.72
                        Kankakee County |          6        2.44       47.15
                         Kendall County |          1        0.41       47.56
                            Knox County |          1        0.41       47.97
                         LaSalle County |          6        2.44       50.41
                            Lake County |          2        0.81       51.22
                         Laramie County |          1        0.41       51.63
                             Lee County |          6        2.44       54.07
                       Lexington County |          1        0.41       54.47
                       Limestone County |          1        0.41       54.88
                           Macon County |          6        2.44       57.32
                           Maury County |          1        0.41       57.72
                       Middlesex County |          1        0.41       58.13
                          Mohave County |          1        0.41       58.54
                      Montgomery County |          1        0.41       58.94
                         Norfolk County |          1        0.41       59.35
                           Norfolk city |          1        0.41       59.76
                       Penobscot County |          6        2.44       62.20
                            Pima County |          6        2.44       64.63
                          Platte County |          1        0.41       65.04
                        Plymouth County |          1        0.41       65.45
                            Polk County |          1        0.41       65.85
                          Saline County |          6        2.44       68.29
                        Santa Fe County |          6        2.44       70.73
                           Scott County |          1        0.41       71.14
                          Shelby County |          6        2.44       73.58
                          Skagit County |          1        0.41       73.98
                       St. Clair County |          6        2.44       76.42
                         Stearns County |          6        2.44       78.86
                        Sullivan County |          1        0.41       79.27
                          Sumner County |          6        2.44       81.71
                          Sumter County |          1        0.41       82.11
                      Terrebonne Parish |          6        2.44       84.55
                           Tulsa County |          1        0.41       84.96
                      Tuscaloosa County |          1        0.41       85.37
                         Volusia County |          1        0.41       85.77
                      Washington County |         12        4.88       90.65
                            Weld County |          1        0.41       91.06
                     Westchester County |          1        0.41       91.46
                            Wood County |          1        0.41       91.87
                       Worcester County |          1        0.41       92.28
                          Wright County |          6        2.44       94.72
                         Yamhill County |          1        0.41       95.12
                            York County |          6        2.44       97.56
                            Yuma County |          6        2.44      100.00
----------------------------------------+-----------------------------------
                                  Total |        246      100.00

. summ prop_tax_rate

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
prop_tax_~te |      3,843    1.603767    .8337059   .3540973    11.5069

. do "C:\Users\ji252\Documents\GitHub\multnomah-county-tax\code\02_sdid_analysis_parallel.do"

. /*******************************************************************************
> File Name:              02_sdid_analysis_parallel.do
> Creator:                John Iselin (parallelized version)
> Date Update:    January 13, 2025
> 
> Called by: 00_multnomah.do
> 
> Purpose: Perform synthetic difference-in-difference estimation using parallel
>          processing to speed up computation across multiple specifications.
> 
>          Each parallel child runs all 6 specifications for one table:
>          - 3 outcome variables (n1, n2, agi) for a given migration type
>          - Each with 2 covariate settings (with/without controls)
>          This allows tables to be generated within each child process.
> 
> Requirements:
> - parallel package: net install parallel, from(https://raw.github.com/gvegayon/parallel/stable/)
>  replace
> 
> Outputs:
> - sdid_weights.dta/xlsx: Synthetic control weights for each specification
> - sdid_results.dta/xlsx: Treatment effects, SEs, p-values for each specification
> - tab_sdid_*.tex: LaTeX tables for each specification group
> - fig_speccurve_*.pdf/jpg: Specification curve plots
> 
> Authors: John Iselin
> 
> For more information, contact john.iselin@yale.edu
> 
> *******************************************************************************/
. 
. ** Start log file
. capture log close log_02

. log using "${logs}02_log_sdid_parallel_${date}", replace text name(log_02)
--------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_sdid_parallel_2
> 026-01-14.log
  log type:  text
 opened on:  14 Jan 2026, 20:49:03

. 
. /*******************************************************************************
> SECTION 1: SETUP AND CONFIGURATION
> *******************************************************************************/
. 
. ** Set number of parallel clusters (adjust based on your machine)
. ** Use fewer than total cores to leave resources for system
. local n_clusters = 6

. 
. ** Parameters
. local reps = 100

. 
. ** Initialize parallel processing
. parallel initialize `n_clusters', force
N Child processes: 6
Stata dir:  C:\Program Files\StataNow19/StataMP-64.exe

. 
. /*******************************************************************************
> SECTION 2: DATA PREPARATION
> (Same as original - prepares main analysis dataset)
> *******************************************************************************/
. 
. ** Load data
. use "${data}working/irs_county_gross", replace

. 
. ** Keep required variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3

. order year fips state* county*

. 
. ** Merge with ACS Data
. merge 1:1 year fips using "${data}working/acs_county_gross_18plus", gen(merge_acs_1)
(variable fips was float, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        20,771
        from master                    18,963  (merge_acs_1==1)
        from using                      1,808  (merge_acs_1==2)

    Matched                             3,017  (merge_acs_1==3)
    -----------------------------------------

. 
. ** Keep require variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3 merge_acs_*

. 
. ** Label acs samples
. rename persons_* acs1_persons_*

. rename households_* acs1_households_*

. rename dollars_* acs1_dollars_*

. 
. ** Merge with ACS Data
. merge 1:1 year fips using "${data}working/acs_county_gross_college", gen(merge_acs_2)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,963
        from master                    18,963  (merge_acs_2==1)
        from using                          0  (merge_acs_2==2)

    Matched                             4,825  (merge_acs_2==3)
    -----------------------------------------

. 
. ** Keep require variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3  merge_acs_*

. 
. ** Label acs samples
. rename persons_* acs2_persons_*

. rename households_* acs2_households_*

. rename dollars_* acs2_dollars_*

. 
. ** Drop "other counties"
. drop if county_fips == 0
(483 observations deleted)

. drop if year == 2015
(430 observations deleted)

. 
. ** Merge with Demographic data
. merge m:1 fips using "${data}working/demographics_2020",        ///
>         gen(demo_merge) keep(master match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            27
        from master                        27  (demo_merge==1)
        from using                          0  (demo_merge==2)

    Matched                            22,848  (demo_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name demo_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
                     |        21          0 |        21 
             Alabama |         0        479 |       479 
              Alaska |         6        198 |       204 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         0         34 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |         0        951 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |        27     22,848 |    22,875 

. tab year demo_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         0      3,140 |     3,140 
      2017 |         0      3,140 |     3,140 
      2018 |         0      3,140 |     3,140 
      2019 |         0      3,140 |     3,140 
      2020 |         2      3,140 |     3,142 
      2021 |         2      3,141 |     3,143 
      2022 |         9      3,133 |     3,142 
      2023 |         7        437 |       444 
      2024 |         7        437 |       444 
-----------+----------------------+----------
     Total |        27     22,848 |    22,875 

. 
. ** Keep if matched
. keep if demo_merge == 3
(27 observations deleted)

. drop demo_merge

. 
. ** Rename
. rename population pop_census

. 
. ** Merge with Demographic data
. merge m:1 year fips using "${data}working/bea_economics",       ///
>         gen(econ_merge) keep(master match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           366
        from master                       366  (econ_merge==1)
        from using                          0  (econ_merge==2)

    Matched                            22,482  (econ_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name econ_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
             Alabama |         0        479 |       479 
              Alaska |         0        198 |       198 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         9         25 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |       357        594 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |       366     22,482 |    22,848 

. tab year econ_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |        52      3,088 |     3,140 
      2017 |        52      3,088 |     3,140 
      2018 |        52      3,088 |     3,140 
      2019 |        52      3,088 |     3,140 
      2020 |        52      3,088 |     3,140 
      2021 |        53      3,088 |     3,141 
      2022 |        53      3,080 |     3,133 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |       366     22,482 |    22,848 

. 
. ** Keep if matched
. keep if econ_merge == 3
(366 observations deleted)

. drop econ_merge

. 
. ** Merge with COVID-19 Data
. merge m:1 fips using ${data}working/covid_cleaned_wide.dta,     ///
>         gen(covid_merge) keep(master match )
(variable state_name was str20, now str24 to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            73
        from master                        73  (covid_merge==1)
        from using                          0  (covid_merge==2)

    Matched                            22,409  (covid_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name covid_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |         0        479 |       479 
               Alaska |        28        170 |       198 
              Arizona |         0        113 |       113 
             Arkansas |         0        531 |       531 
           California |         0        474 |       474 
             Colorado |         0        452 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |         0        535 |       535 
              Georgia |         0      1,157 |     1,157 
               Hawaii |         0         25 |        25 
                Idaho |         0        310 |       310 
             Illinois |         0        740 |       740 
              Indiana |         0        676 |       676 
                 Iowa |         0        703 |       703 
               Kansas |         0        741 |       741 
             Kentucky |         0        854 |       854 
            Louisiana |         0        462 |       462 
                Maine |         0        116 |       116 
             Maryland |         0        190 |       190 
        Massachusetts |         0        116 |       116 
             Michigan |         0        613 |       613 
            Minnesota |         0        625 |       625 
          Mississippi |         0        580 |       580 
             Missouri |         0        819 |       819 
              Montana |         0        394 |       394 
             Nebraska |         0        657 |       657 
               Nevada |         0        123 |       123 
        New Hampshire |         0         70 |        70 
           New Jersey |         0        181 |       181 
           New Mexico |         0        235 |       235 
             New York |        45        431 |       476 
       North Carolina |         0        736 |       736 
         North Dakota |         0        373 |       373 
                 Ohio |         0        658 |       658 
             Oklahoma |         0        547 |       547 
               Oregon |         0        268 |       268 
         Pennsylvania |         0        509 |       509 
         Rhode Island |         0         41 |        41 
       South Carolina |         0        338 |       338 
         South Dakota |         0        462 |       462 
            Tennessee |         0        687 |       687 
                Texas |         0      1,854 |     1,854 
                 Utah |         0        213 |       213 
              Vermont |         0        100 |       100 
             Virginia |         0        594 |       594 
           Washington |         0        293 |       293 
        West Virginia |         0        387 |       387 
            Wisconsin |         0        530 |       530 
              Wyoming |         0        163 |       163 
----------------------+----------------------+----------
                Total |        73     22,409 |    22,482 

. tab year covid_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         9      3,079 |     3,088 
      2017 |         9      3,079 |     3,088 
      2018 |         9      3,079 |     3,088 
      2019 |         9      3,079 |     3,088 
      2020 |         9      3,079 |     3,088 
      2021 |         9      3,079 |     3,088 
      2022 |         9      3,071 |     3,080 
      2023 |         5        432 |       437 
      2024 |         5        432 |       437 
-----------+----------------------+----------
     Total |        73     22,409 |    22,482 

. 
. ** Merge with Property Tax Rates (time-varying)
. merge m:1 year fips using "${data}working/property_tax_rates_overall", ///
>         gen(proptx_merge) keep(master match) keepusing(prop_rate_mean prop_rate_se)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,591
        from master                    18,591  (proptx_merge==1)
        from using                          0  (proptx_merge==2)

    Matched                             3,891  (proptx_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name proptx_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |       422         57 |       479 
               Alaska |       189          9 |       198 
              Arizona |        71         42 |       113 
             Arkansas |       498         33 |       531 
           California |       168        306 |       474 
             Colorado |       440         12 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |       268        267 |       535 
              Georgia |       971        186 |     1,157 
               Hawaii |         7         18 |        25 
                Idaho |       301          9 |       310 
             Illinois |       593        147 |       740 
              Indiana |       532        144 |       676 
                 Iowa |       664         39 |       703 
               Kansas |       714         27 |       741 
             Kentucky |       803         51 |       854 
            Louisiana |       393         69 |       462 
                Maine |        92         24 |       116 
             Maryland |        85        105 |       190 
        Massachusetts |        77         39 |       116 
             Michigan |       469        144 |       613 
            Minnesota |       553         72 |       625 
          Mississippi |       553         27 |       580 
             Missouri |       756         63 |       819 
              Montana |       391          3 |       394 
             Nebraska |       630         27 |       657 
               Nevada |       105         18 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        28        153 |       181 
           New Mexico |       211         24 |       235 
             New York |       287        189 |       476 
       North Carolina |       562        174 |       736 
         North Dakota |       364          9 |       373 
                 Ohio |       469        189 |       658 
             Oklahoma |       517         30 |       547 
               Oregon |       196         72 |       268 
         Pennsylvania |       329        180 |       509 
         Rhode Island |        14         27 |        41 
       South Carolina |       290         48 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       600         87 |       687 
                Texas |     1,512        342 |     1,854 
                 Utah |       168         45 |       213 
              Vermont |        97          3 |       100 
             Virginia |       504         90 |       594 
           Washington |       209         84 |       293 
        West Virginia |       384          3 |       387 
            Wisconsin |       413        117 |       530 
              Wyoming |       160          3 |       163 
----------------------+----------------------+----------
                Total |    18,591      3,891 |    22,482 

. tab year proptx_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |     2,658        430 |     3,088 
      2017 |     2,658        430 |     3,088 
      2018 |     2,658        430 |     3,088 
      2019 |     2,658        430 |     3,088 
      2020 |     2,658        430 |     3,088 
      2021 |     2,658        430 |     3,088 
      2022 |     2,643        437 |     3,080 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |    18,591      3,891 |    22,482 

. 
. ** Rename for clarity
. rename prop_rate_mean prop_tax_rate

. rename prop_rate_se prop_tax_rate_se

. label var prop_tax_rate "Mean property tax rate (% of home value)"

. label var prop_tax_rate_se "SE of property tax rate"

. 
. ** Organize data
. order year fips state_* county_*

. sort fips year

. isid fips year

. 
. ** Keep only sample with non-missing base populations
. tab county_name year if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022

                      |  Tax year
                      |   (year
                      |   before
                      |   move)
          County name |      2017 |     Total
----------------------+-----------+----------
        Loving County |         1 |         1 
----------------------+-----------+----------
                Total |         1 |         1 

. drop if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022
(1 observation deleted)

. 
. ** Keep only sample with observations in each year
. bysort fips: gen ct = _N

. tab county_name state_name if ct < 7

                      |      State name
          County name | Connect..      Texas |     Total
----------------------+----------------------+----------
     Fairfield County |         6          0 |         6 
      Hartford County |         6          0 |         6 
    Litchfield County |         6          0 |         6 
        Loving County |         0          6 |         6 
     Middlesex County |         6          0 |         6 
     New Haven County |         6          0 |         6 
    New London County |         6          0 |         6 
       Tolland County |         6          0 |         6 
       Windham County |         6          0 |         6 
----------------------+----------------------+----------
                Total |        48          6 |        54 

. drop if ct < 7
(54 observations deleted)

. drop ct

. 
. ** Generate IRS sample
. gen irs_sample_1 = inrange(year, 2016, 2022)

. gen irs_sample_2 = inrange(year, 2016, 2022) & merge_acs_1 != 1

. 
. ** Generate ACS Period Indicators
. gen acs_period_1 = merge_acs_1 != 1 & inrange(year, 2016, 2022)

. gen acs_period_2 = merge_acs_1 != 1

. 
. ** Make sure we have a balanced panel of ACS counties
. gen tmp = merge_acs_1 != 1

. bysort fips: egen ct_tmp = total(tmp)

. replace acs_period_1 = 0 if ct_tmp != 9
(246 real changes made)

. replace acs_period_2 = 0 if ct_tmp != 9
(342 real changes made)

. replace irs_sample_2 = 0 if ct_tmp != 9
(246 real changes made)

. drop tmp ct_tmp

. 
. tab year irs_sample_1

  Tax year |
     (year |
    before |     irs_sample_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |         0      3,079 |     3,079 
      2017 |         0      3,079 |     3,079 
      2018 |         0      3,079 |     3,079 
      2019 |         0      3,079 |     3,079 
      2020 |         0      3,079 |     3,079 
      2021 |         0      3,079 |     3,079 
      2022 |         0      3,079 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |       874     21,553 |    22,427 

. tab year irs_sample_2

  Tax year |
     (year |
    before |     irs_sample_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_1

  Tax year |
     (year |
    before |     acs_period_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_2

  Tax year |
     (year |
    before |     acs_period_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |        48        389 |       437 
      2024 |        48        389 |       437 
-----------+----------------------+----------
     Total |    18,926      3,501 |    22,427 

. tab state_name acs_period_1

                      |     acs_period_1
           State name |         0          1 |     Total
----------------------+----------------------+----------
              Alabama |       458         21 |       479 
               Alaska |       191          7 |       198 
              Arizona |        92         21 |       113 
             Arkansas |       510         21 |       531 
           California |       236        238 |       474 
             Colorado |       445          7 |       452 
             Delaware |         6         21 |        27 
 District of Columbia |         2          7 |         9 
              Florida |       339        196 |       535 
              Georgia |     1,017        140 |     1,157 
               Hawaii |        11         14 |        25 
                Idaho |       303          7 |       310 
             Illinois |       656         84 |       740 
              Indiana |       564        112 |       676 
                 Iowa |       675         28 |       703 
               Kansas |       720         21 |       741 
             Kentucky |       819         35 |       854 
            Louisiana |       413         49 |       462 
                Maine |       102         14 |       116 
             Maryland |       113         77 |       190 
        Massachusetts |       102         14 |       116 
             Michigan |       501        112 |       613 
            Minnesota |       583         42 |       625 
          Mississippi |       559         21 |       580 
             Missouri |       784         35 |       819 
              Montana |       394          0 |       394 
             Nebraska |       636         21 |       657 
               Nevada |       109         14 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        62        119 |       181 
           New Mexico |       221         14 |       235 
             New York |       336        140 |       476 
       North Carolina |       610        126 |       736 
         North Dakota |       366          7 |       373 
                 Ohio |       525        133 |       658 
             Oklahoma |       526         21 |       547 
               Oregon |       219         49 |       268 
         Pennsylvania |       369        140 |       509 
         Rhode Island |        20         21 |        41 
       South Carolina |       331          7 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       638         49 |       687 
                Texas |     1,581        266 |     1,847 
                 Utah |       178         35 |       213 
              Vermont |       100          0 |       100 
             Virginia |       531         63 |       594 
           Washington |       230         63 |       293 
        West Virginia |       387          0 |       387 
            Wisconsin |       439         91 |       530 
              Wyoming |       163          0 |       163 
----------------------+----------------------+----------
                Total |    19,704      2,723 |    22,427 

. 
. ** Define treated state
. gen multnomah = state_fips == 41 & county_fips == 51

. label var multnomah "Indicator for Multnomah County, Oregon"

. 
. ** Define treatment indicator
. gen Treated = multnomah == 1 & year > 2020

. label var Treated "Treatment indicator for Multnomah County, Oregon"

. 
. ** Define sample 1: All counties
. gen sample_all = 1

. label var sample_all "All counties (excluding AK, CA, HI OR, WA)"

. 
. ** Define sample 2: Counties in top 95 percent
. summ percent_urban if year == 2020, de

            Percent of population in urban areas
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs               3,079
25%            0              0       Sum of wgt.       3,079

50%     .3256337                      Mean           .3521437
                        Largest       Std. dev.       .332065
75%     .6326353              1
90%      .847923              1       Variance       .1102672
95%     .9372299              1       Skewness       .3661052
99%     .9972304              1       Kurtosis       1.763629

. local cutoff = r(p95)

. tab state_name multnomah if percent_urban >= `cutoff' & year == 2020

                      |     Indicator for
                      |   Multnomah County,
                      |        Oregon
           State name |         0          1 |     Total
----------------------+----------------------+----------
               Alaska |         1          0 |         1 
              Arizona |         1          0 |         1 
           California |        15          0 |        15 
             Colorado |         4          0 |         4 
             Delaware |         1          0 |         1 
 District of Columbia |         1          0 |         1 
              Florida |        13          0 |        13 
              Georgia |         8          0 |         8 
               Hawaii |         1          0 |         1 
                Idaho |         1          0 |         1 
             Illinois |         5          0 |         5 
              Indiana |         3          0 |         3 
                 Iowa |         1          0 |         1 
               Kansas |         2          0 |         2 
             Kentucky |         2          0 |         2 
            Louisiana |         3          0 |         3 
             Maryland |         3          0 |         3 
        Massachusetts |         5          0 |         5 
             Michigan |         3          0 |         3 
            Minnesota |         3          0 |         3 
             Missouri |         4          0 |         4 
             Nebraska |         2          0 |         2 
               Nevada |         3          0 |         3 
           New Jersey |        10          0 |        10 
           New Mexico |         2          0 |         2 
             New York |         9          0 |         9 
       North Carolina |         4          0 |         4 
                 Ohio |         6          0 |         6 
             Oklahoma |         1          0 |         1 
               Oregon |         1          1 |         2 
         Pennsylvania |         4          0 |         4 
         Rhode Island |         2          0 |         2 
            Tennessee |         2          0 |         2 
                Texas |        11          0 |        11 
                 Utah |         4          0 |         4 
             Virginia |        10          0 |        10 
           Washington |         1          0 |         1 
            Wisconsin |         1          0 |         1 
----------------------+----------------------+----------
                Total |       153          1 |       154 

. gen sample_urban95 = percent_urban >= `cutoff' // All counties

. label var sample_urban95 "Urban counties (top 5%) (excluding AK, CA, HI OR, WA)"

. tab sample_urban95 if year == 2020

      Urban |
   counties |
   (top 5%) |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,925       95.00       95.00
          1 |        154        5.00      100.00
------------+-----------------------------------
      Total |      3,079      100.00

. 
. ** Define sample 3: Counties in top 98 percent
. local cutoff = .9864539 //

. tab state_name multnomah if percent_urban >= `cutoff' & year == 2020

                      |     Indicator for
                      |   Multnomah County,
                      |        Oregon
           State name |         0          1 |     Total
----------------------+----------------------+----------
           California |         6          0 |         6 
             Colorado |         2          0 |         2 
 District of Columbia |         1          0 |         1 
              Florida |         4          0 |         4 
              Georgia |         5          0 |         5 
             Illinois |         2          0 |         2 
              Indiana |         1          0 |         1 
            Louisiana |         1          0 |         1 
             Maryland |         1          0 |         1 
        Massachusetts |         1          0 |         1 
             Michigan |         1          0 |         1 
            Minnesota |         1          0 |         1 
             Missouri |         1          0 |         1 
               Nevada |         1          0 |         1 
           New Jersey |         6          0 |         6 
             New York |         7          0 |         7 
       North Carolina |         1          0 |         1 
                 Ohio |         1          0 |         1 
               Oregon |         0          1 |         1 
         Pennsylvania |         2          0 |         2 
         Rhode Island |         1          0 |         1 
                Texas |         3          0 |         3 
                 Utah |         2          0 |         2 
             Virginia |         8          0 |         8 
            Wisconsin |         1          0 |         1 
----------------------+----------------------+----------
                Total |        60          1 |        61 

. gen sample_urban98 = percent_urban >= `cutoff' // All counties

. label var sample_urban98 "Urban counties (top 1%) (excluding AK, CA, HI OR, WA)"

. tab sample_urban98 if year == 2020

      Urban |
   counties |
   (top 1%) |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,018       98.02       98.02
          1 |         61        1.98      100.00
------------+-----------------------------------
      Total |      3,079      100.00

. 
. ** Define Sample of States
. drop if state_name == "Alaska"
(198 observations deleted)

. drop if state_name == "Hawaii"
(25 observations deleted)

. drop if state_name == "California"
(474 observations deleted)

. drop if state_name == "Washington"
(293 observations deleted)

. drop if state_name == "Oregon" & multnomah == 0
(259 observations deleted)

. 
. ** Define sample 4: Counties in top 95 + covid
. cluster kmeans cases_cum* deaths_cum* if        ///
>         sample_urban95 == 1 & year == 2020 & covid_merge == 3 , k(5) gen(kmean)
cluster name: _clus_1

. bysort fips: egen kmean_group = mean(kmean)
(20,046 missing values generated)

. 
. ** Pull out kmeans cluster with Multnoma
. gen tmp1 = kmean if sample_urban95 == 1 & year == 2020 & covid_merge == 3 & multnomah == 1
(21,177 missing values generated)

. egen tmp2 = mean(tmp1)

. gen sample_urban95_covid = sample_urban95 == 1 & kmean_group == tmp2

. drop tmp1 tmp2

. label var sample_urban95_covid "Urban counties (top 5%) w. Kmean Covid Match  (excluding AK, CA,
>  HI OR, WA)"

. tab sample_urban95_covid if year == 2020

      Urban |
   counties |
(top 5%) w. |
Kmean Covid |
      Match |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,879       98.73       98.73
          1 |         37        1.27      100.00
------------+-----------------------------------
      Total |      2,916      100.00

. 
. ** Show results across clusters
. preserve

. 
. ** Keep required variables
. keep if sample_urban95 == 1 & year == 2020 & covid_merge == 3
(21,048 observations deleted)

. keep kmean cases_cum* deaths_cum* population

. collapse (mean) cases_cum* deaths_cum* [fw = population], by(kmean)

. reshape long cases_cum deaths_cum, i(kmean) j(time)
(j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations                5   ->   145         
Number of variables                  59   ->   4           
j variable (29 values)                    ->   time
xij variables:
  cases_cum1 cases_cum2 ... cases_cum29   ->   cases_cum
deaths_cum1 deaths_cum2 ... deaths_cum29  ->   deaths_cum
-----------------------------------------------------------------------------

. xtset kmean time

Panel variable: kmean (strongly balanced)
 Time variable: time, 1 to 29
         Delta: 1 unit

. xtline cases_cum

. graph export "${results}sdid/fig_kmeans.jpg", as(jpg) name("Graph") quality(100) replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/fig_kmeans.jpg written in J
> PEG format

. clear

. 
. ** Restore
. restore

. 
. ** Define covariates
. local covariates "population per_capita_income"

. 
. ** Standardize covariates
. foreach v of local covariates {
  2.         egen tmp_v = std(`v')
  3.         replace `v' = tmp_v
  4.         drop tmp_v
  5. } // END COVAR LOOP
(21,178 real changes made)
(21,178 real changes made)

. 
. ** Define outcome variables (IRS)
. foreach x in "n1" "n2" "agi" {
  2. 
.         if "`x'" == "n1" local xtxt "returns"
  3.         else if "`x'" == "n2" local xtxt "exemptions"
  4.         else if "`x'" == "agi" local xtxt "AGI"
  5. 
.         ** Loop over migration type
.         foreach y in "net" "in" "out" {
  6. 
.                         if "`y'" == "net" local ytxt "Net domestic migration"
  7.                         else if "`y'" == "in" local ytxt "Domestic in-migration"
  8.                         else if "`y'" == "out" local ytxt "Domestic out-migration"
  9. 
.                         ** Generate
.                         gen `x'_`y'_rate_irs = 100 * (`x'_`y'_3 / (`x'_out_1 + `x'_out_2))
 10. 
.                         ** Label var
.                         label var `x'_`y'_rate_irs      "`ytxt' rate, `xtxt' (%)"
 11. 
.         } // END MIGRATION TYPE LOOP
 12. 
. } // END OUTCOME TYPE LOOP
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)

. 
. ** Define outcome variables (ACS)
. 
. ** Rename for loop
. rename acs*_households_* acs*_n1_*

. rename acs*_persons_* acs*_n2_*

. rename acs*_dollars_* acs*_agi_*

. 
. ** Loop over sample
. ** (18+ = 1, college degree == 2, no college degree == 3)
. forvalues i = 1/2{
  2. 
.         if `i' == 1 local itxt ""
  3.         else if `i' == 2 local itxt " (College)"
  4.         else if `i' == 3 local itxt " (No College)"
  5. 
. 
.         ** Define outcome variables (IRS)
.         foreach x in "n1" "n2" "agi" {
  6. 
.                 if "`x'" == "n1" local xtxt "HHs"
  7.                 else if "`x'" == "n2" local xtxt "persons"
  8.                 else if "`x'" == "agi" local xtxt "total income"
  9. 
. 
.                 ** Loop over migration type
.                 foreach y in "net" "in" "out" {
 10. 
.                                 if "`y'" == "net" local ytxt "Net domestic migration"
 11.                                 else if "`y'" == "in" local ytxt "Domestic in-migration"
 12.                                 else if "`y'" == "out" local ytxt "Domestic out-migration"
 13. 
.                                 ** Generate
.                                 gen `x'_`y'_rate_acs`i' = 100 * (acs`i'_`x'_`y'_3 / (acs`i'_`x'_
> out_1 + acs`i'_`x'_out_2))
 14. 
.                                 ** Label var
.                                 label var `x'_`y'_rate_acs`i' "`ytxt' rate, `xtxt'`itxt' (%)"
 15. 
.                 } // END MIGRATION TYPE LOOP
 16. 
.         } // END OUTCOME TYPE LOOP
 17. 
. } // END SAMPLE LOOP
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)

. 
. ** Declare panel
. xtset fips year

Panel variable: fips (unbalanced)
 Time variable: year, 2016 to 2024
         Delta: 1 unit

. 
. ** Tag unique fips
. egen unique = tag(fips)

. tab year unique

  Tax year |
     (year |
    before |       tag(fips)
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |         0      2,916 |     2,916 
      2017 |     2,916          0 |     2,916 
      2018 |     2,916          0 |     2,916 
      2019 |     2,916          0 |     2,916 
      2020 |     2,916          0 |     2,916 
      2021 |     2,916          0 |     2,916 
      2022 |     2,916          0 |     2,916 
      2023 |       383          0 |       383 
      2024 |       383          0 |       383 
-----------+----------------------+----------
     Total |    18,262      2,916 |    21,178 

. 
. ** Label var
. label var year "Year (destination)"

. 
. /*******************************************************************************
> SECTION 3: CREATE TABLE-LEVEL SPECIFICATION GRID
> Each row represents one table = 6 SDID specs (3 outcomes  2 covariate settings)
> *******************************************************************************/
. 
. ** Save main analysis data
. save "${data}working/sdid_analysis_data.dta", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/sdid_analysis_data.dta
    saved

. 
. ** Create table-level specification grid
. preserve

. clear

. 
. ** Table units are defined by:
. ** - data_var (irs_sample_1, irs_sample_2, acs_period_1, acs_period_2)
. ** - out_type (irs, acs1, acs2) - but tied to data_var
. ** - samp_var (sample_all, sample_urban95, sample_urban95_covid)
. ** - exclusion (0, 1)
. ** - migr_type (net, in, out)
. ** Total: 6 data-type combos  3 samples  2 exclusions  3 migrations = 108 tables
. 
. local table_id = 0

. 
. ** Initialize empty dataset
. set obs 0
Number of observations (_N) was 0, now 0.

. gen table_id = .

. gen data_var = ""

. gen out_type = ""

. gen out_txt = ""

. gen samp_var = ""

. gen exclusion = .

. gen migr_type = ""

. 
. save "${data}working/table_grid.dta", replace
(dataset contains 0 observations)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved

. 
. ** Build table grid
. foreach data in "irs_sample_1" "irs_sample_2" "acs_period_1" "acs_period_2" {
  2. 
.         ** Different sets of outcome variable types
.         if "`data'" == "irs_sample_1" | "`data'" == "irs_sample_2" {
  3.                 local out_types "irs"
  4.         }
  5.         else {
  6.                 local out_types "acs1 acs2"
  7.         }
  8. 
.         foreach type of local out_types {
  9. 
.                 ** Labels
.                 if "`data'" == "irs_sample_1" local out_txt "irs_full_16_22"
 10.                 else if "`data'" == "irs_sample_2" local out_txt "irs_389_16_22"
 11.                 else if "`data'" == "acs_period_1" & "`type'" == "acs1" local out_txt "acs_16
> _22_all"
 12.                 else if "`data'" == "acs_period_1" & "`type'" == "acs2" local out_txt "acs_16
> _22_col"
 13.                 else if "`data'" == "acs_period_2" & "`type'" == "acs1" local out_txt "acs_16
> _24_all"
 14.                 else if "`data'" == "acs_period_2" & "`type'" == "acs2" local out_txt "acs_16
> _24_col"
 15. 
.                 foreach samp in "sample_all" "sample_urban95" "sample_urban95_covid" {
 16.                         forvalues exl = 0/1 {
 17.                                 foreach migr in "net" "in" "out" {
 18. 
.                                         local table_id = `table_id' + 1
 19. 
.                                         ** Add row to grid
.                                         clear
 20.                                         set obs 1
 21.                                         gen table_id = `table_id'
 22.                                         gen data_var = "`data'"
 23.                                         gen out_type = "`type'"
 24.                                         gen out_txt = "`out_txt'"
 25.                                         gen samp_var = "`samp'"
 26.                                         gen exclusion = `exl'
 27.                                         gen migr_type = "`migr'"
 28. 
.                                         append using "${data}working/table_grid.dta"
 29.                                         save "${data}working/table_grid.dta", replace
 30. 
.                                 }
 31.                         }
 32.                 }
 33.         }
 34. }
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved

. 
. ** Load and verify grid
. use "${data}working/table_grid.dta", clear

. dis "Total table units: " _N
Total table units: 108

. sort table_id

. save "${data}working/table_grid.dta", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved

. 
. restore

. 
. /*******************************************************************************
> SECTION 4: DEFINE PARALLEL PROGRAM FOR TABLE-LEVEL SDID ESTIMATION
> Each call runs 6 SDID specs and generates one table
> *******************************************************************************/
. 
. ** Define program to run all SDID specifications for one table
. capture program drop run_sdid_table

. program define run_sdid_table
  1.         syntax, table_id(integer) data_path(string) results_path(string) reps(integer)
  2. 
.         ** Load table specification from grid
.         preserve
  3.         use "`data_path'working/table_grid.dta", clear
  4.         keep if table_id == `table_id'
  5. 
.         ** Extract specification parameters
.         local data_var = data_var[1]
  6.         local out_type = out_type[1]
  7.         local out_txt = out_txt[1]
  8.         local samp_var = samp_var[1]
  9.         local exl = exclusion[1]
 10.         local migr = migr_type[1]
 11. 
.         restore
 12. 
.         ** Load main analysis data
.         use "`data_path'working/sdid_analysis_data.dta", clear
 13. 
.         ** Define sample
.         gen sample = `samp_var' == 1 & `data_var' == 1
 14.         if `exl' == 1 replace sample = 0 if year == 2020
 15. 
.         ** Skip if no treated unit in sample
.         qui count if multnomah == 1 & sample == 1
 16.         if r(N) == 0 {
 17.                 dis "Skipping table `table_id': no treated unit in sample"
 18.                 exit
 19.         }
 20. 
.         ** Create output directory
.         capture mkdir "`results_path'sdid/`out_txt'"
 21. 
.         ** Define covariates
.         if "`data_var'" == "irs_sample_1" local covariates "population per_capita_income"
 22.         else local covariates "population per_capita_income prop_rate_mean"
 23. 
.         ** Clear stored estimates
.         eststo clear
 24. 
.         ** Loop over outcomes (n1, n2, agi) and covariate settings (0, 1)
.         foreach outvar in "n1" "n2" "agi" {
 25. 
.                 ** Full outcome variable name
.                 local outcome "`outvar'_`migr'_rate_`out_type'"
 26. 
.                 ** Store label
.                 local label : variable label `outcome'
 27. 
.                 ** Loop over covariate settings
.                 forvalues c = 0/1 {
 28. 
.                         ** Covariates for sdid (supports 'projected' option)
.                         if `c' == 0 local covars ""
 29.                         else if `c' == 1 local covars "covariates(`covariates', projected)"
 30. 
.                         ** Covariates for sdid_event (doesn't support 'projected' option)
.                         if `c' == 0 local covars_event ""
 31.                         else if `c' == 1 local covars_event "covariates(`covariates')"
 32. 
.                         ** File paths for figures
.                         if `exl' == 0 local path "`results_path'sdid/`out_txt'/fig_`out_txt'_`ou
> tcome'_`c'_`samp_var'_"
 33.                         if `exl' == 1 local path "`results_path'sdid/`out_txt'/fig_`out_txt'_
> `outcome'_`c'_`samp_var'_excl2020_"
 34. 
.                         ** Run SDID
.                         capture noisily {
 35.                                 eststo sdid_`outvar'_`c': sdid `outcome' fips year Treated   
>    ///
>                                         if sample == 1,                         ///
>                                         vce(placebo)                            ///
>                                         `covars'                                        ///
>                                         reps(`reps')                            ///
>                                         graph graph_export("`path'", .pdf)
 36.                         }
 37. 
.                         ** Store results
.                         local tmp_tau = e(ATT)
 38.                         local tmp_se = e(se)
 39.                         matrix omega = e(omega)
 40. 
.                         ** Pre-treatment mean and county count
.                         qui summ `outcome' if multnomah == 1 & Treated == 0
 41.                         local tmp_premean = r(mean)
 42.                         estadd scalar mean = r(mean)
 43. 
.                         qui summ `outcome' if year == 2021 & sample == 1
 44.                         local tmp_ncounties = r(N)
 45.                         estadd scalar count = r(N)
 46. 
.                         ** Save treatment effect results
.                         preserve
 47.                         clear
 48.                         set obs 1
 49.                         gen table_id = `table_id'
 50.                         gen sample_data = "`out_txt'"
 51.                         gen sample = "`samp_var'"
 52.                         gen outcome = "`outcome'"
 53.                         gen controls = `c'
 54.                         gen exclusion = `exl'
 55.                         gen tau = `tmp_tau'
 56.                         gen se = `tmp_se'
 57.                         gen pval = 2 * (1 - normal(abs(tau/se)))
 58.                         gen ci_lower = tau - 1.96 * se
 59.                         gen ci_upper = tau + 1.96 * se
 60.                         gen n_counties = `tmp_ncounties'
 61.                         gen pre_mean = `tmp_premean'
 62.                         save "`results_path'sdid/temp_results/results_`table_id'_`outvar'_`c'
> .dta", replace
 63.                         restore
 64. 
.                         ** Save weights
.                         preserve
 65.                         clear
 66.                         svmat double omega, names(col)
 67.                         rename c2 fips
 68.                         rename c1 weight
 69.                         gen table_id = `table_id'
 70.                         gen sample_data = "`out_txt'"
 71.                         gen out = "`outcome'"
 72.                         gen sample = "`samp_var'"
 73.                         gen controls = `c'
 74.                         gen exclusion = `exl'
 75.                         drop if weight == 0
 76.                         drop if missing(fips)
 77.                         save "`results_path'sdid/temp_weights/weights_`table_id'_`outvar'_`c'
> .dta", replace
 78.                         restore
 79. 
. 
.                         ** Run event study
.                         capture noisily {
 80.                                 sdid_event `outcome' fips year Treated  ///
>                                         if sample == 1,                                         
> ///
>                                         `covars_event'                                          
> ///
>                                         vce(placebo)                                            
> ///
>                                         brep(`reps')                                            
> ///
>                                         placebo(all)
 81.                         }
 82. 
.                         local event_rc = _rc
 83. 
.                         if `event_rc' == 0 {
 84. 
.                                 ** Store max year
.                                 qui summ year if multnomah == 1 & sample == 1
 85.                                 local max_yr = r(max)
 86. 
.                                 ** Move results from matrix to data
.                                 qui count if multnomah == 1 & sample == 1
 87.                                 local ct = r(N)
 88.                                 local ct = `ct' + 1
 89. 
.                                 ** Extract matrix
.                                 capture mat res = e(H)[2..`ct',1..5]
 90.                                 if _rc != 0 {
 91.                                         continue
 92.                                 }
 93. 
.                                 ** Move to data
.                                 svmat res
 94. 
.                                 ** Generate ID variable
.                                 gen id = `max_yr' - _n + 1 if !missing(res1)
 95. 
.                                 ** Handle exclusion year labeling
.                                 if `exl' == 1 {
 96.                                         replace id = id - 1 if id <= 2020
 97.                                         expand 2 if id == 2019, gen(tag)
 98.                                         replace id = 2020 if tag == 1
 99.                                         replace res1 = . if tag == 1
100.                                         replace res3 = . if tag == 1
101.                                         replace res4 = . if tag == 1
102.                                 }
103.                                 label var id "Year (destination)"
104. 
.                                 ** Sort
.                                 sort id
105. 
.                                 ** Plot
.                                 twoway  (rcap res3 res4 id, lc(gs10) fc(gs11%50))       ///
>                                                 (scatter res1 id, mc(black)),                   
>         ///
>                                         legend(off) ytitle("`label'")                           
>         ///
>                                         yline(0, lc(red) lp(-))                                 
>                 ///
>                                         xline(2020.5, lc(black) lp(solid))                      
>         ///
>                                         ylabel(-10(2.5)10, format(%9.1f))
106. 
.                                 if `exl' == 1 local evpath "`results_path'sdid/`out_txt'/fig_`ou
> t_txt'_`outcome'_`c'_`samp_var'_excl2020_eventstudy.jpg"
107.                                 else local evpath "`results_path'sdid/`out_txt'/fig_`out_txt'
> _`outcome'_`c'_`samp_var'_eventstudy.jpg"
108. 
.                                 graph export "`evpath'", as(jpg) name("Graph") quality(100) repl
> ace
109. 
.                                 ** Clean up graph variables
.                                 drop res1 res2 res3 res4 res5 id
110.                                 capture drop tag
111. 
.                         }
112.         
.                         ** Clean up sdid_event internal variables (prevents "already defined" er
> ror on next iteration)
.                         capture drop ever_treated*
113. 
.                 } // END COVAR LOOP
114. 
.         } // END OUTCOME LOOP
115. 
.         ** Generate table for this migration type (all 6 specs)
.         ** Determine table path
.         if `exl' == 0 local tabpath "`results_path'sdid/`out_txt'/tab_sdid_`out_txt'_`migr'_`sam
> p_var'.tex"
116.         if `exl' == 1 local tabpath "`results_path'sdid/`out_txt'/tab_sdid_`out_txt'_`migr'_`
> samp_var'_excl2020.tex"
117. 
.         ** Check if we have all estimates
.         capture confirm matrix e(b)
118. 
.         ** Generate table based on data type
.         if "`data_var'" == "irs_sample_1" | "`data_var'" == "irs_sample_2" {
119.                 capture noisily {
120.                         esttab  sdid_n1_0 sdid_n1_1     ///
>                                         sdid_n2_0 sdid_n2_1     ///
>                                         sdid_agi_0 sdid_agi_1 ///
>                                 using "`tabpath'",                                              
>                 ///
>                                 starlevel("*" 0.10 "**" 0.05 "***" 0.01)                ///
>                                 b(%-9.3f) se(%-9.3f) replace                                    
> ///
>                                 mgroups("Returns" "Exemptions" "AGI",                   ///
>                                         pattern(1 0 1 0 1 0) )                                  
>         ///
>                                 mtitle( "No Covariates" "Covariates"                    ///
>                                                 "No Covariates" "Covariates"                    
> ///
>                                                 "No Covariates" "Covariates")                   
> ///
>                                 stats(count mean,                                               
>                 ///
>                                         fmt(%9.0fc %9.3fc)                                      
>                 ///
>                                         labels("Number of Counties" "Pre-treatment mean"))
121.                 }
122.         }
123.         else {
124.                 capture noisily {
125.                         esttab  sdid_n1_0 sdid_n1_1     ///
>                                         sdid_n2_0 sdid_n2_1     ///
>                                         sdid_agi_0 sdid_agi_1 ///
>                                 using "`tabpath'",                                              
>                 ///
>                                 starlevel("*" 0.10 "**" 0.05 "***" 0.01)                ///
>                                 b(%-9.3f) se(%-9.3f) replace                                    
> ///
>                                 mgroups("Households" "Adults" "Household Income",       ///
>                                         pattern(1 0 1 0 1 0) )                                  
>         ///
>                                 mtitle( "No Covariates" "Covariates"                    ///
>                                                 "No Covariates" "Covariates"                    
> ///
>                                                 "No Covariates" "Covariates")                   
> ///
>                                 stats(count mean,                                               
>                 ///
>                                         fmt(%9.0fc %9.3fc)                                      
>                 ///
>                                         labels("Number of Counties" "Pre-treatment mean"))
126.                 }
127.         }
128. 
.         dis "Completed table `table_id': `out_txt' / `migr' / `samp_var' / excl=`exl'"
129. 
. end

. 
. /*******************************************************************************
> SECTION 5: CREATE TEMPORARY DIRECTORIES AND RUN PARALLEL ESTIMATION
> *******************************************************************************/
. 
. ** Create temp directories for results
. capture mkdir "${results}sdid/temp_results"

. capture mkdir "${results}sdid/temp_weights"

. 
. ** Create subfolders for each output type
. foreach out_txt in "irs_full_16_22" "irs_389_16_22" "acs_16_22_all" "acs_16_22_col" "acs_16_24_a
> ll" "acs_16_24_col" {
  2.         capture mkdir "${results}sdid/`out_txt'"
  3. }

. 
. ** Load table grid
. use "${data}working/table_grid.dta", clear

. local n_tables = _N

. dis "Running `n_tables' table units in parallel (each with 6 SDID specs)..."
Running 108 table units in parallel (each with 6 SDID specs)...

. 
. ** Save table IDs for parallel processing
. ** IMPORTANT: Shuffle table order to balance workload across workers
. ** Without shuffling, child 1 gets all sample_all specs (heaviest computation)
. preserve

. keep table_id

. 
. ** Generate random sort order and shuffle
. gen rand_order = runiform()

. sort rand_order

. drop rand_order

. 
. save "${data}working/table_ids.dta", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_ids.dta saved

. restore

. 
. ** Define wrapper program for parallel execution
. capture program drop parallel_sdid_wrapper

. program define parallel_sdid_wrapper
  1.         ** Store all table_ids upfront (run_sdid_table will overwrite the dataset)
.         local n_obs = _N
  2.         forvalues i = 1/`n_obs' {
  3.                 local tid_`i' = table_id[`i']
  4.         }
  5. 
.         ** Now loop through and process each table
.         forvalues i = 1/`n_obs' {
  6.                 dis "Worker processing table `tid_`i'' (`i' of `n_obs' in this chunk)"
  7.                 run_sdid_table, table_id(`tid_`i'') data_path("${data}") results_path("${resu
> lts}") reps(100)
  8.         }
  9. end

. 
. ** Load table IDs and run in parallel
. use "${data}working/table_ids.dta", clear

. 
. ** Run parallel estimation
. dis "Starting parallel SDID estimation at $S_TIME..."
Starting parallel SDID estimation at 20:49:13...

. dis "Each parallel worker processes one table (6 SDID specifications)"
Each parallel worker processes one table (6 SDID specifications)

. timer clear 1

. timer on 1

. 
. parallel, prog(parallel_sdid_wrapper run_sdid_table): parallel_sdid_wrapper
--------------------------------------------------------------------------------
Exporting the following program(s): parallel_sdid_wrapper run_sdid_table

parallel_sdid_wrapper:
  1.         local n_obs = _N
  2.         forvalues i = 1/`n_obs' {
  3.                 local tid_`i' = table_id[`i']
  4.         }
  5.         forvalues i = 1/`n_obs' {
  6.                 dis "Worker processing table `tid_`i'' (`i' of `n_obs' in this chunk)"
  7.                 run_sdid_table, table_id(`tid_`i'') data_path("${data}") results_path("${resu
> lts}") reps(100)
  8.         }

run_sdid_table:
  1.         syntax, table_id(integer) data_path(string) results_path(string) reps(integer)
  2.         preserve
  3.         use "`data_path'working/table_grid.dta", clear
  4.         keep if table_id == `table_id'
  5.         local data_var = data_var[1]
  6.         local out_type = out_type[1]
  7.         local out_txt = out_txt[1]
  8.         local samp_var = samp_var[1]
  9.         local exl = exclusion[1]
 10.         local migr = migr_type[1]
 11.         restore
 12.         use "`data_path'working/sdid_analysis_data.dta", clear
 13.         gen sample = `samp_var' == 1 & `data_var' == 1
 14.         if `exl' == 1 replace sample = 0 if year == 2020
 15.         qui count if multnomah == 1 & sample == 1
 16.         if r(N) == 0 {
 17.                 dis "Skipping table `table_id': no treated unit in sample"
 18.                 exit
 19.         }
 20.         capture mkdir "`results_path'sdid/`out_txt'"
 21.         if "`data_var'" == "irs_sample_1" local covariates "population per_capita_income"
 22.         else local covariates "population per_capita_income prop_rate_mean"
 23.         eststo clear
 24.         foreach outvar in "n1" "n2" "agi" {
 25.                 local outcome "`outvar'_`migr'_rate_`out_type'"
 26.                 local label : variable label `outcome'
 27.                 forvalues c = 0/1 {
 28.                         if `c' == 0 local covars ""
 29.                         else if `c' == 1 local covars "covariates(`covariates', projected)"
 30.                         if `c' == 0 local covars_event ""
 31.                         else if `c' == 1 local covars_event "covariates(`covariates')"
 32.                         if `exl' == 0 local path "`results_path'sdid/`out_txt'/fig_`out_txt'_
> `outcome'_`c'_`samp_var'_"
 33.                         if `exl' == 1 local path "`results_path'sdid/`out_txt'/fig_`out_txt'_
> `outcome'_`c'_`samp_var'_excl2020_"
 34.                         capture noisily {
 35.                                 eststo sdid_`outvar'_`c': sdid `outcome' fips year Treated if
>  sample == 1, vce(placebo) `covars' reps(`reps') graph graph_export("`path'", .pdf)
 36.                         }
 37.                         local tmp_tau = e(ATT)
 38.                         local tmp_se = e(se)
 39.                         matrix omega = e(omega)
 40.                         qui summ `outcome' if multnomah == 1 & Treated == 0
 41.                         local tmp_premean = r(mean)
 42.                         estadd scalar mean = r(mean)
 43.                         qui summ `outcome' if year == 2021 & sample == 1
 44.                         local tmp_ncounties = r(N)
 45.                         estadd scalar count = r(N)
 46.                         preserve
 47.                         clear
 48.                         set obs 1
 49.                         gen table_id = `table_id'
 50.                         gen sample_data = "`out_txt'"
 51.                         gen sample = "`samp_var'"
 52.                         gen outcome = "`outcome'"
 53.                         gen controls = `c'
 54.                         gen exclusion = `exl'
 55.                         gen tau = `tmp_tau'
 56.                         gen se = `tmp_se'
 57.                         gen pval = 2 * (1 - normal(abs(tau/se)))
 58.                         gen ci_lower = tau - 1.96 * se
 59.                         gen ci_upper = tau + 1.96 * se
 60.                         gen n_counties = `tmp_ncounties'
 61.                         gen pre_mean = `tmp_premean'
 62.                         save "`results_path'sdid/temp_results/results_`table_id'_`outvar'_`c'
> .dta", replace
 63.                         restore
 64.                         preserve
 65.                         clear
 66.                         svmat double omega, names(col)
 67.                         rename c2 fips
 68.                         rename c1 weight
 69.                         gen table_id = `table_id'
 70.                         gen sample_data = "`out_txt'"
 71.                         gen out = "`outcome'"
 72.                         gen sample = "`samp_var'"
 73.                         gen controls = `c'
 74.                         gen exclusion = `exl'
 75.                         drop if weight == 0
 76.                         drop if missing(fips)
 77.                         save "`results_path'sdid/temp_weights/weights_`table_id'_`outvar'_`c'
> .dta", replace
 78.                         restore
 79.                         capture noisily {
 80.                                 sdid_event `outcome' fips year Treated if sample == 1, `covar
> s_event' vce(placebo) brep(`reps') placebo(all)
 81.                         }
 82.                         local event_rc = _rc
 83.                         if `event_rc' == 0 {
 84.                                 qui summ year if multnomah == 1 & sample == 1
 85.                                 local max_yr = r(max)
 86.                                 qui count if multnomah == 1 & sample == 1
 87.                                 local ct = r(N)
 88.                                 local ct = `ct' + 1
 89.                                 capture mat res = e(H)[2..`ct',1..5]
 90.                                 if _rc != 0 {
 91.                                         continue
 92.                                 }
 93.                                 svmat res
 94.                                 gen id = `max_yr' - _n + 1 if !missing(res1)
 95.                                 if `exl' == 1 {
 96.                                         replace id = id - 1 if id <= 2020
 97.                                         expand 2 if id == 2019, gen(tag)
 98.                                         replace id = 2020 if tag == 1
 99.                                         replace res1 = . if tag == 1
100.                                         replace res3 = . if tag == 1
101.                                         replace res4 = . if tag == 1
102.                                 }
103.                                 label var id "Year (destination)"
104.                                 sort id
105.                                 twoway (rcap res3 res4 id, lc(gs10) fc(gs11%50)) (scatter res
> 1 id, mc(black)), legend(off) ytitle("`label'") yline(0, lc(red) lp(-)) xline(2020.5, lc(black) 
> lp(solid)) ylabel(-10(2.5)10, format(%9.1f))
106.                                 if `exl' == 1 local evpath "`results_path'sdid/`out_txt'/fig_
> `out_txt'_`outcome'_`c'_`samp_var'_excl2020_eventstudy.jpg"
107.                                 else local evpath "`results_path'sdid/`out_txt'/fig_`out_txt'
> _`outcome'_`c'_`samp_var'_eventstudy.jpg"
108.                                 graph export "`evpath'", as(jpg) name("Graph") quality(100) r
> eplace
109.                                 drop res1 res2 res3 res4 res5 id
110.                                 capture drop tag
111.                         }
112.                         capture drop ever_treated*
113.                 }
114.         }
115.         if `exl' == 0 local tabpath "`results_path'sdid/`out_txt'/tab_sdid_`out_txt'_`migr'_`
> samp_var'.tex"
116.         if `exl' == 1 local tabpath "`results_path'sdid/`out_txt'/tab_sdid_`out_txt'_`migr'_`
> samp_var'_excl2020.tex"
117.         capture confirm matrix e(b)
118.         if "`data_var'" == "irs_sample_1" | "`data_var'" == "irs_sample_2" {
119.                 capture noisily {
120.                         esttab sdid_n1_0 sdid_n1_1 sdid_n2_0 sdid_n2_1 sdid_agi_0 sdid_agi_1 
> using "`tabpath'", starlevel("*" 0.10 "**" 0.05 "***" 0.01) b(%-9.3f) se(%-9.3f) replace mgroups
> ("Returns" "Exemptions" "AGI", pattern(1 0 1 0 1 0) ) mtitle( "No Covariates" "Covariates" "No C
> ovariates" "Covariates" "No Covariates" "Covariates") stats(count mean, fmt(%9.0fc %9.3fc) label
> s("Number of Counties" "Pre-treatment mean"))
121.                 }
122.         }
123.         else {
124.                 capture noisily {
125.                         esttab sdid_n1_0 sdid_n1_1 sdid_n2_0 sdid_n2_1 sdid_agi_0 sdid_agi_1 
> using "`tabpath'", starlevel("*" 0.10 "**" 0.05 "***" 0.01) b(%-9.3f) se(%-9.3f) replace mgroups
> ("Households" "Adults" "Household Income", pattern(1 0 1 0 1 0) ) mtitle( "No Covariates" "Covar
> iates" "No Covariates" "Covariates" "No Covariates" "Covariates") stats(count mean, fmt(%9.0fc %
> 9.3fc) labels("Number of Counties" "Pre-treatment mean"))
126.                 }
127.         }
128.         dis "Completed table `table_id': `out_txt' / `migr' / `samp_var' / excl=`exl'"
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
Parallel Computing with Stata
Child processes: 6
pll_id         : sbqduvf385
Running at     : C:\Users\ji252\Documents\GitHub\multnomah-county-tax
Randtype       : datetime
Waiting for the child processes to finish...
child process 0003 Exited with error -111- while running the command/dofile (view log)...
child process 0004 Exited with error -111- while running the command/dofile (view log)...
child process 0006 Exited with error -111- while running the command/dofile (view log)...
child process 0005 Exited with error -111- while running the command/dofile (view log)...
child process 0001 Exited with error -111- while running the command/dofile (view log)...
child process 0002 Exited with error -111- while running the command/dofile (view log)...
--------------------------------------------------------------------------------
Enter -parallel printlog #- to checkout logfiles.
--------------------------------------------------------------------------------
6 child processes encountered errors. Throwing last error.
r(111);

end of do-file

r(111);

. parallel viewlog 3, e(sbqduvf385)

. use "${data}working/sdid_analysis_data.dta", clear

. des prop_tax_rate

Variable      Storage   Display    Value
    name         type    format    label      Variable label
--------------------------------------------------------------------------------------------------
prop_tax_rate   float   %9.0g                 Mean property tax rate (% of home value)

. do "C:\Users\ji252\AppData\Local\Temp\STD72bc_00000i.tmp"

. /*******************************************************************************
> File Name:              02_sdid_analysis_parallel.do
> Creator:                John Iselin (parallelized version)
> Date Update:    January 13, 2025
> 
> Called by: 00_multnomah.do
> 
> Purpose: Perform synthetic difference-in-difference estimation using parallel
>          processing to speed up computation across multiple specifications.
> 
>          Each parallel child runs all 6 specifications for one table:
>          - 3 outcome variables (n1, n2, agi) for a given migration type
>          - Each with 2 covariate settings (with/without controls)
>          This allows tables to be generated within each child process.
> 
> Requirements:
> - parallel package: net install parallel, from(https://raw.github.com/gvegayon/parallel/stable/)
>  replace
> 
> Outputs:
> - sdid_weights.dta/xlsx: Synthetic control weights for each specification
> - sdid_results.dta/xlsx: Treatment effects, SEs, p-values for each specification
> - tab_sdid_*.tex: LaTeX tables for each specification group
> - fig_speccurve_*.pdf/jpg: Specification curve plots
> 
> Authors: John Iselin
> 
> For more information, contact john.iselin@yale.edu
> 
> *******************************************************************************/
. 
. ** Start log file
. capture log close log_02

. log using "${logs}02_log_sdid_parallel_${date}", replace text name(log_02)
--------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_sdid_parallel_2
> 026-01-14.log
  log type:  text
 opened on:  14 Jan 2026, 20:58:01

. 
. /*******************************************************************************
> SECTION 1: SETUP AND CONFIGURATION
> *******************************************************************************/
. 
. ** Set number of parallel clusters (adjust based on your machine)
. ** Use fewer than total cores to leave resources for system
. local n_clusters = 6

. 
. ** Parameters
. local reps = 100

. 
. ** Initialize parallel processing
. parallel initialize `n_clusters', force
N Child processes: 6
Stata dir:  C:\Program Files\StataNow19/StataMP-64.exe

. 
. /*******************************************************************************
> SECTION 2: DATA PREPARATION
> (Same as original - prepares main analysis dataset)
> *******************************************************************************/
. 
. ** Load data
. use "${data}working/irs_county_gross", replace

. 
. ** Keep required variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3

. order year fips state* county*

. 
. ** Merge with ACS Data
. merge 1:1 year fips using "${data}working/acs_county_gross_18plus", gen(merge_acs_1)
(variable fips was float, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        20,771
        from master                    18,963  (merge_acs_1==1)
        from using                      1,808  (merge_acs_1==2)

    Matched                             3,017  (merge_acs_1==3)
    -----------------------------------------

. 
. ** Keep require variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3 merge_acs_*

. 
. ** Label acs samples
. rename persons_* acs1_persons_*

. rename households_* acs1_households_*

. rename dollars_* acs1_dollars_*

. 
. ** Merge with ACS Data
. merge 1:1 year fips using "${data}working/acs_county_gross_college", gen(merge_acs_2)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,963
        from master                    18,963  (merge_acs_2==1)
        from using                          0  (merge_acs_2==2)

    Matched                             4,825  (merge_acs_2==3)
    -----------------------------------------

. 
. ** Keep require variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3  merge_acs_*

. 
. ** Label acs samples
. rename persons_* acs2_persons_*

. rename households_* acs2_households_*

. rename dollars_* acs2_dollars_*

. 
. ** Drop "other counties"
. drop if county_fips == 0
(483 observations deleted)

. drop if year == 2015
(430 observations deleted)

. 
. ** Merge with Demographic data
. merge m:1 fips using "${data}working/demographics_2020",        ///
>         gen(demo_merge) keep(master match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            27
        from master                        27  (demo_merge==1)
        from using                          0  (demo_merge==2)

    Matched                            22,848  (demo_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name demo_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
                     |        21          0 |        21 
             Alabama |         0        479 |       479 
              Alaska |         6        198 |       204 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         0         34 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |         0        951 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |        27     22,848 |    22,875 

. tab year demo_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         0      3,140 |     3,140 
      2017 |         0      3,140 |     3,140 
      2018 |         0      3,140 |     3,140 
      2019 |         0      3,140 |     3,140 
      2020 |         2      3,140 |     3,142 
      2021 |         2      3,141 |     3,143 
      2022 |         9      3,133 |     3,142 
      2023 |         7        437 |       444 
      2024 |         7        437 |       444 
-----------+----------------------+----------
     Total |        27     22,848 |    22,875 

. 
. ** Keep if matched
. keep if demo_merge == 3
(27 observations deleted)

. drop demo_merge

. 
. ** Rename
. rename population pop_census

. 
. ** Merge with Demographic data
. merge m:1 year fips using "${data}working/bea_economics",       ///
>         gen(econ_merge) keep(master match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           366
        from master                       366  (econ_merge==1)
        from using                          0  (econ_merge==2)

    Matched                            22,482  (econ_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name econ_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
             Alabama |         0        479 |       479 
              Alaska |         0        198 |       198 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         9         25 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |       357        594 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |       366     22,482 |    22,848 

. tab year econ_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |        52      3,088 |     3,140 
      2017 |        52      3,088 |     3,140 
      2018 |        52      3,088 |     3,140 
      2019 |        52      3,088 |     3,140 
      2020 |        52      3,088 |     3,140 
      2021 |        53      3,088 |     3,141 
      2022 |        53      3,080 |     3,133 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |       366     22,482 |    22,848 

. 
. ** Keep if matched
. keep if econ_merge == 3
(366 observations deleted)

. drop econ_merge

. 
. ** Merge with COVID-19 Data
. merge m:1 fips using ${data}working/covid_cleaned_wide.dta,     ///
>         gen(covid_merge) keep(master match )
(variable state_name was str20, now str24 to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            73
        from master                        73  (covid_merge==1)
        from using                          0  (covid_merge==2)

    Matched                            22,409  (covid_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name covid_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |         0        479 |       479 
               Alaska |        28        170 |       198 
              Arizona |         0        113 |       113 
             Arkansas |         0        531 |       531 
           California |         0        474 |       474 
             Colorado |         0        452 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |         0        535 |       535 
              Georgia |         0      1,157 |     1,157 
               Hawaii |         0         25 |        25 
                Idaho |         0        310 |       310 
             Illinois |         0        740 |       740 
              Indiana |         0        676 |       676 
                 Iowa |         0        703 |       703 
               Kansas |         0        741 |       741 
             Kentucky |         0        854 |       854 
            Louisiana |         0        462 |       462 
                Maine |         0        116 |       116 
             Maryland |         0        190 |       190 
        Massachusetts |         0        116 |       116 
             Michigan |         0        613 |       613 
            Minnesota |         0        625 |       625 
          Mississippi |         0        580 |       580 
             Missouri |         0        819 |       819 
              Montana |         0        394 |       394 
             Nebraska |         0        657 |       657 
               Nevada |         0        123 |       123 
        New Hampshire |         0         70 |        70 
           New Jersey |         0        181 |       181 
           New Mexico |         0        235 |       235 
             New York |        45        431 |       476 
       North Carolina |         0        736 |       736 
         North Dakota |         0        373 |       373 
                 Ohio |         0        658 |       658 
             Oklahoma |         0        547 |       547 
               Oregon |         0        268 |       268 
         Pennsylvania |         0        509 |       509 
         Rhode Island |         0         41 |        41 
       South Carolina |         0        338 |       338 
         South Dakota |         0        462 |       462 
            Tennessee |         0        687 |       687 
                Texas |         0      1,854 |     1,854 
                 Utah |         0        213 |       213 
              Vermont |         0        100 |       100 
             Virginia |         0        594 |       594 
           Washington |         0        293 |       293 
        West Virginia |         0        387 |       387 
            Wisconsin |         0        530 |       530 
              Wyoming |         0        163 |       163 
----------------------+----------------------+----------
                Total |        73     22,409 |    22,482 

. tab year covid_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         9      3,079 |     3,088 
      2017 |         9      3,079 |     3,088 
      2018 |         9      3,079 |     3,088 
      2019 |         9      3,079 |     3,088 
      2020 |         9      3,079 |     3,088 
      2021 |         9      3,079 |     3,088 
      2022 |         9      3,071 |     3,080 
      2023 |         5        432 |       437 
      2024 |         5        432 |       437 
-----------+----------------------+----------
     Total |        73     22,409 |    22,482 

. 
. ** Merge with Property Tax Rates (time-varying)
. merge m:1 year fips using "${data}working/property_tax_rates_overall", ///
>         gen(proptx_merge) keep(master match) keepusing(prop_rate_mean prop_rate_se)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,591
        from master                    18,591  (proptx_merge==1)
        from using                          0  (proptx_merge==2)

    Matched                             3,891  (proptx_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name proptx_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |       422         57 |       479 
               Alaska |       189          9 |       198 
              Arizona |        71         42 |       113 
             Arkansas |       498         33 |       531 
           California |       168        306 |       474 
             Colorado |       440         12 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |       268        267 |       535 
              Georgia |       971        186 |     1,157 
               Hawaii |         7         18 |        25 
                Idaho |       301          9 |       310 
             Illinois |       593        147 |       740 
              Indiana |       532        144 |       676 
                 Iowa |       664         39 |       703 
               Kansas |       714         27 |       741 
             Kentucky |       803         51 |       854 
            Louisiana |       393         69 |       462 
                Maine |        92         24 |       116 
             Maryland |        85        105 |       190 
        Massachusetts |        77         39 |       116 
             Michigan |       469        144 |       613 
            Minnesota |       553         72 |       625 
          Mississippi |       553         27 |       580 
             Missouri |       756         63 |       819 
              Montana |       391          3 |       394 
             Nebraska |       630         27 |       657 
               Nevada |       105         18 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        28        153 |       181 
           New Mexico |       211         24 |       235 
             New York |       287        189 |       476 
       North Carolina |       562        174 |       736 
         North Dakota |       364          9 |       373 
                 Ohio |       469        189 |       658 
             Oklahoma |       517         30 |       547 
               Oregon |       196         72 |       268 
         Pennsylvania |       329        180 |       509 
         Rhode Island |        14         27 |        41 
       South Carolina |       290         48 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       600         87 |       687 
                Texas |     1,512        342 |     1,854 
                 Utah |       168         45 |       213 
              Vermont |        97          3 |       100 
             Virginia |       504         90 |       594 
           Washington |       209         84 |       293 
        West Virginia |       384          3 |       387 
            Wisconsin |       413        117 |       530 
              Wyoming |       160          3 |       163 
----------------------+----------------------+----------
                Total |    18,591      3,891 |    22,482 

. tab year proptx_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |     2,658        430 |     3,088 
      2017 |     2,658        430 |     3,088 
      2018 |     2,658        430 |     3,088 
      2019 |     2,658        430 |     3,088 
      2020 |     2,658        430 |     3,088 
      2021 |     2,658        430 |     3,088 
      2022 |     2,643        437 |     3,080 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |    18,591      3,891 |    22,482 

. 
. ** Rename for clarity
. rename prop_rate_mean prop_tax_rate

. rename prop_rate_se prop_tax_rate_se

. label var prop_tax_rate "Mean property tax rate (% of home value)"

. label var prop_tax_rate_se "SE of property tax rate"

. 
. ** Organize data
. order year fips state_* county_*

. sort fips year

. isid fips year

. 
. ** Keep only sample with non-missing base populations
. tab county_name year if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022

                      |  Tax year
                      |   (year
                      |   before
                      |   move)
          County name |      2017 |     Total
----------------------+-----------+----------
        Loving County |         1 |         1 
----------------------+-----------+----------
                Total |         1 |         1 

. drop if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022
(1 observation deleted)

. 
. ** Keep only sample with observations in each year
. bysort fips: gen ct = _N

. tab county_name state_name if ct < 7

                      |      State name
          County name | Connect..      Texas |     Total
----------------------+----------------------+----------
     Fairfield County |         6          0 |         6 
      Hartford County |         6          0 |         6 
    Litchfield County |         6          0 |         6 
        Loving County |         0          6 |         6 
     Middlesex County |         6          0 |         6 
     New Haven County |         6          0 |         6 
    New London County |         6          0 |         6 
       Tolland County |         6          0 |         6 
       Windham County |         6          0 |         6 
----------------------+----------------------+----------
                Total |        48          6 |        54 

. drop if ct < 7
(54 observations deleted)

. drop ct

. 
. ** Generate IRS sample
. gen irs_sample_1 = inrange(year, 2016, 2022)

. gen irs_sample_2 = inrange(year, 2016, 2022) & merge_acs_1 != 1

. 
. ** Generate ACS Period Indicators
. gen acs_period_1 = merge_acs_1 != 1 & inrange(year, 2016, 2022)

. gen acs_period_2 = merge_acs_1 != 1

. 
. ** Make sure we have a balanced panel of ACS counties
. gen tmp = merge_acs_1 != 1

. bysort fips: egen ct_tmp = total(tmp)

. replace acs_period_1 = 0 if ct_tmp != 9
(246 real changes made)

. replace acs_period_2 = 0 if ct_tmp != 9
(342 real changes made)

. replace irs_sample_2 = 0 if ct_tmp != 9
(246 real changes made)

. drop tmp ct_tmp

. 
. tab year irs_sample_1

  Tax year |
     (year |
    before |     irs_sample_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |         0      3,079 |     3,079 
      2017 |         0      3,079 |     3,079 
      2018 |         0      3,079 |     3,079 
      2019 |         0      3,079 |     3,079 
      2020 |         0      3,079 |     3,079 
      2021 |         0      3,079 |     3,079 
      2022 |         0      3,079 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |       874     21,553 |    22,427 

. tab year irs_sample_2

  Tax year |
     (year |
    before |     irs_sample_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_1

  Tax year |
     (year |
    before |     acs_period_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_2

  Tax year |
     (year |
    before |     acs_period_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |        48        389 |       437 
      2024 |        48        389 |       437 
-----------+----------------------+----------
     Total |    18,926      3,501 |    22,427 

. tab state_name acs_period_1

                      |     acs_period_1
           State name |         0          1 |     Total
----------------------+----------------------+----------
              Alabama |       458         21 |       479 
               Alaska |       191          7 |       198 
              Arizona |        92         21 |       113 
             Arkansas |       510         21 |       531 
           California |       236        238 |       474 
             Colorado |       445          7 |       452 
             Delaware |         6         21 |        27 
 District of Columbia |         2          7 |         9 
              Florida |       339        196 |       535 
              Georgia |     1,017        140 |     1,157 
               Hawaii |        11         14 |        25 
                Idaho |       303          7 |       310 
             Illinois |       656         84 |       740 
              Indiana |       564        112 |       676 
                 Iowa |       675         28 |       703 
               Kansas |       720         21 |       741 
             Kentucky |       819         35 |       854 
            Louisiana |       413         49 |       462 
                Maine |       102         14 |       116 
             Maryland |       113         77 |       190 
        Massachusetts |       102         14 |       116 
             Michigan |       501        112 |       613 
            Minnesota |       583         42 |       625 
          Mississippi |       559         21 |       580 
             Missouri |       784         35 |       819 
              Montana |       394          0 |       394 
             Nebraska |       636         21 |       657 
               Nevada |       109         14 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        62        119 |       181 
           New Mexico |       221         14 |       235 
             New York |       336        140 |       476 
       North Carolina |       610        126 |       736 
         North Dakota |       366          7 |       373 
                 Ohio |       525        133 |       658 
             Oklahoma |       526         21 |       547 
               Oregon |       219         49 |       268 
         Pennsylvania |       369        140 |       509 
         Rhode Island |        20         21 |        41 
       South Carolina |       331          7 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       638         49 |       687 
                Texas |     1,581        266 |     1,847 
                 Utah |       178         35 |       213 
              Vermont |       100          0 |       100 
             Virginia |       531         63 |       594 
           Washington |       230         63 |       293 
        West Virginia |       387          0 |       387 
            Wisconsin |       439         91 |       530 
              Wyoming |       163          0 |       163 
----------------------+----------------------+----------
                Total |    19,704      2,723 |    22,427 

. 
. ** Define treated state
. gen multnomah = state_fips == 41 & county_fips == 51

. label var multnomah "Indicator for Multnomah County, Oregon"

. 
. ** Define treatment indicator
. gen Treated = multnomah == 1 & year > 2020

. label var Treated "Treatment indicator for Multnomah County, Oregon"

. 
. ** Define sample 1: All counties
. gen sample_all = 1

. label var sample_all "All counties (excluding AK, CA, HI OR, WA)"

. 
. ** Define sample 2: Counties in top 95 percent
. summ percent_urban if year == 2020, de

            Percent of population in urban areas
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs               3,079
25%            0              0       Sum of wgt.       3,079

50%     .3256337                      Mean           .3521437
                        Largest       Std. dev.       .332065
75%     .6326353              1
90%      .847923              1       Variance       .1102672
95%     .9372299              1       Skewness       .3661052
99%     .9972304              1       Kurtosis       1.763629

. local cutoff = r(p95)

. tab state_name multnomah if percent_urban >= `cutoff' & year == 2020

                      |     Indicator for
                      |   Multnomah County,
                      |        Oregon
           State name |         0          1 |     Total
----------------------+----------------------+----------
               Alaska |         1          0 |         1 
              Arizona |         1          0 |         1 
           California |        15          0 |        15 
             Colorado |         4          0 |         4 
             Delaware |         1          0 |         1 
 District of Columbia |         1          0 |         1 
              Florida |        13          0 |        13 
              Georgia |         8          0 |         8 
               Hawaii |         1          0 |         1 
                Idaho |         1          0 |         1 
             Illinois |         5          0 |         5 
              Indiana |         3          0 |         3 
                 Iowa |         1          0 |         1 
               Kansas |         2          0 |         2 
             Kentucky |         2          0 |         2 
            Louisiana |         3          0 |         3 
             Maryland |         3          0 |         3 
        Massachusetts |         5          0 |         5 
             Michigan |         3          0 |         3 
            Minnesota |         3          0 |         3 
             Missouri |         4          0 |         4 
             Nebraska |         2          0 |         2 
               Nevada |         3          0 |         3 
           New Jersey |        10          0 |        10 
           New Mexico |         2          0 |         2 
             New York |         9          0 |         9 
       North Carolina |         4          0 |         4 
                 Ohio |         6          0 |         6 
             Oklahoma |         1          0 |         1 
               Oregon |         1          1 |         2 
         Pennsylvania |         4          0 |         4 
         Rhode Island |         2          0 |         2 
            Tennessee |         2          0 |         2 
                Texas |        11          0 |        11 
                 Utah |         4          0 |         4 
             Virginia |        10          0 |        10 
           Washington |         1          0 |         1 
            Wisconsin |         1          0 |         1 
----------------------+----------------------+----------
                Total |       153          1 |       154 

. gen sample_urban95 = percent_urban >= `cutoff' // All counties

. label var sample_urban95 "Urban counties (top 5%) (excluding AK, CA, HI OR, WA)"

. tab sample_urban95 if year == 2020

      Urban |
   counties |
   (top 5%) |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,925       95.00       95.00
          1 |        154        5.00      100.00
------------+-----------------------------------
      Total |      3,079      100.00

. 
. ** Define sample 3: Counties in top 98 percent
. local cutoff = .9864539 //

. tab state_name multnomah if percent_urban >= `cutoff' & year == 2020

                      |     Indicator for
                      |   Multnomah County,
                      |        Oregon
           State name |         0          1 |     Total
----------------------+----------------------+----------
           California |         6          0 |         6 
             Colorado |         2          0 |         2 
 District of Columbia |         1          0 |         1 
              Florida |         4          0 |         4 
              Georgia |         5          0 |         5 
             Illinois |         2          0 |         2 
              Indiana |         1          0 |         1 
            Louisiana |         1          0 |         1 
             Maryland |         1          0 |         1 
        Massachusetts |         1          0 |         1 
             Michigan |         1          0 |         1 
            Minnesota |         1          0 |         1 
             Missouri |         1          0 |         1 
               Nevada |         1          0 |         1 
           New Jersey |         6          0 |         6 
             New York |         7          0 |         7 
       North Carolina |         1          0 |         1 
                 Ohio |         1          0 |         1 
               Oregon |         0          1 |         1 
         Pennsylvania |         2          0 |         2 
         Rhode Island |         1          0 |         1 
                Texas |         3          0 |         3 
                 Utah |         2          0 |         2 
             Virginia |         8          0 |         8 
            Wisconsin |         1          0 |         1 
----------------------+----------------------+----------
                Total |        60          1 |        61 

. gen sample_urban98 = percent_urban >= `cutoff' // All counties

. label var sample_urban98 "Urban counties (top 1%) (excluding AK, CA, HI OR, WA)"

. tab sample_urban98 if year == 2020

      Urban |
   counties |
   (top 1%) |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,018       98.02       98.02
          1 |         61        1.98      100.00
------------+-----------------------------------
      Total |      3,079      100.00

. 
. ** Define Sample of States
. drop if state_name == "Alaska"
(198 observations deleted)

. drop if state_name == "Hawaii"
(25 observations deleted)

. drop if state_name == "California"
(474 observations deleted)

. drop if state_name == "Washington"
(293 observations deleted)

. drop if state_name == "Oregon" & multnomah == 0
(259 observations deleted)

. 
. ** Define sample 4: Counties in top 95 + covid
. cluster kmeans cases_cum* deaths_cum* if        ///
>         sample_urban95 == 1 & year == 2020 & covid_merge == 3 , k(5) gen(kmean)
cluster name: _clus_1

. bysort fips: egen kmean_group = mean(kmean)
(20,046 missing values generated)

. 
. ** Pull out kmeans cluster with Multnoma
. gen tmp1 = kmean if sample_urban95 == 1 & year == 2020 & covid_merge == 3 & multnomah == 1
(21,177 missing values generated)

. egen tmp2 = mean(tmp1)

. gen sample_urban95_covid = sample_urban95 == 1 & kmean_group == tmp2

. drop tmp1 tmp2

. label var sample_urban95_covid "Urban counties (top 5%) w. Kmean Covid Match  (excluding AK, CA,
>  HI OR, WA)"

. tab sample_urban95_covid if year == 2020

      Urban |
   counties |
(top 5%) w. |
Kmean Covid |
      Match |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,877       98.66       98.66
          1 |         39        1.34      100.00
------------+-----------------------------------
      Total |      2,916      100.00

. 
. ** Show results across clusters
. preserve

. 
. ** Keep required variables
. keep if sample_urban95 == 1 & year == 2020 & covid_merge == 3
(21,048 observations deleted)

. keep kmean cases_cum* deaths_cum* population

. collapse (mean) cases_cum* deaths_cum* [fw = population], by(kmean)

. reshape long cases_cum deaths_cum, i(kmean) j(time)
(j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations                5   ->   145         
Number of variables                  59   ->   4           
j variable (29 values)                    ->   time
xij variables:
  cases_cum1 cases_cum2 ... cases_cum29   ->   cases_cum
deaths_cum1 deaths_cum2 ... deaths_cum29  ->   deaths_cum
-----------------------------------------------------------------------------

. xtset kmean time

Panel variable: kmean (strongly balanced)
 Time variable: time, 1 to 29
         Delta: 1 unit

. xtline cases_cum

. graph export "${results}sdid/fig_kmeans.jpg", as(jpg) name("Graph") quality(100) replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/fig_kmeans.jpg written in J
> PEG format

. clear

. 
. ** Restore
. restore

. 
. ** Define covariates
. local covariates "population per_capita_income"

. 
. ** Standardize covariates
. foreach v of local covariates {
  2.         egen tmp_v = std(`v')
  3.         replace `v' = tmp_v
  4.         drop tmp_v
  5. } // END COVAR LOOP
(21,178 real changes made)
(21,178 real changes made)

. 
. ** Define outcome variables (IRS)
. foreach x in "n1" "n2" "agi" {
  2. 
.         if "`x'" == "n1" local xtxt "returns"
  3.         else if "`x'" == "n2" local xtxt "exemptions"
  4.         else if "`x'" == "agi" local xtxt "AGI"
  5. 
.         ** Loop over migration type
.         foreach y in "net" "in" "out" {
  6. 
.                         if "`y'" == "net" local ytxt "Net domestic migration"
  7.                         else if "`y'" == "in" local ytxt "Domestic in-migration"
  8.                         else if "`y'" == "out" local ytxt "Domestic out-migration"
  9. 
.                         ** Generate
.                         gen `x'_`y'_rate_irs = 100 * (`x'_`y'_3 / (`x'_out_1 + `x'_out_2))
 10. 
.                         ** Label var
.                         label var `x'_`y'_rate_irs      "`ytxt' rate, `xtxt' (%)"
 11. 
.         } // END MIGRATION TYPE LOOP
 12. 
. } // END OUTCOME TYPE LOOP
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)

. 
. ** Define outcome variables (ACS)
. 
. ** Rename for loop
. rename acs*_households_* acs*_n1_*

. rename acs*_persons_* acs*_n2_*

. rename acs*_dollars_* acs*_agi_*

. 
. ** Loop over sample
. ** (18+ = 1, college degree == 2, no college degree == 3)
. forvalues i = 1/2{
  2. 
.         if `i' == 1 local itxt ""
  3.         else if `i' == 2 local itxt " (College)"
  4.         else if `i' == 3 local itxt " (No College)"
  5. 
. 
.         ** Define outcome variables (IRS)
.         foreach x in "n1" "n2" "agi" {
  6. 
.                 if "`x'" == "n1" local xtxt "HHs"
  7.                 else if "`x'" == "n2" local xtxt "persons"
  8.                 else if "`x'" == "agi" local xtxt "total income"
  9. 
. 
.                 ** Loop over migration type
.                 foreach y in "net" "in" "out" {
 10. 
.                                 if "`y'" == "net" local ytxt "Net domestic migration"
 11.                                 else if "`y'" == "in" local ytxt "Domestic in-migration"
 12.                                 else if "`y'" == "out" local ytxt "Domestic out-migration"
 13. 
.                                 ** Generate
.                                 gen `x'_`y'_rate_acs`i' = 100 * (acs`i'_`x'_`y'_3 / (acs`i'_`x'_
> out_1 + acs`i'_`x'_out_2))
 14. 
.                                 ** Label var
.                                 label var `x'_`y'_rate_acs`i' "`ytxt' rate, `xtxt'`itxt' (%)"
 15. 
.                 } // END MIGRATION TYPE LOOP
 16. 
.         } // END OUTCOME TYPE LOOP
 17. 
. } // END SAMPLE LOOP
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)

. 
. ** Declare panel
. xtset fips year

Panel variable: fips (unbalanced)
 Time variable: year, 2016 to 2024
         Delta: 1 unit

. 
. ** Tag unique fips
. egen unique = tag(fips)

. tab year unique

  Tax year |
     (year |
    before |       tag(fips)
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |         0      2,916 |     2,916 
      2017 |     2,916          0 |     2,916 
      2018 |     2,916          0 |     2,916 
      2019 |     2,916          0 |     2,916 
      2020 |     2,916          0 |     2,916 
      2021 |     2,916          0 |     2,916 
      2022 |     2,916          0 |     2,916 
      2023 |       383          0 |       383 
      2024 |       383          0 |       383 
-----------+----------------------+----------
     Total |    18,262      2,916 |    21,178 

. 
. ** Label var
. label var year "Year (destination)"

. 
. /*******************************************************************************
> SECTION 3: CREATE TABLE-LEVEL SPECIFICATION GRID
> Each row represents one table = 6 SDID specs (3 outcomes  2 covariate settings)
> *******************************************************************************/
. 
. ** Save main analysis data
. save "${data}working/sdid_analysis_data.dta", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/sdid_analysis_data.dta
    saved

. 
. ** Create table-level specification grid
. preserve

. clear

. 
. ** Table units are defined by:
. ** - data_var (irs_sample_1, irs_sample_2, acs_period_1, acs_period_2)
. ** - out_type (irs, acs1, acs2) - but tied to data_var
. ** - samp_var (sample_all, sample_urban95, sample_urban95_covid)
. ** - exclusion (0, 1)
. ** - migr_type (net, in, out)
. ** Total: 6 data-type combos  3 samples  2 exclusions  3 migrations = 108 tables
. 
. local table_id = 0

. 
. ** Initialize empty dataset
. set obs 0
Number of observations (_N) was 0, now 0.

. gen table_id = .

. gen data_var = ""

. gen out_type = ""

. gen out_txt = ""

. gen samp_var = ""

. gen exclusion = .

. gen migr_type = ""

. 
. save "${data}working/table_grid.dta", replace
(dataset contains 0 observations)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved

. 
. ** Build table grid
. foreach data in "irs_sample_1" "irs_sample_2" "acs_period_1" "acs_period_2" {
  2. 
.         ** Different sets of outcome variable types
.         if "`data'" == "irs_sample_1" | "`data'" == "irs_sample_2" {
  3.                 local out_types "irs"
  4.         }
  5.         else {
  6.                 local out_types "acs1 acs2"
  7.         }
  8. 
.         foreach type of local out_types {
  9. 
.                 ** Labels
.                 if "`data'" == "irs_sample_1" local out_txt "irs_full_16_22"
 10.                 else if "`data'" == "irs_sample_2" local out_txt "irs_389_16_22"
 11.                 else if "`data'" == "acs_period_1" & "`type'" == "acs1" local out_txt "acs_16
> _22_all"
 12.                 else if "`data'" == "acs_period_1" & "`type'" == "acs2" local out_txt "acs_16
> _22_col"
 13.                 else if "`data'" == "acs_period_2" & "`type'" == "acs1" local out_txt "acs_16
> _24_all"
 14.                 else if "`data'" == "acs_period_2" & "`type'" == "acs2" local out_txt "acs_16
> _24_col"
 15. 
.                 foreach samp in "sample_all" "sample_urban95" "sample_urban95_covid" {
 16.                         forvalues exl = 0/1 {
 17.                                 foreach migr in "net" "in" "out" {
 18. 
.                                         local table_id = `table_id' + 1
 19. 
.                                         ** Add row to grid
.                                         clear
 20.                                         set obs 1
 21.                                         gen table_id = `table_id'
 22.                                         gen data_var = "`data'"
 23.                                         gen out_type = "`type'"
 24.                                         gen out_txt = "`out_txt'"
 25.                                         gen samp_var = "`samp'"
 26.                                         gen exclusion = `exl'
 27.                                         gen migr_type = "`migr'"
 28. 
.                                         append using "${data}working/table_grid.dta"
 29.                                         save "${data}working/table_grid.dta", replace
 30. 
.                                 }
 31.                         }
 32.                 }
 33.         }
 34. }
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved

. 
. ** Load and verify grid
. use "${data}working/table_grid.dta", clear

. dis "Total table units: " _N
Total table units: 108

. sort table_id

. save "${data}working/table_grid.dta", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved

. 
. restore

. 
. /*******************************************************************************
> SECTION 4: DEFINE PARALLEL PROGRAM FOR TABLE-LEVEL SDID ESTIMATION
> Each call runs 6 SDID specs and generates one table
> *******************************************************************************/
. 
. ** Define program to run all SDID specifications for one table
. capture program drop run_sdid_table

. program define run_sdid_table
  1.         syntax, table_id(integer) data_path(string) results_path(string) reps(integer)
  2. 
.         ** Load table specification from grid
.         preserve
  3.         use "`data_path'working/table_grid.dta", clear
  4.         keep if table_id == `table_id'
  5. 
.         ** Extract specification parameters
.         local data_var = data_var[1]
  6.         local out_type = out_type[1]
  7.         local out_txt = out_txt[1]
  8.         local samp_var = samp_var[1]
  9.         local exl = exclusion[1]
 10.         local migr = migr_type[1]
 11. 
.         restore
 12. 
.         ** Load main analysis data
.         use "`data_path'working/sdid_analysis_data.dta", clear
 13. 
.         ** Define sample
.         gen sample = `samp_var' == 1 & `data_var' == 1
 14.         if `exl' == 1 replace sample = 0 if year == 2020
 15. 
.         ** Skip if no treated unit in sample
.         qui count if multnomah == 1 & sample == 1
 16.         if r(N) == 0 {
 17.                 dis "Skipping table `table_id': no treated unit in sample"
 18.                 exit
 19.         }
 20. 
.         ** Create output directory
.         capture mkdir "`results_path'sdid/`out_txt'"
 21. 
.         ** Define covariates
.         if "`data_var'" == "irs_sample_1" local covariates "population per_capita_income"
 22.         else local covariates "population per_capita_income prop_tax_rate"
 23. 
.         ** Clear stored estimates
.         eststo clear
 24. 
.         ** Loop over outcomes (n1, n2, agi) and covariate settings (0, 1)
.         foreach outvar in "n1" "n2" "agi" {
 25. 
.                 ** Full outcome variable name
.                 local outcome "`outvar'_`migr'_rate_`out_type'"
 26. 
.                 ** Store label
.                 local label : variable label `outcome'
 27. 
.                 ** Loop over covariate settings
.                 forvalues c = 0/1 {
 28. 
.                         ** Covariates for sdid (supports 'projected' option)
.                         if `c' == 0 local covars ""
 29.                         else if `c' == 1 local covars "covariates(`covariates', projected)"
 30. 
.                         ** Covariates for sdid_event (doesn't support 'projected' option)
.                         if `c' == 0 local covars_event ""
 31.                         else if `c' == 1 local covars_event "covariates(`covariates')"
 32. 
.                         ** File paths for figures
.                         if `exl' == 0 local path "`results_path'sdid/`out_txt'/fig_`out_txt'_`ou
> tcome'_`c'_`samp_var'_"
 33.                         if `exl' == 1 local path "`results_path'sdid/`out_txt'/fig_`out_txt'_
> `outcome'_`c'_`samp_var'_excl2020_"
 34. 
.                         ** Run SDID
.                         capture noisily {
 35.                                 eststo sdid_`outvar'_`c': sdid `outcome' fips year Treated   
>    ///
>                                         if sample == 1,                         ///
>                                         vce(placebo)                            ///
>                                         `covars'                                        ///
>                                         reps(`reps')                            ///
>                                         graph graph_export("`path'", .pdf)
 36.                         }
 37. 
.                         ** Store results
.                         local tmp_tau = e(ATT)
 38.                         local tmp_se = e(se)
 39.                         matrix omega = e(omega)
 40. 
.                         ** Pre-treatment mean and county count
.                         qui summ `outcome' if multnomah == 1 & Treated == 0
 41.                         local tmp_premean = r(mean)
 42.                         estadd scalar mean = r(mean)
 43. 
.                         qui summ `outcome' if year == 2021 & sample == 1
 44.                         local tmp_ncounties = r(N)
 45.                         estadd scalar count = r(N)
 46. 
.                         ** Save treatment effect results
.                         preserve
 47.                         clear
 48.                         set obs 1
 49.                         gen table_id = `table_id'
 50.                         gen sample_data = "`out_txt'"
 51.                         gen sample = "`samp_var'"
 52.                         gen outcome = "`outcome'"
 53.                         gen controls = `c'
 54.                         gen exclusion = `exl'
 55.                         gen tau = `tmp_tau'
 56.                         gen se = `tmp_se'
 57.                         gen pval = 2 * (1 - normal(abs(tau/se)))
 58.                         gen ci_lower = tau - 1.96 * se
 59.                         gen ci_upper = tau + 1.96 * se
 60.                         gen n_counties = `tmp_ncounties'
 61.                         gen pre_mean = `tmp_premean'
 62.                         save "`results_path'sdid/temp_results/results_`table_id'_`outvar'_`c'
> .dta", replace
 63.                         restore
 64. 
.                         ** Save weights
.                         preserve
 65.                         clear
 66.                         svmat double omega, names(col)
 67.                         rename c2 fips
 68.                         rename c1 weight
 69.                         gen table_id = `table_id'
 70.                         gen sample_data = "`out_txt'"
 71.                         gen out = "`outcome'"
 72.                         gen sample = "`samp_var'"
 73.                         gen controls = `c'
 74.                         gen exclusion = `exl'
 75.                         drop if weight == 0
 76.                         drop if missing(fips)
 77.                         save "`results_path'sdid/temp_weights/weights_`table_id'_`outvar'_`c'
> .dta", replace
 78.                         restore
 79. 
. 
.                         ** Run event study
.                         capture noisily {
 80.                                 sdid_event `outcome' fips year Treated  ///
>                                         if sample == 1,                                         
> ///
>                                         `covars_event'                                          
> ///
>                                         vce(placebo)                                            
> ///
>                                         brep(`reps')                                            
> ///
>                                         placebo(all)
 81.                         }
 82. 
.                         local event_rc = _rc
 83. 
.                         if `event_rc' == 0 {
 84. 
.                                 ** Store max year
.                                 qui summ year if multnomah == 1 & sample == 1
 85.                                 local max_yr = r(max)
 86. 
.                                 ** Move results from matrix to data
.                                 qui count if multnomah == 1 & sample == 1
 87.                                 local ct = r(N)
 88.                                 local ct = `ct' + 1
 89. 
.                                 ** Extract matrix
.                                 capture mat res = e(H)[2..`ct',1..5]
 90.                                 if _rc != 0 {
 91.                                         continue
 92.                                 }
 93. 
.                                 ** Move to data
.                                 svmat res
 94. 
.                                 ** Generate ID variable
.                                 gen id = `max_yr' - _n + 1 if !missing(res1)
 95. 
.                                 ** Handle exclusion year labeling
.                                 if `exl' == 1 {
 96.                                         replace id = id - 1 if id <= 2020
 97.                                         expand 2 if id == 2019, gen(tag)
 98.                                         replace id = 2020 if tag == 1
 99.                                         replace res1 = . if tag == 1
100.                                         replace res3 = . if tag == 1
101.                                         replace res4 = . if tag == 1
102.                                 }
103.                                 label var id "Year (destination)"
104. 
.                                 ** Sort
.                                 sort id
105. 
.                                 ** Plot
.                                 twoway  (rcap res3 res4 id, lc(gs10) fc(gs11%50))       ///
>                                                 (scatter res1 id, mc(black)),                   
>         ///
>                                         legend(off) ytitle("`label'")                           
>         ///
>                                         yline(0, lc(red) lp(-))                                 
>                 ///
>                                         xline(2020.5, lc(black) lp(solid))                      
>         ///
>                                         ylabel(-10(2.5)10, format(%9.1f))
106. 
.                                 if `exl' == 1 local evpath "`results_path'sdid/`out_txt'/fig_`ou
> t_txt'_`outcome'_`c'_`samp_var'_excl2020_eventstudy.jpg"
107.                                 else local evpath "`results_path'sdid/`out_txt'/fig_`out_txt'
> _`outcome'_`c'_`samp_var'_eventstudy.jpg"
108. 
.                                 graph export "`evpath'", as(jpg) name("Graph") quality(100) repl
> ace
109. 
.                                 ** Clean up graph variables
.                                 drop res1 res2 res3 res4 res5 id
110.                                 capture drop tag
111. 
.                         }
112.         
.                         ** Clean up sdid_event internal variables (prevents "already defined" er
> ror on next iteration)
.                         capture drop ever_treated*
113. 
.                 } // END COVAR LOOP
114. 
.         } // END OUTCOME LOOP
115. 
.         ** Generate table for this migration type (all 6 specs)
.         ** Determine table path
.         if `exl' == 0 local tabpath "`results_path'sdid/`out_txt'/tab_sdid_`out_txt'_`migr'_`sam
> p_var'.tex"
116.         if `exl' == 1 local tabpath "`results_path'sdid/`out_txt'/tab_sdid_`out_txt'_`migr'_`
> samp_var'_excl2020.tex"
117. 
.         ** Check if we have all estimates
.         capture confirm matrix e(b)
118. 
.         ** Generate table based on data type
.         if "`data_var'" == "irs_sample_1" | "`data_var'" == "irs_sample_2" {
119.                 capture noisily {
120.                         esttab  sdid_n1_0 sdid_n1_1     ///
>                                         sdid_n2_0 sdid_n2_1     ///
>                                         sdid_agi_0 sdid_agi_1 ///
>                                 using "`tabpath'",                                              
>                 ///
>                                 starlevel("*" 0.10 "**" 0.05 "***" 0.01)                ///
>                                 b(%-9.3f) se(%-9.3f) replace                                    
> ///
>                                 mgroups("Returns" "Exemptions" "AGI",                   ///
>                                         pattern(1 0 1 0 1 0) )                                  
>         ///
>                                 mtitle( "No Covariates" "Covariates"                    ///
>                                                 "No Covariates" "Covariates"                    
> ///
>                                                 "No Covariates" "Covariates")                   
> ///
>                                 stats(count mean,                                               
>                 ///
>                                         fmt(%9.0fc %9.3fc)                                      
>                 ///
>                                         labels("Number of Counties" "Pre-treatment mean"))
121.                 }
122.         }
123.         else {
124.                 capture noisily {
125.                         esttab  sdid_n1_0 sdid_n1_1     ///
>                                         sdid_n2_0 sdid_n2_1     ///
>                                         sdid_agi_0 sdid_agi_1 ///
>                                 using "`tabpath'",                                              
>                 ///
>                                 starlevel("*" 0.10 "**" 0.05 "***" 0.01)                ///
>                                 b(%-9.3f) se(%-9.3f) replace                                    
> ///
>                                 mgroups("Households" "Adults" "Household Income",       ///
>                                         pattern(1 0 1 0 1 0) )                                  
>         ///
>                                 mtitle( "No Covariates" "Covariates"                    ///
>                                                 "No Covariates" "Covariates"                    
> ///
>                                                 "No Covariates" "Covariates")                   
> ///
>                                 stats(count mean,                                               
>                 ///
>                                         fmt(%9.0fc %9.3fc)                                      
>                 ///
>                                         labels("Number of Counties" "Pre-treatment mean"))
126.                 }
127.         }
128. 
.         dis "Completed table `table_id': `out_txt' / `migr' / `samp_var' / excl=`exl'"
129. 
. end

. 
. /*******************************************************************************
> SECTION 5: CREATE TEMPORARY DIRECTORIES AND RUN PARALLEL ESTIMATION
> *******************************************************************************/
. 
. ** Create temp directories for results
. capture mkdir "${results}sdid/temp_results"

. capture mkdir "${results}sdid/temp_weights"

. 
. ** Create subfolders for each output type
. foreach out_txt in "irs_full_16_22" "irs_389_16_22" "acs_16_22_all" "acs_16_22_col" "acs_16_24_a
> ll" "acs_16_24_col" {
  2.         capture mkdir "${results}sdid/`out_txt'"
  3. }

. 
. ** Load table grid
. use "${data}working/table_grid.dta", clear

. local n_tables = _N

. dis "Running `n_tables' table units in parallel (each with 6 SDID specs)..."
Running 108 table units in parallel (each with 6 SDID specs)...

. 
. ** Save table IDs for parallel processing
. ** IMPORTANT: Shuffle table order to balance workload across workers
. ** Without shuffling, child 1 gets all sample_all specs (heaviest computation)
. preserve

. keep table_id

. 
. ** Generate random sort order and shuffle
. gen rand_order = runiform()

. sort rand_order

. drop rand_order

. 
. save "${data}working/table_ids.dta", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_ids.dta saved

. restore

. 
. ** Define wrapper program for parallel execution
. capture program drop parallel_sdid_wrapper

. program define parallel_sdid_wrapper
  1.         ** Store all table_ids upfront (run_sdid_table will overwrite the dataset)
.         local n_obs = _N
  2.         forvalues i = 1/`n_obs' {
  3.                 local tid_`i' = table_id[`i']
  4.         }
  5. 
.         ** Now loop through and process each table
.         forvalues i = 1/`n_obs' {
  6.                 dis "Worker processing table `tid_`i'' (`i' of `n_obs' in this chunk)"
  7.                 run_sdid_table, table_id(`tid_`i'') data_path("${data}") results_path("${resu
> lts}") reps(100)
  8.         }
  9. end

. 
. ** Load table IDs and run in parallel
. use "${data}working/table_ids.dta", clear

. 
. ** Run parallel estimation
. dis "Starting parallel SDID estimation at $S_TIME..."
Starting parallel SDID estimation at 20:58:04...

. dis "Each parallel worker processes one table (6 SDID specifications)"
Each parallel worker processes one table (6 SDID specifications)

. timer clear 1

. timer on 1

. 
. parallel, prog(parallel_sdid_wrapper run_sdid_table): parallel_sdid_wrapper
--------------------------------------------------------------------------------
Exporting the following program(s): parallel_sdid_wrapper run_sdid_table

parallel_sdid_wrapper:
  1.         local n_obs = _N
  2.         forvalues i = 1/`n_obs' {
  3.                 local tid_`i' = table_id[`i']
  4.         }
  5.         forvalues i = 1/`n_obs' {
  6.                 dis "Worker processing table `tid_`i'' (`i' of `n_obs' in this chunk)"
  7.                 run_sdid_table, table_id(`tid_`i'') data_path("${data}") results_path("${resu
> lts}") reps(100)
  8.         }

run_sdid_table:
  1.         syntax, table_id(integer) data_path(string) results_path(string) reps(integer)
  2.         preserve
  3.         use "`data_path'working/table_grid.dta", clear
  4.         keep if table_id == `table_id'
  5.         local data_var = data_var[1]
  6.         local out_type = out_type[1]
  7.         local out_txt = out_txt[1]
  8.         local samp_var = samp_var[1]
  9.         local exl = exclusion[1]
 10.         local migr = migr_type[1]
 11.         restore
 12.         use "`data_path'working/sdid_analysis_data.dta", clear
 13.         gen sample = `samp_var' == 1 & `data_var' == 1
 14.         if `exl' == 1 replace sample = 0 if year == 2020
 15.         qui count if multnomah == 1 & sample == 1
 16.         if r(N) == 0 {
 17.                 dis "Skipping table `table_id': no treated unit in sample"
 18.                 exit
 19.         }
 20.         capture mkdir "`results_path'sdid/`out_txt'"
 21.         if "`data_var'" == "irs_sample_1" local covariates "population per_capita_income"
 22.         else local covariates "population per_capita_income prop_tax_rate"
 23.         eststo clear
 24.         foreach outvar in "n1" "n2" "agi" {
 25.                 local outcome "`outvar'_`migr'_rate_`out_type'"
 26.                 local label : variable label `outcome'
 27.                 forvalues c = 0/1 {
 28.                         if `c' == 0 local covars ""
 29.                         else if `c' == 1 local covars "covariates(`covariates', projected)"
 30.                         if `c' == 0 local covars_event ""
 31.                         else if `c' == 1 local covars_event "covariates(`covariates')"
 32.                         if `exl' == 0 local path "`results_path'sdid/`out_txt'/fig_`out_txt'_
> `outcome'_`c'_`samp_var'_"
 33.                         if `exl' == 1 local path "`results_path'sdid/`out_txt'/fig_`out_txt'_
> `outcome'_`c'_`samp_var'_excl2020_"
 34.                         capture noisily {
 35.                                 eststo sdid_`outvar'_`c': sdid `outcome' fips year Treated if
>  sample == 1, vce(placebo) `covars' reps(`reps') graph graph_export("`path'", .pdf)
 36.                         }
 37.                         local tmp_tau = e(ATT)
 38.                         local tmp_se = e(se)
 39.                         matrix omega = e(omega)
 40.                         qui summ `outcome' if multnomah == 1 & Treated == 0
 41.                         local tmp_premean = r(mean)
 42.                         estadd scalar mean = r(mean)
 43.                         qui summ `outcome' if year == 2021 & sample == 1
 44.                         local tmp_ncounties = r(N)
 45.                         estadd scalar count = r(N)
 46.                         preserve
 47.                         clear
 48.                         set obs 1
 49.                         gen table_id = `table_id'
 50.                         gen sample_data = "`out_txt'"
 51.                         gen sample = "`samp_var'"
 52.                         gen outcome = "`outcome'"
 53.                         gen controls = `c'
 54.                         gen exclusion = `exl'
 55.                         gen tau = `tmp_tau'
 56.                         gen se = `tmp_se'
 57.                         gen pval = 2 * (1 - normal(abs(tau/se)))
 58.                         gen ci_lower = tau - 1.96 * se
 59.                         gen ci_upper = tau + 1.96 * se
 60.                         gen n_counties = `tmp_ncounties'
 61.                         gen pre_mean = `tmp_premean'
 62.                         save "`results_path'sdid/temp_results/results_`table_id'_`outvar'_`c'
> .dta", replace
 63.                         restore
 64.                         preserve
 65.                         clear
 66.                         svmat double omega, names(col)
 67.                         rename c2 fips
 68.                         rename c1 weight
 69.                         gen table_id = `table_id'
 70.                         gen sample_data = "`out_txt'"
 71.                         gen out = "`outcome'"
 72.                         gen sample = "`samp_var'"
 73.                         gen controls = `c'
 74.                         gen exclusion = `exl'
 75.                         drop if weight == 0
 76.                         drop if missing(fips)
 77.                         save "`results_path'sdid/temp_weights/weights_`table_id'_`outvar'_`c'
> .dta", replace
 78.                         restore
 79.                         capture noisily {
 80.                                 sdid_event `outcome' fips year Treated if sample == 1, `covar
> s_event' vce(placebo) brep(`reps') placebo(all)
 81.                         }
 82.                         local event_rc = _rc
 83.                         if `event_rc' == 0 {
 84.                                 qui summ year if multnomah == 1 & sample == 1
 85.                                 local max_yr = r(max)
 86.                                 qui count if multnomah == 1 & sample == 1
 87.                                 local ct = r(N)
 88.                                 local ct = `ct' + 1
 89.                                 capture mat res = e(H)[2..`ct',1..5]
 90.                                 if _rc != 0 {
 91.                                         continue
 92.                                 }
 93.                                 svmat res
 94.                                 gen id = `max_yr' - _n + 1 if !missing(res1)
 95.                                 if `exl' == 1 {
 96.                                         replace id = id - 1 if id <= 2020
 97.                                         expand 2 if id == 2019, gen(tag)
 98.                                         replace id = 2020 if tag == 1
 99.                                         replace res1 = . if tag == 1
100.                                         replace res3 = . if tag == 1
101.                                         replace res4 = . if tag == 1
102.                                 }
103.                                 label var id "Year (destination)"
104.                                 sort id
105.                                 twoway (rcap res3 res4 id, lc(gs10) fc(gs11%50)) (scatter res
> 1 id, mc(black)), legend(off) ytitle("`label'") yline(0, lc(red) lp(-)) xline(2020.5, lc(black) 
> lp(solid)) ylabel(-10(2.5)10, format(%9.1f))
106.                                 if `exl' == 1 local evpath "`results_path'sdid/`out_txt'/fig_
> `out_txt'_`outcome'_`c'_`samp_var'_excl2020_eventstudy.jpg"
107.                                 else local evpath "`results_path'sdid/`out_txt'/fig_`out_txt'
> _`outcome'_`c'_`samp_var'_eventstudy.jpg"
108.                                 graph export "`evpath'", as(jpg) name("Graph") quality(100) r
> eplace
109.                                 drop res1 res2 res3 res4 res5 id
110.                                 capture drop tag
111.                         }
112.                         capture drop ever_treated*
113.                 }
114.         }
115.         if `exl' == 0 local tabpath "`results_path'sdid/`out_txt'/tab_sdid_`out_txt'_`migr'_`
> samp_var'.tex"
116.         if `exl' == 1 local tabpath "`results_path'sdid/`out_txt'/tab_sdid_`out_txt'_`migr'_`
> samp_var'_excl2020.tex"
117.         capture confirm matrix e(b)
118.         if "`data_var'" == "irs_sample_1" | "`data_var'" == "irs_sample_2" {
119.                 capture noisily {
120.                         esttab sdid_n1_0 sdid_n1_1 sdid_n2_0 sdid_n2_1 sdid_agi_0 sdid_agi_1 
> using "`tabpath'", starlevel("*" 0.10 "**" 0.05 "***" 0.01) b(%-9.3f) se(%-9.3f) replace mgroups
> ("Returns" "Exemptions" "AGI", pattern(1 0 1 0 1 0) ) mtitle( "No Covariates" "Covariates" "No C
> ovariates" "Covariates" "No Covariates" "Covariates") stats(count mean, fmt(%9.0fc %9.3fc) label
> s("Number of Counties" "Pre-treatment mean"))
121.                 }
122.         }
123.         else {
124.                 capture noisily {
125.                         esttab sdid_n1_0 sdid_n1_1 sdid_n2_0 sdid_n2_1 sdid_agi_0 sdid_agi_1 
> using "`tabpath'", starlevel("*" 0.10 "**" 0.05 "***" 0.01) b(%-9.3f) se(%-9.3f) replace mgroups
> ("Households" "Adults" "Household Income", pattern(1 0 1 0 1 0) ) mtitle( "No Covariates" "Covar
> iates" "No Covariates" "Covariates" "No Covariates" "Covariates") stats(count mean, fmt(%9.0fc %
> 9.3fc) labels("Number of Counties" "Pre-treatment mean"))
126.                 }
127.         }
128.         dis "Completed table `table_id': `out_txt' / `migr' / `samp_var' / excl=`exl'"
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
Parallel Computing with Stata
Child processes: 6
pll_id         : 4m6zvea7x7
Running at     : C:\Users\ji252\Documents\GitHub\multnomah-county-tax
Randtype       : datetime
Waiting for the child processes to finish...
child process 0005 Exited with error -111- while running the command/dofile (view log)...
child process 0006 has exited without error...
The user pressed -break-. Trying to stop the child processes...
                 stata():  3598  Stata returned error
       parallel_finito():     -  function returned error
          parallel_run():     -  function returned error
                 <istmt>:     -  function returned error
r(3598);

end of do-file

r(3598);

. parallel viewlog 5, e(4m6zvea7x7)

. do "C:\Users\ji252\AppData\Local\Temp\STD72bc_00000j.tmp"

. 
. ** Load data
. use "${data}working/irs_county_gross", replace

. 
. ** Keep required variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3

. order year fips state* county*

. 
. ** Merge with ACS Data
. merge 1:1 year fips using "${data}working/acs_county_gross_18plus", gen(merge_acs_1)
(variable fips was float, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        20,771
        from master                    18,963  (merge_acs_1==1)
        from using                      1,808  (merge_acs_1==2)

    Matched                             3,017  (merge_acs_1==3)
    -----------------------------------------

. 
. ** Keep require variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3 merge_acs_*

. 
. ** Label acs samples
. rename persons_* acs1_persons_*

. rename households_* acs1_households_*

. rename dollars_* acs1_dollars_*

. 
. ** Merge with ACS Data
. merge 1:1 year fips using "${data}working/acs_county_gross_college", gen(merge_acs_2)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,963
        from master                    18,963  (merge_acs_2==1)
        from using                          0  (merge_acs_2==2)

    Matched                             4,825  (merge_acs_2==3)
    -----------------------------------------

. 
. ** Keep require variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3  merge_acs_*

. 
. ** Label acs samples
. rename persons_* acs2_persons_*

. rename households_* acs2_households_*

. rename dollars_* acs2_dollars_*

. 
. ** Drop "other counties"
. drop if county_fips == 0
(483 observations deleted)

. drop if year == 2015
(430 observations deleted)

. 
. ** Merge with Demographic data
. merge m:1 fips using "${data}working/demographics_2020",        ///
>         gen(demo_merge) keep(master match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            27
        from master                        27  (demo_merge==1)
        from using                          0  (demo_merge==2)

    Matched                            22,848  (demo_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name demo_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
                     |        21          0 |        21 
             Alabama |         0        479 |       479 
              Alaska |         6        198 |       204 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         0         34 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |         0        951 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |        27     22,848 |    22,875 

. tab year demo_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         0      3,140 |     3,140 
      2017 |         0      3,140 |     3,140 
      2018 |         0      3,140 |     3,140 
      2019 |         0      3,140 |     3,140 
      2020 |         2      3,140 |     3,142 
      2021 |         2      3,141 |     3,143 
      2022 |         9      3,133 |     3,142 
      2023 |         7        437 |       444 
      2024 |         7        437 |       444 
-----------+----------------------+----------
     Total |        27     22,848 |    22,875 

. 
. ** Keep if matched
. keep if demo_merge == 3
(27 observations deleted)

. drop demo_merge

. 
. ** Rename
. rename population pop_census

. 
. ** Merge with Demographic data
. merge m:1 year fips using "${data}working/bea_economics",       ///
>         gen(econ_merge) keep(master match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           366
        from master                       366  (econ_merge==1)
        from using                          0  (econ_merge==2)

    Matched                            22,482  (econ_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name econ_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
             Alabama |         0        479 |       479 
              Alaska |         0        198 |       198 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         9         25 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |       357        594 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |       366     22,482 |    22,848 

. tab year econ_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |        52      3,088 |     3,140 
      2017 |        52      3,088 |     3,140 
      2018 |        52      3,088 |     3,140 
      2019 |        52      3,088 |     3,140 
      2020 |        52      3,088 |     3,140 
      2021 |        53      3,088 |     3,141 
      2022 |        53      3,080 |     3,133 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |       366     22,482 |    22,848 

. 
. ** Keep if matched
. keep if econ_merge == 3
(366 observations deleted)

. drop econ_merge

. 
. ** Merge with COVID-19 Data
. merge m:1 fips using ${data}working/covid_cleaned_wide.dta,     ///
>         gen(covid_merge) keep(master match )
(variable state_name was str20, now str24 to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            73
        from master                        73  (covid_merge==1)
        from using                          0  (covid_merge==2)

    Matched                            22,409  (covid_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name covid_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |         0        479 |       479 
               Alaska |        28        170 |       198 
              Arizona |         0        113 |       113 
             Arkansas |         0        531 |       531 
           California |         0        474 |       474 
             Colorado |         0        452 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |         0        535 |       535 
              Georgia |         0      1,157 |     1,157 
               Hawaii |         0         25 |        25 
                Idaho |         0        310 |       310 
             Illinois |         0        740 |       740 
              Indiana |         0        676 |       676 
                 Iowa |         0        703 |       703 
               Kansas |         0        741 |       741 
             Kentucky |         0        854 |       854 
            Louisiana |         0        462 |       462 
                Maine |         0        116 |       116 
             Maryland |         0        190 |       190 
        Massachusetts |         0        116 |       116 
             Michigan |         0        613 |       613 
            Minnesota |         0        625 |       625 
          Mississippi |         0        580 |       580 
             Missouri |         0        819 |       819 
              Montana |         0        394 |       394 
             Nebraska |         0        657 |       657 
               Nevada |         0        123 |       123 
        New Hampshire |         0         70 |        70 
           New Jersey |         0        181 |       181 
           New Mexico |         0        235 |       235 
             New York |        45        431 |       476 
       North Carolina |         0        736 |       736 
         North Dakota |         0        373 |       373 
                 Ohio |         0        658 |       658 
             Oklahoma |         0        547 |       547 
               Oregon |         0        268 |       268 
         Pennsylvania |         0        509 |       509 
         Rhode Island |         0         41 |        41 
       South Carolina |         0        338 |       338 
         South Dakota |         0        462 |       462 
            Tennessee |         0        687 |       687 
                Texas |         0      1,854 |     1,854 
                 Utah |         0        213 |       213 
              Vermont |         0        100 |       100 
             Virginia |         0        594 |       594 
           Washington |         0        293 |       293 
        West Virginia |         0        387 |       387 
            Wisconsin |         0        530 |       530 
              Wyoming |         0        163 |       163 
----------------------+----------------------+----------
                Total |        73     22,409 |    22,482 

. tab year covid_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         9      3,079 |     3,088 
      2017 |         9      3,079 |     3,088 
      2018 |         9      3,079 |     3,088 
      2019 |         9      3,079 |     3,088 
      2020 |         9      3,079 |     3,088 
      2021 |         9      3,079 |     3,088 
      2022 |         9      3,071 |     3,080 
      2023 |         5        432 |       437 
      2024 |         5        432 |       437 
-----------+----------------------+----------
     Total |        73     22,409 |    22,482 

. 
. ** Merge with Property Tax Rates (time-varying)
. merge m:1 year fips using "${data}working/property_tax_rates_overall", ///
>         gen(proptx_merge) keep(master match) keepusing(prop_rate_mean prop_rate_se)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,591
        from master                    18,591  (proptx_merge==1)
        from using                          0  (proptx_merge==2)

    Matched                             3,891  (proptx_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name proptx_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |       422         57 |       479 
               Alaska |       189          9 |       198 
              Arizona |        71         42 |       113 
             Arkansas |       498         33 |       531 
           California |       168        306 |       474 
             Colorado |       440         12 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |       268        267 |       535 
              Georgia |       971        186 |     1,157 
               Hawaii |         7         18 |        25 
                Idaho |       301          9 |       310 
             Illinois |       593        147 |       740 
              Indiana |       532        144 |       676 
                 Iowa |       664         39 |       703 
               Kansas |       714         27 |       741 
             Kentucky |       803         51 |       854 
            Louisiana |       393         69 |       462 
                Maine |        92         24 |       116 
             Maryland |        85        105 |       190 
        Massachusetts |        77         39 |       116 
             Michigan |       469        144 |       613 
            Minnesota |       553         72 |       625 
          Mississippi |       553         27 |       580 
             Missouri |       756         63 |       819 
              Montana |       391          3 |       394 
             Nebraska |       630         27 |       657 
               Nevada |       105         18 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        28        153 |       181 
           New Mexico |       211         24 |       235 
             New York |       287        189 |       476 
       North Carolina |       562        174 |       736 
         North Dakota |       364          9 |       373 
                 Ohio |       469        189 |       658 
             Oklahoma |       517         30 |       547 
               Oregon |       196         72 |       268 
         Pennsylvania |       329        180 |       509 
         Rhode Island |        14         27 |        41 
       South Carolina |       290         48 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       600         87 |       687 
                Texas |     1,512        342 |     1,854 
                 Utah |       168         45 |       213 
              Vermont |        97          3 |       100 
             Virginia |       504         90 |       594 
           Washington |       209         84 |       293 
        West Virginia |       384          3 |       387 
            Wisconsin |       413        117 |       530 
              Wyoming |       160          3 |       163 
----------------------+----------------------+----------
                Total |    18,591      3,891 |    22,482 

. tab year proptx_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |     2,658        430 |     3,088 
      2017 |     2,658        430 |     3,088 
      2018 |     2,658        430 |     3,088 
      2019 |     2,658        430 |     3,088 
      2020 |     2,658        430 |     3,088 
      2021 |     2,658        430 |     3,088 
      2022 |     2,643        437 |     3,080 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |    18,591      3,891 |    22,482 

. 
. ** Rename for clarity
. rename prop_rate_mean prop_tax_rate

. rename prop_rate_se prop_tax_rate_se

. label var prop_tax_rate "Mean property tax rate (% of home value)"

. label var prop_tax_rate_se "SE of property tax rate"

. 
. ** Organize data
. order year fips state_* county_*

. sort fips year

. isid fips year

. 
. ** Keep only sample with non-missing base populations
. tab county_name year if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022

                      |  Tax year
                      |   (year
                      |   before
                      |   move)
          County name |      2017 |     Total
----------------------+-----------+----------
        Loving County |         1 |         1 
----------------------+-----------+----------
                Total |         1 |         1 

. drop if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022
(1 observation deleted)

. 
. ** Keep only sample with observations in each year
. bysort fips: gen ct = _N

. tab county_name state_name if ct < 7

                      |      State name
          County name | Connect..      Texas |     Total
----------------------+----------------------+----------
     Fairfield County |         6          0 |         6 
      Hartford County |         6          0 |         6 
    Litchfield County |         6          0 |         6 
        Loving County |         0          6 |         6 
     Middlesex County |         6          0 |         6 
     New Haven County |         6          0 |         6 
    New London County |         6          0 |         6 
       Tolland County |         6          0 |         6 
       Windham County |         6          0 |         6 
----------------------+----------------------+----------
                Total |        48          6 |        54 

. drop if ct < 7
(54 observations deleted)

. drop ct

. 
. ** Generate IRS sample
. gen irs_sample_1 = inrange(year, 2016, 2022)

. gen irs_sample_2 = inrange(year, 2016, 2022) & merge_acs_1 != 1

. 
. ** Generate ACS Period Indicators
. gen acs_period_1 = merge_acs_1 != 1 & inrange(year, 2016, 2022)

. gen acs_period_2 = merge_acs_1 != 1

. 
. ** Make sure we have a balanced panel of ACS counties
. gen tmp = merge_acs_1 != 1

. bysort fips: egen ct_tmp = total(tmp)

. replace acs_period_1 = 0 if ct_tmp != 9
(246 real changes made)

. replace acs_period_2 = 0 if ct_tmp != 9
(342 real changes made)

. replace irs_sample_2 = 0 if ct_tmp != 9
(246 real changes made)

. drop tmp ct_tmp

. 
. tab year irs_sample_1

  Tax year |
     (year |
    before |     irs_sample_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |         0      3,079 |     3,079 
      2017 |         0      3,079 |     3,079 
      2018 |         0      3,079 |     3,079 
      2019 |         0      3,079 |     3,079 
      2020 |         0      3,079 |     3,079 
      2021 |         0      3,079 |     3,079 
      2022 |         0      3,079 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |       874     21,553 |    22,427 

. tab year irs_sample_2

  Tax year |
     (year |
    before |     irs_sample_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_1

  Tax year |
     (year |
    before |     acs_period_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_2

  Tax year |
     (year |
    before |     acs_period_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |        48        389 |       437 
      2024 |        48        389 |       437 
-----------+----------------------+----------
     Total |    18,926      3,501 |    22,427 

. tab state_name acs_period_1

                      |     acs_period_1
           State name |         0          1 |     Total
----------------------+----------------------+----------
              Alabama |       458         21 |       479 
               Alaska |       191          7 |       198 
              Arizona |        92         21 |       113 
             Arkansas |       510         21 |       531 
           California |       236        238 |       474 
             Colorado |       445          7 |       452 
             Delaware |         6         21 |        27 
 District of Columbia |         2          7 |         9 
              Florida |       339        196 |       535 
              Georgia |     1,017        140 |     1,157 
               Hawaii |        11         14 |        25 
                Idaho |       303          7 |       310 
             Illinois |       656         84 |       740 
              Indiana |       564        112 |       676 
                 Iowa |       675         28 |       703 
               Kansas |       720         21 |       741 
             Kentucky |       819         35 |       854 
            Louisiana |       413         49 |       462 
                Maine |       102         14 |       116 
             Maryland |       113         77 |       190 
        Massachusetts |       102         14 |       116 
             Michigan |       501        112 |       613 
            Minnesota |       583         42 |       625 
          Mississippi |       559         21 |       580 
             Missouri |       784         35 |       819 
              Montana |       394          0 |       394 
             Nebraska |       636         21 |       657 
               Nevada |       109         14 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        62        119 |       181 
           New Mexico |       221         14 |       235 
             New York |       336        140 |       476 
       North Carolina |       610        126 |       736 
         North Dakota |       366          7 |       373 
                 Ohio |       525        133 |       658 
             Oklahoma |       526         21 |       547 
               Oregon |       219         49 |       268 
         Pennsylvania |       369        140 |       509 
         Rhode Island |        20         21 |        41 
       South Carolina |       331          7 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       638         49 |       687 
                Texas |     1,581        266 |     1,847 
                 Utah |       178         35 |       213 
              Vermont |       100          0 |       100 
             Virginia |       531         63 |       594 
           Washington |       230         63 |       293 
        West Virginia |       387          0 |       387 
            Wisconsin |       439         91 |       530 
              Wyoming |       163          0 |       163 
----------------------+----------------------+----------
                Total |    19,704      2,723 |    22,427 

. 
. ** Define treated state
. gen multnomah = state_fips == 41 & county_fips == 51

. label var multnomah "Indicator for Multnomah County, Oregon"

. 
. ** Define treatment indicator
. gen Treated = multnomah == 1 & year > 2020

. label var Treated "Treatment indicator for Multnomah County, Oregon"

. 
. ** Define sample 1: All counties
. gen sample_all = 1

. label var sample_all "All counties (excluding AK, CA, HI OR, WA)"

. 
. ** Define sample 2: Counties in top 95 percent
. summ percent_urban if year == 2020, de

            Percent of population in urban areas
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs               3,079
25%            0              0       Sum of wgt.       3,079

50%     .3256337                      Mean           .3521437
                        Largest       Std. dev.       .332065
75%     .6326353              1
90%      .847923              1       Variance       .1102672
95%     .9372299              1       Skewness       .3661052
99%     .9972304              1       Kurtosis       1.763629

. local cutoff = r(p95)

. tab state_name multnomah if percent_urban >= `cutoff' & year == 2020

                      |     Indicator for
                      |   Multnomah County,
                      |        Oregon
           State name |         0          1 |     Total
----------------------+----------------------+----------
               Alaska |         1          0 |         1 
              Arizona |         1          0 |         1 
           California |        15          0 |        15 
             Colorado |         4          0 |         4 
             Delaware |         1          0 |         1 
 District of Columbia |         1          0 |         1 
              Florida |        13          0 |        13 
              Georgia |         8          0 |         8 
               Hawaii |         1          0 |         1 
                Idaho |         1          0 |         1 
             Illinois |         5          0 |         5 
              Indiana |         3          0 |         3 
                 Iowa |         1          0 |         1 
               Kansas |         2          0 |         2 
             Kentucky |         2          0 |         2 
            Louisiana |         3          0 |         3 
             Maryland |         3          0 |         3 
        Massachusetts |         5          0 |         5 
             Michigan |         3          0 |         3 
            Minnesota |         3          0 |         3 
             Missouri |         4          0 |         4 
             Nebraska |         2          0 |         2 
               Nevada |         3          0 |         3 
           New Jersey |        10          0 |        10 
           New Mexico |         2          0 |         2 
             New York |         9          0 |         9 
       North Carolina |         4          0 |         4 
                 Ohio |         6          0 |         6 
             Oklahoma |         1          0 |         1 
               Oregon |         1          1 |         2 
         Pennsylvania |         4          0 |         4 
         Rhode Island |         2          0 |         2 
            Tennessee |         2          0 |         2 
                Texas |        11          0 |        11 
                 Utah |         4          0 |         4 
             Virginia |        10          0 |        10 
           Washington |         1          0 |         1 
            Wisconsin |         1          0 |         1 
----------------------+----------------------+----------
                Total |       153          1 |       154 

. gen sample_urban95 = percent_urban >= `cutoff' // All counties

. label var sample_urban95 "Urban counties (top 5%) (excluding AK, CA, HI OR, WA)"

. tab sample_urban95 if year == 2020

      Urban |
   counties |
   (top 5%) |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,925       95.00       95.00
          1 |        154        5.00      100.00
------------+-----------------------------------
      Total |      3,079      100.00

. 
. ** Define sample 3: Counties in top 98 percent
. local cutoff = .9864539 //

. tab state_name multnomah if percent_urban >= `cutoff' & year == 2020

                      |     Indicator for
                      |   Multnomah County,
                      |        Oregon
           State name |         0          1 |     Total
----------------------+----------------------+----------
           California |         6          0 |         6 
             Colorado |         2          0 |         2 
 District of Columbia |         1          0 |         1 
              Florida |         4          0 |         4 
              Georgia |         5          0 |         5 
             Illinois |         2          0 |         2 
              Indiana |         1          0 |         1 
            Louisiana |         1          0 |         1 
             Maryland |         1          0 |         1 
        Massachusetts |         1          0 |         1 
             Michigan |         1          0 |         1 
            Minnesota |         1          0 |         1 
             Missouri |         1          0 |         1 
               Nevada |         1          0 |         1 
           New Jersey |         6          0 |         6 
             New York |         7          0 |         7 
       North Carolina |         1          0 |         1 
                 Ohio |         1          0 |         1 
               Oregon |         0          1 |         1 
         Pennsylvania |         2          0 |         2 
         Rhode Island |         1          0 |         1 
                Texas |         3          0 |         3 
                 Utah |         2          0 |         2 
             Virginia |         8          0 |         8 
            Wisconsin |         1          0 |         1 
----------------------+----------------------+----------
                Total |        60          1 |        61 

. gen sample_urban98 = percent_urban >= `cutoff' // All counties

. label var sample_urban98 "Urban counties (top 1%) (excluding AK, CA, HI OR, WA)"

. tab sample_urban98 if year == 2020

      Urban |
   counties |
   (top 1%) |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,018       98.02       98.02
          1 |         61        1.98      100.00
------------+-----------------------------------
      Total |      3,079      100.00

. 
. ** Define Sample of States
. drop if state_name == "Alaska"
(198 observations deleted)

. drop if state_name == "Hawaii"
(25 observations deleted)

. drop if state_name == "California"
(474 observations deleted)

. drop if state_name == "Washington"
(293 observations deleted)

. drop if state_name == "Oregon" & multnomah == 0
(259 observations deleted)

. 
. ** Define sample 4: Counties in top 95 + covid
. cluster kmeans cases_cum* deaths_cum* if        ///
>         sample_urban95 == 1 & year == 2020 & covid_merge == 3 , k(5) gen(kmean)
cluster name: _clus_1

. bysort fips: egen kmean_group = mean(kmean)
(20,046 missing values generated)

. 
. ** Pull out kmeans cluster with Multnoma
. gen tmp1 = kmean if sample_urban95 == 1 & year == 2020 & covid_merge == 3 & multnomah == 1
(21,177 missing values generated)

. egen tmp2 = mean(tmp1)

. gen sample_urban95_covid = sample_urban95 == 1 & kmean_group == tmp2

. drop tmp1 tmp2

. label var sample_urban95_covid "Urban counties (top 5%) w. Kmean Covid Match  (excluding AK, CA,
>  HI OR, WA)"

. tab sample_urban95_covid if year == 2020

      Urban |
   counties |
(top 5%) w. |
Kmean Covid |
      Match |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,879       98.73       98.73
          1 |         37        1.27      100.00
------------+-----------------------------------
      Total |      2,916      100.00

. 
. ** Show results across clusters
. preserve

. 
. ** Keep required variables
. keep if sample_urban95 == 1 & year == 2020 & covid_merge == 3
(21,048 observations deleted)

. keep kmean cases_cum* deaths_cum* population

. collapse (mean) cases_cum* deaths_cum* [fw = population], by(kmean)

. reshape long cases_cum deaths_cum, i(kmean) j(time)
(j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations                5   ->   145         
Number of variables                  59   ->   4           
j variable (29 values)                    ->   time
xij variables:
  cases_cum1 cases_cum2 ... cases_cum29   ->   cases_cum
deaths_cum1 deaths_cum2 ... deaths_cum29  ->   deaths_cum
-----------------------------------------------------------------------------

. xtset kmean time

Panel variable: kmean (strongly balanced)
 Time variable: time, 1 to 29
         Delta: 1 unit

. xtline cases_cum

. graph export "${results}sdid/fig_kmeans.jpg", as(jpg) name("Graph") quality(100) replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/fig_kmeans.jpg written in J
> PEG format

. clear

. 
. ** Restore
. restore

. 
. ** Define covariates
. local covariates "population per_capita_income"

. 
. ** Standardize covariates
. foreach v of local covariates {
  2.         egen tmp_v = std(`v')
  3.         replace `v' = tmp_v
  4.         drop tmp_v
  5. } // END COVAR LOOP
(21,178 real changes made)
(21,178 real changes made)

. 
. ** Define outcome variables (IRS)
. foreach x in "n1" "n2" "agi" {
  2. 
.         if "`x'" == "n1" local xtxt "returns"
  3.         else if "`x'" == "n2" local xtxt "exemptions"
  4.         else if "`x'" == "agi" local xtxt "AGI"
  5. 
.         ** Loop over migration type
.         foreach y in "net" "in" "out" {
  6. 
.                         if "`y'" == "net" local ytxt "Net domestic migration"
  7.                         else if "`y'" == "in" local ytxt "Domestic in-migration"
  8.                         else if "`y'" == "out" local ytxt "Domestic out-migration"
  9. 
.                         ** Generate
.                         gen `x'_`y'_rate_irs = 100 * (`x'_`y'_3 / (`x'_out_1 + `x'_out_2))
 10. 
.                         ** Label var
.                         label var `x'_`y'_rate_irs      "`ytxt' rate, `xtxt' (%)"
 11. 
.         } // END MIGRATION TYPE LOOP
 12. 
. } // END OUTCOME TYPE LOOP
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)

. 
. ** Define outcome variables (ACS)
. 
. ** Rename for loop
. rename acs*_households_* acs*_n1_*

. rename acs*_persons_* acs*_n2_*

. rename acs*_dollars_* acs*_agi_*

. 
. ** Loop over sample
. ** (18+ = 1, college degree == 2, no college degree == 3)
. forvalues i = 1/2{
  2. 
.         if `i' == 1 local itxt ""
  3.         else if `i' == 2 local itxt " (College)"
  4.         else if `i' == 3 local itxt " (No College)"
  5. 
. 
.         ** Define outcome variables (IRS)
.         foreach x in "n1" "n2" "agi" {
  6. 
.                 if "`x'" == "n1" local xtxt "HHs"
  7.                 else if "`x'" == "n2" local xtxt "persons"
  8.                 else if "`x'" == "agi" local xtxt "total income"
  9. 
. 
.                 ** Loop over migration type
.                 foreach y in "net" "in" "out" {
 10. 
.                                 if "`y'" == "net" local ytxt "Net domestic migration"
 11.                                 else if "`y'" == "in" local ytxt "Domestic in-migration"
 12.                                 else if "`y'" == "out" local ytxt "Domestic out-migration"
 13. 
.                                 ** Generate
.                                 gen `x'_`y'_rate_acs`i' = 100 * (acs`i'_`x'_`y'_3 / (acs`i'_`x'_
> out_1 + acs`i'_`x'_out_2))
 14. 
.                                 ** Label var
.                                 label var `x'_`y'_rate_acs`i' "`ytxt' rate, `xtxt'`itxt' (%)"
 15. 
.                 } // END MIGRATION TYPE LOOP
 16. 
.         } // END OUTCOME TYPE LOOP
 17. 
. } // END SAMPLE LOOP
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)

. 
. ** Declare panel
. xtset fips year

Panel variable: fips (unbalanced)
 Time variable: year, 2016 to 2024
         Delta: 1 unit

. 
. ** Tag unique fips
. egen unique = tag(fips)

. tab year unique

  Tax year |
     (year |
    before |       tag(fips)
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |         0      2,916 |     2,916 
      2017 |     2,916          0 |     2,916 
      2018 |     2,916          0 |     2,916 
      2019 |     2,916          0 |     2,916 
      2020 |     2,916          0 |     2,916 
      2021 |     2,916          0 |     2,916 
      2022 |     2,916          0 |     2,916 
      2023 |       383          0 |       383 
      2024 |       383          0 |       383 
-----------+----------------------+----------
     Total |    18,262      2,916 |    21,178 

. 
. ** Label var
. label var year "Year (destination)"

. 
. /*******************************************************************************
> SECTION 3: CREATE TABLE-LEVEL SPECIFICATION GRID
> Each row represents one table = 6 SDID specs (3 outcomes  2 covariate settings)
> *******************************************************************************/
. 
end of do-file

. gen sample = irs_sample_1 == 1& year != 2020

. isid fips year if sample == 1
if not allowed
r(101);

. isid fips year

. isid n1_out_rate_irs fips year Treated if sample == 1
if not allowed
r(101);

. sdid n1_out_rate_irs fips year Treated if sample == 1
option vce() required
r(198);

. sdid n1_out_rate_irs fips year Treated if sample == 1, vce(placebo)
Placebo replications (50). This may take some time.
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5
.....................--Break--
r(1);

. sdid n1_out_rate_irs fips year Treated if sample == 1, vce(placebo) covariates(prop_tax_rate )
Missing values found in covariates.
A balanced panel without missing observations is required.
r(416);

. do "C:\Users\ji252\AppData\Local\Temp\STD72bc_00000k.tmp"

. 
. ** Synthetic Difference-in-Difference Analysis
. do ${code}02_sdid_analysis_parallel.do 

. /*******************************************************************************
> File Name:              02_sdid_analysis_parallel.do
> Creator:                John Iselin (parallelized version)
> Date Update:    January 13, 2025
> 
> Called by: 00_multnomah.do
> 
> Purpose: Perform synthetic difference-in-difference estimation using parallel
>          processing to speed up computation across multiple specifications.
> 
>          Each parallel child runs all 6 specifications for one table:
>          - 3 outcome variables (n1, n2, agi) for a given migration type
>          - Each with 2 covariate settings (with/without controls)
>          This allows tables to be generated within each child process.
> 
> Requirements:
> - parallel package: net install parallel, from(https://raw.github.com/gvegayon/parallel/stable/)
>  replace
> 
> Outputs:
> - sdid_weights.dta/xlsx: Synthetic control weights for each specification
> - sdid_results.dta/xlsx: Treatment effects, SEs, p-values for each specification
> - tab_sdid_*.tex: LaTeX tables for each specification group
> - fig_speccurve_*.pdf/jpg: Specification curve plots
> 
> Authors: John Iselin
> 
> For more information, contact john.iselin@yale.edu
> 
> *******************************************************************************/
. 
. ** Start log file
. capture log close log_02

. log using "${logs}02_log_sdid_parallel_${date}", replace text name(log_02)
--------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_sdid_parallel_2
> 026-01-14.log
  log type:  text
 opened on:  14 Jan 2026, 22:06:00

. 
. /*******************************************************************************
> SECTION 1: SETUP AND CONFIGURATION
> *******************************************************************************/
. 
. ** Set number of parallel clusters (adjust based on your machine)
. ** Use fewer than total cores to leave resources for system
. local n_clusters = 6

. 
. ** Parameters
. local reps = 100

. 
. ** Initialize parallel processing
. parallel initialize `n_clusters', force
N Child processes: 6
Stata dir:  C:\Program Files\StataNow19/StataMP-64.exe

. 
. /*******************************************************************************
> SECTION 2: DATA PREPARATION
> (Same as original - prepares main analysis dataset)
> *******************************************************************************/
. 
. ** Load data
. use "${data}working/irs_county_gross", replace

. 
. ** Keep required variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3

. order year fips state* county*

. 
. ** Merge with ACS Data
. merge 1:1 year fips using "${data}working/acs_county_gross_18plus", gen(merge_acs_1)
(variable fips was float, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        20,771
        from master                    18,963  (merge_acs_1==1)
        from using                      1,808  (merge_acs_1==2)

    Matched                             3,017  (merge_acs_1==3)
    -----------------------------------------

. 
. ** Keep require variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3 merge_acs_*

. 
. ** Label acs samples
. rename persons_* acs1_persons_*

. rename households_* acs1_households_*

. rename dollars_* acs1_dollars_*

. 
. ** Merge with ACS Data
. merge 1:1 year fips using "${data}working/acs_county_gross_college", gen(merge_acs_2)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,963
        from master                    18,963  (merge_acs_2==1)
        from using                          0  (merge_acs_2==2)

    Matched                             4,825  (merge_acs_2==3)
    -----------------------------------------

. 
. ** Keep require variables
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3  merge_acs_*

. 
. ** Label acs samples
. rename persons_* acs2_persons_*

. rename households_* acs2_households_*

. rename dollars_* acs2_dollars_*

. 
. ** Drop "other counties"
. drop if county_fips == 0
(483 observations deleted)

. drop if year == 2015
(430 observations deleted)

. 
. ** Merge with Demographic data
. merge m:1 fips using "${data}working/demographics_2020",        ///
>         gen(demo_merge) keep(master match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            27
        from master                        27  (demo_merge==1)
        from using                          0  (demo_merge==2)

    Matched                            22,848  (demo_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name demo_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
                     |        21          0 |        21 
             Alabama |         0        479 |       479 
              Alaska |         6        198 |       204 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         0         34 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |         0        951 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |        27     22,848 |    22,875 

. tab year demo_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         0      3,140 |     3,140 
      2017 |         0      3,140 |     3,140 
      2018 |         0      3,140 |     3,140 
      2019 |         0      3,140 |     3,140 
      2020 |         2      3,140 |     3,142 
      2021 |         2      3,141 |     3,143 
      2022 |         9      3,133 |     3,142 
      2023 |         7        437 |       444 
      2024 |         7        437 |       444 
-----------+----------------------+----------
     Total |        27     22,848 |    22,875 

. 
. ** Keep if matched
. keep if demo_merge == 3
(27 observations deleted)

. drop demo_merge

. 
. ** Rename
. rename population pop_census

. 
. ** Merge with Demographic data
. merge m:1 year fips using "${data}working/bea_economics",       ///
>         gen(econ_merge) keep(master match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           366
        from master                       366  (econ_merge==1)
        from using                          0  (econ_merge==2)

    Matched                            22,482  (econ_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name econ_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
             Alabama |         0        479 |       479 
              Alaska |         0        198 |       198 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         9         25 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |       357        594 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |       366     22,482 |    22,848 

. tab year econ_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |        52      3,088 |     3,140 
      2017 |        52      3,088 |     3,140 
      2018 |        52      3,088 |     3,140 
      2019 |        52      3,088 |     3,140 
      2020 |        52      3,088 |     3,140 
      2021 |        53      3,088 |     3,141 
      2022 |        53      3,080 |     3,133 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |       366     22,482 |    22,848 

. 
. ** Keep if matched
. keep if econ_merge == 3
(366 observations deleted)

. drop econ_merge

. 
. ** Merge with COVID-19 Data
. merge m:1 fips using ${data}working/covid_cleaned_wide.dta,     ///
>         gen(covid_merge) keep(master match )
(variable state_name was str20, now str24 to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            73
        from master                        73  (covid_merge==1)
        from using                          0  (covid_merge==2)

    Matched                            22,409  (covid_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name covid_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |         0        479 |       479 
               Alaska |        28        170 |       198 
              Arizona |         0        113 |       113 
             Arkansas |         0        531 |       531 
           California |         0        474 |       474 
             Colorado |         0        452 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |         0        535 |       535 
              Georgia |         0      1,157 |     1,157 
               Hawaii |         0         25 |        25 
                Idaho |         0        310 |       310 
             Illinois |         0        740 |       740 
              Indiana |         0        676 |       676 
                 Iowa |         0        703 |       703 
               Kansas |         0        741 |       741 
             Kentucky |         0        854 |       854 
            Louisiana |         0        462 |       462 
                Maine |         0        116 |       116 
             Maryland |         0        190 |       190 
        Massachusetts |         0        116 |       116 
             Michigan |         0        613 |       613 
            Minnesota |         0        625 |       625 
          Mississippi |         0        580 |       580 
             Missouri |         0        819 |       819 
              Montana |         0        394 |       394 
             Nebraska |         0        657 |       657 
               Nevada |         0        123 |       123 
        New Hampshire |         0         70 |        70 
           New Jersey |         0        181 |       181 
           New Mexico |         0        235 |       235 
             New York |        45        431 |       476 
       North Carolina |         0        736 |       736 
         North Dakota |         0        373 |       373 
                 Ohio |         0        658 |       658 
             Oklahoma |         0        547 |       547 
               Oregon |         0        268 |       268 
         Pennsylvania |         0        509 |       509 
         Rhode Island |         0         41 |        41 
       South Carolina |         0        338 |       338 
         South Dakota |         0        462 |       462 
            Tennessee |         0        687 |       687 
                Texas |         0      1,854 |     1,854 
                 Utah |         0        213 |       213 
              Vermont |         0        100 |       100 
             Virginia |         0        594 |       594 
           Washington |         0        293 |       293 
        West Virginia |         0        387 |       387 
            Wisconsin |         0        530 |       530 
              Wyoming |         0        163 |       163 
----------------------+----------------------+----------
                Total |        73     22,409 |    22,482 

. tab year covid_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         9      3,079 |     3,088 
      2017 |         9      3,079 |     3,088 
      2018 |         9      3,079 |     3,088 
      2019 |         9      3,079 |     3,088 
      2020 |         9      3,079 |     3,088 
      2021 |         9      3,079 |     3,088 
      2022 |         9      3,071 |     3,080 
      2023 |         5        432 |       437 
      2024 |         5        432 |       437 
-----------+----------------------+----------
     Total |        73     22,409 |    22,482 

. 
. ** Merge with Property Tax Rates (time-varying)
. merge m:1 year fips using "${data}working/property_tax_rates_overall", ///
>         gen(proptx_merge) keep(master match) keepusing(prop_rate_mean prop_rate_se)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,591
        from master                    18,591  (proptx_merge==1)
        from using                          0  (proptx_merge==2)

    Matched                             3,891  (proptx_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name proptx_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |       422         57 |       479 
               Alaska |       189          9 |       198 
              Arizona |        71         42 |       113 
             Arkansas |       498         33 |       531 
           California |       168        306 |       474 
             Colorado |       440         12 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |       268        267 |       535 
              Georgia |       971        186 |     1,157 
               Hawaii |         7         18 |        25 
                Idaho |       301          9 |       310 
             Illinois |       593        147 |       740 
              Indiana |       532        144 |       676 
                 Iowa |       664         39 |       703 
               Kansas |       714         27 |       741 
             Kentucky |       803         51 |       854 
            Louisiana |       393         69 |       462 
                Maine |        92         24 |       116 
             Maryland |        85        105 |       190 
        Massachusetts |        77         39 |       116 
             Michigan |       469        144 |       613 
            Minnesota |       553         72 |       625 
          Mississippi |       553         27 |       580 
             Missouri |       756         63 |       819 
              Montana |       391          3 |       394 
             Nebraska |       630         27 |       657 
               Nevada |       105         18 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        28        153 |       181 
           New Mexico |       211         24 |       235 
             New York |       287        189 |       476 
       North Carolina |       562        174 |       736 
         North Dakota |       364          9 |       373 
                 Ohio |       469        189 |       658 
             Oklahoma |       517         30 |       547 
               Oregon |       196         72 |       268 
         Pennsylvania |       329        180 |       509 
         Rhode Island |        14         27 |        41 
       South Carolina |       290         48 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       600         87 |       687 
                Texas |     1,512        342 |     1,854 
                 Utah |       168         45 |       213 
              Vermont |        97          3 |       100 
             Virginia |       504         90 |       594 
           Washington |       209         84 |       293 
        West Virginia |       384          3 |       387 
            Wisconsin |       413        117 |       530 
              Wyoming |       160          3 |       163 
----------------------+----------------------+----------
                Total |    18,591      3,891 |    22,482 

. tab year proptx_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |     2,658        430 |     3,088 
      2017 |     2,658        430 |     3,088 
      2018 |     2,658        430 |     3,088 
      2019 |     2,658        430 |     3,088 
      2020 |     2,658        430 |     3,088 
      2021 |     2,658        430 |     3,088 
      2022 |     2,643        437 |     3,080 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |    18,591      3,891 |    22,482 

. 
. ** Rename for clarity
. rename prop_rate_mean prop_tax_rate

. rename prop_rate_se prop_tax_rate_se

. label var prop_tax_rate "Mean property tax rate (% of home value)"

. label var prop_tax_rate_se "SE of property tax rate"

. 
. ** Organize data
. order year fips state_* county_*

. sort fips year

. isid fips year

. 
. ** Keep only sample with non-missing base populations
. tab county_name year if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022

                      |  Tax year
                      |   (year
                      |   before
                      |   move)
          County name |      2017 |     Total
----------------------+-----------+----------
        Loving County |         1 |         1 
----------------------+-----------+----------
                Total |         1 |         1 

. drop if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022
(1 observation deleted)

. 
. ** Keep only sample with observations in each year
. bysort fips: gen ct = _N

. tab county_name state_name if ct < 7

                      |      State name
          County name | Connect..      Texas |     Total
----------------------+----------------------+----------
     Fairfield County |         6          0 |         6 
      Hartford County |         6          0 |         6 
    Litchfield County |         6          0 |         6 
        Loving County |         0          6 |         6 
     Middlesex County |         6          0 |         6 
     New Haven County |         6          0 |         6 
    New London County |         6          0 |         6 
       Tolland County |         6          0 |         6 
       Windham County |         6          0 |         6 
----------------------+----------------------+----------
                Total |        48          6 |        54 

. drop if ct < 7
(54 observations deleted)

. drop ct

. 
. ** Generate IRS sample
. gen irs_sample_1 = inrange(year, 2016, 2022)

. gen irs_sample_2 = inrange(year, 2016, 2022) & merge_acs_1 != 1

. 
. ** Generate ACS Period Indicators
. gen acs_period_1 = merge_acs_1 != 1 & inrange(year, 2016, 2022)

. gen acs_period_2 = merge_acs_1 != 1

. 
. ** Make sure we have a balanced panel of ACS counties
. gen tmp = merge_acs_1 != 1

. bysort fips: egen ct_tmp = total(tmp)

. replace acs_period_1 = 0 if ct_tmp != 9
(246 real changes made)

. replace acs_period_2 = 0 if ct_tmp != 9
(342 real changes made)

. replace irs_sample_2 = 0 if ct_tmp != 9
(246 real changes made)

. drop tmp ct_tmp

. 
. tab year irs_sample_1

  Tax year |
     (year |
    before |     irs_sample_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |         0      3,079 |     3,079 
      2017 |         0      3,079 |     3,079 
      2018 |         0      3,079 |     3,079 
      2019 |         0      3,079 |     3,079 
      2020 |         0      3,079 |     3,079 
      2021 |         0      3,079 |     3,079 
      2022 |         0      3,079 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |       874     21,553 |    22,427 

. tab year irs_sample_2

  Tax year |
     (year |
    before |     irs_sample_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_1

  Tax year |
     (year |
    before |     acs_period_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_2

  Tax year |
     (year |
    before |     acs_period_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |        48        389 |       437 
      2024 |        48        389 |       437 
-----------+----------------------+----------
     Total |    18,926      3,501 |    22,427 

. tab state_name acs_period_1

                      |     acs_period_1
           State name |         0          1 |     Total
----------------------+----------------------+----------
              Alabama |       458         21 |       479 
               Alaska |       191          7 |       198 
              Arizona |        92         21 |       113 
             Arkansas |       510         21 |       531 
           California |       236        238 |       474 
             Colorado |       445          7 |       452 
             Delaware |         6         21 |        27 
 District of Columbia |         2          7 |         9 
              Florida |       339        196 |       535 
              Georgia |     1,017        140 |     1,157 
               Hawaii |        11         14 |        25 
                Idaho |       303          7 |       310 
             Illinois |       656         84 |       740 
              Indiana |       564        112 |       676 
                 Iowa |       675         28 |       703 
               Kansas |       720         21 |       741 
             Kentucky |       819         35 |       854 
            Louisiana |       413         49 |       462 
                Maine |       102         14 |       116 
             Maryland |       113         77 |       190 
        Massachusetts |       102         14 |       116 
             Michigan |       501        112 |       613 
            Minnesota |       583         42 |       625 
          Mississippi |       559         21 |       580 
             Missouri |       784         35 |       819 
              Montana |       394          0 |       394 
             Nebraska |       636         21 |       657 
               Nevada |       109         14 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        62        119 |       181 
           New Mexico |       221         14 |       235 
             New York |       336        140 |       476 
       North Carolina |       610        126 |       736 
         North Dakota |       366          7 |       373 
                 Ohio |       525        133 |       658 
             Oklahoma |       526         21 |       547 
               Oregon |       219         49 |       268 
         Pennsylvania |       369        140 |       509 
         Rhode Island |        20         21 |        41 
       South Carolina |       331          7 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       638         49 |       687 
                Texas |     1,581        266 |     1,847 
                 Utah |       178         35 |       213 
              Vermont |       100          0 |       100 
             Virginia |       531         63 |       594 
           Washington |       230         63 |       293 
        West Virginia |       387          0 |       387 
            Wisconsin |       439         91 |       530 
              Wyoming |       163          0 |       163 
----------------------+----------------------+----------
                Total |    19,704      2,723 |    22,427 

. 
. ** Define treated state
. gen multnomah = state_fips == 41 & county_fips == 51

. label var multnomah "Indicator for Multnomah County, Oregon"

. 
. ** Define treatment indicator
. gen Treated = multnomah == 1 & year > 2020

. label var Treated "Treatment indicator for Multnomah County, Oregon"

. 
. ** Define sample 1: All counties
. gen sample_all = 1

. label var sample_all "All counties (excluding AK, CA, HI OR, WA)"

. 
. ** Define sample 2: Counties in top 95 percent
. summ percent_urban if year == 2020, de

            Percent of population in urban areas
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs               3,079
25%            0              0       Sum of wgt.       3,079

50%     .3256337                      Mean           .3521437
                        Largest       Std. dev.       .332065
75%     .6326353              1
90%      .847923              1       Variance       .1102672
95%     .9372299              1       Skewness       .3661052
99%     .9972304              1       Kurtosis       1.763629

. local cutoff = r(p95)

. tab state_name multnomah if percent_urban >= `cutoff' & year == 2020

                      |     Indicator for
                      |   Multnomah County,
                      |        Oregon
           State name |         0          1 |     Total
----------------------+----------------------+----------
               Alaska |         1          0 |         1 
              Arizona |         1          0 |         1 
           California |        15          0 |        15 
             Colorado |         4          0 |         4 
             Delaware |         1          0 |         1 
 District of Columbia |         1          0 |         1 
              Florida |        13          0 |        13 
              Georgia |         8          0 |         8 
               Hawaii |         1          0 |         1 
                Idaho |         1          0 |         1 
             Illinois |         5          0 |         5 
              Indiana |         3          0 |         3 
                 Iowa |         1          0 |         1 
               Kansas |         2          0 |         2 
             Kentucky |         2          0 |         2 
            Louisiana |         3          0 |         3 
             Maryland |         3          0 |         3 
        Massachusetts |         5          0 |         5 
             Michigan |         3          0 |         3 
            Minnesota |         3          0 |         3 
             Missouri |         4          0 |         4 
             Nebraska |         2          0 |         2 
               Nevada |         3          0 |         3 
           New Jersey |        10          0 |        10 
           New Mexico |         2          0 |         2 
             New York |         9          0 |         9 
       North Carolina |         4          0 |         4 
                 Ohio |         6          0 |         6 
             Oklahoma |         1          0 |         1 
               Oregon |         1          1 |         2 
         Pennsylvania |         4          0 |         4 
         Rhode Island |         2          0 |         2 
            Tennessee |         2          0 |         2 
                Texas |        11          0 |        11 
                 Utah |         4          0 |         4 
             Virginia |        10          0 |        10 
           Washington |         1          0 |         1 
            Wisconsin |         1          0 |         1 
----------------------+----------------------+----------
                Total |       153          1 |       154 

. gen sample_urban95 = percent_urban >= `cutoff' // All counties

. label var sample_urban95 "Urban counties (top 5%) (excluding AK, CA, HI OR, WA)"

. tab sample_urban95 if year == 2020

      Urban |
   counties |
   (top 5%) |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,925       95.00       95.00
          1 |        154        5.00      100.00
------------+-----------------------------------
      Total |      3,079      100.00

. 
. ** Define sample 3: Counties in top 98 percent
. local cutoff = .9864539 //

. tab state_name multnomah if percent_urban >= `cutoff' & year == 2020

                      |     Indicator for
                      |   Multnomah County,
                      |        Oregon
           State name |         0          1 |     Total
----------------------+----------------------+----------
           California |         6          0 |         6 
             Colorado |         2          0 |         2 
 District of Columbia |         1          0 |         1 
              Florida |         4          0 |         4 
              Georgia |         5          0 |         5 
             Illinois |         2          0 |         2 
              Indiana |         1          0 |         1 
            Louisiana |         1          0 |         1 
             Maryland |         1          0 |         1 
        Massachusetts |         1          0 |         1 
             Michigan |         1          0 |         1 
            Minnesota |         1          0 |         1 
             Missouri |         1          0 |         1 
               Nevada |         1          0 |         1 
           New Jersey |         6          0 |         6 
             New York |         7          0 |         7 
       North Carolina |         1          0 |         1 
                 Ohio |         1          0 |         1 
               Oregon |         0          1 |         1 
         Pennsylvania |         2          0 |         2 
         Rhode Island |         1          0 |         1 
                Texas |         3          0 |         3 
                 Utah |         2          0 |         2 
             Virginia |         8          0 |         8 
            Wisconsin |         1          0 |         1 
----------------------+----------------------+----------
                Total |        60          1 |        61 

. gen sample_urban98 = percent_urban >= `cutoff' // All counties

. label var sample_urban98 "Urban counties (top 1%) (excluding AK, CA, HI OR, WA)"

. tab sample_urban98 if year == 2020

      Urban |
   counties |
   (top 1%) |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,018       98.02       98.02
          1 |         61        1.98      100.00
------------+-----------------------------------
      Total |      3,079      100.00

. 
. ** Define Sample of States
. drop if state_name == "Alaska"
(198 observations deleted)

. drop if state_name == "Hawaii"
(25 observations deleted)

. drop if state_name == "California"
(474 observations deleted)

. drop if state_name == "Washington"
(293 observations deleted)

. drop if state_name == "Oregon" & multnomah == 0
(259 observations deleted)

. 
. ** Define sample 4: Counties in top 95 + covid
. cluster kmeans cases_cum* deaths_cum* if        ///
>         sample_urban95 == 1 & year == 2020 & covid_merge == 3 , k(5) gen(kmean)
cluster name: _clus_1

. bysort fips: egen kmean_group = mean(kmean)
(20,046 missing values generated)

. 
. ** Pull out kmeans cluster with Multnoma
. gen tmp1 = kmean if sample_urban95 == 1 & year == 2020 & covid_merge == 3 & multnomah == 1
(21,177 missing values generated)

. egen tmp2 = mean(tmp1)

. gen sample_urban95_covid = sample_urban95 == 1 & kmean_group == tmp2

. drop tmp1 tmp2

. label var sample_urban95_covid "Urban counties (top 5%) w. Kmean Covid Match  (excluding AK, CA,
>  HI OR, WA)"

. tab sample_urban95_covid if year == 2020

      Urban |
   counties |
(top 5%) w. |
Kmean Covid |
      Match |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,879       98.73       98.73
          1 |         37        1.27      100.00
------------+-----------------------------------
      Total |      2,916      100.00

. 
. ** Show results across clusters
. preserve

. 
. ** Keep required variables
. keep if sample_urban95 == 1 & year == 2020 & covid_merge == 3
(21,048 observations deleted)

. keep kmean cases_cum* deaths_cum* population

. collapse (mean) cases_cum* deaths_cum* [fw = population], by(kmean)

. reshape long cases_cum deaths_cum, i(kmean) j(time)
(j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations                5   ->   145         
Number of variables                  59   ->   4           
j variable (29 values)                    ->   time
xij variables:
  cases_cum1 cases_cum2 ... cases_cum29   ->   cases_cum
deaths_cum1 deaths_cum2 ... deaths_cum29  ->   deaths_cum
-----------------------------------------------------------------------------

. xtset kmean time

Panel variable: kmean (strongly balanced)
 Time variable: time, 1 to 29
         Delta: 1 unit

. xtline cases_cum

. graph export "${results}sdid/fig_kmeans.jpg", as(jpg) name("Graph") quality(100) replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/fig_kmeans.jpg written in J
> PEG format

. clear

. 
. ** Restore
. restore

. 
. ** Define covariates
. local covariates "population per_capita_income"

. 
. ** Standardize covariates
. foreach v of local covariates {
  2.         egen tmp_v = std(`v')
  3.         replace `v' = tmp_v
  4.         drop tmp_v
  5. } // END COVAR LOOP
(21,178 real changes made)
(21,178 real changes made)

. 
. ** Define outcome variables (IRS)
. foreach x in "n1" "n2" "agi" {
  2. 
.         if "`x'" == "n1" local xtxt "returns"
  3.         else if "`x'" == "n2" local xtxt "exemptions"
  4.         else if "`x'" == "agi" local xtxt "AGI"
  5. 
.         ** Loop over migration type
.         foreach y in "net" "in" "out" {
  6. 
.                         if "`y'" == "net" local ytxt "Net domestic migration"
  7.                         else if "`y'" == "in" local ytxt "Domestic in-migration"
  8.                         else if "`y'" == "out" local ytxt "Domestic out-migration"
  9. 
.                         ** Generate
.                         gen `x'_`y'_rate_irs = 100 * (`x'_`y'_3 / (`x'_out_1 + `x'_out_2))
 10. 
.                         ** Label var
.                         label var `x'_`y'_rate_irs      "`ytxt' rate, `xtxt' (%)"
 11. 
.         } // END MIGRATION TYPE LOOP
 12. 
. } // END OUTCOME TYPE LOOP
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)

. 
. ** Define outcome variables (ACS)
. 
. ** Rename for loop
. rename acs*_households_* acs*_n1_*

. rename acs*_persons_* acs*_n2_*

. rename acs*_dollars_* acs*_agi_*

. 
. ** Loop over sample
. ** (18+ = 1, college degree == 2, no college degree == 3)
. forvalues i = 1/2{
  2. 
.         if `i' == 1 local itxt ""
  3.         else if `i' == 2 local itxt " (College)"
  4.         else if `i' == 3 local itxt " (No College)"
  5. 
. 
.         ** Define outcome variables (IRS)
.         foreach x in "n1" "n2" "agi" {
  6. 
.                 if "`x'" == "n1" local xtxt "HHs"
  7.                 else if "`x'" == "n2" local xtxt "persons"
  8.                 else if "`x'" == "agi" local xtxt "total income"
  9. 
. 
.                 ** Loop over migration type
.                 foreach y in "net" "in" "out" {
 10. 
.                                 if "`y'" == "net" local ytxt "Net domestic migration"
 11.                                 else if "`y'" == "in" local ytxt "Domestic in-migration"
 12.                                 else if "`y'" == "out" local ytxt "Domestic out-migration"
 13. 
.                                 ** Generate
.                                 gen `x'_`y'_rate_acs`i' = 100 * (acs`i'_`x'_`y'_3 / (acs`i'_`x'_
> out_1 + acs`i'_`x'_out_2))
 14. 
.                                 ** Label var
.                                 label var `x'_`y'_rate_acs`i' "`ytxt' rate, `xtxt'`itxt' (%)"
 15. 
.                 } // END MIGRATION TYPE LOOP
 16. 
.         } // END OUTCOME TYPE LOOP
 17. 
. } // END SAMPLE LOOP
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)

. 
. ** Declare panel
. xtset fips year

Panel variable: fips (unbalanced)
 Time variable: year, 2016 to 2024
         Delta: 1 unit

. 
. ** Tag unique fips
. egen unique = tag(fips)

. tab year unique

  Tax year |
     (year |
    before |       tag(fips)
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |         0      2,916 |     2,916 
      2017 |     2,916          0 |     2,916 
      2018 |     2,916          0 |     2,916 
      2019 |     2,916          0 |     2,916 
      2020 |     2,916          0 |     2,916 
      2021 |     2,916          0 |     2,916 
      2022 |     2,916          0 |     2,916 
      2023 |       383          0 |       383 
      2024 |       383          0 |       383 
-----------+----------------------+----------
     Total |    18,262      2,916 |    21,178 

. 
. ** Label var
. label var year "Year (destination)"

. 
. /*******************************************************************************
> SECTION 3: CREATE TABLE-LEVEL SPECIFICATION GRID
> Each row represents one table = 6 SDID specs (3 outcomes  2 covariate settings)
> *******************************************************************************/
. 
. ** Save main analysis data
. save "${data}working/sdid_analysis_data.dta", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/sdid_analysis_data.dta
    saved

. 
. ** Create table-level specification grid
. preserve

. clear

. 
. ** Table units are defined by:
. ** - data_var (irs_sample_1, irs_sample_2, acs_period_1, acs_period_2)
. ** - out_type (irs, acs1, acs2) - but tied to data_var
. ** - samp_var (sample_all, sample_urban95, sample_urban95_covid)
. ** - exclusion (0, 1)
. ** - migr_type (net, in, out)
. ** Total: 6 data-type combos  3 samples  2 exclusions  3 migrations = 108 tables
. 
. local table_id = 0

. 
. ** Initialize empty dataset
. set obs 0
Number of observations (_N) was 0, now 0.

. gen table_id = .

. gen data_var = ""

. gen out_type = ""

. gen out_txt = ""

. gen samp_var = ""

. gen exclusion = .

. gen migr_type = ""

. 
. save "${data}working/table_grid.dta", replace
(dataset contains 0 observations)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved

. 
. ** Build table grid
. foreach data in "irs_sample_1" "irs_sample_2" "acs_period_1" "acs_period_2" {
  2. 
.         ** Different sets of outcome variable types
.         if "`data'" == "irs_sample_1" | "`data'" == "irs_sample_2" {
  3.                 local out_types "irs"
  4.         }
  5.         else {
  6.                 local out_types "acs1 acs2"
  7.         }
  8. 
.         foreach type of local out_types {
  9. 
.                 ** Labels
.                 if "`data'" == "irs_sample_1" local out_txt "irs_full_16_22"
 10.                 else if "`data'" == "irs_sample_2" local out_txt "irs_389_16_22"
 11.                 else if "`data'" == "acs_period_1" & "`type'" == "acs1" local out_txt "acs_16
> _22_all"
 12.                 else if "`data'" == "acs_period_1" & "`type'" == "acs2" local out_txt "acs_16
> _22_col"
 13.                 else if "`data'" == "acs_period_2" & "`type'" == "acs1" local out_txt "acs_16
> _24_all"
 14.                 else if "`data'" == "acs_period_2" & "`type'" == "acs2" local out_txt "acs_16
> _24_col"
 15. 
.                 foreach samp in "sample_all" "sample_urban95" "sample_urban95_covid" {
 16.                         forvalues exl = 0/1 {
 17.                                 foreach migr in "net" "in" "out" {
 18. 
.                                         local table_id = `table_id' + 1
 19. 
.                                         ** Add row to grid
.                                         clear
 20.                                         set obs 1
 21.                                         gen table_id = `table_id'
 22.                                         gen data_var = "`data'"
 23.                                         gen out_type = "`type'"
 24.                                         gen out_txt = "`out_txt'"
 25.                                         gen samp_var = "`samp'"
 26.                                         gen exclusion = `exl'
 27.                                         gen migr_type = "`migr'"
 28. 
.                                         append using "${data}working/table_grid.dta"
 29.                                         save "${data}working/table_grid.dta", replace
 30. 
.                                 }
 31.                         }
 32.                 }
 33.         }
 34. }
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str10, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable samp_var was str14, now str20 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
(variable migr_type was str2, now str3 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved
Number of observations (_N) was 0, now 1.
(variable out_txt was str13, now str14 to accommodate using data's values)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved

. 
. ** Load and verify grid
. use "${data}working/table_grid.dta", clear

. dis "Total table units: " _N
Total table units: 108

. sort table_id

. save "${data}working/table_grid.dta", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_grid.dta saved

. 
. restore

. 
. /*******************************************************************************
> SECTION 4: DEFINE PARALLEL PROGRAM FOR TABLE-LEVEL SDID ESTIMATION
> Each call runs 6 SDID specs and generates one table
> *******************************************************************************/
. 
. ** Define program to run all SDID specifications for one table
. capture program drop run_sdid_table

. program define run_sdid_table
  1.         syntax, table_id(integer) data_path(string) results_path(string) reps(integer)
  2. 
.         ** Load table specification from grid
.         preserve
  3.         use "`data_path'working/table_grid.dta", clear
  4.         keep if table_id == `table_id'
  5. 
.         ** Extract specification parameters
.         local data_var = data_var[1]
  6.         local out_type = out_type[1]
  7.         local out_txt = out_txt[1]
  8.         local samp_var = samp_var[1]
  9.         local exl = exclusion[1]
 10.         local migr = migr_type[1]
 11. 
.         restore
 12. 
.         ** Load main analysis data
.         use "`data_path'working/sdid_analysis_data.dta", clear
 13. 
.         ** Define sample
.         gen sample = `samp_var' == 1 & `data_var' == 1
 14.         if `exl' == 1 replace sample = 0 if year == 2020
 15. 
.         ** Skip if no treated unit in sample
.         qui count if multnomah == 1 & sample == 1
 16.         if r(N) == 0 {
 17.                 dis "Skipping table `table_id': no treated unit in sample"
 18.                 exit
 19.         }
 20. 
.         ** Create output directory
.         capture mkdir "`results_path'sdid/`out_txt'"
 21. 
.         ** Define covariates
.         if "`data_var'" == "irs_sample_1" local covariates "population per_capita_income"
 22.         else local covariates "population per_capita_income prop_tax_rate"
 23. 
.         ** Clear stored estimates
.         eststo clear
 24. 
.         ** Loop over outcomes (n1, n2, agi) and covariate settings (0, 1)
.         foreach outvar in "n1" "n2" "agi" {
 25. 
.                 ** Full outcome variable name
.                 local outcome "`outvar'_`migr'_rate_`out_type'"
 26. 
.                 ** Store label
.                 local label : variable label `outcome'
 27. 
.                 ** Loop over covariate settings
.                 forvalues c = 0/1 {
 28. 
.                         ** Covariates for sdid (supports 'projected' option)
.                         if `c' == 0 local covars ""
 29.                         else if `c' == 1 local covars "covariates(`covariates', projected)"
 30. 
.                         ** Covariates for sdid_event (doesn't support 'projected' option)
.                         if `c' == 0 local covars_event ""
 31.                         else if `c' == 1 local covars_event "covariates(`covariates')"
 32. 
.                         ** File paths for figures
.                         if `exl' == 0 local path "`results_path'sdid/`out_txt'/fig_`out_txt'_`ou
> tcome'_`c'_`samp_var'_"
 33.                         if `exl' == 1 local path "`results_path'sdid/`out_txt'/fig_`out_txt'_
> `outcome'_`c'_`samp_var'_excl2020_"
 34. 
.                         ** Run SDID
.                         capture noisily {
 35.                                 eststo sdid_`outvar'_`c': sdid `outcome' fips year Treated   
>    ///
>                                         if sample == 1,                         ///
>                                         vce(placebo)                            ///
>                                         `covars'                                        ///
>                                         reps(`reps')                            ///
>                                         graph graph_export("`path'", .pdf)
 36.                         }
 37. 
.                         ** Store results
.                         local tmp_tau = e(ATT)
 38.                         local tmp_se = e(se)
 39.                         matrix omega = e(omega)
 40. 
.                         ** Pre-treatment mean and county count
.                         qui summ `outcome' if multnomah == 1 & Treated == 0
 41.                         local tmp_premean = r(mean)
 42.                         estadd scalar mean = r(mean)
 43. 
.                         qui summ `outcome' if year == 2021 & sample == 1
 44.                         local tmp_ncounties = r(N)
 45.                         estadd scalar count = r(N)
 46. 
.                         ** Save treatment effect results
.                         preserve
 47.                         clear
 48.                         set obs 1
 49.                         gen table_id = `table_id'
 50.                         gen sample_data = "`out_txt'"
 51.                         gen sample = "`samp_var'"
 52.                         gen outcome = "`outcome'"
 53.                         gen controls = `c'
 54.                         gen exclusion = `exl'
 55.                         gen tau = `tmp_tau'
 56.                         gen se = `tmp_se'
 57.                         gen pval = 2 * (1 - normal(abs(tau/se)))
 58.                         gen ci_lower = tau - 1.96 * se
 59.                         gen ci_upper = tau + 1.96 * se
 60.                         gen n_counties = `tmp_ncounties'
 61.                         gen pre_mean = `tmp_premean'
 62.                         save "`results_path'sdid/temp_results/results_`table_id'_`outvar'_`c'
> .dta", replace
 63.                         restore
 64. 
.                         ** Save weights
.                         preserve
 65.                         clear
 66.                         svmat double omega, names(col)
 67.                         rename c2 fips
 68.                         rename c1 weight
 69.                         gen table_id = `table_id'
 70.                         gen sample_data = "`out_txt'"
 71.                         gen out = "`outcome'"
 72.                         gen sample = "`samp_var'"
 73.                         gen controls = `c'
 74.                         gen exclusion = `exl'
 75.                         drop if weight == 0
 76.                         drop if missing(fips)
 77.                         save "`results_path'sdid/temp_weights/weights_`table_id'_`outvar'_`c'
> .dta", replace
 78.                         restore
 79. 
. 
.                         ** Run event study
.                         capture noisily {
 80.                                 sdid_event `outcome' fips year Treated  ///
>                                         if sample == 1,                                         
> ///
>                                         `covars_event'                                          
> ///
>                                         vce(placebo)                                            
> ///
>                                         brep(`reps')                                            
> ///
>                                         placebo(all)
 81.                         }
 82. 
.                         local event_rc = _rc
 83. 
.                         if `event_rc' == 0 {
 84. 
.                                 ** Store max year
.                                 qui summ year if multnomah == 1 & sample == 1
 85.                                 local max_yr = r(max)
 86. 
.                                 ** Move results from matrix to data
.                                 qui count if multnomah == 1 & sample == 1
 87.                                 local ct = r(N)
 88.                                 local ct = `ct' + 1
 89. 
.                                 ** Extract matrix
.                                 capture mat res = e(H)[2..`ct',1..5]
 90.                                 if _rc != 0 {
 91.                                         continue
 92.                                 }
 93. 
.                                 ** Preserve data before plotting (expand creates duplicate obs)
.                                 preserve
 94. 
.                                 ** Move to data
.                                 svmat res
 95. 
.                                 ** Generate ID variable
.                                 gen id = `max_yr' - _n + 1 if !missing(res1)
 96. 
.                                 ** Handle exclusion year labeling
.                                 if `exl' == 1 {
 97.                                         replace id = id - 1 if id <= 2020
 98.                                         expand 2 if id == 2019, gen(tag)
 99.                                         replace id = 2020 if tag == 1
100.                                         replace res1 = . if tag == 1
101.                                         replace res3 = . if tag == 1
102.                                         replace res4 = . if tag == 1
103.                                 }
104.                                 label var id "Year (destination)"
105. 
.                                 ** Sort
.                                 sort id
106. 
.                                 ** Plot
.                                 twoway  (rcap res3 res4 id, lc(gs10) fc(gs11%50))       ///
>                                                 (scatter res1 id, mc(black)),                   
>         ///
>                                         legend(off) ytitle("`label'")                           
>         ///
>                                         yline(0, lc(red) lp(-))                                 
>                 ///
>                                         xline(2020.5, lc(black) lp(solid))                      
>         ///
>                                         ylabel(-10(2.5)10, format(%9.1f))
107. 
.                                 if `exl' == 1 local evpath "`results_path'sdid/`out_txt'/fig_`ou
> t_txt'_`outcome'_`c'_`samp_var'_excl2020_eventstudy.jpg"
108.                                 else local evpath "`results_path'sdid/`out_txt'/fig_`out_txt'
> _`outcome'_`c'_`samp_var'_eventstudy.jpg"
109. 
.                                 graph export "`evpath'", as(jpg) name("Graph") quality(100) repl
> ace
110. 
.                                 ** Restore data (removes expanded rows and temp variables)
.                                 restore
111. 
.                         }
112.         
.                         ** Clean up sdid_event internal variables (prevents "already defined" er
> ror on next iteration)
.                         capture drop ever_treated*
113. 
.                 } // END COVAR LOOP
114. 
.         } // END OUTCOME LOOP
115. 
.         ** Generate table for this migration type (all 6 specs)
.         ** Determine table path
.         if `exl' == 0 local tabpath "`results_path'sdid/`out_txt'/tab_sdid_`out_txt'_`migr'_`sam
> p_var'.tex"
116.         if `exl' == 1 local tabpath "`results_path'sdid/`out_txt'/tab_sdid_`out_txt'_`migr'_`
> samp_var'_excl2020.tex"
117. 
.         ** Check if we have all estimates
.         capture confirm matrix e(b)
118. 
.         ** Generate table based on data type
.         if "`data_var'" == "irs_sample_1" | "`data_var'" == "irs_sample_2" {
119.                 capture noisily {
120.                         esttab  sdid_n1_0 sdid_n1_1     ///
>                                         sdid_n2_0 sdid_n2_1     ///
>                                         sdid_agi_0 sdid_agi_1 ///
>                                 using "`tabpath'",                                              
>                 ///
>                                 starlevel("*" 0.10 "**" 0.05 "***" 0.01)                ///
>                                 b(%-9.3f) se(%-9.3f) replace                                    
> ///
>                                 mgroups("Returns" "Exemptions" "AGI",                   ///
>                                         pattern(1 0 1 0 1 0) )                                  
>         ///
>                                 mtitle( "No Covariates" "Covariates"                    ///
>                                                 "No Covariates" "Covariates"                    
> ///
>                                                 "No Covariates" "Covariates")                   
> ///
>                                 stats(count mean,                                               
>                 ///
>                                         fmt(%9.0fc %9.3fc)                                      
>                 ///
>                                         labels("Number of Counties" "Pre-treatment mean"))
121.                 }
122.         }
123.         else {
124.                 capture noisily {
125.                         esttab  sdid_n1_0 sdid_n1_1     ///
>                                         sdid_n2_0 sdid_n2_1     ///
>                                         sdid_agi_0 sdid_agi_1 ///
>                                 using "`tabpath'",                                              
>                 ///
>                                 starlevel("*" 0.10 "**" 0.05 "***" 0.01)                ///
>                                 b(%-9.3f) se(%-9.3f) replace                                    
> ///
>                                 mgroups("Households" "Adults" "Household Income",       ///
>                                         pattern(1 0 1 0 1 0) )                                  
>         ///
>                                 mtitle( "No Covariates" "Covariates"                    ///
>                                                 "No Covariates" "Covariates"                    
> ///
>                                                 "No Covariates" "Covariates")                   
> ///
>                                 stats(count mean,                                               
>                 ///
>                                         fmt(%9.0fc %9.3fc)                                      
>                 ///
>                                         labels("Number of Counties" "Pre-treatment mean"))
126.                 }
127.         }
128. 
.         dis "Completed table `table_id': `out_txt' / `migr' / `samp_var' / excl=`exl'"
129. 
. end

. 
. /*******************************************************************************
> SECTION 5: CREATE TEMPORARY DIRECTORIES AND RUN PARALLEL ESTIMATION
> *******************************************************************************/
. 
. ** Create temp directories for results
. capture mkdir "${results}sdid/temp_results"

. capture mkdir "${results}sdid/temp_weights"

. 
. ** Create subfolders for each output type
. foreach out_txt in "irs_full_16_22" "irs_389_16_22" "acs_16_22_all" "acs_16_22_col" "acs_16_24_a
> ll" "acs_16_24_col" {
  2.         capture mkdir "${results}sdid/`out_txt'"
  3. }

. 
. ** Load table grid
. use "${data}working/table_grid.dta", clear

. local n_tables = _N

. dis "Running `n_tables' table units in parallel (each with 6 SDID specs)..."
Running 108 table units in parallel (each with 6 SDID specs)...

. 
. ** Save table IDs for parallel processing
. ** IMPORTANT: Shuffle table order to balance workload across workers
. ** Without shuffling, child 1 gets all sample_all specs (heaviest computation)
. preserve

. keep table_id

. 
. ** Generate random sort order and shuffle
. gen rand_order = runiform()

. sort rand_order

. drop rand_order

. 
. save "${data}working/table_ids.dta", replace
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/data/working/table_ids.dta saved

. restore

. 
. ** Define wrapper program for parallel execution
. capture program drop parallel_sdid_wrapper

. program define parallel_sdid_wrapper
  1.         ** Store all table_ids upfront (run_sdid_table will overwrite the dataset)
.         local n_obs = _N
  2.         forvalues i = 1/`n_obs' {
  3.                 local tid_`i' = table_id[`i']
  4.         }
  5. 
.         ** Now loop through and process each table
.         forvalues i = 1/`n_obs' {
  6.                 dis "Worker processing table `tid_`i'' (`i' of `n_obs' in this chunk)"
  7.                 run_sdid_table, table_id(`tid_`i'') data_path("${data}") results_path("${resu
> lts}") reps(100)
  8.         }
  9. end

. 
. ** Load table IDs and run in parallel
. use "${data}working/table_ids.dta", clear

. 
. ** Run parallel estimation
. dis "Starting parallel SDID estimation at $S_TIME..."
Starting parallel SDID estimation at 22:06:04...

. dis "Each parallel worker processes one table (6 SDID specifications)"
Each parallel worker processes one table (6 SDID specifications)

. timer clear 1

. timer on 1

. 
. parallel, prog(parallel_sdid_wrapper run_sdid_table): parallel_sdid_wrapper
--------------------------------------------------------------------------------
Exporting the following program(s): parallel_sdid_wrapper run_sdid_table

parallel_sdid_wrapper:
  1.         local n_obs = _N
  2.         forvalues i = 1/`n_obs' {
  3.                 local tid_`i' = table_id[`i']
  4.         }
  5.         forvalues i = 1/`n_obs' {
  6.                 dis "Worker processing table `tid_`i'' (`i' of `n_obs' in this chunk)"
  7.                 run_sdid_table, table_id(`tid_`i'') data_path("${data}") results_path("${resu
> lts}") reps(100)
  8.         }

run_sdid_table:
  1.         syntax, table_id(integer) data_path(string) results_path(string) reps(integer)
  2.         preserve
  3.         use "`data_path'working/table_grid.dta", clear
  4.         keep if table_id == `table_id'
  5.         local data_var = data_var[1]
  6.         local out_type = out_type[1]
  7.         local out_txt = out_txt[1]
  8.         local samp_var = samp_var[1]
  9.         local exl = exclusion[1]
 10.         local migr = migr_type[1]
 11.         restore
 12.         use "`data_path'working/sdid_analysis_data.dta", clear
 13.         gen sample = `samp_var' == 1 & `data_var' == 1
 14.         if `exl' == 1 replace sample = 0 if year == 2020
 15.         qui count if multnomah == 1 & sample == 1
 16.         if r(N) == 0 {
 17.                 dis "Skipping table `table_id': no treated unit in sample"
 18.                 exit
 19.         }
 20.         capture mkdir "`results_path'sdid/`out_txt'"
 21.         if "`data_var'" == "irs_sample_1" local covariates "population per_capita_income"
 22.         else local covariates "population per_capita_income prop_tax_rate"
 23.         eststo clear
 24.         foreach outvar in "n1" "n2" "agi" {
 25.                 local outcome "`outvar'_`migr'_rate_`out_type'"
 26.                 local label : variable label `outcome'
 27.                 forvalues c = 0/1 {
 28.                         if `c' == 0 local covars ""
 29.                         else if `c' == 1 local covars "covariates(`covariates', projected)"
 30.                         if `c' == 0 local covars_event ""
 31.                         else if `c' == 1 local covars_event "covariates(`covariates')"
 32.                         if `exl' == 0 local path "`results_path'sdid/`out_txt'/fig_`out_txt'_
> `outcome'_`c'_`samp_var'_"
 33.                         if `exl' == 1 local path "`results_path'sdid/`out_txt'/fig_`out_txt'_
> `outcome'_`c'_`samp_var'_excl2020_"
 34.                         capture noisily {
 35.                                 eststo sdid_`outvar'_`c': sdid `outcome' fips year Treated if
>  sample == 1, vce(placebo) `covars' reps(`reps') graph graph_export("`path'", .pdf)
 36.                         }
 37.                         local tmp_tau = e(ATT)
 38.                         local tmp_se = e(se)
 39.                         matrix omega = e(omega)
 40.                         qui summ `outcome' if multnomah == 1 & Treated == 0
 41.                         local tmp_premean = r(mean)
 42.                         estadd scalar mean = r(mean)
 43.                         qui summ `outcome' if year == 2021 & sample == 1
 44.                         local tmp_ncounties = r(N)
 45.                         estadd scalar count = r(N)
 46.                         preserve
 47.                         clear
 48.                         set obs 1
 49.                         gen table_id = `table_id'
 50.                         gen sample_data = "`out_txt'"
 51.                         gen sample = "`samp_var'"
 52.                         gen outcome = "`outcome'"
 53.                         gen controls = `c'
 54.                         gen exclusion = `exl'
 55.                         gen tau = `tmp_tau'
 56.                         gen se = `tmp_se'
 57.                         gen pval = 2 * (1 - normal(abs(tau/se)))
 58.                         gen ci_lower = tau - 1.96 * se
 59.                         gen ci_upper = tau + 1.96 * se
 60.                         gen n_counties = `tmp_ncounties'
 61.                         gen pre_mean = `tmp_premean'
 62.                         save "`results_path'sdid/temp_results/results_`table_id'_`outvar'_`c'
> .dta", replace
 63.                         restore
 64.                         preserve
 65.                         clear
 66.                         svmat double omega, names(col)
 67.                         rename c2 fips
 68.                         rename c1 weight
 69.                         gen table_id = `table_id'
 70.                         gen sample_data = "`out_txt'"
 71.                         gen out = "`outcome'"
 72.                         gen sample = "`samp_var'"
 73.                         gen controls = `c'
 74.                         gen exclusion = `exl'
 75.                         drop if weight == 0
 76.                         drop if missing(fips)
 77.                         save "`results_path'sdid/temp_weights/weights_`table_id'_`outvar'_`c'
> .dta", replace
 78.                         restore
 79.                         capture noisily {
 80.                                 sdid_event `outcome' fips year Treated if sample == 1, `covar
> s_event' vce(placebo) brep(`reps') placebo(all)
 81.                         }
 82.                         local event_rc = _rc
 83.                         if `event_rc' == 0 {
 84.                                 qui summ year if multnomah == 1 & sample == 1
 85.                                 local max_yr = r(max)
 86.                                 qui count if multnomah == 1 & sample == 1
 87.                                 local ct = r(N)
 88.                                 local ct = `ct' + 1
 89.                                 capture mat res = e(H)[2..`ct',1..5]
 90.                                 if _rc != 0 {
 91.                                         continue
 92.                                 }
 93.                                 preserve
 94.                                 svmat res
 95.                                 gen id = `max_yr' - _n + 1 if !missing(res1)
 96.                                 if `exl' == 1 {
 97.                                         replace id = id - 1 if id <= 2020
 98.                                         expand 2 if id == 2019, gen(tag)
 99.                                         replace id = 2020 if tag == 1
100.                                         replace res1 = . if tag == 1
101.                                         replace res3 = . if tag == 1
102.                                         replace res4 = . if tag == 1
103.                                 }
104.                                 label var id "Year (destination)"
105.                                 sort id
106.                                 twoway (rcap res3 res4 id, lc(gs10) fc(gs11%50)) (scatter res
> 1 id, mc(black)), legend(off) ytitle("`label'") yline(0, lc(red) lp(-)) xline(2020.5, lc(black) 
> lp(solid)) ylabel(-10(2.5)10, format(%9.1f))
107.                                 if `exl' == 1 local evpath "`results_path'sdid/`out_txt'/fig_
> `out_txt'_`outcome'_`c'_`samp_var'_excl2020_eventstudy.jpg"
108.                                 else local evpath "`results_path'sdid/`out_txt'/fig_`out_txt'
> _`outcome'_`c'_`samp_var'_eventstudy.jpg"
109.                                 graph export "`evpath'", as(jpg) name("Graph") quality(100) r
> eplace
110.                                 restore
111.                         }
112.                         capture drop ever_treated*
113.                 }
114.         }
115.         if `exl' == 0 local tabpath "`results_path'sdid/`out_txt'/tab_sdid_`out_txt'_`migr'_`
> samp_var'.tex"
116.         if `exl' == 1 local tabpath "`results_path'sdid/`out_txt'/tab_sdid_`out_txt'_`migr'_`
> samp_var'_excl2020.tex"
117.         capture confirm matrix e(b)
118.         if "`data_var'" == "irs_sample_1" | "`data_var'" == "irs_sample_2" {
119.                 capture noisily {
120.                         esttab sdid_n1_0 sdid_n1_1 sdid_n2_0 sdid_n2_1 sdid_agi_0 sdid_agi_1 
> using "`tabpath'", starlevel("*" 0.10 "**" 0.05 "***" 0.01) b(%-9.3f) se(%-9.3f) replace mgroups
> ("Returns" "Exemptions" "AGI", pattern(1 0 1 0 1 0) ) mtitle( "No Covariates" "Covariates" "No C
> ovariates" "Covariates" "No Covariates" "Covariates") stats(count mean, fmt(%9.0fc %9.3fc) label
> s("Number of Counties" "Pre-treatment mean"))
121.                 }
122.         }
123.         else {
124.                 capture noisily {
125.                         esttab sdid_n1_0 sdid_n1_1 sdid_n2_0 sdid_n2_1 sdid_agi_0 sdid_agi_1 
> using "`tabpath'", starlevel("*" 0.10 "**" 0.05 "***" 0.01) b(%-9.3f) se(%-9.3f) replace mgroups
> ("Households" "Adults" "Household Income", pattern(1 0 1 0 1 0) ) mtitle( "No Covariates" "Covar
> iates" "No Covariates" "Covariates" "No Covariates" "Covariates") stats(count mean, fmt(%9.0fc %
> 9.3fc) labels("Number of Counties" "Pre-treatment mean"))
126.                 }
127.         }
128.         dis "Completed table `table_id': `out_txt' / `migr' / `samp_var' / excl=`exl'"
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
Parallel Computing with Stata
Child processes: 6
pll_id         : ffp8vcw6l9
Running at     : C:\Users\ji252\Documents\GitHub\multnomah-county-tax
Randtype       : datetime
Waiting for the child processes to finish...
child process 0005 has exited without er
> ror...
child process 0001 has exited without er
> ror...
child process 0004 has exited without er
> ror...
The user pressed -break-. Trying to stop the child processes...
                 stata():  3598  Stata returned error
       parallel_finito():     -  function returned error
          parallel_run():     -  function returned error
                 <istmt>:     -  function returned error
r(3598);

end of do-file
r(3598);

end of do-file

r(3598);

. 
. do "C:\Users\ji252\AppData\Local\Temp\STD72bc_00000l.tmp"

. ** Synthetic Difference-in-Difference Analysis
. do ${code}02_sdid_analysis.do 

. /*******************************************************************************
> File Name:              02_sdid_analysis.do
> Creator:                John Iselin
> Date Update:    January 13, 2025
> 
> Called by: 00_multnomah.do
> 
> Purpose: Perform synthetic difference-in-difference estimation.
> 
> Outputs:
> - sdid_weights.dta/xlsx: Synthetic control weights for each specification
> - sdid_results.dta/xlsx: Treatment effects, SEs, p-values for each specification
> - fig_speccurve_*.pdf/jpg: Specification curve plots
> 
> TODO:
> 1) Recreate IRS sample with solely counties in ACS sample.
> 
> Authors: John Iselin
> 
> For more information, contact john.iselin@yale.edu
> 
> *******************************************************************************/
. 
. 
. ** Start log file 
. capture log close log_02

. log using "${logs}02_log_sdid_${date}", replace text name(log_02)
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_sdid_2026-01-14.log
    not found)
--------------------------------------------------------------------------------------------------
      name:  log_02
       log:  C:/Users/ji252/Documents/GitHub/multnomah-county-tax/code/logs/02_log_sdid_2026-01-14
> .log
  log type:  text
 opened on:  15 Jan 2026, 12:37:22

. 
. ** Parameters 
. local reps = 100

. 
. ** Load data 
. use "${data}working/irs_county_gross", replace 

. 
. ** Keep required variables 
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3

. order year fips state* county* 

. 
. ** Merge with ACS Data 
. merge 1:1 year fips using "${data}working/acs_county_gross_18plus", gen(merge_acs_1)
(variable fips was float, now double to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        20,771
        from master                    18,963  (merge_acs_1==1)
        from using                      1,808  (merge_acs_1==2)

    Matched                             3,017  (merge_acs_1==3)
    -----------------------------------------

. 
. ** Keep require variables 
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3 merge_acs_*

. 
. ** Label acs samples 
. rename persons_* acs1_persons_* 

. rename households_* acs1_households_*

. rename dollars_* acs1_dollars_*

. 
. ** Merge with ACS Data 
. merge 1:1 year fips using "${data}working/acs_county_gross_college", gen(merge_acs_2)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,963
        from master                    18,963  (merge_acs_2==1)
        from using                          0  (merge_acs_2==2)

    Matched                             4,825  (merge_acs_2==3)
    -----------------------------------------

. 
. ** Keep require variables 
. keep year fips state* county* *_net_3 *_out_1 *_out_2 *_in_3 *_out_3  merge_acs_*

. 
. ** Label acs samples 
. rename persons_* acs2_persons_*

. rename households_* acs2_households_*

. rename dollars_* acs2_dollars_*

. 
. ** Drop "other counties"
. drop if county_fips == 0
(483 observations deleted)

. drop if year == 2015 
(430 observations deleted)

. 
. ** Merge with Demographic data 
. merge m:1 fips using "${data}working/demographics_2020",        ///
>         gen(demo_merge) keep(master match)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            27
        from master                        27  (demo_merge==1)
        from using                          0  (demo_merge==2)

    Matched                            22,848  (demo_merge==3)
    -----------------------------------------

.         
. ** Show match 
. tab state_name demo_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
                     |        21          0 |        21 
             Alabama |         0        479 |       479 
              Alaska |         6        198 |       204 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         0         34 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |         0        951 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |        27     22,848 |    22,875 

. tab year demo_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         0      3,140 |     3,140 
      2017 |         0      3,140 |     3,140 
      2018 |         0      3,140 |     3,140 
      2019 |         0      3,140 |     3,140 
      2020 |         2      3,140 |     3,142 
      2021 |         2      3,141 |     3,143 
      2022 |         9      3,133 |     3,142 
      2023 |         7        437 |       444 
      2024 |         7        437 |       444 
-----------+----------------------+----------
     Total |        27     22,848 |    22,875 

. 
. ** Keep if matched 
. keep if demo_merge == 3
(27 observations deleted)

. drop demo_merge

. 
. ** Rename 
. rename population pop_census

.         
. ** Merge with Demographic data 
. merge m:1 year fips using "${data}working/bea_economics",       ///
>         gen(econ_merge) keep(master match) 

    Result                      Number of obs
    -----------------------------------------
    Not matched                           366
        from master                       366  (econ_merge==1)
        from using                          0  (econ_merge==2)

    Matched                            22,482  (econ_merge==3)
    -----------------------------------------

.         
. ** Show match 
. tab state_name econ_merge, m

                     | Matching result from
                     |         merge
          State name | Master on  Matched ( |     Total
---------------------+----------------------+----------
             Alabama |         0        479 |       479 
              Alaska |         0        198 |       198 
             Arizona |         0        113 |       113 
            Arkansas |         0        531 |       531 
          California |         0        474 |       474 
            Colorado |         0        452 |       452 
         Connecticut |         0         48 |        48 
            Delaware |         0         27 |        27 
District of Columbia |         0          9 |         9 
             Florida |         0        535 |       535 
             Georgia |         0      1,157 |     1,157 
              Hawaii |         9         25 |        34 
               Idaho |         0        310 |       310 
            Illinois |         0        740 |       740 
             Indiana |         0        676 |       676 
                Iowa |         0        703 |       703 
              Kansas |         0        741 |       741 
            Kentucky |         0        854 |       854 
           Louisiana |         0        462 |       462 
               Maine |         0        116 |       116 
            Maryland |         0        190 |       190 
       Massachusetts |         0        116 |       116 
            Michigan |         0        613 |       613 
           Minnesota |         0        625 |       625 
         Mississippi |         0        580 |       580 
            Missouri |         0        819 |       819 
             Montana |         0        394 |       394 
            Nebraska |         0        657 |       657 
              Nevada |         0        123 |       123 
       New Hampshire |         0         70 |        70 
          New Jersey |         0        181 |       181 
          New Mexico |         0        235 |       235 
            New York |         0        476 |       476 
      North Carolina |         0        736 |       736 
        North Dakota |         0        373 |       373 
                Ohio |         0        658 |       658 
            Oklahoma |         0        547 |       547 
              Oregon |         0        268 |       268 
        Pennsylvania |         0        509 |       509 
        Rhode Island |         0         41 |        41 
      South Carolina |         0        338 |       338 
        South Dakota |         0        462 |       462 
           Tennessee |         0        687 |       687 
               Texas |         0      1,854 |     1,854 
                Utah |         0        213 |       213 
             Vermont |         0        100 |       100 
            Virginia |       357        594 |       951 
          Washington |         0        293 |       293 
       West Virginia |         0        387 |       387 
           Wisconsin |         0        530 |       530 
             Wyoming |         0        163 |       163 
---------------------+----------------------+----------
               Total |       366     22,482 |    22,848 

. tab year econ_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |        52      3,088 |     3,140 
      2017 |        52      3,088 |     3,140 
      2018 |        52      3,088 |     3,140 
      2019 |        52      3,088 |     3,140 
      2020 |        52      3,088 |     3,140 
      2021 |        53      3,088 |     3,141 
      2022 |        53      3,080 |     3,133 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |       366     22,482 |    22,848 

. 
. ** Keep if matched 
. keep if econ_merge == 3
(366 observations deleted)

. drop econ_merge

. 
. ** Merge with COVID-19 Data
. merge m:1 fips using ${data}working/covid_cleaned_wide.dta,     ///
>         gen(covid_merge) keep(master match )
(variable state_name was str20, now str24 to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            73
        from master                        73  (covid_merge==1)
        from using                          0  (covid_merge==2)

    Matched                            22,409  (covid_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name covid_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |         0        479 |       479 
               Alaska |        28        170 |       198 
              Arizona |         0        113 |       113 
             Arkansas |         0        531 |       531 
           California |         0        474 |       474 
             Colorado |         0        452 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |         0        535 |       535 
              Georgia |         0      1,157 |     1,157 
               Hawaii |         0         25 |        25 
                Idaho |         0        310 |       310 
             Illinois |         0        740 |       740 
              Indiana |         0        676 |       676 
                 Iowa |         0        703 |       703 
               Kansas |         0        741 |       741 
             Kentucky |         0        854 |       854 
            Louisiana |         0        462 |       462 
                Maine |         0        116 |       116 
             Maryland |         0        190 |       190 
        Massachusetts |         0        116 |       116 
             Michigan |         0        613 |       613 
            Minnesota |         0        625 |       625 
          Mississippi |         0        580 |       580 
             Missouri |         0        819 |       819 
              Montana |         0        394 |       394 
             Nebraska |         0        657 |       657 
               Nevada |         0        123 |       123 
        New Hampshire |         0         70 |        70 
           New Jersey |         0        181 |       181 
           New Mexico |         0        235 |       235 
             New York |        45        431 |       476 
       North Carolina |         0        736 |       736 
         North Dakota |         0        373 |       373 
                 Ohio |         0        658 |       658 
             Oklahoma |         0        547 |       547 
               Oregon |         0        268 |       268 
         Pennsylvania |         0        509 |       509 
         Rhode Island |         0         41 |        41 
       South Carolina |         0        338 |       338 
         South Dakota |         0        462 |       462 
            Tennessee |         0        687 |       687 
                Texas |         0      1,854 |     1,854 
                 Utah |         0        213 |       213 
              Vermont |         0        100 |       100 
             Virginia |         0        594 |       594 
           Washington |         0        293 |       293 
        West Virginia |         0        387 |       387 
            Wisconsin |         0        530 |       530 
              Wyoming |         0        163 |       163 
----------------------+----------------------+----------
                Total |        73     22,409 |    22,482 

. tab year covid_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |         9      3,079 |     3,088 
      2017 |         9      3,079 |     3,088 
      2018 |         9      3,079 |     3,088 
      2019 |         9      3,079 |     3,088 
      2020 |         9      3,079 |     3,088 
      2021 |         9      3,079 |     3,088 
      2022 |         9      3,071 |     3,080 
      2023 |         5        432 |       437 
      2024 |         5        432 |       437 
-----------+----------------------+----------
     Total |        73     22,409 |    22,482 

. 
. ** Merge with Property Tax Rates (time-varying)
. merge m:1 year fips using "${data}working/property_tax_rates_overall", ///
>         gen(proptx_merge) keep(master match) keepusing(prop_rate_mean prop_rate_se)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        18,591
        from master                    18,591  (proptx_merge==1)
        from using                          0  (proptx_merge==2)

    Matched                             3,891  (proptx_merge==3)
    -----------------------------------------

. 
. ** Show match
. tab state_name proptx_merge, m

                      | Matching result from
                      |         merge
           State name | Master on  Matched ( |     Total
----------------------+----------------------+----------
              Alabama |       422         57 |       479 
               Alaska |       189          9 |       198 
              Arizona |        71         42 |       113 
             Arkansas |       498         33 |       531 
           California |       168        306 |       474 
             Colorado |       440         12 |       452 
          Connecticut |         0         48 |        48 
             Delaware |         0         27 |        27 
 District of Columbia |         0          9 |         9 
              Florida |       268        267 |       535 
              Georgia |       971        186 |     1,157 
               Hawaii |         7         18 |        25 
                Idaho |       301          9 |       310 
             Illinois |       593        147 |       740 
              Indiana |       532        144 |       676 
                 Iowa |       664         39 |       703 
               Kansas |       714         27 |       741 
             Kentucky |       803         51 |       854 
            Louisiana |       393         69 |       462 
                Maine |        92         24 |       116 
             Maryland |        85        105 |       190 
        Massachusetts |        77         39 |       116 
             Michigan |       469        144 |       613 
            Minnesota |       553         72 |       625 
          Mississippi |       553         27 |       580 
             Missouri |       756         63 |       819 
              Montana |       391          3 |       394 
             Nebraska |       630         27 |       657 
               Nevada |       105         18 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        28        153 |       181 
           New Mexico |       211         24 |       235 
             New York |       287        189 |       476 
       North Carolina |       562        174 |       736 
         North Dakota |       364          9 |       373 
                 Ohio |       469        189 |       658 
             Oklahoma |       517         30 |       547 
               Oregon |       196         72 |       268 
         Pennsylvania |       329        180 |       509 
         Rhode Island |        14         27 |        41 
       South Carolina |       290         48 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       600         87 |       687 
                Texas |     1,512        342 |     1,854 
                 Utah |       168         45 |       213 
              Vermont |        97          3 |       100 
             Virginia |       504         90 |       594 
           Washington |       209         84 |       293 
        West Virginia |       384          3 |       387 
            Wisconsin |       413        117 |       530 
              Wyoming |       160          3 |       163 
----------------------+----------------------+----------
                Total |    18,591      3,891 |    22,482 

. tab year proptx_merge, m

  Tax year |
     (year | Matching result from
    before |         merge
     move) | Master on  Matched ( |     Total
-----------+----------------------+----------
      2016 |     2,658        430 |     3,088 
      2017 |     2,658        430 |     3,088 
      2018 |     2,658        430 |     3,088 
      2019 |     2,658        430 |     3,088 
      2020 |     2,658        430 |     3,088 
      2021 |     2,658        430 |     3,088 
      2022 |     2,643        437 |     3,080 
      2023 |         0        437 |       437 
      2024 |         0        437 |       437 
-----------+----------------------+----------
     Total |    18,591      3,891 |    22,482 

. 
. ** Rename for clarity
. rename prop_rate_mean prop_tax_rate

. rename prop_rate_se prop_tax_rate_se

. label var prop_tax_rate "Mean property tax rate (% of home value)"

. label var prop_tax_rate_se "SE of property tax rate"

. 
. ** Organize data 
. order year fips state_* county_* 

. sort fips year  

. isid fips year 

. 
. ** Keep only sample with non-missing base populations
. tab county_name year if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022

                      |  Tax year
                      |   (year
                      |   before
                      |   move)
          County name |      2017 |     Total
----------------------+-----------+----------
        Loving County |         1 |         1 
----------------------+-----------+----------
                Total |         1 |         1 

. drop if (missing(n1_out_1 ) | n1_out_1 == 0 ) & year <= 2022
(1 observation deleted)

. 
. ** Keep only sample with observations in each year 
. bysort fips: gen ct = _N

. tab county_name state_name if ct < 7 

                      |      State name
          County name | Connect..      Texas |     Total
----------------------+----------------------+----------
     Fairfield County |         6          0 |         6 
      Hartford County |         6          0 |         6 
    Litchfield County |         6          0 |         6 
        Loving County |         0          6 |         6 
     Middlesex County |         6          0 |         6 
     New Haven County |         6          0 |         6 
    New London County |         6          0 |         6 
       Tolland County |         6          0 |         6 
       Windham County |         6          0 |         6 
----------------------+----------------------+----------
                Total |        48          6 |        54 

. drop if ct < 7 
(54 observations deleted)

. drop ct 

. 
. ** Generate IRS sample 
. gen irs_sample_1 = inrange(year, 2016, 2022) 

. gen irs_sample_2 = inrange(year, 2016, 2022) & merge_acs_1 != 1 

. 
. ** Generate ACS Period Indicators 
. gen acs_period_1 = merge_acs_1 != 1 & inrange(year, 2016, 2022)

. gen acs_period_2 = merge_acs_1 != 1 

. 
. ** Make sure we have a balanced panel of ACS counties 
. gen tmp = merge_acs_1 != 1 

. bysort fips: egen ct_tmp = total(tmp)

. replace acs_period_1 = 0 if ct_tmp != 9 
(246 real changes made)

. replace acs_period_2 = 0 if ct_tmp != 9 
(342 real changes made)

. replace irs_sample_2 = 0 if ct_tmp != 9
(246 real changes made)

. drop tmp ct_tmp

. 
. tab year irs_sample_1 

  Tax year |
     (year |
    before |     irs_sample_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |         0      3,079 |     3,079 
      2017 |         0      3,079 |     3,079 
      2018 |         0      3,079 |     3,079 
      2019 |         0      3,079 |     3,079 
      2020 |         0      3,079 |     3,079 
      2021 |         0      3,079 |     3,079 
      2022 |         0      3,079 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |       874     21,553 |    22,427 

. tab year irs_sample_2 

  Tax year |
     (year |
    before |     irs_sample_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_1 

  Tax year |
     (year |
    before |     acs_period_1
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |       437          0 |       437 
      2024 |       437          0 |       437 
-----------+----------------------+----------
     Total |    19,704      2,723 |    22,427 

. tab year acs_period_2

  Tax year |
     (year |
    before |     acs_period_2
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |     2,690        389 |     3,079 
      2017 |     2,690        389 |     3,079 
      2018 |     2,690        389 |     3,079 
      2019 |     2,690        389 |     3,079 
      2020 |     2,690        389 |     3,079 
      2021 |     2,690        389 |     3,079 
      2022 |     2,690        389 |     3,079 
      2023 |        48        389 |       437 
      2024 |        48        389 |       437 
-----------+----------------------+----------
     Total |    18,926      3,501 |    22,427 

. tab state_name acs_period_1     

                      |     acs_period_1
           State name |         0          1 |     Total
----------------------+----------------------+----------
              Alabama |       458         21 |       479 
               Alaska |       191          7 |       198 
              Arizona |        92         21 |       113 
             Arkansas |       510         21 |       531 
           California |       236        238 |       474 
             Colorado |       445          7 |       452 
             Delaware |         6         21 |        27 
 District of Columbia |         2          7 |         9 
              Florida |       339        196 |       535 
              Georgia |     1,017        140 |     1,157 
               Hawaii |        11         14 |        25 
                Idaho |       303          7 |       310 
             Illinois |       656         84 |       740 
              Indiana |       564        112 |       676 
                 Iowa |       675         28 |       703 
               Kansas |       720         21 |       741 
             Kentucky |       819         35 |       854 
            Louisiana |       413         49 |       462 
                Maine |       102         14 |       116 
             Maryland |       113         77 |       190 
        Massachusetts |       102         14 |       116 
             Michigan |       501        112 |       613 
            Minnesota |       583         42 |       625 
          Mississippi |       559         21 |       580 
             Missouri |       784         35 |       819 
              Montana |       394          0 |       394 
             Nebraska |       636         21 |       657 
               Nevada |       109         14 |       123 
        New Hampshire |        70          0 |        70 
           New Jersey |        62        119 |       181 
           New Mexico |       221         14 |       235 
             New York |       336        140 |       476 
       North Carolina |       610        126 |       736 
         North Dakota |       366          7 |       373 
                 Ohio |       525        133 |       658 
             Oklahoma |       526         21 |       547 
               Oregon |       219         49 |       268 
         Pennsylvania |       369        140 |       509 
         Rhode Island |        20         21 |        41 
       South Carolina |       331          7 |       338 
         South Dakota |       462          0 |       462 
            Tennessee |       638         49 |       687 
                Texas |     1,581        266 |     1,847 
                 Utah |       178         35 |       213 
              Vermont |       100          0 |       100 
             Virginia |       531         63 |       594 
           Washington |       230         63 |       293 
        West Virginia |       387          0 |       387 
            Wisconsin |       439         91 |       530 
              Wyoming |       163          0 |       163 
----------------------+----------------------+----------
                Total |    19,704      2,723 |    22,427 

.         
. ** Define treated state 
. gen multnomah = state_fips == 41 & county_fips == 51

. label var multnomah "Indicator for Multnomah County, Oregon"    

. 
. ** Define treatment indicator 
. gen Treated = multnomah == 1 & year > 2020

. label var Treated "Treatment indicator for Multnomah County, Oregon"    

. 
. ** Define sample 1: All counties 
. gen sample_all = 1 

. label var sample_all "All counties (excluding AK, CA, HI OR, WA)"

. 
. ** Define sample 2: Counties in top 95 percent 
. summ percent_urban if year == 2020, de 

            Percent of population in urban areas
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs               3,079
25%            0              0       Sum of wgt.       3,079

50%     .3256337                      Mean           .3521437
                        Largest       Std. dev.       .332065
75%     .6326353              1
90%      .847923              1       Variance       .1102672
95%     .9372299              1       Skewness       .3661052
99%     .9972304              1       Kurtosis       1.763629

. local cutoff = r(p95) 

. tab state_name multnomah if percent_urban >= `cutoff' & year == 2020

                      |     Indicator for
                      |   Multnomah County,
                      |        Oregon
           State name |         0          1 |     Total
----------------------+----------------------+----------
               Alaska |         1          0 |         1 
              Arizona |         1          0 |         1 
           California |        15          0 |        15 
             Colorado |         4          0 |         4 
             Delaware |         1          0 |         1 
 District of Columbia |         1          0 |         1 
              Florida |        13          0 |        13 
              Georgia |         8          0 |         8 
               Hawaii |         1          0 |         1 
                Idaho |         1          0 |         1 
             Illinois |         5          0 |         5 
              Indiana |         3          0 |         3 
                 Iowa |         1          0 |         1 
               Kansas |         2          0 |         2 
             Kentucky |         2          0 |         2 
            Louisiana |         3          0 |         3 
             Maryland |         3          0 |         3 
        Massachusetts |         5          0 |         5 
             Michigan |         3          0 |         3 
            Minnesota |         3          0 |         3 
             Missouri |         4          0 |         4 
             Nebraska |         2          0 |         2 
               Nevada |         3          0 |         3 
           New Jersey |        10          0 |        10 
           New Mexico |         2          0 |         2 
             New York |         9          0 |         9 
       North Carolina |         4          0 |         4 
                 Ohio |         6          0 |         6 
             Oklahoma |         1          0 |         1 
               Oregon |         1          1 |         2 
         Pennsylvania |         4          0 |         4 
         Rhode Island |         2          0 |         2 
            Tennessee |         2          0 |         2 
                Texas |        11          0 |        11 
                 Utah |         4          0 |         4 
             Virginia |        10          0 |        10 
           Washington |         1          0 |         1 
            Wisconsin |         1          0 |         1 
----------------------+----------------------+----------
                Total |       153          1 |       154 

. gen sample_urban95 = percent_urban >= `cutoff' // All counties 

. label var sample_urban95 "Urban counties (top 5%) (excluding AK, CA, HI OR, WA)"

. tab sample_urban95 if year == 2020

      Urban |
   counties |
   (top 5%) |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,925       95.00       95.00
          1 |        154        5.00      100.00
------------+-----------------------------------
      Total |      3,079      100.00

. 
. ** Define sample 3: Counties in top 98 percent 
. local cutoff = .9864539 //

. tab state_name multnomah if percent_urban >= `cutoff' & year == 2020

                      |     Indicator for
                      |   Multnomah County,
                      |        Oregon
           State name |         0          1 |     Total
----------------------+----------------------+----------
           California |         6          0 |         6 
             Colorado |         2          0 |         2 
 District of Columbia |         1          0 |         1 
              Florida |         4          0 |         4 
              Georgia |         5          0 |         5 
             Illinois |         2          0 |         2 
              Indiana |         1          0 |         1 
            Louisiana |         1          0 |         1 
             Maryland |         1          0 |         1 
        Massachusetts |         1          0 |         1 
             Michigan |         1          0 |         1 
            Minnesota |         1          0 |         1 
             Missouri |         1          0 |         1 
               Nevada |         1          0 |         1 
           New Jersey |         6          0 |         6 
             New York |         7          0 |         7 
       North Carolina |         1          0 |         1 
                 Ohio |         1          0 |         1 
               Oregon |         0          1 |         1 
         Pennsylvania |         2          0 |         2 
         Rhode Island |         1          0 |         1 
                Texas |         3          0 |         3 
                 Utah |         2          0 |         2 
             Virginia |         8          0 |         8 
            Wisconsin |         1          0 |         1 
----------------------+----------------------+----------
                Total |        60          1 |        61 

. gen sample_urban98 = percent_urban >= `cutoff' // All counties 

. label var sample_urban98 "Urban counties (top 1%) (excluding AK, CA, HI OR, WA)"

. tab sample_urban98 if year == 2020

      Urban |
   counties |
   (top 1%) |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,018       98.02       98.02
          1 |         61        1.98      100.00
------------+-----------------------------------
      Total |      3,079      100.00

. 
. ** Define Sample of States      
. drop if state_name == "Alaska"
(198 observations deleted)

. drop if state_name == "Hawaii"
(25 observations deleted)

. drop if state_name == "California"
(474 observations deleted)

. drop if state_name == "Washington"
(293 observations deleted)

. drop if state_name == "Oregon" & multnomah == 0
(259 observations deleted)

. 
. ** Define sample 4: Counties in top 95 + covid 
. cluster kmeans cases_cum* deaths_cum* if        ///
>         sample_urban95 == 1 & year == 2020 & covid_merge == 3 , k(5) gen(kmean)
cluster name: _clus_1

. bysort fips: egen kmean_group = mean(kmean)
(20,046 missing values generated)

. 
. ** Pull out kmeans cluster with Multnoma
. gen tmp1 = kmean if sample_urban95 == 1 & year == 2020 & covid_merge == 3 & multnomah == 1 
(21,177 missing values generated)

. egen tmp2 = mean(tmp1)

. gen sample_urban95_covid = sample_urban95 == 1 & kmean_group == tmp2

. drop tmp1 tmp2 

. label var sample_urban95_covid "Urban counties (top 5%) w. Kmean Covid Match  (excluding AK, CA,
>  HI OR, WA)"

. tab sample_urban95_covid if year == 2020

      Urban |
   counties |
(top 5%) w. |
Kmean Covid |
      Match |
 (excluding |
 AK, CA, HI |
    OR, WA) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      2,879       98.73       98.73
          1 |         37        1.27      100.00
------------+-----------------------------------
      Total |      2,916      100.00

. 
. ** Show results across clusters 
. preserve 

. 
. ** Keep required variables 
. keep if sample_urban95 == 1 & year == 2020 & covid_merge == 3
(21,048 observations deleted)

. keep kmean cases_cum* deaths_cum* population

. collapse (mean) cases_cum* deaths_cum* [fw = population], by(kmean)

. reshape long cases_cum deaths_cum, i(kmean) j(time)
(j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations                5   ->   145         
Number of variables                  59   ->   4           
j variable (29 values)                    ->   time
xij variables:
  cases_cum1 cases_cum2 ... cases_cum29   ->   cases_cum
deaths_cum1 deaths_cum2 ... deaths_cum29  ->   deaths_cum
-----------------------------------------------------------------------------

. xtset kmean time 

Panel variable: kmean (strongly balanced)
 Time variable: time, 1 to 29
         Delta: 1 unit

. xtline cases_cum 

. graph export "${results}sdid/fig_kmeans.jpg", as(jpg) name("Graph") quality(100) replace        
>         
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/fig_kmeans.jpg written in J
> PEG format

. clear  

. 
. ** Restore      
. restore 

. 
. ** Define covariates 
. local covariates "population per_capita_income"

. 
. ** Standardize covariates 
. foreach v of local covariates {
  2.         egen tmp_v = std(`v') 
  3.         replace `v' = tmp_v
  4.         drop tmp_v
  5. } // END COVAR LOOP 
(21,178 real changes made)
(21,178 real changes made)

. 
. ** Define outcome variables (IRS)
. foreach x in "n1" "n2" "agi" {
  2.         
.         if "`x'" == "n1" local xtxt "returns"
  3.         else if "`x'" == "n2" local xtxt "exemptions"
  4.         else if "`x'" == "agi" local xtxt "AGI"
  5.         
.         ** Loop over migration type 
.         foreach y in "net" "in" "out" {
  6.                 
.                         if "`y'" == "net" local ytxt "Net domestic migration"
  7.                         else if "`y'" == "in" local ytxt "Domestic in-migration"
  8.                         else if "`y'" == "out" local ytxt "Domestic out-migration"
  9.                 
.                         ** Generate
.                         gen `x'_`y'_rate_irs = 100 * (`x'_`y'_3 / (`x'_out_1 + `x'_out_2))
 10. 
.                         ** Label var 
.                         label var `x'_`y'_rate_irs      "`ytxt' rate, `xtxt' (%)"
 11.                         
.         } // END MIGRATION TYPE LOOP 
 12.         
. } // END OUTCOME TYPE LOOP 
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)
(766 missing values generated)

. 
. ** Define outcome variables (ACS)
. 
. ** Rename for loop 
. rename acs*_households_* acs*_n1_*

. rename acs*_persons_* acs*_n2_*

. rename acs*_dollars_* acs*_agi_*

. 
. ** Loop over sample 
. ** (18+ = 1, college degree == 2, no college degree == 3)
. forvalues i = 1/2{
  2.         
.         if `i' == 1 local itxt ""
  3.         else if `i' == 2 local itxt " (College)"
  4.         else if `i' == 3 local itxt " (No College)"
  5.         
. 
.         ** Define outcome variables (IRS)
.         foreach x in "n1" "n2" "agi" {
  6.                 
.                 if "`x'" == "n1" local xtxt "HHs"
  7.                 else if "`x'" == "n2" local xtxt "persons"
  8.                 else if "`x'" == "agi" local xtxt "total income"
  9.         
.                 
.                 ** Loop over migration type 
.                 foreach y in "net" "in" "out" {
 10.                         
.                                 if "`y'" == "net" local ytxt "Net domestic migration"
 11.                                 else if "`y'" == "in" local ytxt "Domestic in-migration"
 12.                                 else if "`y'" == "out" local ytxt "Domestic out-migration"
 13.                         
.                                 ** Generate
.                                 gen `x'_`y'_rate_acs`i' = 100 * (acs`i'_`x'_`y'_3 / (acs`i'_`x'_
> out_1 + acs`i'_`x'_out_2))
 14. 
.                                 ** Label var 
.                                 label var `x'_`y'_rate_acs`i' "`ytxt' rate, `xtxt'`itxt' (%)"
 15.                                 
.                 } // END MIGRATION TYPE LOOP 
 16.                 
.         } // END OUTCOME TYPE LOOP 
 17.         
. } // END SAMPLE LOOP 
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)
(17,815 missing values generated)

. 
. ** Declare panel
. xtset fips year 

Panel variable: fips (unbalanced)
 Time variable: year, 2016 to 2024
         Delta: 1 unit

. 
. ** Tag unique fips 
. egen unique = tag(fips)

. tab year unique

  Tax year |
     (year |
    before |       tag(fips)
     move) |         0          1 |     Total
-----------+----------------------+----------
      2016 |         0      2,916 |     2,916 
      2017 |     2,916          0 |     2,916 
      2018 |     2,916          0 |     2,916 
      2019 |     2,916          0 |     2,916 
      2020 |     2,916          0 |     2,916 
      2021 |     2,916          0 |     2,916 
      2022 |     2,916          0 |     2,916 
      2023 |       383          0 |       383 
      2024 |       383          0 |       383 
-----------+----------------------+----------
     Total |    18,262      2,916 |    21,178 

. 
. ** Label var 
. label var year "Year (destination)"

. 
. ** Before your loops, set up weights dataset
. preserve

. clear

. set obs 0
Number of observations (_N) was 0, now 0.

. gen fips = .

. gen weight = .

. gen sample_data = ""

. gen out = ""

. gen sample = ""

. gen controls = .

. gen exclusion = .

. save "${results}sdid/sdid_weights.dta", replace
(dataset contains 0 observations)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_weights.dta saved

. clear

. restore

. 
. ** Set up treatment effects dataset
. preserve

. clear

. set obs 0
Number of observations (_N) was 0, now 0.

. gen sample_data = ""

. gen sample = ""

. gen outcome = ""

. gen controls = .

. gen exclusion = .

. gen tau = .

. gen se = .

. gen pval = .

. gen ci_lower = .

. gen ci_upper = .

. gen n_counties = .

. gen pre_mean = .

. save "${results}sdid/sdid_results.dta", replace
(dataset contains 0 observations)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_results.dta saved

. clear

. restore 

. 
. ** Loop over IRS and ACS Samples  
. foreach data of varlist irs_sample_1 irs_sample_2 acs_period_1 acs_period_2  {
  2. 
.         ** Different sets of outcome variables 
.         if "`data'" == "irs_sample_1" local out_type "irs"
  3.         else if "`data'" == "irs_sample_2" local out_type "irs"
  4.         else local out_type "acs1 acs2"
  5. 
.         ** Loop over Outcome var type 
.         foreach type of local out_type {
  6.                 
.                 ** Labels 
.                 if "`data'" == "irs_sample_1" local out_txt "irs_full_16_22"
  7.                 if "`data'" == "irs_sample_2" local out_txt "irs_389_16_22"
  8.                 else if "`data'" == "acs_period_1" & "`type'" == "acs1" local out_txt "acs_16
> _22_all"
  9.                 else if "`data'" == "acs_period_1" & "`type'" == "acs2" local out_txt "acs_16
> _22_col"
 10.                 else if "`data'" == "acs_period_1" & "`type'" == "acs3" local out_txt "acs_16
> _22_noc"
 11.                 else if "`data'" == "acs_period_1" & "`type'" == "acs4" local out_txt "acs_16
> _22_3D"
 12.                 else if "`data'" == "acs_period_2" & "`type'" == "acs1" local out_txt "acs_16
> _24_all"
 13.                 else if "`data'" == "acs_period_2" & "`type'" == "acs2" local out_txt "acs_16
> _24_col"
 14.                 else if "`data'" == "acs_period_2" & "`type'" == "acs3" local out_txt "acs_16
> _24_noc"
 15.                 else if "`data'" == "acs_period_2" & "`type'" == "acs4" local out_txt "acs_16
> _24_3D"
 16. 
.                 ** Check if subfolder exists, create if not
.                 capture mkdir "${results}sdid/`out_txt'"
 17. 
.                 ** Loop over samples
.                 foreach samp of varlist sample_all sample_urban95 sample_urban95_covid {        
 18.                         
.                         ** Loop over exclusion of 2019-2020 period 
.                         forvalues exl = 1(-1)0 {
 19.                                 
.                                 ** Define sample        
.                                 gen sample = `samp' == 1 & `data' == 1 
 20.                                 if `exl' == 1 replace sample = 0 if year == 2020 
 21.                                 
.                                 ** Clear stored values 
.                                 eststo clear 
 22.                                 
.                                 ** Loop over migration type 
.                                 foreach migr in "net" "in" "out" {
 23.                                         
.                                         ** Loop over outcomes 
.                                         foreach out of varlist  n1_`migr'_rate_`type'   ///
>                                                                                         n2_`migr
> '_rate_`type'   ///
>                                                                                         agi_`mig
> r'_rate_`type' {
 24.                                         
.                                                 ** Store label 
.                                                 local label : variable label `out'
 25.                                                 
.                                                 ** Loop over inclusion of covariates
.                                                 forvalues c = 0/1 {
 26.                                                 
.                                                         ** Covariates
.                                                         if `c' == 0 local covars ""
 27.                                                         else if `c' == 1 local covars "covari
> ates(`covariates', projected)"
 28. 
.                                                         ** Covariates for sdid_event (doesn't su
> pport 'projected' option)
.                                                         if `c' == 0 local covars_event ""
 29.                                                         else if `c' == 1 local covars_event "
> covariates(`covariates')"
 30.                                                         
.                                                         ** File Name 
.                                                         if `exl' == 0 local path "${results}sdid
> /`out_txt'/fig_`out_txt'_`out'_`c'_`samp'_"
 31.                                                         if `exl' == 1 local path "${results}s
> did/`out_txt'/fig_`out_txt'_`out'_`c'_`samp'_excl2020_"
 32.                 
.                                                         
.                                                         ** Run SDID
.                                                         eststo sdid_`out'_`c': sdid `out' fips y
> ear Treated     ///
>                                                                 if sample == 1,                 
>         ///
>                                                                 vce(placebo)                    
>         ///
>                                                                 `covars'                        
>                 ///
>                                                                 reps(`reps')                    
>         ///
>                                                                 graph graph_export("`path'", .pd
> f)
 33. 
.                                                         ** Store model output 
.                                                         local tmp_tau = e(ATT)
 34.                                                         local tmp_se = e(se)
 35.                                                         matrix omega = e(omega)
 36.                                                         
.                                                         ** Store pre-treatment means and county 
> counts 
.                                                         qui summ `out' if multnomah == 1 & Treat
> ed == 0
 37.                                                         local tmp_premean = r(mean)
 38.                                                         estadd scalar mean = r(mean)
 39.                                                         
.                                                         qui summ `out' if year == 2021 & sample 
> == 1
 40.                                                         local tmp_ncounties = r(N)
 41.                                                         estadd scalar count = r(N)      
 42.                                                         
.                                                         ** Preserve ATE / SE 
.                                                         preserve
 43.                                                         clear
 44.                                                         qui set obs 1
 45.                                                         gen sample_data = "`out_txt'"
 46.                                                         gen sample = "`samp'"
 47.                                                         gen outcome = "`out'"
 48.                                                         gen controls = `c'
 49.                                                         gen exclusion = `exl'
 50.                                                         gen tau = `tmp_tau'
 51.                                                         gen se = `tmp_se'
 52.                                                         gen pval = 2 * (1 - normal(abs(tau/se
> )))
 53.                                                         gen ci_lower = tau - 1.96 * se
 54.                                                         gen ci_upper = tau + 1.96 * se
 55.                                                         gen n_counties = `tmp_ncounties'
 56.                                                         gen pre_mean = `tmp_premean'
 57.                                                         order sample_data sample outcome cont
> rols exclusion     ///
>                                                                 tau se pval ci_lower ci_upper n_
> counties pre_mean
 58.                                                         append using "${results}sdid/sdid_res
> ults.dta"
 59.                                                         compress
 60.                                                         save "${results}sdid/sdid_results.dta
> ", replace
 61.                                                         clear
 62.                                                         restore
 63.                                                         
.                                                         ** Store weights
.                                                         preserve
 64.                                                         clear
 65.                                                         svmat double omega, names(col)
 66.                                                         rename c2 fips
 67.                                                         rename c1 weight
 68.                                                         gen sample_data = "`out_txt'"
 69.                                                         gen out = "`out'"
 70.                                                         gen sample = "`samp'"
 71.                                                         gen controls = `c'
 72.                                                         gen exclusion = `exl'
 73.                                                         drop if weight == 0
 74.                                                         drop if missing(fips )
 75.                                                         order sample_data sample out controls
>  exclusion fips weight
 76.                                                         sort weight
 77.                                                         append using "${results}sdid/sdid_wei
> ghts.dta"
 78.                                                         compress
 79.                                                         save "${results}sdid/sdid_weights.dta
> ", replace
 80.                                                         clear 
 81.                                                         restore 
 82.                                                         
.                                                         ** Run event-study
.                                                         sdid_event `out' fips year Treated      
>                 ///
>                                                                 if sample == 1,                 
>                         ///
>                                                                 `covars_event'                  
>                         ///
>                                                                 vce(placebo)                    
>                         ///
>                                                                 brep(`reps')                    
>                         ///
>                                                                 placebo(all)
 83. 
.                                                         ** Clean up sdid_event internal variable
> s
.                                                         capture drop ever_treated*
 84.                                                         
.                                                         ** Create Figure
. 
.                                                         ** Store max year
.                                                         qui summ year if multnomah == 1 & sample
>  == 1
 85.                                                         local max_yr = r(max)
 86.                                                         dis "`max_yr'"
 87. 
.                                                         ** Move results from matrix to data
.                                                         qui count if multnomah == 1 & sample == 
> 1
 88.                                                         local ct = r(N)
 89.                                                         local ct = `ct' + 1
 90.                                                         matrix list e(H)
 91.                                                         mat res = e(H)[2..`ct',1..5]
 92. 
.                                                         ** Preserve data before plotting (expand
>  creates duplicate obs)
.                                                         preserve
 93. 
.                                                         ** Move Matrix results to data
.                                                         svmat res
 94. 
.                                                         ** Generate ID variable
.                                                         gen id = `max_yr' - _n + 1 if !missing(r
> es1)
 95. 
.                                                         ** Update labeling for exclusion of 2020
.                                                         if `exl' == 1 {
 96.                                                                 replace id = id - 1 if id <= 
> 2020
 97.                                                                 expand 2 if id == 2019, gen(t
> ag)
 98.                                                                 replace id = 2020 if tag == 1
 99.                                                                 replace res1 = . if tag == 1
100.                                                                 replace res3 = . if tag == 1
101.                                                                 replace res4 = . if tag == 1
102.                                                         }
103.                                                         label var id "Year (destination)"
104. 
.                                                         ** Sort
.                                                         sort id
105. 
.                                                         ** Plot
.                                                         twoway  (rcap res3 res4 id, lc(gs10) fc(
> gs11%50))       ///
>                                                                         (scatter res1 id, mc(bla
> ck)),                           ///
>                                                                 legend(off) ytitle("`label'")   
>                                 ///
>                                                                 yline(0, lc(red) lp(-))         
>                                         ///
>                                                                 xline(2020.5, lc(black) lp(solid
> ))                              ///
>                                                                 ylabel(-10(2.5)10, format(%9.1f)
> )
106. 
.                                                         if `exl' == 0 local path "${results}sdid
> /`out_txt'/fig_`out_txt'_`out'_`c'_`samp'_eventstudy.jpg"
107.                                                         if `exl' == 1 local path "${results}s
> did/`out_txt'/fig_`out_txt'_`out'_`c'_`samp'_excl2020_eventstudy.jpg"
108. 
.                                                         graph export "`path'",  ///
>                                                                 as(jpg) name("Graph") quality(10
> 0) replace
109. 
.                                                         ** Restore data (removes expanded rows a
> nd temp variables)
.                                                         restore 
110.                                                                                         
.                                                 } // END COVAR LOOP 
111.                                         
.                                         } // END OUTCOME LOOP 
112.                                         
.                                         ** Determine name
.                                         if `exl' == 0 local path "${results}sdid/`out_txt'/tab_s
> did_`out_txt'_`migr'_`samp'.tex"
113.                                         if `exl' == 1 local path "${results}sdid/`out_txt'/ta
> b_sdid_`out_txt'_`migr'_`samp'_excl2020.tex"
114.                                         
. 
.                                         ** Table of results 
.                                         if "`data'" == "irs_sample1" |  "`data'" == "irs_sample2
> " |  {
115.                                         
.                                         esttab  sdid_n1_`migr'_rate_`type'_0 sdid_n1_`migr'_rate
> _`type'_1       ///
>                                                         sdid_n2_`migr'_rate_`type'_0 sdid_n2_`mi
> gr'_rate_`type'_1       ///
>                                                         sdid_agi_`migr'_rate_`type'_0 sdid_agi_`
> migr'_rate_`type'_1 ///
>                                                 using "`path'",                                 
>                         ///
>                                         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                
> ///
>                                         b(%-9.3f) se(%-9.3f) replace                            
>         ///
>                                         mgroups("Returns" "Exemptions" "AGI",                   
> ///
>                                                 pattern(1 0 1 0 1 0) )                          
>                 ///
>                                         mtitle( "No Covariates" "Covariates"                    
> ///
>                                                         "No Covariates" "Covariates"            
>         ///
>                                                         "No Covariates" "Covariates")           
>         ///
>                                         stats(count mean,                                       
>                         ///
>                                                 fmt(%9.0fc %9.3fc)                              
>                         ///
>                                                 labels("Number of Counties" "Pre-treatment mean"
> ))
116.                                         }
117.                                         else {
118.                                         esttab  sdid_n1_`migr'_rate_`type'_0 sdid_n1_`migr'_r
> ate_`type'_1       ///
>                                                         sdid_n2_`migr'_rate_`type'_0 sdid_n2_`mi
> gr'_rate_`type'_1       ///
>                                                         sdid_agi_`migr'_rate_`type'_0 sdid_agi_`
> migr'_rate_`type'_1 ///
>                                                 using "`path'",                                 
>                         ///
>                                         starlevel("*" 0.10 "**" 0.05 "***" 0.01)                
> ///
>                                         b(%-9.3f) se(%-9.3f) replace                            
>         ///
>                                         mgroups("Households" "Adults" "Household Income",       
> ///
>                                                 pattern(1 0 1 0 1 0) )                          
>                 ///
>                                         mtitle( "No Covariates" "Covariates"                    
> ///
>                                                         "No Covariates" "Covariates"            
>         ///
>                                                         "No Covariates" "Covariates")           
>         ///
>                                         stats(count mean,                                       
>                         ///
>                                                 fmt(%9.0fc %9.3fc)                              
>                         ///
>                                                 labels("Number of Counties" "Pre-treatment mean"
> ))
119.                                                 
.                                         }
120. 
.                                 
.                                 } // END MIGRATION TYPE LOOP 
121.                                 
.                                 ** Drop sample var 
.                                 drop sample 
122.                                 
.                         } // END EXCLUSION LOOP 
123.                         
.                 } // END SAMPLE LOOP 
124.         
.         } // END OUT TYPE 
125.         
. } // END DATA LOOP 
(2,916 real changes made)
Placebo replications (100). This may take some time.
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5
..................................................     50
..................................................     100


Synthetic Difference-in-Differences Estimator

-----------------------------------------------------------------------------
n1_net_rat~s |     ATT     Std. Err.     t      P>|t|    [95% Conf. Interval]
-------------+---------------------------------------------------------------
     Treated |  -1.92529    0.86615    -2.22    0.026    -3.62290    -0.22767
-----------------------------------------------------------------------------
95% CIs and p-values are based on large-sample approximations.
Refer to Arkhangelsky et al., (2021) for theoretical derivations.
file
    C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_ful
    > l_16_22_n1_net_rate_irs_0_sample_all_excl2020_trends2021.pdf saved as PDF format

added scalar:
               e(mean) =  .1434552

added scalar:
              e(count) =  2916
  variable controls was float now byte
  variable exclusion was float now byte
  variable n_counties was float now int
  (8 bytes saved)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_results.dta saved
number of observations will be reset to 2916
Press any key to continue, or Break to abort
Number of observations (_N) was 0, now 2,916.
(1,160 observations deleted)
(1 observation deleted)
  variable controls was float now byte
  variable exclusion was float now byte
  variable fips was double now long
  (17,550 bytes saved)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/sdid_weights.dta saved
Synthetic Difference-in-differences

Boostrap replications (100), placebo mode.
|0% ----------------------------------------- 100%|
|.................................................|


             |  Estimate         SE      LB CI      UB CI  Switchers 
-------------+------------------------------------------------------
         ATT | -1.925286   .9956241   -3.87671   .0261371          1 
    Effect_1 | -2.430048   1.243754  -4.867806   .0077105          1 
    Effect_2 | -1.420525   .9564732  -3.295212   .4541626          1 
   Placebo_1 |  .0018158   .0069485  -.0118033    .015435          1 
   Placebo_2 | -.0017198   .0189576  -.0388767   .0354371          1 
   Placebo_3 | -.0060693    .014383  -.0342599   .0221213          1 
   Placebo_4 |  .0088023   .0079215  -.0067238   .0243284          1 
2022

e(H)[7,5]
             Estimate          SE       LB CI       UB CI   Switchers
      ATT  -1.9252863   .99562414  -3.8767096   .02613705           1
 Effect_1  -2.4300477   1.2437542   -4.867806   .00771051           1
 Effect_2  -1.4205248   .95647317  -3.2952122   .45416261           1
Placebo_1   .00181583   .00694853  -.01180328   .01543495           1
Placebo_2  -.00171981    .0189576  -.03887671   .03543709           1
Placebo_3  -.00606931   .01438297  -.03425994   .02212132           1
Placebo_4   .00880226   .00792147  -.00672383   .02432835           1
(21,172 missing values generated)
(4 real changes made)
(1 observation created)
(1 real change made)
(1 real change made, 1 to missing)
(1 real change made, 1 to missing)
(1 real change made, 1 to missing)
(file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_ful
> l_16_22_n1_net_rate_irs_0_sample_all_excl2020_eventstudy.jpg not found)
file C:/Users/ji252/Documents/GitHub/multnomah-county-tax/results/sdid/irs_full_16_22/fig_irs_full
> _16_22_n1_net_rate_irs_0_sample_all_excl2020_eventstudy.jpg written in JPEG format
Placebo replications (100). This may take some time.
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5
.................................--Break--
r(1);

end of do-file
--Break--
r(1);

end of do-file

--Break--
r(1);

. exit, clear
